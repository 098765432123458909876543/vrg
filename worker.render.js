/*!
 * bowser@2.11.0 (MIT)
 *   author: Dustin Diaz <dustin@dustindiaz.com> (http://dustindiaz.com)
 *   url: git+https://github.com/lancedikson/bowser.git
 *   contributors:
 *     Denis Demchenko (http://twitter.com/lancedikson)
 *
 *   Copyright 2015, Dustin Diaz (the "Original Author")
 *   All rights reserved.
 *
 *   MIT License
 *
 *   Permission is hereby granted, free of charge, to any person
 *   obtaining a copy of this software and associated documentation
 *   files (the "Software"), to deal in the Software without
 *   restriction, including without limitation the rights to use,
 *   copy, modify, merge, publish, distribute, sublicense, and/or sell
 *   copies of the Software, and to permit persons to whom the
 *   Software is furnished to do so, subject to the following
 *   conditions:
 *
 *   The above copyright notice and this permission notice shall be
 *   included in all copies or substantial portions of the Software.
 *
 *   Distributions of all or part of the Software intended to be used
 *   by the recipients as they would use the unmodified Software,
 *   containing modifications that substantially alter, remove, or
 *   disable functionality of the Software, outside of the documented
 *   configuration mechanisms provided by the Software, shall be
 *   modified such that the Original Author's bug reporting email
 *   addresses and urls are either replaced with the contact information
 *   of the parties responsible for the changes, or removed entirely.
 *
 *   THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 *   EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
 *   OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 *   NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
 *   HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
 *   WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
 *   FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
 *   OTHER DEALINGS IN THE SOFTWARE.
 *
 *
 *   Except where noted, this license applies to any and all software
 *   programs and associated documentation files created by the
 *   Original Author, when distributed with the Software.
 *
 *
 *
 * fast-copy@2.1.3 (MIT)
 *   author: tony_quetano@planttheidea.com
 *   url: git+https://github.com/planttheidea/fast-copy.git
 *   contributors:
 *     Dariusz Rzepka <rzepkadarek@gmail.com>
 *
 *   MIT License
 *
 *   Copyright (c) 2018 Tony Quetano
 *
 *   Permission is hereby granted, free of charge, to any person obtaining a copy
 *   of this software and associated documentation files (the "Software"), to deal
 *   in the Software without restriction, including without limitation the rights
 *   to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 *   copies of the Software, and to permit persons to whom the Software is
 *   furnished to do so, subject to the following conditions:
 *
 *   The above copyright notice and this permission notice shall be included in all
 *   copies or substantial portions of the Software.
 *
 *   THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 *   IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 *   FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 *   AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 *   LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 *   OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 *   SOFTWARE.
 *
 *
 *
 * is-electron@2.2.1 (MIT)
 *   author: Cheton Wu <cheton@gmail.com>
 *   url: git@github.com:cheton/is-electron.git
 *
 *   The MIT License (MIT)
 *
 *   Copyright (c) 2016-2018 Cheton Wu
 *
 *   Permission is hereby granted, free of charge, to any person obtaining a copy
 *   of this software and associated documentation files (the "Software"), to deal
 *   in the Software without restriction, including without limitation the rights
 *   to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 *   copies of the Software, and to permit persons to whom the Software is
 *   furnished to do so, subject to the following conditions:
 *
 *   The above copyright notice and this permission notice shall be included in all
 *   copies or substantial portions of the Software.
 *
 *   THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 *   IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 *   FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 *   AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 *   LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 *   OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 *   SOFTWARE.
 *
 *
 *
 * is-mobile@3.1.1 (MIT)
 *   author: Julian Gruber (http://juliangruber.com)
 *   url: git://github.com/juliangruber/is-mobile.git
 *
 *
 */
/*! For license information please see worker.render.js.LICENSE.txt */
(()=>{var t,e,n,r,i,o,s={2554:(t,e,n)=>{"use strict";n.a(t,(async(t,r)=>{try{n.d(e,{P:()=>h});var i=n(1141),o=n(46),s=n(5227),a=n(8355),l=n(1321),c=n(3484),d=n(3390),u=t([i,o]);[i,o]=u.then?(await u)():u;class h extends i.CP{constructor(t,e,n,r){super("crt",s.Z,{color:d.Z,filter:a.Z,crt:l.Z,blur:c.Z},e),this.isBegin=!1,this.renderers=t,this.imageCanvas=n,this.setting=r}begin(){this.isBegin=!0,this.imageCanvas=(0,o.vL)(0,0)}getScreens(){return Object.values(this.renderers).map((t=>t.getScreen()))}rendering(){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.getScreen().getContext("webgl2");const e=this.getScreen();if(this.isBegin){const t=Math.floor(e.width/this.setting.getCRTSubPixel()),n=Math.floor(e.height/this.setting.getCRTSubPixel());this.imageCanvas.width!==t&&(this.imageCanvas.width=t),this.imageCanvas.height!==n&&(this.imageCanvas.height=n);const r=this.imageCanvas.getContext("2d");if(null===r)return!1;this.getScreens().forEach((t=>{null!==r&&0!==t.width&&0!==t.height&&r.drawImage(t,0,0,r.canvas.width,r.canvas.height)}))}return t=t||e.getContext("webgl2"),null!==t&&t instanceof WebGL2RenderingContext&&this.renderingGL(t,{color:{width:t.canvas.width,height:t.canvas.height},filter:{width:t.canvas.width,height:t.canvas.height},crt:{width:t.canvas.width,height:t.canvas.height},blur:{width:t.canvas.width,height:t.canvas.height},bloom:{width:t.canvas.width,height:t.canvas.height}},{0:{format:4,data:this.imageCanvas,width:this.imageCanvas.width,height:this.imageCanvas.height,sync:!0},1:{attachment:{crt:0},format:4,mipmap:!0,min:"linear",mag:"linear",width:t.canvas.width,height:t.canvas.height,generateMipmap:!0,sync:!0}},{screen:{program:["color","filter"],unit:0},crt:{program:["blur"],unit:1},time:{type:"1f",value:[performance.now()/1e3]},contrast:{type:"1f",value:[this.setting.getContrast()]},brightness:{type:"1f",value:[this.setting.getBrightness()]},sub:{type:"2f",value:[t.canvas.width/this.imageCanvas.width,t.canvas.height/this.imageCanvas.height]},gamma:{type:"1f",value:[1.25]},lens:{type:"1f",value:[this.setting.getCRTLens()]},deep:{type:"1f",value:[this.setting.getCRTDeep()]},edge:{type:"1f",value:[this.setting.getCRTEdge()]},line:{type:"1f",value:[.5]},scanline:{type:"1f",value:[.25]},scanline_count:{type:"1f",value:[25]},scanline_speed:{type:"1f",value:[1]},disorder:{type:"1f",value:[0]},disorder_count:{type:"1f",value:[0]},vig:{type:"1f",value:[this.setting.getCRTVig()]},ca:{type:"1f",value:[5]},shadowMask:{type:"1i",value:[this.setting.hasCRTShadowMask()?1:0]},blink_force:{type:"1f",value:[.0125]},blink_time:{type:"1f",value:[1]}},this.setting.hasCRT()?["filter","crt","blur"]:["color"])}}r()}catch(t){r(t)}}))},8943:(t,e,n)=>{"use strict";n.d(e,{p:()=>ut});var r=n(5580),i=n(5666),o=n(1276);const s=new Map;function a(t,e){let n;const r=t.toLowerCase();switch(!0){case/^int[0-9]+$/.test(r):switch(r){case"int8":n=new Int8Array(e);break;case"int16":n=new Int16Array(e);break;case"int32":n=new Int32Array(e)}break;case/^uint[0-9]+$/.test(r):switch(r){case"uint8":n=new Uint8Array(e);break;case"uint16":n=new Uint16Array(e);break;case"uint32":n=new Uint32Array(e)}break;case"uint8clamped"===r:n=new Uint8ClampedArray(e);break;case/^float[0-9]+$/.test(r):switch(r){case"float32":n=new Float32Array(e);break;case"float64":n=new Float64Array(e)}}if(!n)throw new Error("Not found array type was ".concat(t));return n}function l(){return"SharedArrayBuffer"in self}function c(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=a(t,e).byteLength;return!n&&l()?new SharedArrayBuffer(r):new ArrayBuffer(r)}function d(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return a(t,c(t,e,n))}var u=n(2574);function h(t,e,n,r,i,s,a,l){if(t|=0,n|=0,i+l>(e|=0)&&i<e+1){const e=a/2;if((r+e>t||r-e<t+1)&&(s+e>n||s-e<n+1)){const i=t,a=n,l=t+1,c=n,d=t,u=n+1,h=t+1,f=n+1;return r<i&&s<a?(0,o.LW)(r,s,i,a)<e:r>l&&s<c?(0,o.LW)(r,s,l,c)<e:r<d&&s>u?(0,o.LW)(r,s,d,u)<e:!(r>h&&s>f)||(0,o.LW)(r,s,h,f)<e}}return!1}function f(t,e,n,r,i,s,a){const l=Math.max(0,Math.abs(t-r)-s/2),c=Math.max(0,Math.abs(e-i)-a/2);return(0,o.oK)(l,c,l,c)<=n*n}function g(t,e,n,r,i,s,a,l,c,d){const[u,h,f,g,m,p]=function(t,e,n,r,i,s,a,l,c,d){if(e<a+d&&e+i>a||a<e+i&&a+d>e){const[u,h,f,g]=function(t,e,n,r,i,s){let[a,l]=(0,o.xw)(t,e,r,i),c=Math.sqrt(a*a+l*l);let d=n/2+s/2-c;if(d<=0)return[0,0,0,0];c>0&&(c=1/c);return a*=c,l*=c,d/=2,[a*d,l*d,-a*d,-l*d]}(t,n,r,s,l,c),m=0!==u||0!==h||0!==f||0!==g?a-e>d/.5?e-(a+d):a-(e+i):0;return[u,m/2,h,f,-m/2,g]}return[0,0,0,0,0,0]}(t,e,n,r,i,s,a,l,c,d);return 0!==u||0!==h||0!==f||0!==g||0!==m||0!==p}const m=new Array;function p(t,e,n,r,i,o,s,a,l){return(t-r)*(s-r)+(e-i)*(a-i)+(n-o)*(l-o)}function v(t,e,n,r,i,s,a,l,c,d){let u=arguments.length>10&&void 0!==arguments[10]?arguments[10]:new o.P(0,0,0),h=arguments.length>11&&void 0!==arguments[11]?arguments[11]:new o.P(0,0,0);const f=r*r+i*i+s*s,g=r*(a-=t)+i*(l-=e)+s*(c-=n),m=a*a+l*l+c*c-d*d;if(0===f)return!1;let p=g*g-f*m;if(p<0)return!1;p=Math.sqrt(p);const v=(g-p)/f,b=(g+p)/f;return!(v<0||b<0)&&(u.x=t+v*r,u.y=e+v*i,u.z=n+v*s,h.x=t+b*r,h.y=e+b*i,h.z=n+b*s,!0)}function b(t,e,n,r,i,s,a,l,c,d,u,h,f){let g=arguments.length>13&&void 0!==arguments[13]?arguments[13]:new o.P(0,0,0),m=arguments.length>14&&void 0!==arguments[14]?arguments[14]:new o.P(0,0,0);const p=a-t,v=l-e,b=c-n,y=(d-=t)-p,x=(u-=e)-v,_=(h-=n)-b,w=r*r+i*i+s*s,E=y*r+x*i+_*s,O=p*r+v*i+b*s,R=y*y+x*x+_*_,S=p*y+v*x+b*_,T=p*p+v*v+b*b,L=f*f;if(0===R)return!1;const M=w-E*E/R,P=O-S*E/R,I=T-S*S/R-L;if(0===M)return!1;let B=P*P-M*I;if(B<0)return!1;B=Math.sqrt(B);const C=(P-B)/M,A=(P+B)/M;return g.x=t+C*r,g.y=e+C*i,g.z=n+C*s,m.x=t+A*r,m.y=e+A*i,m.z=n+A*s,!0}function y(t,e,n,r,i,s,a,l,c,d,u,h){const[f,g,m]=(0,o.tL)(r,i),y=new o.P(-1,-1,-1),x=new o.P(-1,-1,-1);d-=h/=2;let _=!1,w=!1,E=!1;if(1==v(t,e,n,f,g,m,s,a+=h,l,h,y,x)&&p(c,d,u,s,a,l,y.x,y.y,y.z)<=0)_=!0;else if(1==v(t,e,n,f,g,m,c,d,u,h,y,x)&&p(s,a,l,c,d,u,y.x,y.y,y.z)<=0)w=!0;else{if(!(1==b(t,e,n,f,g,m,s,a,l,c,d,u,h,y,x)&&p(s,a,l,c,d,u,y.x,y.y,y.z)>0&&p(c,d,u,s,a,l,y.x,y.y,y.z)>0))return[-1,-1,-1,-1,-1,-1];E=!0}const O=new o.P(0,0,0);return _&&p(c,d,u,s,a,l,x.x,x.y,x.z)<=0||w&&p(s,a,l,c,d,u,x.x,x.y,x.z)<=0||E&&p(s,a,l,c,d,u,x.x,x.y,x.z)>0&&p(c,d,u,s,a,l,x.x,x.y,x.z)>0||1==v(t,e,n,f,g,m,s,a,l,h,O,x)&&p(c,d,u,s,a,l,x.x,x.y,x.z)<=0||1==v(t,e,n,f,g,m,c,d,u,h,O,x)&&p(s,a,l,c,d,u,x.x,x.y,x.z)<=0||b(t,e,n,f,g,m,s,a,l,c,d,u,h,O,x),[y.x,y.y,y.z,x.x,x.y,x.z]}function x(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Math.floor;return isNaN(t)||t===1/0?e:-1===n?t:r(Math.abs(t)*n)/n*Math.sign(t)}function _(t,e,n){return isNaN(t)||isNaN(e)||isNaN(n)?0:t===1/0||e===1/0||n===1/0?1/0:t*(1-n)+e*n}const w=[[1,0,0],[0,0,1],[-1,0,0],[0,0,-1],[1,0,1],[-1,0,-1],[1,0,-1],[-1,0,1]],E=[[1,0,0],[-1,0,0],[0,1,0],[0,-1,0],[0,0,1],[0,0,-1],[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[0,1,1],[0,-1,1],[0,1,-1],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[1,-1,-1],[-1,1,1],[1,-1,1],[1,1,-1],[-1,-1,1],[1,-1,-1],[-1,1,-1],[-1,-1,-1],[1,1,1]];function O(t,e,n,r,i,o,s,a){return((0|i)*s*o+(0|r)*o+(0|n))*t+e}function R(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Array;const r=e/2,i=Math.floor(t-r),o=Math.ceil(t+r);if(!(i^o))return[i];for(let e=0|i,s=0|o;e<s;e=e+1|0){const i=e+.5,o=Math.abs(i-t);Math.sqrt(o*o)>r||n.push(e)}return n}function S(t,e,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Array;const i=n/2,o=Math.floor(t-i),s=Math.floor(e-i),a=Math.ceil(t+i),l=Math.ceil(e+i);if(o==a&&s===l)return[o,s];for(let i=0|o,c=0|a;i<c;i=i+1|0)for(let o=0|s,a=0|l;o<a;o=o+1|0)h(i,0,o,t,.5,e,n,0)&&r.push(i,o);return r}function T(t,e,n,r,i){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:new Array;const s=r/2,a=i,l=Math.floor(t-s),c=Math.floor(e),d=Math.floor(n-s),u=Math.ceil(t+s),f=Math.ceil(e+a),g=Math.ceil(n+s);if(l===u&&c===f&&d===g)return[l,c,d];for(let s=0|l,a=0|u;s<a;s=s+1|0)for(let a=0|d,l=0|g;a<l;a=a+1|0)for(let l=0|c,d=0|f;l<d;l=l+1|0)h(s,l,a,t,e,n,r,i)&&o.push(s,l,a);return o}function L(t,e,n,r,i,s,a,l){return function(t,e,n,r,i){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1/0,a=arguments.length>6?arguments[6]:void 0,l=arguments.length>7?arguments[7]:void 0;const[c,d,u]=(0,o.XC)(t,e);let h=1/c,f=1/d,g=1/u,m=Math.floor(n),p=Math.floor(r),v=Math.floor(i),b=0,y=0,x=0,_=0,w=0,E=0;h>0?(b=1,_=(m+1-n)*h):(h*=-1,b=-1,_=(n-m)*h),f>0?(y=1,w=(p+1-r)*f):(f*=-1,y=-1,w=(r-p)*f),g>0?(x=1,E=(v+1-i)*g):(g*=-1,x=-1,E=(i-v)*g);let O=_<w?_<E?_:E:w<E?w:E,R=_<w?_<E?0:2:w<E?1:2;do{const t=a(m,p,v,O,R,_,w,E,h,f,g,b,y,x);if(t){let e=n+O/h*b,o=r+O/f*y,s=i+O/g*x;switch(R){case 0:e=Math.round(e);break;case 1:o=Math.round(o);break;case 2:s=Math.round(s)}if(l&&l(m,p,v,e,o,s,t,O,R,_,w,E,h,f,g,b,y,x))break;return[e,o,s,O]}{const t=_<w?_<E?_:E:w<E?w:E;let e=n+t/h*b,o=r+t/f*y,s=i+t/g*x;switch(_<w?_<E?0:2:w<E?1:2){case 0:e=Math.round(e);break;case 1:o=Math.round(o);break;case 2:s=Math.round(s)}if(l&&l(m,p,v,e,o,s,!1,O,R,_,w,E,h,f,g,b,y,x))break}_<w?_<E?(m+=b,O=_,_+=h,R=0):(v+=x,O=E,E+=g,R=2):w<E?(p+=y,O=w,w+=f,R=1):(v+=x,O=E,E+=g,R=2)}while(O<s);return[-1,-1,-1,-1]}((0,o.B8)(t),(0,o.B8)(e),n,r,i,s,a,l)}function M(t,e,n,r,i,s,a){const l=(0,o.B8)(t),c=(0,o.B8)(e);return function(t,e,n,r,i){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1/0,a=arguments.length>6?arguments[6]:void 0;const[l,c,d]=(0,o.XC)(t,e),u=1/l,h=1/c,f=1/d,g=Math.sign(l),m=Math.sign(c),p=Math.sign(d),v=g*u,b=m*h,y=p*f,_=Math.abs(u),w=Math.abs(h),E=Math.abs(f);let O=Math.floor(n),R=Math.floor(r),S=Math.floor(i),T=1/l,L=1/c,M=1/d,P=0,I=0,B=0,C=0,A=0,k=0;T>0?(P=1,C=(O+1-n)*T):(T*=-1,P=-1,C=(n-O)*T),L>0?(I=1,A=(R+1-r)*L):(L*=-1,I=-1,A=(r-R)*L),M>0?(B=1,k=(S+1-i)*M):(M*=-1,B=-1,k=(i-S)*M);let D=C<A?C<k?C:k:A<k?A:k,F=C<A?C<k?0:2:A<k?1:2;do{const t=a(O,R,S);if(t<=0){let t=n+D/T*P,e=r+D/L*I,o=i+D/M*B;switch(F){case 0:t=Math.round(t);break;case 1:e=Math.round(e);break;case 2:o=Math.round(o)}return[t,e,o,D]}const e=Math.floor(x(Math.max(0,t-1)/_,0)),o=Math.floor(x(Math.max(0,t-1)/w,0)),s=Math.floor(x(Math.max(0,t-1)/E,0));C+=e*v,A+=o*b,k+=s*y,O+=e*g,R+=o*m,S+=s*p,C<A?C<k?(O+=P,D=C,C+=T,F=0):(S+=B,D=k,k+=M,F=2):A<k?(R+=I,D=A,A+=L,F=1):(S+=B,D=k,k+=M,F=2)}while(D<s);return[-1,-1,-1,-1]}(l<Number.EPSILON&&l>-Number.EPSILON?Number.EPSILON:l,c<Number.EPSILON&&c>-Number.EPSILON?-Number.EPSILON:c,n,r,i,s,a)}function P(t,e,n,r,i,o,s){let[a,l,c]=s;const d=0|e,u=0|n,h=0|r;if(null===t||d<0||d>=a||u<0||u>=l||h<0||h>=c)return-1;return t[O(o,i,d,u,h,a,l)]}function I(t,e,n,r,i,o,a,l,c){let[u,h,f]=a;const g=0|e,m=0|n,p=0|r;if(null===t||g<0||g>=u||m<0||m>=h||p<0||p>=f)return!1;const v=O(o,i,g,m,p,u,h),b=t[v],y=function(t,e){const n=s.has(t)?s.get(t):d(t,1,!0);return n?(n[0]=e,n[0]):e}(l,c);return b!==y&&(t[v]=c,!0)}function B(t,e,n,r,i,o,s,a,l,c){let d=arguments.length>10&&void 0!==arguments[10]&&arguments[10],u=arguments.length>11&&void 0!==arguments[11]&&arguments[11],h=arguments.length>12&&void 0!==arguments[12]&&arguments[12];if(i<0||o<0||s<0||i>a-1||o>l-1||s>c-1)return!1;const f=O(n,0,i,o,s,a,l);if(null===t||null===e)return!1;const g=t[f],m=0===e[f];return t[f]=h?r:d?0===e[f]?r:u?Math.max(0,Math.max(t[f],r)):Math.max(0,Math.min(t[f],r)):0===e[f]?r:t[f],e[f]=1,g!==t[f]||m}class C{constructor(t){this.filter=t}find(t,e,n,r,i){const[o,s,a]=t;let l=1/0,c=!1;const d=new Array,u={},h=(n,r,i,h)=>{if(r<0||i<0||h<0||r>o-1||i>s-1||h>a-1)return l=Math.min(l,n-1),void(c=!0);const f="".concat(r,",").concat(i,",").concat(h);if(u.hasOwnProperty(f))return l=Math.min(l,n-1),void(c=!0);u[f]=!0,1===P(this.filter,r,i,h,0,e,t)?c||d.push({count:n,x:r,y:i,z:h}):(l=Math.min(l,n-1),c=!0)};for(h(1,n,r,i);d.length>0;){const t=d.shift()||null;if(null===t)break;const{count:e,x:n,y:r,z:i}=t;for(let t=0,o=0|E.length;t<o;t=t+1|0){const[o,s,a]=E[t];h(e+1,n+o,r+s,i+a)}}return l===1/0?1:l}update(t,e,n,r,i,o,s,a){const[l,c,d]=n,u=P(this.filter,o,s,a,0,i,n)===r,h=u?this.find(n,i,o,s,a):0,f=new Array({count:h,x:o,y:s,z:a}),g={},m="".concat(o,",").concat(s,",").concat(a);if(g.hasOwnProperty(m))return;g[m]=!0,B(t,e,i,h,o,s,a,l,c,d,!0,u,!1);const p=(o,s,a,h)=>{if(o<0||s<0||a<0||h<0||s>l-1||a>c-1||h>d-1)return;const m="".concat(s,",").concat(a,",").concat(h);g.hasOwnProperty(m)||(g[m]=!0,B(t,e,i,o,s,a,h,l,c,d,!0,u,!1)&&P(this.filter,s,a,h,0,i,n)===r&&f.push({count:o,x:s,y:a,z:h}))};for(u&&p(this.find(n,i,o,s,a),o,s,a);f.length>0;){const t=f.shift()||null;if(null===t)break;const{count:e,x:r,y:o,z:s}=t;for(let t=0,a=0|E.length;t<a;t=t+1|0){const[a,l,c]=E[t];p(u?this.find(n,i,r+a,o+l,s+c):e+1,r+a,o+l,s+c)}}}}class A{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"uint8",i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:-1;this.buffer=null,this.is_update=!0,this.is_reflesh_distance_field=!1,this.filter=null,this.distance_field=null,this.fill_distance_field=null,this.inserts=new Array,this.distance_field_builder=null,this.width=t,this.height=e,this.depth=n,this.distance=(0,o.X6)(0,0,0,t,e,n),this.data_type=r,this.length=i,this.fill=s,this.setSize(t,e,n)}clear(){this.setSize(1,1,1)}setSize(t,e,n){if(t===this.width&&e===this.height&&n===this.depth&&null!==this.buffer)return;const r=d(this.data_type,t*e*n*this.length),i=d("int32",t*e*n),s=d("int8",t*e*n);this.distance_field_builder=new C(r),this.buffer=r.buffer,this.width=t,this.height=e,this.depth=n,this.distance=(0,o.X6)(0,0,0,t,e,n),this.filter=r,this.distance_field=i,this.fill_distance_field=s,this.is_update=!0,r.fill(this.fill),i.fill(1),s.fill(0)}getWorldDistance(){return this.distance}getSize(){const{width:t,height:e,depth:n}=this;return[t,e,n]}getFill(){return this.fill}getLength(){return this.length}getBuffer(){return this.buffer}getFilter(){return this.filter}getDistanceField(){return this.distance_field}getFillDistanceField(){return this.fill_distance_field}set(t,e,n,r,i){let o=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:this.getFilter(),a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:this.getSize();var l;if(null===s)return;const c=0|e,d=0|n,u=0|r,h=s===this.getFilter()?this.length:1,[f,g,m]=a,p=s[O(h,t,c,d,u,f,g)];if(I(s,e,n,r,t,h,a,this.data_type,i)&&s===this.getFilter()&&(this.is_update=!0,p!==this.fill&&void 0!==this.inserts[p]&&(this.inserts[p].count--,this.inserts[p].count<=0&&delete this.inserts[p]),i!==this.fill&&(void 0===this.inserts[i]?this.inserts[i]={count:1}:this.inserts[i].count++),o)){const t=this.getDistanceField(),e=this.getFillDistanceField();null!==t&&null!==e&&(null===(l=this.distance_field_builder)||void 0===l||l.update(t,e,this.getSize(),this.getFill(),this.getLength(),c,d,u))}}get(t,e,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.getFilter(),o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:this.getSize();return null===i?-1:P(i,e,n,r,t,i===this.getFilter()?this.length:1,o)}getCount(t){return void 0===this.inserts[t]?0:this.inserts[t].count}expand(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(0===t&&0===e&&0===n)return;const[r,i,o]=this.getSize(),s=this.getFilter(),a=this.getDistanceField(),l=this.getFillDistanceField();this.setSize(r+Math.abs(t),i+Math.abs(e),o+Math.abs(n));for(let c=r-1|0;c>=0;c=c-1|0)for(let d=i-1|0;d>=0;d=d-1|0)for(let u=o-1|0;u>=0;u=u-1|0){const h=c+Math.abs(t<0?-t:0),f=d+Math.abs(e<0?-e:0),g=u+Math.abs(n<0?-n:0),m=this.get(0,c,d,u,a,[r,i,o]),p=this.get(0,c,d,u,l,[r,i,o]);this.set(0,h,f,g,-1===m?0:m,!1,this.getDistanceField()),this.set(0,h,f,g,-1===p?0:p,!1,this.getFillDistanceField());for(let t=0,e=0|this.length;t<e;t=t+1|0){const e=this.get(t,c,d,u,s,[r,i,o]);this.set(t,h,f,g,-1===e?1:e,!1,this.getFilter())}}}reduction(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(0===t&&0===e&&0===n)return;const[r,i,o]=this.getSize(),s=this.getFilter(),a=this.getDistanceField(),l=this.getFillDistanceField();this.setSize(r-Math.abs(t),i-Math.abs(e),o-Math.abs(n));for(let c=r-1|0;c>=0;c=c-1|0)for(let d=i-1|0;d>=0;d=d-1|0)for(let u=o-1|0;u>=0;u=u-1|0){const h=c-Math.abs(t<0?-t:0),f=d-Math.abs(e<0?-e:0),g=u-Math.abs(n<0?-n:0),m=this.get(0,c,d,u,a,[r,i,o]),p=this.get(0,c,d,u,l,[r,i,o]);this.set(0,h,f,g,-1===m?0:m,!1,this.getDistanceField()),this.set(0,h,f,g,-1===p?0:p,!1,this.getFillDistanceField());for(let t=0,e=0|this.length;t<e;t=t+1|0){const e=this.get(t,c,d,u,s,[r,i,o]);this.set(t,h,f,g,-1===e?1:e,!1,this.getFilter())}}}requestRefleshDistanceField(){this.is_reflesh_distance_field=!0}cancelRefleshDistanceField(){this.is_reflesh_distance_field=!1}async refleshDistanceField(){var t,e;const n=this.getFilter(),r=this.getDistanceField(),i=this.getFillDistanceField(),[o,s,a]=this.getSize(),l=this.getFill();if(null!==n&&null!==r&&null!==i){r.fill(1),null===(t=this.fill_distance_field)||void 0===t||t.fill(0);for(let t=0;t<o;t=t+1|0)for(let n=0;n<s;n=n+1|0)for(let c=0;c<a;c=c+1|0)this.get(0,t,n,c)!==this.fill&&(null===(e=this.distance_field_builder)||void 0===e||e.update(r,i,[o,s,a],l,this.getLength(),t,n,c));this.finalize()}}hasUpdate(){return this.is_update}finalize(){var t;null===(t=this.fill_distance_field)||void 0===t||t.fill(1)}checkUpdate(){let t=this.is_update;return this.is_reflesh_distance_field&&(this.refleshDistanceField(),this.is_reflesh_distance_field=!1,t=!0),this.is_update=!1,t}}var k=n(4402),D=n(9790);class F{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t=>[-1,-1,-1,-1,-1];this.size=new o.P(1,1,1),this.entitys=new Array,this.oldPropertys=new WeakMap,this.oldPoints=new WeakMap,this.data=new Array,this.points=new Array,this.heap=new Array,this.hasAdd=t,this.paramGetter=e}hasOverPosition(t,e,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;const[o,s,a]=this.getSize();return t+r/2<0||e+i<0||n+r/2<0||t-r/2>=o||e>=s||n-r/2>=a}getDimension(){const[,t,e]=this.getSize();switch(!0){case!(1^t):return 1;case!(1^e):return 2}return 3}calcMortonNumber(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(this.hasOverPosition(t,e,n))return-1;switch(this.getDimension()){case 1:return(0,k.mY)(t);case 2:return(0,k.nI)(t,n);case 3:return(0,k.Hq)(t,e,n)}}setSize(t,e,n){this.size.x=t,this.size.y=e,this.size.z=n}getSize(){return[this.size.x,this.size.y,this.size.z]}getEntityProperty(t){return this.paramGetter(t)}getOldEntityProperty(t){const e=this.oldPropertys.get(t);return e?[e.x,e.y,e.z,e.rx,e.ry]:[-1,-1,-1,-1,-1]}add(t){this.hasAdd(t)&&!this.entitys.includes(t)&&this.entitys.push(t)}remove(t){this.hasAdd(t)&&this.entitys.includes(t)&&this.entitys.splice(this.entitys.indexOf(t),1)}hasEntity(t){return this.hasAdd(t)}clear(){this.entitys.forEach((t=>this.oldPropertys.delete(t))),this.size.x=0,this.size.y=0,this.size.z=0,(0,u.vF)(this.data),(0,u.vF)(this.points),(0,u.vF)(this.entitys)}getCell(t){return this.data[t]||new Array}getPointCell(t,e,n){const r=this.calcMortonNumber(t,e,n);return this.getCell(r)}getAppendPoints(){return this.points}getDataLength(){return this.data.length}setOldPosition(t){const e=this.oldPropertys.get(t);if(void 0!==e){const[n,r,i,o,s]=this.getEntityProperty(t),a=Math.floor(n-o/2),l=Math.floor(r),c=Math.floor(i-o/2),d=Math.ceil(n+o/2),u=Math.ceil(r+s),h=Math.ceil(i+o/2);e.sx=a,e.sy=l,e.sz=c,e.ex=d,e.ey=u,e.ez=h,e.x=n,e.y=r,e.z=i,e.rx=o,e.ry=s}}initOldPosition(t){const e={x:-1,y:-1,z:-1,rx:-1,ry:-1,sx:-1,sy:-1,sz:-1,ex:-1,ey:-1,ez:-1};return this.oldPropertys.set(t,e),e}appendCells(t,e){const n=t.getID();for(let t=0,r=0|e.length;t<r;t=t+1|0){const r=e[t],i=this.data[r];void 0===i?this.data[r]=[n]:i.includes(n)||(i.push(n),i.length>1&&!this.points.includes(r)&&this.points.push(r))}}update(t,e,n){this.setSize(t,e,n),D.D1?this.data.fill(void 0):this.data.length=0,(0,u.vF)(this.points);for(let t=0,e=0|this.entitys.length;t<e;t=t+1|0){const e=this.entitys[t],[n,r,i,s,a]=this.getEntityProperty(e);let l=this.oldPropertys.get(e);if(void 0===l&&(l=this.initOldPosition(e)),-1!==n&&-1!==r&&-1!==i&&!this.hasOverPosition(n,r,i,s,a)){let t=this.oldPoints.get(e);void 0===t&&this.oldPoints.set(e,t=new Array);const c=Math.floor(n-s/2),d=Math.floor(r),h=Math.floor(i-s/2),f=Math.ceil(n+s/2),g=Math.ceil(r+a),m=Math.ceil(i+s/2);if(l.sx!==c||l.sy!==d||l.sz!==h||l.ex!==f||l.ey!==g||l.ez!==m){const e=-1===l.x?n:l.x,p=-1===l.y?r:l.y,v=-1===l.z?i:l.z,b=n-e,y=r-p,_=i-v,w=(0,o.X6)(b,y,_,0,0,0),[E,O]=(0,o.tx)(b,y,_,0,0,0),L=Math.min(w,s/4,a/4,.5),[M,P,I]=(0,o.c8)(E,O,0,0,1),B=this.getDimension();let C=0;for((0,u.vF)(t);;){const n=e+C*M,r=p+C*P,i=v+C*I;(0,u.vF)(this.heap);let o=this.heap;switch(B){case 1:o=R(n,s,this.heap);break;case 2:o=S(n,i,s,this.heap);break;case 3:o=T(n,r,i,s,a,this.heap)}for(let e=0,n=0|o.length;e<n;e=e+B|0){const n=o[e],r=o[e+1],i=o[e+2];let s=-1;switch(B){case 1:s=this.calcMortonNumber(n,0,0);break;case 2:s=this.calcMortonNumber(n,0,r);break;case 3:s=this.calcMortonNumber(n,r,i)}-1===s||t.includes(s)||t.push(s)}if(C>=w)break;C=Math.min(w,x(C+L,w,1e5,Math.ceil))}0===L&&(l.sx=c,l.sy=d,l.sz=h,l.ex=f,l.ey=g,l.ez=m)}this.appendCells(e,t)}l.x=n,l.y=r,l.z=i,l.rx=s,l.ry=a}}}var z=n(2424),N=n(6749);new WeakMap,new WeakMap;var U=n(7764);const X={},V=new Array;let G=!1,H=!1;"window"in self&&U.rw.addEventListener("message",(t=>{const{data:e}=t;if(e instanceof Object)switch(e.method){case"enable":G=!0;break;case"disable":G=!1;break;case"log":H=!1;for(const t in e.messages){const{id:n,message:r}=e.messages[t];X[n]=r}const t=Object.values(e.messages);for(const e in X)t.some((t=>t.id===e))||delete X[e];break;case"stop":H=!0}}));class j{constructor(t){this.id=(0,z.D)(),this.components=new Array,this.entity=t;for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];this.components.push(...n)}hasEntity(t){return t instanceof this.entity&&!this.components.some((e=>!t.hasComponent(e)))}additional(t,e,n){}movable(t,e,n){}physical(t,e,n){}offset(t,e,n){}preadditional(t,e){}premovable(t,e){}prephysical(t,e){}preoffset(t,e){}ending(t,e){}rendering(t,e){}destructor(t,e){}}class Y extends class{constructor(t){this.id=(0,z.D)(),this.components=new WeakMap,this.live=!0,this.isUpdate=!0;for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];this.setComponents(...n),this.names="".concat(t.length>0?"".concat(t," "):"").concat(this.id).split(" ")}getID(){return this.id}getNames(){return[...this.names]}addNames(){for(let t=0,e=0|arguments.length;t<e;t=t+1|0){const e=t<0||arguments.length<=t?void 0:arguments[t];this.names.includes(e)||(this.names.push(e),this.isUpdate=!0)}}removeNames(){for(let t=0,e=0|arguments.length;t<e;t=t+1|0){const e=t<0||arguments.length<=t?void 0:arguments[t];this.names.includes(e)&&(this.names.splice(this.names.indexOf(e),1),this.isUpdate=!0)}}hasComponent(t){return this.components.has(t)}setComponents(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];e.forEach((t=>{if(!t)return;let e=t;do{this.components.set(e.constructor,t)}while(null!==(e=e.constructor.prototype.__proto__));this.isUpdate=!0}))}getComponent(t){return this.components.get(t)}removeComponent(t){this.components.has(t)&&(this.components.delete(t),this.isUpdate=!0)}checkUpdate(){const{isUpdate:t}=this;return this.isUpdate=!1,t}hasUpdate(){return this.isUpdate}hasLive(){return this.live}remove(){this.live=!1}destroy(){}}{constructor(){super(...arguments),this.position=new o.P(0,0,0),this.direction=new o.P(0,0,0)}}class W{constructor(t,e){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.size=new o.FM(t,e),this.treeFix=n}}class q{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5&&void 0!==arguments[5]&&arguments[5];this.material=t,this.scale=e,this.rotate=n,this.bounding=r,this.flip={x:i,y:o}}}class Z{constructor(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.axes={x:t,y:e,z:n},this.bottom=r}}class J{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;this.fix=new o.P(0,0,0),this.fixRotate=0,this.position=new o.P(t,e,n),this.scale=r,this.rotate=i}}class K{constructor(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Array,r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this.init=!1,this.enable=!0,this.old=new o.P(-1,-1,-1),this.targets=new Array,this.size=new o.FM(t,e),this.filter=n,this.treeFix=r}}class Q{constructor(t,e){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.size=new o.FM(t,e),this.treeFix=n}}class ${constructor(t,e,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;this.cost=0,this.x=t,this.y=e,this.z=n,this.stepX=r,this.stepY=i,this.stepZ=o,this.step=null===s?0:s.step+1,this.prev=s}getCost(t,e,n){return(0,o.X6)(t,e,n,this.x,this.y,this.z)+this.step}}class tt{constructor(){this.stacks=new Array,this.queue=new Array,this.sorts=new WeakMap,this.block={block:!1}}find(t,e,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:t=>({block:!1}),o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:t=>!0,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:t=>t.step,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:()=>!0,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:()=>0;const c=[];return new Promise(((d,h)=>{if(!t.hasFinish())return;const f=(3===t.dimension?E:w).slice(),{block:g}=this;let m=0;t.begin(.5+(0|e),.5+(0|n),.5+(0|r));const p=this;this.queue.push(function*(){yield()=>0;let e=!1;do{e&&(0,u.qr)(t.searchPoint).asc((t=>t.cost)),e=!1;const n=t.searchPoint.shift();if(void 0===n||!a())break;if(o(n)){t.close(n),d(null);break}(0,u.Sy)(f);for(let r=0|f.length;m<r;m=m+1|0){const[r,o,a]=f[m],c=r+(0|n.x)|0,d=o+(0|n.y)|0,u=a+(0|n.z)|0;let h=p.stacks.shift()||null;null===h?h=new $(c+.5,d+.5,u+.5,r,o,a,n):(h.x=c+.5,h.y=d+.5,h.z=u+.5,h.stepX=r,h.stepY=o,h.stepZ=a,h.prev=n,h.cost=0),g.block=!1,delete g.label,i(h,g);let v="".concat(c,",").concat(d,",").concat(u);void 0!==g.label&&(v="".concat(v,"-").concat(g.label)),t.hasSearch[v]||(t.hasSearch[v]=!0,g.block||(h.cost=s(h),e=!0,t.searchPoint.push(h))),yield l}m=0,c.push(n)}while(t.searchPoint.length>0);return t.close(null),h(),!0}())})).finally((()=>{this.stacks.push(...c)}))}update(t){(0,u.qr)(this.queue).asc((t=>(this.sorts.get(t)||(()=>0))()));const e=performance.now();do{const t=this.queue.shift()||null;if(null===t)break;{const e=t.next();e.done||(this.sorts.set(t,e.value),this.queue.push(t))}}while(performance.now()-e<t&&this.queue.length>0)}}var et=n(8187);class nt{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.position=new o.P(t,e,n)}}class rt{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.value=t}}var it=n(2276);const ot=[[0,0],[1,0],[0,1],[-1,0],[0,-1],[1,1],[1,-1],[-1,1],[-1,-1]];function st(t,e){return t.top===e.top&&t.bottom===e.bottom&&t.right===e.right&&t.left===e.left&&t.front===e.front&&t.back===e.back&&t.flipXRight===e.flipXRight&&t.flipYRight===e.flipYRight&&t.flipXLeft===e.flipXLeft&&t.flipYLeft===e.flipYLeft&&t.flipXFront===e.flipXFront&&t.flipYFront===e.flipYFront&&t.flipXBack===e.flipXBack&&t.flipYBack===e.flipYBack&&t.flipXTop===e.flipXTop&&t.flipYTop===e.flipYTop&&t.flipXBottom===e.flipXBottom&&t.flipYBottom===e.flipYBottom&&t.position.x===e.position.x&&t.position.y===e.position.y&&t.position.z===e.position.z}function at(t,e,n,r,i){t[e*n+r]=i}class lt{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.data=t,this.width=e,this.height=n,this.depth=r}}class ct{constructor(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1/0;this.buffers={},this.clusterAABBs=new Array,this.clusterBoxX=0,this.clusterBoxY=0,this.clusterWidth=0,this.clusterHeight=0,this.dists=new WeakMap,this.billboardPropLength=14,this.voxelPropLength=21,this.oldScene=null,this.setting=t,this.maxTextureSize=e,this.maxDrawDistance=n}getClusterResolution(){return this.setting.clusterResolution||16}getBuffer(t){return l()?this.buffers[t]:new lt(this.buffers[t].data.slice(),this.buffers[t].width,this.buffers[t].height,this.buffers[t].depth)}requireBuffer(t,e,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const[o,s,a]=function(t,e){return[Math.min(e,t),Math.min(e,1+Math.floor(t/e)),Math.min(e,1+Math.floor(Math.floor(t/e)/e))]}(n,this.maxTextureSize),l=o*s*a*r;return(i||!this.buffers.hasOwnProperty(t)||this.buffers[t].data.length<l)&&(this.buffers[t]=new lt(d(e,l,i),o,s,a)),this.buffers[t]}lightCullingData(t){const e=new Array,n=t.getCamera(),r=t.getSun(),i=t.getEntitys();if(n.hasComponent(rt)){const{position:t,direction:e}=n,r=n.getComponent(rt).value;if(null!==r){let i=new o.P(0,0,0);n.hasComponent(nt)&&(i=n.getComponent(nt).position);const[s,a]=(0,o.t6)(r.direction.x,i.x,i.z);t.x=r.position.x+s,t.y=r.position.y+i.y,t.z=r.position.z+a,e.x=r.direction.x,e.y=r.direction.y,e.z=r.direction.z}}for(let t=0,r=0|i.length;t<r;t=t+1|0){const r=i[t];if(r&&!r.hasLive()||!(r instanceof Y)||!r.hasComponent(q)||!r.hasComponent(Z))continue;const{direction:s,position:a}=r;if(r.hasComponent(J)&&r.hasComponent(rt)){const t=r.getComponent(J),e=r.getComponent(q),i=r.getComponent(rt);if(null!==i.value){const{position:r,direction:l}=i.value,[c,d,u]=(0,o.c8)(l.x,l.y,t.position.x*(t.position.z/it.N),t.position.y*(t.position.z/it.N),t.position.z);a.x=r.x+c,a.y=r.y+d,a.z=r.z+u;const[h,f,g]=(0,o.c8)(l.x,l.y,t.position.x*(t.position.z/n.fov),t.position.y*(t.position.z/n.fov),t.position.z);t.fix.x=r.x+h,t.fix.y=r.y+f,t.fix.z=r.z+g,e.scale=t.scale*(t.position.z/it.N);let m=0;if(l.y>=0){m+=(0,o.B8)(l.x),m+=Math.PI/16*(Math.abs(t.position.x)/.25)*(t.position.x>0?1:-1)*(Math.abs(Math.max(0,it.N-.5))/.5)*((o.uB-l.y)/o.uB);let e=m+Math.sin(2*(0,o.KO)(a.x,a.z,i.value.position.x,i.value.position.z))*(Math.PI/16*(Math.abs(Math.max(0,it.N-.5))/.5)*(1-Math.abs(Math.sin(l.y))));e+=Math.sin(2*(0,o.KO)(a.x,a.z,i.value.position.x,i.value.position.z))*(Math.PI/16*(Math.abs(Math.max(0,.5-it.N))/.25)*Math.abs(Math.sin(l.y))),e+=Math.sin(2*(0,o.KO)(a.x,a.z,i.value.position.x,i.value.position.z))*(Math.PI/32*Math.abs(Math.cos(2*l.y)))*(Math.abs(t.position.x)/.25),m=_(e,m,Math.max(0,Math.min(1,((s.y-Math.PI/3.5)/.5+1)/2))),m+=((.5-Math.abs(l.y)/(Math.PI/2))/.5*(Math.PI/16)+Math.PI/16)*(t.position.x>0?-1:1)*Math.min(1,Math.abs(t.position.x)/.25)}else m+=Math.PI/(16-Math.abs(Math.max(0,.5-it.N))/.5*6)*(Math.abs(t.position.x)/.25)*(t.position.x>0?-1:1)*(Math.abs(l.y)/o.uB),m+=(Math.sin(s.x)+o.uB*Math.sign(t.position.x)*(Math.abs(Math.max(0,.5-it.N))/.25))*(Math.PI/16+Math.abs(Math.max(0,it.N-.5))/.25*16*Math.cos(-l.y))*(Math.abs(t.position.x)/.25),m+=(Math.abs(l.y)/o.uB*(Math.PI/5)-Math.PI/32)*(t.position.x>0?-1:1)*Math.min(1,Math.abs(t.position.x)/.25);t.fixRotate=m,e.rotate=t.rotate}}const l=a.x,c=a.y+r.getComponent(Z).bottom*r.getComponent(q).scale,d=a.z,u=(0,o.X6)(l,c,d,n.position.x,n.position.y,n.position.z);if(u>this.maxDrawDistance)continue;const[h,f]=(0,o.tx)(l,c,d,n.position.x,n.position.y,n.position.z),[g,m]=(0,o.vr)(h,f,n.direction.x,n.direction.y);g>Math.PI/2&&m>Math.PI/2||(this.dists.set(r,u),e.push(r))}return e.length>1&&(0,u.qr)(e).asc((t=>this.dists.get(t))),{billboards:e,camera:{position:{x:n.position.x,y:n.position.y,z:n.position.z},direction:{x:n.direction.x,y:n.direction.y,z:n.direction.z},fov:n.fov,zoom:n.zoom,light:n.light},sun:{direction:{x:r.direction.x,y:r.direction.y}}}}frustumCullingData(t,e,n){const{clusterWidth:r,clusterHeight:i,clusterAABBs:s,clusterBoxX:a,clusterBoxY:l}=this,[c,d]=t.getSize(),u=c/Math.min(c,d),h=d/Math.min(c,d),g=e.getCamera(),m=g.fov*g.zoom,p=[...new Array(r*i)].map((()=>[])),v=new Array,b=a*u,y=l*h,[x,_,w,E,O,R,S,T,L]=(0,o.gJ)(g.direction.x,g.direction.y,m);let M=0;for(let t=0,e=0|n.length;t<e;t=t+1|0){const e=n[t],{position:a}=e,l=e.getComponent(Z),c=e.getComponent(q),d=a.x,P=a.y+l.bottom*c.scale,I=a.z;let[B,C,A]=(0,o.iV)(g.position.x,g.position.y,g.position.z,d,P,I,c.scale,x,_,w,E,O,R,S,T,L,g.direction.z,e.hasComponent(J)?it.N:m);A*=c.bounding;const k=Math.floor(Math.min(r*b,Math.max(0,B+r*b/2-A))/b),D=Math.floor(Math.min(i*y,Math.max(0,C+i*y/2-A))/y),F=Math.floor(Math.min(r*b,Math.max(0,B+r*b/2+A))/b),z=Math.floor(Math.min(i*y,Math.max(0,C+i*y/2+A))/y),N=Math.min(k,F),U=Math.min(D,z),X=Math.max(k,F),V=Math.max(D,z);if(X<0||V<0||N>=r||U>=i)continue;let G=!1;for(let t=0|U,e=V+1|0;t<e;t=t+1|0)for(let e=0|N,n=X+1|0;e<n;e=e+1|0){if(e<0||t<0||e>=r||t>=i)continue;const n=t*r+e|0;if(!f(B,C,A,s[2*n]*u,s[2*n+1]*h,b,y))continue;const o=p[n]||null;null!==o&&o.push(M),G=!0}G&&(v.push({id:M,entity:e}),M++)}return{bind_entitys:v,cullings:p}}buildEntitys(t,e){const{billboardPropLength:n}=this,r=this.requireBuffer("billboard_parameters","float32",Math.max(n,e.length*n),1,!0),i=t.getMaterialManager().getMaterials();for(let t=0,s=0|e.length;t<s;t=t+1|0){const{id:s,entity:a}=e[t],{position:l}=a,c=a.getComponent(q),d=a.getComponent(Z),u=a.hasComponent(J);at(r.data,n,s,0,l.x),at(r.data,n,s,1,l.y+d.bottom*c.scale),at(r.data,n,s,2,l.z),at(r.data,n,s,3,c.scale),at(r.data,n,s,4,c.bounding),at(r.data,n,s,5,u?a.getComponent(J).fix.x:d.axes.x?1:0),at(r.data,n,s,6,u?a.getComponent(J).fix.y:d.axes.y?1:0),at(r.data,n,s,7,u?a.getComponent(J).fix.z:d.axes.z?1:0),at(r.data,n,s,8,(0,o.B8)(c.rotate)),at(r.data,n,s,9,c.flip.x?-1:1),at(r.data,n,s,10,c.flip.y?-1:1),at(r.data,n,s,11,u?1:0),at(r.data,n,s,12,u?(0,o.B8)(a.getComponent(J).fixRotate):0),at(r.data,n,s,13,i.indexOf(c.material)||0)}return{billboard_parameters:r}}buildCullingData(t){const e=this.requireBuffer("cluster_list","int32",Math.max(1,t.length),1,!0),n=this.requireBuffer("item_list","int32",Math.max(1,t.reduce(((t,e)=>t+e.length),0)),1,!0);for(let r=0,i=0|t.length;r<i;r=r+1|0){const i=t[r],o=r>0?e.data[r-1]:0;e.data[r]=o+i.length;for(let t=0,e=0|i.length;t<e;t=t+1|0)n.data[o+t]=i[t]}return{cluster_list:e,item_list:n}}buildMaterials(t,e,n){if(!t.checkUpdate()&&!e.checkUpdate()&&!n)return{materials:null,sync_materials:!1};const r=[],i=e.getMaterials();for(const e in i){const n=Number(e);if(isNaN(n))continue;const o=i[n];r[n]=t.getBufferLocation(o.src,o.index)}const o=this.requireBuffer("materials","int32",Math.max(1,r.length),1);for(let t=0,e=0|r.length;t<e;t=t+1|0)o.data[t]=r[t]||0;return{materials:this.getBuffer("materials"),sync_materials:!0}}buildVoxels(t,e,n){if(!e.checkUpdate()&&!n)return{voxels:null,sync_voxels:!1};const r=[],i=e.getVoxels(),{voxelPropLength:o}=this;for(const e in i){const n=Number(e);if(isNaN(n))continue;const s=i[n];if(null===s)for(let t=0,e=0|o;t<e;t=t+1|0)r[n*o+t]=0;else{const e=t.getTileSet(),i=t.getMaterials();r[n*o+0]=s.position.x,r[n*o+1]=s.position.y,r[n*o+2]=s.position.z,null!==e?(r[n*o+3]=Object.values(i).indexOf(e[s.front]),r[n*o+4]=Object.values(i).indexOf(e[s.back]),r[n*o+5]=Object.values(i).indexOf(e[s.right]),r[n*o+6]=Object.values(i).indexOf(e[s.left]),r[n*o+7]=Object.values(i).indexOf(e[s.top]),r[n*o+8]=Object.values(i).indexOf(e[s.bottom])):(r[n*o+3]=Object.values(i).indexOf(i.NONE),r[n*o+4]=Object.values(i).indexOf(i.NONE),r[n*o+5]=Object.values(i).indexOf(i.NONE),r[n*o+6]=Object.values(i).indexOf(i.NONE),r[n*o+7]=Object.values(i).indexOf(i.NONE),r[n*o+8]=Object.values(i).indexOf(i.NONE)),r[n*o+9]=s.flipXFront?-1:1,r[n*o+10]=s.flipYFront?-1:1,r[n*o+11]=s.flipXBack?-1:1,r[n*o+12]=s.flipYBack?-1:1,r[n*o+13]=s.flipXRight?-1:1,r[n*o+14]=s.flipYRight?-1:1,r[n*o+15]=s.flipXLeft?-1:1,r[n*o+16]=s.flipYLeft?-1:1,r[n*o+17]=s.flipXTop?-1:1,r[n*o+18]=s.flipYTop?-1:1,r[n*o+19]=s.flipXBottom?-1:1,r[n*o+20]=s.flipYBottom?-1:1}}const s=this.requireBuffer("voxels","float32",Math.max(o,r.length),1);for(let t=0,e=0|r.length;t<e;t=t+1|0)s.data[t]=r[t]||0;return{voxels:this.getBuffer("voxels"),sync_voxels:!0}}getMaxDrawDistance(){return this.maxDrawDistance}setMaxDrawDistance(t){this.maxDrawDistance=t}createData(t,e,n,r){const i=t.getRendererManager(),s=t.getMaterialManager(),a=t.getVoxelManager(),c=this.oldScene!==t.getName()||r;this.oldScene=t.getName();const d=t.getMap(),u=t.getLateTime();let h=null,f=null,g=null,m=null,p=null,v=null;const b=[],y=[];if(n){g=[this.getClusterResolution(),this.getClusterResolution()];const e=g[0],n=g[1];if(this.clusterWidth!==e||this.clusterWidth!==n){const[t,r,i]=(0,o.xv)(e,n,this.requireBuffer("frustum","float32",e,2*n).data);this.clusterAABBs=t,this.clusterBoxX=r,this.clusterBoxY=i,this.clusterWidth=e,this.clusterHeight=n}const{billboards:r,camera:s,sun:a}=this.lightCullingData(t),{bind_entitys:l,cullings:c}=this.frustumCullingData(i,t,r),{billboard_parameters:d}=this.buildEntitys(t,l),{cluster_list:u,item_list:y}=this.buildCullingData(c);h=s,f=a,m=d,p=u,v=y,b.push(m.data.buffer,p.data.buffer,v.data.buffer)}const{materials:x,sync_materials:_}=this.buildMaterials(e,s,c),{voxels:w,sync_voxels:E}=this.buildVoxels(t,a,c),O=t.getBackground(),R=d.checkUpdate(),S=d.getFilter(),T=d.getDistanceField();return l()||(S&&(R||c)&&y.push(S.buffer),null!==T&&(R||c)&&y.push(T.buffer),null!==x&&(_||c)&&y.push(x.data.buffer),null!==w&&(E||c)&&y.push(w.data.buffer),null!==x&&(_||c)&&b.push(x.data.buffer),null!==w&&(E||c)&&b.push(w.data.buffer)),y.push(...b),[{camera:h,sun:f,map:{width:d.getSize()[0],height:d.getSize()[1],depth:d.getSize()[2],distance:d.getWorldDistance(),data:R||c?S:null},distance_field:(R||c)&&null!==T?{width:d.getSize()[0],height:d.getSize()[1],depth:d.getSize()[2],data:T}:null,materials:_||c?x:null,voxels:E||c?w:null,cluster_resolution:g,billboard_parameters:m,item_list:v,cluster_list:p,background:O,lateTime:u},b,y]}}const dt=[30,60,90,120,1/0];class ut{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.setting=t,this.init(e)}init(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.setFramerate(this.setting.hasOwnProperty("framerate")?this.setting.framerate:1),this.setFOV(this.setting.hasOwnProperty("fov")?this.setting.fov:130,t),this.setInnerDeadzoneX(this.setting.stickInnerDeadzoneX||0),this.setOuterDeadzoneX(this.setting.stickOuterDeadzoneX||0),this.setInnerDeadzoneY(this.setting.stickInnerDeadzoneY||0),this.setOuterDeadzoneY(this.setting.stickOuterDeadzoneY||0),this.setSoundVolume(this.setting.hasOwnProperty("soundVolume")?this.setting.soundVolume:1),this.setClusterResolution(this.setting.hasOwnProperty("clusterResolution")?this.setting.clusterResolution:16),this.setFullscreen(this.setting.hasOwnProperty("isFullscreen")?this.setting.isFullscreen:!!(0,i.Vp)()),this.setBrowserFullscreen(!!this.setting.hasOwnProperty("isBrowserFullscreen")&&this.setting.isBrowserFullscreen),this.setReolutionIndex(this.setting.hasOwnProperty("resolutionIndex")?this.setting.resolutionIndex:-1),this.setReflectionCount(this.setting.hasOwnProperty("reflectionCount")?this.setting.reflectionCount:2),this.setShadow(!this.setting.hasOwnProperty("isShadow")||this.setting.isShadow),this.setSoftShadow(!this.setting.hasOwnProperty("isSoftShadow")||this.setting.isSoftShadow),this.setRoughness(!this.setting.hasOwnProperty("isRoughness")||this.setting.isRoughness),this.setBloom(!this.setting.hasOwnProperty("isBloom")||this.setting.isBloom),this.setMuzzleFlash(!this.setting.hasOwnProperty("isMuzzleFlash")||this.setting.isMuzzleFlash),this.setPixelizedLighting(!this.setting.hasOwnProperty("isPixelizedLighting")||this.setting.isPixelizedLighting),this.setLightingDotScale(this.setting.hasOwnProperty("lightingDotScale")?this.setting.lightingDotScale:1),this.setBlurDotScale(this.setting.hasOwnProperty("blurDotScale")?this.setting.blurDotScale:4),this.setContrast(this.setting.hasOwnProperty("contrast")?this.setting.contrast:1),this.setBrightness(this.setting.hasOwnProperty("brightness")?this.setting.brightness:1),this.setCRTEnable(!!this.setting.hasOwnProperty("isCRT")&&this.setting.isCRT),this.setCRTSubPixel(this.setting.hasOwnProperty("crtSubPixel")?this.setting.crtSubPixel:3),this.setCRTLens(this.setting.hasOwnProperty("crtLens")?this.setting.crtLens:.075),this.setCRTDeep(this.setting.hasOwnProperty("crtDeep")?this.setting.crtDeep:.075),this.setCRTEdge(this.setting.hasOwnProperty("crtEdge")?this.setting.crtEdge:.025),this.setCRTVig(this.setting.hasOwnProperty("crtVig")?this.setting.crtVig:.175),this.setCRTShadowMask(!!this.setting.hasOwnProperty("isCRTShadowMask")&&this.setting.isCRTShadowMask),this.setHUD(!this.setting.hasOwnProperty("isHUD")||this.setting.isHUD),this.setSensibility(this.setting.hasOwnProperty("sensibility")?this.setting.sensibility:50),this.setInvertX(!!this.setting.hasOwnProperty("invertX")&&this.setting.invertX),this.setInvertY(!!this.setting.hasOwnProperty("invertY")&&this.setting.invertY),this.setBob(!this.setting.hasOwnProperty("bob")||this.setting.bob),this.setToggleSprint(!this.setting.hasOwnProperty("toggleSprint")||this.setting.toggleSprint),this.setToggleCluch(!this.setting.hasOwnProperty("toggleCluch")||this.setting.toggleCluch),this.setWeaponChargeStandTime(this.setting.hasOwnProperty("weaponChargeStandTime")?this.setting.weaponChargeStandTime:180),this.setWeaponWheelStandTime(this.setting.hasOwnProperty("weaponWheelStandTime")?this.setting.weaponWheelStandTime:180),this.setEatSound(!this.setting.hasOwnProperty("eatSound")||this.setting.eatSound),this.setCheckPoint(!this.setting.hasOwnProperty("isCheckPoint")||this.setting.isCheckPoint),this.setDeadLoseWeapon(!!this.setting.hasOwnProperty("isDeadLoseWeapon")&&this.setting.isDeadLoseWeapon),this.setPermaDeath(!!this.setting.hasOwnProperty("isPermaDeath")&&this.setting.isPermaDeath),this.setSSSSlowMo(!this.setting.hasOwnProperty("isSSSSlowMo")||this.setting.isSSSSlowMo),this.setRandomWeaponDrop(this.setting.hasOwnProperty("randomWeaponDrop")?this.setting.randomWeaponDrop:0),this.setRandomHeightEnemy(this.setting.hasOwnProperty("randomHeightEnemy")?this.setting.randomHeightEnemy:1),this.setNotSpawnAcotrs(!!this.setting.hasOwnProperty("isNotSpawnActors")&&this.setting.isNotSpawnAcotrs),this.setDebugLog(!!this.setting.hasOwnProperty("isDebugLog")&&this.setting.isDebugLog)}reset(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const t in this.setting)delete this.setting[t];this.init(t)}saveSetting(){(0,r.nL)("setting")}setHUD(t){this.setting.isHUD=t,this.saveSetting()}setSensibility(t){this.setting.sensibility=t,this.saveSetting()}setInvertX(t){this.setting.invertX=t,this.saveSetting()}setInvertY(t){this.setting.invertY=t,this.saveSetting()}setBob(t){this.setting.bob=t,this.saveSetting()}setToggleSprint(t){this.setting.toggleSprint=t,this.saveSetting()}setToggleCluch(t){this.setting.toggleCluch=t,this.saveSetting()}setWeaponChargeStandTime(t){this.setting.weaponChargeStandTime=t,this.saveSetting()}setWeaponWheelStandTime(t){this.setting.weaponWheelStandTime=t,this.saveSetting()}setEatSound(t){this.setting.eatSound=t,this.saveSetting()}setCheckPoint(t){this.setting.isCheckPoint=t,this.saveSetting()}setDeadLoseWeapon(t){this.setting.isDeadLoseWeapon=t,this.saveSetting()}setPermaDeath(t){this.setting.isPermaDeath=t,this.saveSetting()}setSSSSlowMo(t){this.setting.isSSSSlowMo=t,this.saveSetting()}setRandomWeaponDrop(t){this.setting.randomWeaponDrop=t,this.saveSetting()}setRandomHeightEnemy(t){this.setting.randomHeightEnemy=t,this.saveSetting()}setNotSpawnAcotrs(t){this.setting.isNotSpawnActors=t,this.saveSetting()}setDebugLog(t){this.setting.isDebugLog=t,this.saveSetting()}setFOV(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;null!==e&&e.getScenes().forEach((e=>{if(!(e instanceof class extends class extends class extends class extends class{constructor(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.speed=1,this.maxFrameSkipCount=5,this.framerate=60,this.update=0,this.reqAnim=null,this.timeout=null,this.updateTime=-1,this.nextGameTick=-1,this.paintTime=-1,this.skipFrameCount=-1,this.isSkip=!1,this.stackTick=0,this.isSleep=!1,this.isError=!1,this.isUpdateDefault=!1,this.isPaintDefault=!1,self.addEventListener("error",(()=>{this.error()})),this.useAnimationFrame=t}error(){this.isError=!0,this.stop(),new N.j(this,"error").trigger()}sleep(){this.isSleep=!0,new N.j(this,"sleep").trigger({})}unsleep(){this.isSleep=!1,new N.j(this,"unsleep").trigger()}updateDefault(){this.isUpdateDefault=!0}paintDefault(){this.isPaintDefault=!0}getFramerate(){return(0,i.Vp)()?60:1/0}reset(){let t=!1;return null!==this.reqAnim&&(cancelAnimationFrame(this.reqAnim),t=!0),this.updateTime=-1,this.nextGameTick=-1,this.paintTime=-1,this.skipFrameCount=-1,this.stackTick=0,this.reqAnim=null,t}tickFunc(t){if(this.requestTick(),-1===this.updateTime&&(this.updateTime=t),-1===this.nextGameTick&&(this.nextGameTick=t),-1===this.paintTime&&(this.paintTime=t),-1===this.skipFrameCount&&(this.skipFrameCount=this.maxFrameSkipCount),this.isSleep)return this.updateTime=t,this.paintTime=t,this.nextGameTick=t,void(this.skipFrameCount=this.maxFrameSkipCount);const e=t-this.updateTime;this.updateTime=t;const n=Math.max(60,this.getFramerate()),r=x(1e3/e,n);this.framerate=Math.min(n,r);let i=0,o=t;for(;;){if((this.update>0||i>0)&&(performance.now()-this.paintTime>=1e3/this.getFramerate()||this.isPaintDefault)&&(this.useAnimationFrame&&"requestAnimationFrame"in self?null===this.reqAnim&&(this.reqAnim=requestAnimationFrame((()=>{new N.j(this,"paint").trigger({now:t,framerate:r,fps:this.getFramerate()}),this.reqAnim=null})),this.isPaintDefault=!1,this.paintTime=t):(new N.j(this,"paint").trigger({now:t,framerate:r,fps:this.getFramerate()}),this.isPaintDefault=!1,this.paintTime=t)),this.nextGameTick>=t){this.isSkip||(this.skipFrameCount=Math.min(this.maxFrameSkipCount,this.skipFrameCount+.5)),this.isSkip=!1;break}if(i>=this.skipFrameCount){this.skipFrameCount=Math.max(1,this.skipFrameCount-1|0),this.stackTick=t-this.nextGameTick,this.isSkip=!0;break}0===i&&new N.j(this,"updatebegin").trigger({now:t,framerate:r,fps:this.getFramerate()}),i++;const e=performance.now(),n=e-o+this.stackTick;o=e;const s=n/(1e3/60)*this.speed;new N.j(this,"update").trigger({time:s,now:t,framerate:r,fps:this.getFramerate()}),this.stackTick=0,this.nextGameTick+=n}const s=Math.max(0,e-(performance.now()-t));(i>0||this.isUpdateDefault)&&(this.isUpdateDefault=!1,new N.j(this,"updateend").trigger({time:s/(1e3/60),now:t,framerate:r,fps:this.getFramerate()})),this.paintTime===t?this.update=0:this.update+=i}requestTick(){null===this.timeout&&(this.timeout=setTimeout((()=>{const t=performance.now();this.timeout=null,this.tickFunc(t)})))}cancelTick(){return null!==this.timeout&&(clearTimeout(this.timeout),this.timeout=null,!0)}run(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return!(this.isError||this.hasRun()||this.isSleep&&!t||(this.reset(),this.isSleep=!1,this.requestTick(),0))}stop(){return!this.hasRun()||(this.reset(),this.cancelTick())}getNowFramerate(){return this.framerate}hasRun(){return null!==this.timeout}hasSleep(){return this.isSleep}getSpeed(){return this.speed}getMaxSkipFrameCount(){return this.maxFrameSkipCount}setSpeed(t){this.speed=t}setMaxSkipFrameCount(){return this.maxFrameSkipCount}clear(){this.setSpeed(1)}}{constructor(){super(...arguments),this.id=(0,z.D)(),this.additionals=new Array,this.movables=new Array,this.physicals=new Array,this.offsets=new Array,this.preadditionals=new Array,this.premovables=new Array,this.prephysicals=new Array,this.preoffsets=new Array,this.endings=new Array,this.renderings=new Array,this.destructors=new Array,this.heapSystem=new WeakMap,this.entitys=new Array,this.stands=new Array,this.entitysID={},this.entitysName={}}getID(){return this.id}addSystems(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];e.forEach((t=>{t.additional!==j.prototype.additional&&this.additionals.push(t),t.movable!==j.prototype.movable&&this.movables.push(t),t.physical!==j.prototype.physical&&this.physicals.push(t),t.offset!==j.prototype.offset&&this.offsets.push(t),t.preadditional!==j.prototype.preadditional&&this.preadditionals.push(t),t.premovable!==j.prototype.premovable&&this.premovables.push(t),t.prephysical!==j.prototype.prephysical&&this.prephysicals.push(t),t.preoffset!==j.prototype.preoffset&&this.preoffsets.push(t),t.rendering!==j.prototype.ending&&this.endings.push(t),t.rendering!==j.prototype.rendering&&this.renderings.push(t),t.destructor!==j.prototype.destructor&&this.destructors.push(t)}))}check(){for(;this.stands.length>0;){const t=this.stands.shift()||null;if(null===t||!t.hasLive()||this.entitys.includes(t))continue;this.entitys.push(t),this.entitysID[t.getID()]=t;const e=t.getNames();for(let n=0,r=0|e.length;n<r;n=n+1|0){const r=e[n];this.entitysName.hasOwnProperty(r)||(this.entitysName[r]=new Array),this.entitysName[r].push(t)}}}syncEntitys(){const t=[...this.additionals,...this.movables,...this.physicals,...this.offsets,...this.renderings,...this.destructors];for(let e=0,n=0|arguments.length;e<n;e=e+1|0){const n=e<0||arguments.length<=e?void 0:arguments[e],r=n.getNames();for(let t=0,e=0|r.length;t<e;t=t+1|0){const e=r[t];this.entitysName.hasOwnProperty(e)||(this.entitysName[e]=new Array),this.entitysName[e].push(n)}for(const t in this.entitysName){const e=this.entitysName[t];e.includes(n)&&(e.splice(e.indexOf(n),1),0===e.length&&delete this.entitysName[t])}for(let e=0,r=0|t.length;e<r;e=e+1|0){const r=t[e];this.heapSystem.has(r)||this.heapSystem.set(r,new Array);const i=this.heapSystem.get(r)||[];r.hasEntity(n)?i.includes(n)||i.push(n):i.includes(n)&&i.splice(i.indexOf(n),1)}}}addEntitys(){for(let t=0,e=0|arguments.length;t<e;t=t+1|0){const e=t<0||arguments.length<=t?void 0:arguments[t];this.entitys.includes(e)||this.stands.includes(e)||this.stands.push(e)}}removeEntitys(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var r;const i=[...this.additionals,...this.movables,...this.physicals,...this.offsets];for(let t=0,n=0|this.destructors.length;t<n;t=t+1|0){const n=this.destructors[t],i=((null===(r=this.heapSystem.get(n))||void 0===r?void 0:r.slice())||[]).filter((t=>e.includes(t)));for(let t=0,e=0|i.length;t<e;t=t+1|0){const e=i[t];(!e.hasUpdate()||n.hasEntity(e))&&n.destructor(e,this)}}for(let t=0,n=0|e.length;t<n;t=t+1|0){const n=e[t];this.entitys.splice(this.entitys.indexOf(n),1),delete this.entitysID[n.getID()];for(const t in this.entitysName){const e=this.entitysName[t];e.includes(n)&&(e.splice(e.indexOf(n),1),0===e.length&&delete this.entitysName[t])}n.destroy();for(let t=0,e=0|i.length;t<e;t=t+1|0){const e=i[t],r=this.heapSystem.get(e)||[];r.includes(n)&&r.splice(r.indexOf(n),1)}}}hasEntity(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return e.some((t=>t.hasLive()&&-1!==Object.keys(this.entitys).indexOf(t.getID())))}getEntitys(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t=>!0;return this.entitys.filter((e=>e.hasLive()&&t(e)))}getEntityOfID(t){if(!this.entitysID.hasOwnProperty(t))return null;const e=this.entitysID[t];return e.hasLive()?e:null}getEntitysOfName(){const t=new Array;for(let e=0,n=0|arguments.length;e<n;e=e+1|0){const n=e<0||arguments.length<=e?void 0:arguments[e];this.entitysName.hasOwnProperty(n)&&t.push(...this.entitysName[n].filter((e=>e.hasLive()&&!t.includes(e))))}return t}clear(){for(let t=0,e=0|this.stands.length;t<e;t=t+1|0)this.stands[t].remove();for(let t=0,e=0|this.entitys.length;t<e;t=t+1|0)this.entitys[t].remove();super.clear()}onupdate(t){var e,n,r,i;const{time:o,now:s,framerate:a,fps:l}=t;new N.j(this,"ecsbegin").trigger({time:o,now:s,framerate:a,fps:l});const c=new Array,d=new Array;let u=0;for(let t=0,e=0|this.entitys.length;t<e;t=t+1|0){const e=this.entitys[t];if(e.hasLive()){if(u++,!e.checkUpdate())continue;c.push(e)}else d.push(e)}var h,f;c.length>0&&this.syncEntitys(...c),d.length>0&&this.removeEntitys(...d),h="entity",f="entitys:".concat(u),V.push({id:h,message:f}),new N.j(this,"beforeadditional").trigger({time:o,now:s,framerate:a,fps:l});for(let t=0,e=0|this.preadditionals.length;t<e;t=t+1|0)this.preadditionals[t].preadditional(o,this);for(let t=0,n=0|this.additionals.length;t<n;t=t+1|0){const n=this.additionals[t],r=(null===(e=this.heapSystem.get(n))||void 0===e?void 0:e.slice())||[];for(let t=0,e=0|r.length;t<e;t=t+1|0){const e=r[t];e.hasLive()&&(!e.hasUpdate()||n.hasEntity(e))&&n.additional(o,e,this)}}new N.j(this,"beforemoveble").trigger({time:o,now:s,framerate:a,fps:l});for(let t=0,e=0|this.premovables.length;t<e;t=t+1|0)this.premovables[t].premovable(o,this);for(let t=0,e=0|this.movables.length;t<e;t=t+1|0){const e=this.movables[t],r=(null===(n=this.heapSystem.get(e))||void 0===n?void 0:n.slice())||[];for(let t=0,n=0|r.length;t<n;t=t+1|0){const n=r[t];n.hasLive()&&(!n.hasUpdate()||e.hasEntity(n))&&e.movable(o,n,this)}}new N.j(this,"beforephysical").trigger({time:o,now:s,framerate:a,fps:l});for(let t=0,e=0|this.prephysicals.length;t<e;t=t+1|0)this.prephysicals[t].prephysical(o,this);for(let t=0,e=0|this.physicals.length;t<e;t=t+1|0){const e=this.physicals[t],n=(null===(r=this.heapSystem.get(e))||void 0===r?void 0:r.slice())||[];for(let t=0,r=0|n.length;t<r;t=t+1|0){const r=n[t];r.hasLive()&&(!r.hasUpdate()||e.hasEntity(r))&&e.physical(o,r,this)}}new N.j(this,"beforeoffset").trigger({time:o,now:s,framerate:a,fps:l});for(let t=0,e=0|this.preoffsets.length;t<e;t=t+1|0)this.preoffsets[t].preoffset(o,this);for(let t=0,e=0|this.offsets.length;t<e;t=t+1|0){const e=this.offsets[t],n=(null===(i=this.heapSystem.get(e))||void 0===i?void 0:i.slice())||[];for(let t=0,r=0|n.length;t<r;t=t+1|0){const r=n[t];r.hasLive()&&(!r.hasUpdate()||e.hasEntity(r))&&e.offset(o,r,this)}}this.check(),new N.j(this,"ecsend").trigger({time:o,now:s,framerate:a,fps:l})}onupdateend(t){var e;for(let t=0,n=0|this.endings.length;t<n;t=t+1|0){const n=this.endings[t],r=(null===(e=this.heapSystem.get(n))||void 0===e?void 0:e.slice())||[];for(let t=0,e=0|r.length;t<e;t=t+1|0){const e=r[t];e.hasLive()&&(!e.hasUpdate()||n.hasEntity(e))&&n.ending(e,this)}}}onpaint(t){var e;for(let t=0,n=0|this.renderings.length;t<n;t=t+1|0){const n=this.renderings[t],r=(null===(e=this.heapSystem.get(n))||void 0===e?void 0:e.slice())||[];for(let t=0,e=0|r.length;t<e;t=t+1|0){const e=r[t];e.hasLive()&&(!e.hasUpdate()||n.hasEntity(e))&&n.rendering(e,this)}}}}{constructor(t,e,n,r,i,o){super(!1),this.name=t,this.scenes=e,this.renderers=n,this.assets=r,this.controls=i,this.sounds=o}getName(){return this.name}getRendererManager(){return this.renderers}getAssetManager(){return this.assets}getControlManager(){return this.controls}getSoundManager(){return this.sounds}createSound(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return this.sounds.create(t,e,null===n?(0,z.D)():n)}getSound(t){return this.sounds.getSound(t)}hasSound(t){return this.sounds.hasSound(t)}getSceneManager(){return this.scenes}clear(){const t=this.getSceneManager(),e=this.getControlManager();t.clear(),e.clear(),super.clear()}oninactive(){this.getControlManager().clear()}onupdatebegin(t){let{time:e,now:n,framerate:r,fps:i}=t;new N.j(this.getControlManager(),"update").trigger({time:e,now:n,framerate:r,fps:i})}onupdateend(t){const{time:e,now:n,framerate:r,fps:i}=t;new N.j(this.getSceneManager(),"update").trigger({time:e,now:n,framerate:r,fps:i}),new N.j(this.getRendererManager(),"update").trigger({time:e,now:n,framerate:r,fps:i}),new N.j(this.getSoundManager(),"update").trigger({time:e,now:n,framerate:r,fps:i})}}{constructor(t,e,n,r,i,o){super(t,e,n,r,i,o)}createTransferUIData(){return[]}}{constructor(t,e,n,r,i,s,a,l,c,d,u,h,f,g,m,p){super(t,a,l,c,d,u),this.isForceUpdate=!1,this.tile_set=null,this.background=null,this.mats={},this.lateTime=0,this.trees={range:new F((t=>t instanceof Y&&t.hasComponent(W)),(t=>{if(!(t instanceof Y))return[-1,-1,-1,-1,-1];const e=t.getComponent(W),n=e.treeFix&&t.hasComponent(nt)?t.getComponent(nt).position:new o.P(0,0,0);return[t.position.x+n.x,t.position.y+n.y,t.position.z+n.z,e.size.x,e.size.y]})),hitbox:new F((t=>t instanceof Y&&t.hasComponent(Q)),(t=>{if(!(t instanceof Y))return[-1,-1,-1,-1,-1];const e=t.getComponent(Q),n=e.treeFix&&t.hasComponent(nt)?t.getComponent(nt).position:new o.P(0,0,0);return[t.position.x+n.x,t.position.y+n.y,t.position.z+n.z,e.size.x,e.size.y]})),collision:new F((t=>t instanceof Y&&t.hasComponent(K)),(t=>{if(!(t instanceof Y))return[-1,-1,-1,-1,-1];const e=t.getComponent(K),n=e.treeFix&&t.hasComponent(nt)?t.getComponent(nt).position:new o.P(0,0,0);return[t.position.x+n.x,t.position.y+n.y,t.position.z+n.z,e.size.x,e.size.y]}))},this.finder=new tt,this.margin=i,this.materials=h,this.voxels=f,this.camera=m,this.sun=p,this.addEntitys(m,p),this.transferDataBuilder=new ct(g,s,1/0),this.offset={top:i,bottom:i,front:i,back:i,right:i,left:i},this.map=new A(e,n,r,"int32",1,1)}initTrees(t){for(const e in this.trees){const n=this.trees[e];n.hasEntity(t)&&n.initOldPosition(t)}}addEntitys(){for(let t=0,e=0|arguments.length;t<e;t=t+1|0){const e=t<0||arguments.length<=t?void 0:arguments[t];for(const t in this.trees)this.trees[t].add(e)}super.addEntitys(...arguments)}removeEntitys(){for(let t=0,e=0|arguments.length;t<e;t=t+1|0){const e=t<0||arguments.length<=t?void 0:arguments[t];for(const t in this.trees)this.trees[t].remove(e)}super.removeEntitys(...arguments)}getMaterialManager(){return this.materials}getVoxelManager(){return this.voxels}getMap(){return this.map}getWorldDistance(){return this.map.getWorldDistance()}getWorldSize(){return this.map.getSize()}getCamera(){return this.camera}getSun(){return this.sun}getMargin(){return this.margin}getOffset(){return this.offset}getVoxel(t,e,n){return this.getVoxelManager().getVoxel(this.map.get(0,t,e,n)-1)}getDistanceField(t,e,n){let r=this.map.get(0,t,e,n,this.map.getDistanceField(),this.map.getSize());return-1===r?0:r}getMaterials(){return this.mats}getTileSet(){return this.tile_set}getBackground(){return this.background||{theme:0,rise_up_color:[50/255,125/255,50/255],night_up_color:[50/255,125/255,50/255],rise_down_color:[100/255,125/255,50/255],night_down_color:[100/255,125/255,50/255],material_up:[1,.625,.075],material_down:[1,.625,0],noise_size:5,noise_length:2}}getLateTime(){return this.lateTime}getTree(t){return this.trees[t]||null}setWorldSize(t,e,n,r,i,o,s,a,l){this.map.setSize(t,e,n),this.offset.top=r,this.offset.bottom=i,this.offset.front=o,this.offset.back=s,this.offset.right=a,this.offset.left=l}setActorPosition(t,e,n,r){t.position.x=e,t.position.y=n,t.position.z=r;for(const e in this.trees)this.trees[e].setOldPosition(t)}setCamera(t){this.camera=t}setSun(t){this.sun=t}setTileSet(t){this.tile_set!==t&&(this.isForceUpdate=!0),this.tile_set=t}setBackground(t){this.background=t}setMaterials(t){for(const e in t)this.mats[e]=t[e]}setVoxel(t,e,n,r){let i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],o=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const s=this.getVoxelManager(),a=s.getVoxels(),l=this.map.get(0,t,e,n)-1,c=s.getVoxel(l);l>0&&this.map.getCount(l+1)<=0&&(c!==et.xZ||c!==et.g7)&&s.removeVoxels(c);let d=!1;for(let t=0,e=0|a.length;t<e;t=t+1|0){const e=a[t];if(null!==e&&st(e,r)){d=!0;break}}d||s.addVoxels(r);const u=a.find((t=>null!==t&&st(t,r)));if(void 0!==u){const r=a.indexOf(u)+1;this.map.set(0,t,e,n,r,i)}o&&(r===et.g7?this.reductionPosition():this.expandPosition())}setDistanceField(t,e,n,r){this.map.set(0,t,e,n,r,!1,this.map.getDistanceField())}hasOutOfWorld(t,e,n){return function(t,e,n,r){const[i,o,s]=t.getSize();return e<=0||e>=i-1||n<=0||n>=o-1||r<=0||r>=s-1}(this.map,t,e,n)}clear(){const t=this.getMap(),e=this.getVoxelManager(),n=this.getControlManager();t.clear(),e.clear(),n.clear();for(const t in this.trees)this.trees[t].clear();this.lateTime=0,super.clear()}hitScanVoxel(t,e,n,r,i,o){return M(t,e,n,r,i,o,((t,e,n)=>this.getDistanceField(t,e,n)))}hasHitScanVoxel(t,e,n,r,i,o){const[s,a,l]=this.hitScanVoxel(t,e,n,r,i,o);return!(-1===s&&-1===a&&-1===l)}hasHitScanBoldFind(t,e,n,r,i,o,s){let a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:1/0,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:new Array;const[c,d,u,,]=this.hitScanBoldFind(t,e,n,r,i,o,s,a,l);return-1!==c&&-1!==d&&-1!==u}hasHitScanBold(t,e,n,r,i,o,s){let a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:1/0,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:new Array;const[c,d,u,,]=this.hitScanBold(t,e,n,r,i,o,s,a,l);return-1!==c&&-1!==d&&-1!==u}hasHitScanVoxelBoldFind(t,e,n,r,i,o){let s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1/0;const[a,l,c]=this.hitScanVoxelBold(t,e,n,r,i,o,s);return-1!==a&&-1!==l&&-1!==c}hasHitScanVoxelBold(t,e,n,r,i,o){let s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1/0;const[a,l,c]=this.hitScanVoxelBold(t,e,n,r,i,o,s);return-1!==a&&-1!==l&&-1!==c}hasBlockScaleVoxel(t,e,n,r,i){return function(t,e,n,r,i){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:()=>!1;(0,u.vF)(m);const s=T(t,e,n,r,i,m);for(let a=0,l=0|s.length;a<l;a=a+3|0){const l=s[a],c=s[a+1],d=s[a+2];if(o("type",l,c,d)&&h(l,c,d,t,e,n,r,i))return!0}return!1}(t,e,n,r,i,((t,e,n,r)=>this.getVoxel(e,n,r)!==et.g7))}hasBlockScale(t,e,n,r,i,s){let a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:new Array;if(this.hasBlockScaleVoxel(e,n,r,i,s))return!0;const l=new Array,c=this.trees[t],d=t=>a.includes(t),u=T(e,n,r,i,s,[]);for(let t=0,a=0|u.length;t<a;t=t+3|0){const a=u[t],h=u[t+1],f=u[t+2],m=c.getPointCell(a,h,f);for(let t=0,a=0|m.length;t<a;t=t+1|0){const a=this.getEntityOfID(m[t]);if(null===a||!a.hasLive()||l.includes(a)||a.getNames().some(d)||d(a.getID()))continue;const[u,h,f,p,v]=c.getEntityProperty(a);if(-1===u&&-1===h&&-1===f)continue;let[b,y,_,,,]=c.getOldEntityProperty(a);b=-1===b?u:b,y=-1===y?h:y,_=-1===_?f:_;const w=u-b,E=h-y,O=f-_,R=(0,o.X6)(w,E,O,0,0,0),[S,T]=(0,o.tx)(w,E,O,0,0,0),L=Math.min(R,p/4,v/4,.5),[M,P,I]=(0,o.c8)(S,T,0,0,1);let B=0;for(;;){if(g(e,n,r,i,s,b+B*M,y+B*P,_+B*I,p,v))return!0;if(B>=R)break;B=Math.min(R,x(B+L,R,1e5,Math.ceil))}}}return!1}getEntitysOfRange(t,e,n,r,i,s){let a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:new Array;const l=new Array,c=new Array,d=this.trees[t],u=t=>a.includes(t),h=T(e,n-s/2,r,i,s,[]);for(let t=0,a=0|h.length;t<a;t=t+3|0){const a=h[t],f=h[t+1],m=h[t+2],p=d.getPointCell(a,f,m);for(let t=0,a=0|p.length;t<a;t=t+1|0){const a=p[t],h=this.getEntityOfID(a);if(null===h||!h.hasLive()||c.includes(h)||h.getNames().some(u)||u(a))continue;const[f,m,v,b,y]=d.getEntityProperty(h);if(-1===f&&-1===m&&-1===v)continue;let[_,w,E,,,]=d.getOldEntityProperty(h);_=-1===_?f:_,w=-1===w?m:w,E=-1===E?v:E;const O=f-_,R=m-w,S=v-E,T=(0,o.X6)(O,R,S,0,0,0),[L,M]=(0,o.tx)(O,R,S,0,0,0),P=Math.min(T,b/4,y/4,.5),[I,B,C]=(0,o.c8)(L,M,0,0,1);let A=0;for(;;){if(g(e,n-s/2,r,i,s,_+A*I,w+A*B,E+A*C,b,y)){l.push(h);break}if(A>=T)break;A=Math.min(T,x(A+P,T,1e5,Math.ceil))}}}return l}getEntitysOfLine(t,e,n,r,i,s,a){let l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:[],c=arguments.length>8&&void 0!==arguments[8]?arguments[8]:(t,e,n)=>!1;const d=new Array,h=new Array,f=t=>l.includes(t),g=this.trees[t];return L(e,n,r,i,s,a,c,((t,l,c,u,m,p,v,b,_,w,E,O,R,S,T,L,M,P)=>{const I=g.getPointCell(t,l,c);for(let t=0,l=0|I.length;t<l;t=t+1|0){const l=I[t],c=this.getEntityOfID(l);if(null===c||!c.hasLive()||h.includes(c)||c.getNames().some(f)||f(l))continue;const[v,b,_,w,E]=g.getEntityProperty(c);if(-1===v&&-1===b&&-1===_)continue;let[O,R,S,,,]=g.getOldEntityProperty(c);O=-1===O?v:O,R=-1===R?b:R,S=-1===S?_:S;const T=v-O,L=b-R,M=_-S,P=(0,o.X6)(T,L,M,0,0,0),[B,C]=(0,o.tx)(T,L,M,0,0,0),[A,k,D]=(0,o.c8)(B,C,0,0,1),F=Math.min(P,w/4,E/4,.5);let z=0;for(;;){const t=O+z*A,l=R+z*k,f=S+z*D;if((r<u?r<t+w/2:u<t+w/2)&&(i<m?i<l+E:m<l+E)&&(s<p?s<f+w/2:p<f+w/2)&&(r>u?r>t-w/2:u>t-w/2)&&(i>m?i>l:m>l)&&(s>p?s>f-w/2:p>f-w/2)){const[u,g,m]=y(r,i,s,e,n,t,l,f,t,l+E,f,w);if(-1!==u||-1!==g||-1!==m){const t=(0,o.X6)(u,g,m,r,i,s);if(t<a){h.push(c),d.push([u,g,m,t,c]);break}}}if(z>=P)break;z=Math.min(P,x(z+F,P,1e5,Math.ceil))}}return d.length>0})),d.length>1&&(0,u.qr)(d).asc((t=>t[3])),d}hitScan(t,e,n,r,i,s,a){let l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:[];const c=new Array,d=new Array,h=this.trees[t],f=t=>l.includes(t),[g,m,p,v]=L(e,n,r,i,s,a,((t,e,n)=>this.getVoxel(t,e,n)!==et.g7),((t,l,u,g,m,p,v,b,_,w,E,O,R,S,T,L,M,P)=>{const I=h.getPointCell(t,l,u);for(let t=0,l=0|I.length;t<l;t=t+1|0){const l=this.getEntityOfID(I[t]);if(null===l||!l.hasLive()||d.includes(l)||l.getNames().some(f)||f(l.getID()))continue;const[u,v,b,_,w]=h.getEntityProperty(l);if(-1===u&&-1===v&&-1===b)continue;let[E,O,R,,,]=h.getOldEntityProperty(l);E=-1===E?u:E,O=-1===O?v:O,R=-1===R?b:R;const S=u-E,T=v-O,L=b-R,M=(0,o.X6)(S,T,L,0,0,0),P=x(Math.min(a,(0,o.X6)(g,m,p,r,i,s)/a),0),[B,C]=(0,o.tx)(S,T,L,0,0,0),[A,k,D]=(0,o.c8)(B,C,0,0,1),F=u+M*P*A,z=v+M*P*k,N=b+M*P*D;if((r<g?r<F+_/2:g<F+_/2)&&(i<m?i<z+w:m<z+w)&&(s<p?s<N+_/2:p<N+_/2)&&(r>g?r>F-_/2:g>F-_/2)&&(i>m?i>z:m>z)&&(s>p?s>N-_/2:p>N-_/2)){const[t,u,h]=y(r,i,s,e,n,F,z,N,F,z+w,N,_);if(-1===t&&-1===u&&-1===h)continue;const f=(0,o.X6)(t,u,h,r,i,s);f<a&&(d.push(l),c.push([t,u,h,f,l]))}}return c.length>0}));return c.length>1&&(0,u.qr)(c).asc((t=>t[3])),c.push([g,m,p,v,null]),c[0]}hasHitScan(t,e,n,r,i,s,a){let l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:[];const c=new Array,d=new Array,u=new Array,h=this.trees[t],[f,g,m]=L(e,n,r,i,s,a,((t,e,n)=>this.getVoxel(t,e,n)!==et.g7),((t,f,g,m,p,v,b,_,w,E,O,R,S,T,L,M,P,I)=>{const B=h.getPointCell(t,f,g);for(let t=0,f=0|B.length;t<f;t=t+1|0){const f=this.getEntityOfID(B[t]);if(null===f||!f.hasLive()||u.includes(f))continue;if(f instanceof Y&&f.getNames().some((t=>l.includes(t)))){u.push(f);continue}const[g,b,_,w,E]=h.getEntityProperty(f);if(-1===g&&-1===b&&-1===_)continue;let[O,R,S,,,]=h.getOldEntityProperty(f);O=-1===O?g:O,R=-1===R?b:R,S=-1===S?_:S;const T=(0,o.X6)(g,b,_,O,R,S),L=x(Math.min(1,(0,o.X6)(m,p,v,r,i,s)/a),0),[M,P]=(0,o.tx)(g,b,_,O,R,S),[I,C,A]=(0,o.c8)(M,P,0,0,1),k=g+T*L*I,D=b+T*L*C,F=_+T*L*A;if((r<m?r<k+w/2:m<k+w/2)&&(i<p?i<D+E:p<D+E)&&(s<v?s<F+w/2:v<F+w/2)&&(r>m?r>k-w/2:m>k-w/2)&&(i>p?i>D:p>D)&&(s>v?s>F-w/2:v>F-w/2)){const[t,l,u]=y(r,i,s,e,n,k,D,F,k,D+E,F,w);if(-1===t&&-1===l&&-1===u)continue;const h=(0,o.X6)(t,l,u,r,i,s);h<a&&(d.push(f),c.push([t,l,u,h,f]))}}return!1}));return-1!==f&&-1!==g&&-1!==m}hasHitScanActor(t,e,n,r,i,s,a){let l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:[];const c=new Array,d=this.trees[t];let u=!1;return L(e,n,r,i,s,a,((t,e,n)=>this.getVoxel(t,e,n)!==et.g7),((t,h,f,g,m,p,v,b,_,w,E,O,R,S,T,L,M,P)=>{const I=d.getPointCell(t,h,f);for(let t=0,h=0|I.length;t<h;t=t+1|0){const h=this.getEntityOfID(I[t]);if(null===h||!h.hasLive()||c.includes(h))continue;if(h instanceof Y&&h.getNames().some((t=>l.includes(t)))){c.push(h);continue}const[f,v,b,_,w]=d.getEntityProperty(h);if(-1===f&&-1===v&&-1===b)continue;let[E,O,R,,,]=d.getOldEntityProperty(h);E=-1===E?f:E,O=-1===O?v:O,R=-1===R?b:R;const S=f-E,T=v-O,L=b-R,M=(0,o.X6)(S,T,L,0,0,0),P=x(Math.min(1,(0,o.X6)(g,m,p,r,i,s)/a),0),[B,C]=(0,o.tx)(S,T,L,0,0,0),[A,k,D]=(0,o.c8)(B,C,0,0,1),F=f+M*P*A,z=v+M*P*k,N=b+M*P*D;if((r<g?r<F+_/2:g<F+_/2)&&(i<m?i<z+w:m<z+w)&&(s<p?s<N+_/2:p<N+_/2)&&(r>g?r>F-_/2:g>F-_/2)&&(i>m?i>z:m>z)&&(s>p?s>N-_/2:p>N-_/2)){const[t,l,c]=y(r,i,s,e,n,F,z,N,F,z+w,N,_);if(-1===t&&-1===l&&-1===c)continue;if((0,o.X6)(t,l,c,r,i,s)<a)return u=!0,!0}}return!1})),u}hitScanBold(t,e,n,r,i,s,a,l){let c=arguments.length>8&&void 0!==arguments[8]?arguments[8]:[];const d=new Array,h=t=>c.includes(t),f=this.trees[t],[m,p,v]=this.getWorldSize(),b=Math.min(l,(0,o.X6)(m,p,v,0,0,0)),[y,_,w]=(0,o.c8)(e,n,0,0,b),E=(0,o.X6)(y,_,w,0,0,0),[O,R]=(0,o.tx)(y,_,w,0,0,0),[S,L,M]=(0,o.c8)(O,R,0,0,1),P=Math.min(E,a,.5);let I,B=new Array,C=null,A=0;for(;;){const t=r+A*S,l=i+A*L,c=s+A*M,u=T(t,l-a/2,c,a,a);for(let m=0,p=0|u.length;m<p;m=m+3|0){const p=u[m+0],v=u[m+1],y=u[m+2];if(this.getVoxel(p,v,y)!==et.g7){const[a,u]=(0,o.tx)(p+.5,v+.5,y+.5,t,l,c),h=(0,o.X6)(p+.5,v+.5,y+.5,t,l,c),f=Math.cos(a)+Math.sin(a),g=Math.sin(u)+Math.cos(u),[m,b,x]=(0,o.c8)(e,n,0,0,h-Math.sqrt(Math.max(f*f,g*g))+(0,o.X6)(t,l,c,r,i,s));d.push([m+r,b+i,x+s,(0,o.X6)(m+r,b+i,x+s,r,i,s),null]),I=!0}const _="".concat(p,",").concat(v,",").concat(y);B=_!==C?f.getPointCell(p,v,y):B,C=_;for(let e=0,n=0|B.length;e<n;e=e+1|0){const n=B[e],u=this.getEntityOfID(n);if(null===u||!u.hasLive()||h(u.getID())||u.getNames().some(h))continue;const[m,p,v,y,_]=f.getEntityProperty(u);if(-1===m&&-1===p&&-1===v)continue;let[w,O,R,,,]=f.getOldEntityProperty(u);w=-1===w?m:w,O=-1===O?p:O,R=-1===R?v:R;const S=m-w,T=p-O,L=v-R,M=x(Math.min(1,A/E),0),[P,I]=(0,o.tx)(S,T,L,0,0,0),[C,k,D]=(0,o.c8)(P,I,0,0,1),F=(0,o.X6)(S,T,L,0,0,0);if(g(t,l-a/2,c,a,a,w+F*M*C,O+F*M*k,R+F*M*D,y,_)){const e=t,n=l,a=c,h=(0,o.X6)(e,n,a,r,i,s);h<b&&d.push([e,n,a,h,u])}}}if(I||A>=E){A=E;break}A=Math.min(E,x(A+P,E,1e5,Math.ceil))}return d.length>0?((0,u.qr)(d).asc((t=>t[3])),d[0]):[-1,-1,-1,-1,null]}hitScanBoldFind(t,e,n,r,i,s,a,l){let c=arguments.length>8&&void 0!==arguments[8]?arguments[8]:[];const d=new Array,h=t=>c.includes(t),f=this.trees[t];let m=new Array,p=null,[v,b,y,_]=this.hitScanVoxelBoldFindMax(e,n,r,i,s,a,1/0);if(-1!==v&&-1!==b&&-1!==y){const t=Math.min(l,_),e=v-r,n=b-i,c=y-s,w=(0,o.X6)(e,n,c,0,0,0),[E,O]=(0,o.tx)(e,n,c,0,0,0),[R,S,L]=(0,o.c8)(E,O,0,0,1),M=Math.min(w,a,.5);let P=0;for(;;){const e=r+P*R,n=i+P*S,l=s+P*L,c=T(e,n-a/2,l,a,a);for(let u=0,v=0|c.length;u<v;u=u+3|0){const v=c[u+0],b=c[u+1],y=c[u+2],_="".concat(v,",").concat(b,",").concat(y);m=_!==p?f.getPointCell(v,b,y):m,p=_;for(let c=0,u=0|m.length;c<u;c=c+1|0){const u=m[c],p=this.getEntityOfID(u);if(null===p||!p.hasLive()||h(p.getID())||p.getNames().some(h))continue;const[v,b,y,_,E]=f.getEntityProperty(p);if(-1===v&&-1===b&&-1===y)continue;let[O,R,S,,,]=f.getOldEntityProperty(p);O=-1===O?v:O,R=-1===R?b:R,S=-1===S?y:S;const T=v-O,L=b-R,M=y-S,I=x(Math.min(1,P/w),0),[B,C]=(0,o.tx)(T,L,M,0,0,0),[A,k,D]=(0,o.c8)(B,C,0,0,1),F=(0,o.X6)(T,L,M,0,0,0);if(g(e,n-a/2,l,a,a,O+F*I*A,R+F*I*k,S+F*I*D,_,E)){const a=e,c=n,u=l,h=(0,o.X6)(a,c,u,r,i,s);h<t&&d.push([a,c,u,h,p])}}}if(P>=w){P=w;break}P=Math.min(w,x(P+M,w,1e5,Math.ceil))}if(d.length>1)return(0,u.qr)(d).asc((t=>t[3])),d[0]}return 0===d.length&&([v,b,y,_]=this.hitScanVoxelBoldFindMin(e,n,r,i,s,a,l)),[v,b,y,_,null]}hitScanVoxelBoldFindMin(t,e,n,r,i,s){let a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1/0,l=-1,c=-1,d=-1,u=1/0;const h=s/2;let f=!1;for(let s=0,g=0|ot.length;s<g;s=s+1|0){const g=(0,o.KO)(ot[s][0],ot[s][1],0,0),m=Math.cos(g)*h,p=Math.sin(g)*h,[v,b,y]=(0,o.c8)(t,e,m,p,0),[x,_,w,E]=this.hitScanVoxel(t,e,n+v,r+b,i+y,a);-1!==x&&-1!==_&&-1!==w&&E<u&&(l=x-v,c=_-b,d=w-y,u=E,f=!0)}return[l,c,d,f?u:-1]}hitScanVoxelBoldFindMax(t,e,n,r,i,s){let a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1/0,l=-1,c=-1,d=-1,u=0;const h=s/2;let f=!1;for(let s=0,g=0|ot.length;s<g;s=s+1|0){const g=(0,o.KO)(ot[s][0],ot[s][1],0,0),m=Math.cos(g)*h,p=Math.sin(g)*h,[v,b,y]=(0,o.c8)(t,e,m,p,0),[x,_,w,E]=this.hitScanVoxel(t,e,n+v,r+b,i+y,a);-1!==x&&-1!==_&&-1!==w&&E>u&&(l=x-v,c=_-b,d=w-y,u=E,f=!0)}return[l,c,d,f?u:-1]}hitScanVoxelBold(t,e,n,r,i,s,a){const l=new Array,[c,d,h]=this.getWorldSize(),f=Math.min(a,(0,o.X6)(c,d,h,0,0,0)),[g,m,p]=(0,o.c8)(t,e,0,0,f),v=(0,o.X6)(g,m,p,0,0,0),[b,y]=(0,o.tx)(g,m,p,0,0,0),[_,w,E]=(0,o.c8)(b,y,0,0,1),O=Math.min(v,s,.5);let R,S=0;for(;;){const a=n+S*_,c=r+S*w,d=i+S*E,u=T(a,c-s/2,d,s,s);for(let s=0,h=0|u.length;s<h;s=s+3|0){const h=u[s+0],f=u[s+1],g=u[s+2];if(this.getVoxel(h,f,g)!==et.g7){const[s,u]=(0,o.tx)(h+.5,f+.5,g+.5,a,c,d),m=(0,o.X6)(h+.5,f+.5,g+.5,a,c,d),p=Math.cos(s)+Math.sin(s),v=Math.sin(u)+Math.cos(u),[b,y,x]=(0,o.c8)(t,e,0,0,m-Math.sqrt(Math.max(p*p,v*v))+(0,o.X6)(a,c,d,n,r,i));l.push([b+n,y+r,x+i,(0,o.X6)(b+n,y+r,x+i,n,r,i),null]),R=!0}}if(R||S>=v){S=v;break}S=Math.min(v,x(S+O,v,1e5,Math.ceil))}return l.length>0?((0,u.qr)(l).asc((t=>t[3])),l[0]):[-1,-1,-1,-1,null]}expandPosition(){const[t,e,n]=this.getWorldSize(),r=this.getMargin();let i=0,o=0,s=0,a=t-1,l=e-1,c=n-1;t:for(;i<t;){for(let t=0;t<n;t=t+1|0)for(let n=0;n<e;n=n+1|0)if(this.getVoxel(i,n,t)!==et.g7&&this.getVoxel(i,n,t)!==et.xZ)break t;i+=1}t:for(;a>=0;){for(let t=0;t<n;t=t+1|0)for(let n=0;n<e;n=n+1|0)if(this.getVoxel(a,n,t)!==et.g7&&this.getVoxel(a,n,t)!==et.xZ)break t;a+=-1}t:for(;o<e;){for(let e=0;e<t;e=e+1|0)for(let t=0;t<n;t=t+1|0)if(this.getVoxel(e,o,t)!==et.g7&&this.getVoxel(e,o,t)!==et.xZ)break t;o+=1}t:for(;l>=0;){for(let e=0;e<t;e=e+1|0)for(let t=0;t<n;t=t+1|0)if(this.getVoxel(e,l,t)!==et.g7&&this.getVoxel(e,l,t)!==et.xZ)break t;l+=-1}t:for(;s<n;){for(let n=0;n<t;n=n+1|0)for(let t=0;t<e;t=t+1|0)if(this.getVoxel(n,t,s)!==et.g7&&this.getVoxel(n,t,s)!==et.xZ)break t;s+=1}t:for(;c>=0;){for(let n=0;n<t;n=n+1|0)for(let t=0;t<e;t=t+1|0)if(this.getVoxel(n,t,c)!==et.g7&&this.getVoxel(n,t,c)!==et.xZ)break t;c+=-1}let d=0,u=0,h=0;this.offset.left=r,d+=Math.min(0,i-r),this.offset.right=a+r,d+=Math.max(0,a+r-(t-1)),this.offset.bottom=r,u+=Math.min(0,o-r),this.offset.top=l+r,u+=Math.max(0,l+r-(e-1)),this.offset.back=r,h+=Math.min(0,s-r),this.offset.front=c+r,h+=Math.max(0,c+r-(n-1)),this.map.expand(d,u,h);const f=this.getEntitys();for(let t=0,e=0|f.length;t<e;t=t+1|0){const e=f[t];if(!(e instanceof Y))continue;const{position:n}=e;n.x+=Math.abs(d<0?d:0),n.y+=Math.abs(u<0?u:0),n.z+=Math.abs(h<0?h:0)}}reductionPosition(){const[t,e,n]=this.getWorldSize(),r=this.getMargin();let i=0,o=0,s=0,a=t-1,l=e-1,c=n-1;t:for(;i<t;){for(let t=0;t<n;t=t+1|0)for(let n=0;n<e;n=n+1|0)if(this.getVoxel(i,n,t)!==et.g7&&this.getVoxel(i,n,t)!==et.xZ)break t;i+=1}t:for(;a>=0;){for(let t=0;t<n;t=t+1|0)for(let n=0;n<e;n=n+1|0)if(this.getVoxel(a,n,t)!==et.g7&&this.getVoxel(a,n,t)!==et.xZ)break t;a+=-1}t:for(;o<e;){for(let e=0;e<t;e=e+1|0)for(let t=0;t<n;t=t+1|0)if(this.getVoxel(e,o,t)!==et.g7&&this.getVoxel(e,o,t)!==et.xZ)break t;o+=1}t:for(;l>=0;){for(let e=0;e<t;e=e+1|0)for(let t=0;t<n;t=t+1|0)if(this.getVoxel(e,l,t)!==et.g7&&this.getVoxel(e,l,t)!==et.xZ)break t;l+=-1}t:for(;s<n;){for(let n=0;n<t;n=n+1|0)for(let t=0;t<e;t=t+1|0)if(this.getVoxel(n,t,s)!==et.g7&&this.getVoxel(n,t,s)!==et.xZ)break t;s+=1}t:for(;c>=0;){for(let n=0;n<t;n=n+1|0)for(let t=0;t<e;t=t+1|0)if(this.getVoxel(n,t,c)!==et.g7&&this.getVoxel(n,t,c)!==et.xZ)break t;c+=-1}let d=0,u=0,h=0;this.offset.left=r,d+=Math.min(0,r-i),this.offset.right=a+r,d+=Math.max(0,t-1-(a+r)),this.offset.bottom=r,u+=Math.min(0,r-o),this.offset.top=l+r,u+=Math.max(0,e-1-(l+r)),this.offset.back=r,h+=Math.min(0,r-s),this.offset.front=c+r,h+=Math.max(0,n-1-(c+r)),this.map.reduction(d,u,h);const f=this.getEntitys();for(let t=0,e=0|f.length;t<e;t=t+1|0){const e=f[t];if(!(e instanceof Y))continue;const{position:n}=e;n.x-=Math.abs(d<0?d:0),n.y-=Math.abs(u<0?u:0),n.z-=Math.abs(h<0?h:0)}}findPath(t,e,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:(t,e)=>{e.block=!0},o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:t=>!0,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:t=>t.step,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:()=>!0,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:()=>0;return this.finder.find(t,e,n,r,i,o,s,a,l)}createTransferVoxelData(t,e,n){return n=n||this.isForceUpdate,this.isForceUpdate=!1,this.transferDataBuilder.createData(t,this.getAssetManager(),e,n)}onbeforeoffset(t){const[e,n,r]=this.getWorldSize();for(const t in this.trees)this.trees[t].update(e,n,r)}onupdateend(t){const{time:e}=t;this.lateTime+=1e-7*e,this.finder.update(e*(1e3/60)),super.onupdateend(t)}}))return;e.getCamera().fov=(0,o.c6)(t)})),this.setting.fov=t,this.saveSetting()}setFramerate(t){t>=dt.length&&(t=1),this.setting.framerate=t,this.saveSetting()}setSoundVolume(t){this.setting.soundVolume=t,this.saveSetting()}setClusterResolution(t){this.setting.clusterResolution=t,this.saveSetting()}setFullscreen(t){this.setting.isFullscreen=t,this.saveSetting()}setBrowserFullscreen(t){this.setting.isBrowserFullscreen=t,this.saveSetting()}setReolutionIndex(t){this.setting.resolutionIndex=t,this.saveSetting()}setReflectionCount(t){this.setting.reflectionCount=t,this.saveSetting()}setShadow(t){this.setting.isShadow=t,this.saveSetting()}setSoftShadow(t){this.setting.isSoftShadow=t,this.saveSetting()}setRoughness(t){this.setting.isRoughness=t,this.saveSetting()}setBloom(t){this.setting.isBloom=t,this.saveSetting()}setMuzzleFlash(t){this.setting.isMuzzleFlash=t,this.saveSetting()}setPixelizedLighting(t){this.setting.isPixelizedLighting=t,this.saveSetting()}setLightingDotScale(t){this.setting.lightingDotScale=t,this.saveSetting()}setBlurDotScale(t){this.setting.blurDotScale=t,this.saveSetting()}setContrast(t){this.setting.contrast=t,this.saveSetting()}setBrightness(t){this.setting.brightness=t,this.saveSetting()}setCRTEnable(t){this.setting.isCRT=t,this.saveSetting()}setCRTDeep(t){this.setting.crtDeep=t,this.saveSetting()}setCRTSubPixel(t){this.setting.crtSubPixel=t,this.saveSetting()}setCRTLens(t){this.setting.crtLens=t,this.saveSetting()}setCRTEdge(t){this.setting.crtEdge=t,this.saveSetting()}setCRTVig(t){this.setting.crtVig=t,this.saveSetting()}setCRTShadowMask(t){this.setting.isCRTShadowMask=t,this.saveSetting()}setInnerDeadzoneX(t){this.setting.stickInnerDeadzoneX=t,this.saveSetting()}setOuterDeadzoneX(t){this.setting.stickOuterDeadzoneX=t,this.saveSetting()}setInnerDeadzoneY(t){this.setting.stickInnerDeadzoneY=t,this.saveSetting()}setOuterDeadzoneY(t){this.setting.stickOuterDeadzoneY=t,this.saveSetting()}getRandomWeaponDrop(){return this.setting.randomWeaponDrop}getRandomHeightEnemy(){return this.setting.randomHeightEnemy}hasBob(){return this.setting.bob}hasToggleSprint(){return this.setting.toggleSprint}hasToggleCluch(){return this.setting.toggleCluch}getWeaponChargeStandTime(){return this.setting.weaponChargeStandTime}getWeaponWheelStandTime(){return this.setting.weaponWheelStandTime}hasEatSound(){return this.setting.eatSound}hasHUD(){return this.setting.isHUD}hasCheckPoint(){return this.setting.isCheckPoint}hasDeadLoseWeapon(){return this.setting.isDeadLoseWeapon}hasPermaDeath(){return this.setting.isPermaDeath}hasSSSSlowMo(){return this.setting.isSSSSlowMo}hasNotSpawnActors(){return this.setting.isNotSpawnActors}hasDebugLog(){return this.setting.isDebugLog}getSoundVolume(){return this.setting.soundVolume}getReflectionCount(){return this.setting.reflectionCount}getLightingDotScale(){return this.hasCRT()?1:this.setting.lightingDotScale}getBlurDotScale(){return this.hasCRT()?1:this.setting.blurDotScale}getClusterResolution(){return this.setting.clusterResolution}hasShadow(){return this.setting.isShadow}hasSoftShadow(){return this.setting.isSoftShadow}hasRoughness(){return this.setting.isRoughness}hasBloom(){return this.setting.isBloom}hasMuzzleFlash(){return this.setting.isMuzzleFlash}hasPixelizedLighting(){return this.setting.isPixelizedLighting}getContrast(){return this.setting.contrast}getBrightness(){return this.setting.brightness}hasCRT(){return this.setting.isCRT}getResolutionIndex(){return this.setting.resolutionIndex}hasFullscreen(){return this.setting.isFullscreen}hasBrowserFullscreen(){return this.setting.isBrowserFullscreen}getCRTSubPixel(){return this.hasCRT()?this.setting.crtSubPixel:1}getCRTLens(){return this.setting.crtLens}getCRTDeep(){return this.setting.crtDeep}getCRTEdge(){return this.setting.crtEdge}getCRTVig(){return this.setting.crtVig}hasCRTShadowMask(){return this.setting.isCRTShadowMask}getSensibility(){return this.setting.sensibility}hasInvertX(){return this.setting.invertX}hasInvertY(){return this.setting.invertY}getInnerDeadzoneX(){return this.setting.stickInnerDeadzoneX}getOuterDeadzoneX(){return this.setting.stickOuterDeadzoneX}getInnerDeadzoneY(){return this.setting.stickInnerDeadzoneY}getOuterDeadzoneY(){return this.setting.stickOuterDeadzoneY}getFramerate(){return(0,i.Vp)()?dt[this.setting.framerate]:1/0}getFramerateIndex(){return this.setting.framerate}getFOV(){return this.setting.fov}getVolume(){return this.setting.soundVolume}}},1528:(t,e,n)=>{"use strict";n.a(t,(async(t,e)=>{try{var r=n(2279),i=n(46),o=n(3650),s=n(9210),a=n(2221),l=n(2554),c=n(8187),d=n(7062),u=n(6749),h=n(3601),f=n(2983),g=n(7764),m=n(8943),p=n(5580),v=n(4451),b=t([r,i,s,a,l]);function y(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function x(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?y(Object(n),!0).forEach((function(e){_(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):y(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function _(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}[r,i,s,a,l]=b.then?(await b)():b;let w=null;const E=new Array,O=new r.m(64,c.Y_);let R,S=0,T=0,L=0,M=-1,P=-1,I=!1,B=!1,C=!1,A=!1,k=!1,D=null,F=new Array,z=null,N=0,U=0,X=0,V=null;function G(){if(D=D||F.shift()||null,null!==D)for(;F.length>0;){const t=F.shift()||null;null!==t&&(null!==t.voxel&&(null===D.voxel?D.voxel=x({},t.voxel):(D.voxel.camera=null!==t.voxel.camera?t.voxel.camera:D.voxel.camera,D.voxel.sun=null!==t.voxel.sun?t.voxel.sun:D.voxel.sun,D.voxel.map=null!==t.voxel.map.data?t.voxel.map:D.voxel.map,D.voxel.distance_field=null!==t.voxel.distance_field?t.voxel.distance_field:D.voxel.distance_field,D.voxel.materials=null!==t.voxel.materials?t.voxel.materials:D.voxel.materials,D.voxel.voxels=null!==t.voxel.voxels?t.voxel.voxels:D.voxel.voxels,D.voxel.cluster_resolution=null!==t.voxel.cluster_resolution?t.voxel.cluster_resolution:D.voxel.cluster_resolution,D.voxel.billboard_parameters=null!==t.voxel.billboard_parameters?t.voxel.billboard_parameters:D.voxel.billboard_parameters,D.voxel.item_list=null!==t.voxel.item_list?t.voxel.item_list:D.voxel.item_list,D.voxel.cluster_list=null!==t.voxel.cluster_list?t.voxel.cluster_list:D.voxel.cluster_list,D.voxel.background=t.voxel.background,D.voxel.lateTime=t.voxel.lateTime)),D.ui=null!==t.ui?t.ui:D.ui)}}function H(t){null!==t&&F.push(t)}function j(){const t={assets:O.createTransferData()};V?V.postMessage({method:"apply-render-data",render:null==w?void 0:w.createTransferData(),update:t,fps:X}):"BroadcastChannel"in self?g.y3.postMessage({method:"apply-render-data",render:null==w?void 0:w.createTransferData(),update:t,fps:X}):(0,f.gC)({method:"apply-render-data",render:null==w?void 0:w.createTransferData(),update:t,fps:X},[])}function Y(t){q(),t-L<1e3/R.getFramerate()||(L=t,t-N>1e3&&(N=t,X=U,U=0),(F.length>0||null!==D)&&(j(),G(),null==w||w.rendering(D,O),D=null,U++),null==w||w.resize(!1))}function W(){-1===P&&(P=(0,f.Kk)((()=>{P=-1,W(),G()})))}function q(){-1===M&&(M=requestAnimationFrame((t=>{M=-1,Y(t)})))}function Z(){!C&&B||(B=!0,W(),q())}function J(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];B&&(B=!1,cancelAnimationFrame(M),M=-1,t&&((0,f.GK)(P),P=-1))}async function K(t){z=t.mainScreen;const e=await(0,p.X0)("setting");R=new m.p(e);const n=(0,i.vL)(0,0),r=new s.f,c=new a.O(e,1/0),g=new l.P({voxel:c,ui:r},z,n,R);w=new o.T(e,v.V,{voxel:c,crt:g,ui:r}),setInterval((()=>{let t=!1;A&&c.hasFinish()&&(A=!1,t=!0),k&&g.hasFinish()&&(k=!1,t=!0),!t||A||k||(0,f.gC)({method:"unlockpaintwait"},[])})),new u.j(g,"recompile").on((()=>{k=!0,(0,f.gC)({method:"paintwait"},[])})),new u.j(g,"lostcontext").on((()=>{(0,f.gC)({method:"lostcontext"},[])})),new u.j(g,"contextrestored").on((()=>{(0,f.gC)({method:"contextrestored"},[]),g.destroy(),r.destroy(),c.destroy()})),new u.j(c,"recompile").on((()=>{A=!0,(0,f.gC)({method:"paintwait"},[])})),new u.j(c,"lostcontext").on((()=>{(0,f.gC)({method:"lostcontext"},[])})),new u.j(c,"contextrestored").on((()=>{(0,f.gC)({method:"contextrestored"},[]),g.destroy(),r.destroy(),c.destroy()})),new u.j(w,"resize").on((t=>{let{width:e,height:n}=t;(0,f.gC)({method:"resize",width:e,height:n},[])})),S=O.getAssetLenght()+t.assetLength,E.push(...t.logos),(0,f.gC)({method:"ready"},[]),await new Promise((t=>{const e=()=>{I?t(null):setTimeout(e)};e()}));let b=n.getContext("2d"),y=-1,x=performance.now(),_=!1;try{await new Promise((async t=>{const r=3750;x=performance.now(),M=requestAnimationFrame((function i(){const o=performance.now(),s=(0,d.O)()?r*(E.length+1):o-x;if(null!==b){if(M=requestAnimationFrame(i),k)return void(x=o);T>=S&&-1===y&&(y=o);const[a,l]=(0,h.u)(e,v.V),c=Math.floor(a/R.getCRTSubPixel()),d=Math.floor(l/R.getCRTSubPixel());n.width=c,n.height=d,b.clearRect(0,0,b.canvas.width,b.canvas.height);const u=s/r|0,f=E[u-1]||null,g=E[u+1]||null,m=E[u]||null,p=s%r;if(null===g&&p>750||null===m&&null===f)!_&&-1!==y&&Math.min(1,(o-y)/1e3)>=1&&(cancelAnimationFrame(M),t(null));else if(p<r){if(b.save(),null!==f){const t=b.canvas.height<b.canvas.width?b.canvas.height/f.height:b.canvas.width/f.width;b.globalAlpha=1-Math.min(1,p/500),b.drawImage(f,0,0,f.width,f.height,-(f.width*t-b.canvas.width)/2,0,f.width*t,f.height*t)}if(null!==m){const t=b.canvas.height<b.canvas.width?b.canvas.height/m.height:b.canvas.width/m.width;b.globalAlpha=Math.min(1,p/500),b.drawImage(m,0,0,m.width,m.height,-(m.width*t-b.canvas.width)/2,0,m.width*t,m.height*t)}b.restore()}const w=T/S;b.save();const O=n.height/1080;b.globalAlpha=-1===y?1:1-Math.min(1,(o-y)/250),b.fillStyle="rgb(100,100,100)",b.fillRect(0,b.canvas.height-(75*O|0),b.canvas.width*w,75*O|0),b.fillStyle="rgb(255,255,255)",b.font="".concat(2.5*O,"em Meiryo"),b.fillText("Loading [".concat(Math.floor(100*w),"%]"),25*O|0,b.canvas.height-(25*O|0)),b.restore()}null==w||w.resize(!1),null==w||w.rendering(null,O)})),await O.load((()=>T+=1))}))}catch(t){throw _=!0,t}cancelAnimationFrame(M),M=-1,w.resize(!1),w.rendering(null,O),g.begin(),(0,f.gC)({method:"loaded"},[]),Z()}addEventListener("message",(t=>{const{data:e}=t;if(e instanceof Object)switch(e.method){case"init":V=e.paintChannel,null!==V&&(V.addEventListener("message",(t=>{const{data:e}=t;if(e instanceof Object&&"transfer-render"===e.method)H(e.data)})),V.start()),K(e.data);break;case"start":null==w||w.resize(!1);break;case"loading":I=!0;break;case"send-loaded":T+=1;break;case"transfer-render":F.push(e.data);break;case"resize":null==w||w.resize(!0)}})),addEventListener("error",(t=>{(0,f.gC)({method:"error"},[]),C=!0})),g.mI.addEventListener("message",(t=>{const{data:e}=t;if(e instanceof Object)switch(e.method){case"run":case"unsleep":Z();break;case"stop":J();break;case"sleep":J(!0);break;case"error":C=!0,J(!0)}})),(0,f.gC)({method:"standby"},[]),e()}catch(t){e(t)}}))},8187:(t,e,n)=>{"use strict";n.d(e,{Y_:()=>m,g7:()=>p,xZ:()=>v});class r{constructor(t,e){this.src=t,this.index=e}}var i=n(9764),o=n(1276);class s{constructor(t,e,n,r,i,s,a,l,c){let d=arguments.length>9&&void 0!==arguments[9]&&arguments[9],u=arguments.length>10&&void 0!==arguments[10]&&arguments[10],h=arguments.length>11&&void 0!==arguments[11]&&arguments[11],f=arguments.length>12&&void 0!==arguments[12]&&arguments[12],g=arguments.length>13&&void 0!==arguments[13]&&arguments[13],m=arguments.length>14&&void 0!==arguments[14]&&arguments[14],p=arguments.length>15&&void 0!==arguments[15]&&arguments[15],v=arguments.length>16&&void 0!==arguments[16]&&arguments[16],b=arguments.length>17&&void 0!==arguments[17]&&arguments[17],y=arguments.length>18&&void 0!==arguments[18]&&arguments[18],x=arguments.length>19&&void 0!==arguments[19]&&arguments[19],_=arguments.length>20&&void 0!==arguments[20]&&arguments[20];this.flipXFront=!1,this.flipYFront=!1,this.flipXBack=!1,this.flipYBack=!1,this.flipXRight=!1,this.flipYRight=!1,this.flipXLeft=!1,this.flipYLeft=!1,this.flipXTop=!1,this.flipYTop=!1,this.flipXBottom=!1,this.flipYBottom=!1,this.position=new o.P(t,e,n),this.front=r,this.back=i,this.right=s,this.left=a,this.top=l,this.bottom=c,this.flipXFront=d,this.flipYFront=u,this.flipXBack=h,this.flipYBack=f,this.flipXRight=g,this.flipYRight=m,this.flipXLeft=p,this.flipYLeft=v,this.flipXTop=b,this.flipYTop=y,this.flipXBottom=x,this.flipYBottom=_}}var a=n(1727),l=n(9459);const c=["touchstart","touchend","mousedown","keydown"],d=new WeakMap;function u(t){if(d.get(t)||"suspended"!==t.state)return t;const e=self.document.body;function n(){t.resume().then(r)}function r(){c.forEach((t=>e.removeEventListener(t,n))),d.delete(t)}return c.forEach((t=>e.addEventListener(t,n,!1))),d.set(t,!0),t}var h=n(3437);let f=null;if("AudioContext"in self){f=new AudioContext;try{u(f)}catch(t){self.addEventListener("load",(()=>f&&u(f)))}}class g extends l.x{async load(){0===this.data.length&&(this.data=await Promise.all(this.src.map((async t=>f?f.decodeAudioData((await(0,h.hn)(t,"arraybuffer")).source):null))))}}const m=[new a.s("./asset/font.png"),new a.s("./asset/icon.png"),new a.s("./asset/key.png"),new a.s("./asset/horde_badge.png"),new a.s("./asset/title-prod.png"),new a.s("./asset/title-demo.png"),new a.s("./asset/how_to_play_keyboard.png"),new a.s("./asset/how_to_play_gamepad.png"),new a.s("./asset/memberscard/members.png"),new a.s("./asset/memberscard/silver.png"),new a.s("./asset/memberscard/gold.png"),new a.s("./asset/memberscard/platinum.png"),new a.s("./asset/memberscard/diamond.png"),new i.g("./asset/wall/default.albedo.png","./asset/wall/default.pbr.png","./asset/wall/default.normal.png"),new i.g("./asset/wall/desert.albedo.png","./asset/wall/desert.pbr.png","./asset/wall/desert.normal.png"),new i.g("./asset/hud/hand.albedo.png","./asset/hud/hand.pbr.png","./asset/hud/hand.normal.png"),new i.g("./asset/hud/foot.albedo.png","./asset/hud/foot.pbr.png","./asset/hud/foot.normal.png"),new i.g("./asset/hud/slowball.albedo.png","./asset/hud/slowball.pbr.png","./asset/hud/slowball.normal.png"),new i.g("./asset/hud/binoculars.albedo.png","./asset/hud/binoculars.pbr.png","./asset/hud/binoculars.normal.png"),new i.g("./asset/hud/energyshield.albedo.png","./asset/hud/energyshield.pbr.png","./asset/hud/energyshield.normal.png"),new i.g("./asset/hud/combobooster.albedo.png","./asset/hud/combobooster.pbr.png","./asset/hud/combobooster.normal.png"),new i.g("./asset/hud/hookshot.albedo.png","./asset/hud/hookshot.pbr.png","./asset/hud/hookshot.normal.png"),new i.g("./asset/hud/pistol.albedo.png","./asset/hud/pistol.pbr.png","./asset/hud/pistol.normal.png"),new i.g("./asset/hud/handcannon.albedo.png","./asset/hud/handcannon.pbr.png","./asset/hud/handcannon.normal.png"),new i.g("./asset/hud/machingun.albedo.png","./asset/hud/machingun.pbr.png","./asset/hud/machingun.normal.png"),new i.g("./asset/hud/chainshotgun.albedo.png","./asset/hud/chainshotgun.pbr.png","./asset/hud/chainshotgun.normal.png"),new i.g("./asset/hud/shotgun.albedo.png","./asset/hud/shotgun.pbr.png","./asset/hud/shotgun.normal.png"),new i.g("./asset/hud/heavycannon.albedo.png","./asset/hud/heavycannon.pbr.png","./asset/hud/heavycannon.normal.png"),new i.g("./asset/hud/launcher.albedo.png","./asset/hud/launcher.pbr.png","./asset/hud/launcher.normal.png"),new i.g("./asset/hud/clusterbow.albedo.png","./asset/hud/clusterbow.pbr.png","./asset/hud/clusterbow.normal.png"),new i.g("./asset/hud/plasmagun.albedo.png","./asset/hud/plasmagun.pbr.png","./asset/hud/plasmagun.normal.png"),new i.g("./asset/hud/plasmasmg.albedo.png","./asset/hud/plasmasmg.pbr.png","./asset/hud/plasmasmg.normal.png"),new i.g("./asset/entity/debug.albedo.png","./asset/entity/debug.pbr.png","./asset/entity/debug.normal.png"),new i.g("./asset/entity/ui.albedo.png","./asset/entity/ui.pbr.png","./asset/entity/ui.normal.png"),new i.g("./asset/entity/bullet.albedo.png","./asset/entity/bullet.pbr.png","./asset/entity/bullet.normal.png"),new i.g("./asset/entity/blood.albedo.png","./asset/entity/blood.pbr.png","./asset/entity/blood.normal.png"),new i.g("./asset/entity/acid.albedo.png","./asset/entity/acid.pbr.png","./asset/entity/acid.normal.png"),new i.g("./asset/entity/gib.albedo.png","./asset/entity/gib.pbr.png","./asset/entity/gib.normal.png"),new i.g("./asset/entity/hit.albedo.png","./asset/entity/hit.pbr.png","./asset/entity/hit.normal.png"),new i.g("./asset/entity/ring.albedo.png","./asset/entity/ring.pbr.png","./asset/entity/ring.normal.png"),new i.g("./asset/entity/stuff.albedo.png","./asset/entity/stuff.pbr.png","./asset/entity/stuff.normal.png"),new i.g("./asset/entity/spark.albedo.png","./asset/entity/spark.pbr.png","./asset/entity/spark.normal.png"),new i.g("./asset/entity/explode.albedo.png","./asset/entity/explode.pbr.png","./asset/entity/explode.normal.png"),new i.g("./asset/entity/flame.albedo.png","./asset/entity/flame.pbr.png","./asset/entity/flame.normal.png"),new i.g("./asset/entity/enemy-guy.albedo.png","./asset/entity/enemy-guy.pbr.png","./asset/entity/enemy-guy.normal.png"),new i.g("./asset/entity/helmet.albedo.png","./asset/entity/helmet.pbr.png","./asset/entity/helmet.normal.png"),new i.g("./asset/entity/enemy-armor.albedo.png","./asset/entity/enemy-armor.pbr.png","./asset/entity/enemy-armor.normal.png"),new i.g("./asset/entity/object.albedo.png","./asset/entity/object.pbr.png","./asset/entity/object.normal.png"),new i.g("./asset/entity/checkpoint.albedo.png","./asset/entity/checkpoint.pbr.png","./asset/entity/checkpoint.normal.png"),new i.g("./asset/entity/spawner.albedo.png","./asset/entity/spawner.pbr.png","./asset/entity/spawner.normal.png"),new i.g("./asset/entity/health.albedo.png","./asset/entity/health.pbr.png","./asset/entity/health.normal.png"),new i.g("./asset/entity/armor.albedo.png","./asset/entity/armor.pbr.png","./asset/entity/armor.normal.png"),new i.g("./asset/entity/stamina.albedo.png","./asset/entity/stamina.pbr.png","./asset/entity/stamina.normal.png"),new i.g("./asset/entity/ammo.albedo.png","./asset/entity/ammo.pbr.png","./asset/entity/ammo.normal.png"),new i.g("./asset/entity/weapon.albedo.png","./asset/entity/weapon.pbr.png","./asset/entity/weapon.normal.png"),new i.g("./asset/entity/key.albedo.png","./asset/entity/key.pbr.png","./asset/entity/key.normal.png")],p=(new g("./asset/sound/menu/press.mp3"),new g("./asset/sound/menu/cancel.mp3"),new g("./asset/sound/menu/scroll.mp3"),new g("./asset/sound/menu/move.mp3"),new g("./asset/sound/menu/buy.mp3"),new g("./asset/sound/effect/explode.mp3"),new g("./asset/sound/effect/corrosive.mp3"),new g("./asset/sound/effect/splash.mp3"),new g("./asset/sound/effect/head-shot.mp3"),new g("./asset/sound/effect/bullet-wall-spark.mp3"),new g("./asset/sound/effect/mine-drop.wav"),new g("./asset/sound/effect/damage-ammo.mp3"),new g("./asset/sound/effect/damage-melee.mp3"),new g("./asset/sound/effect/damage-magic.mp3"),new g("./asset/sound/effect/damage-slash.mp3"),new g("./asset/sound/effect/damage-flame.mp3"),new g("./asset/sound/effect/damage-corrosive1.mp3"),new g("./asset/sound/effect/damage-corrosive2.mp3"),new g("./asset/sound/weapon/punch-fire.mp3"),new g("./asset/sound/weapon/punch-fire-charge.mp3"),new g("./asset/sound/weapon/combobooster-fire.mp3"),new g("./asset/sound/weapon/combobooster-loop.mp3"),new g("./asset/sound/weapon/pistol-fire.mp3"),new g("./asset/sound/weapon/hook-fire.mp3"),new g("./asset/sound/weapon/hook-bullet.mp3"),new g("./asset/sound/weapon/machingun-fire.mp3"),new g("./asset/sound/weapon/chainshotgun-fire.wav"),new g("./asset/sound/weapon/chainshotgun-start.wav"),new g("./asset/sound/weapon/chainshotgun-loop.wav"),new g("./asset/sound/weapon/chainshotgun-end.wav"),new g("./asset/sound/weapon/heavycannon-fire.mp3"),new g("./asset/sound/weapon/heavycannon-fire-charge.wav"),new g("./asset/sound/weapon/heavycannon-pump.mp3"),new g("./asset/sound/weapon/shotgun-fire.mp3"),new g("./asset/sound/weapon/shotgun-pump.mp3"),new g("./asset/sound/weapon/launcher-fire.mp3"),new g("./asset/sound/weapon/launcher-pump.mp3"),new g("./asset/sound/weapon/clusterbow-fire.wav"),new g("./asset/sound/weapon/plasmagun-fire.mp3"),new g("./asset/sound/weapon/plasmasmg-fire.mp3"),new g("./asset/sound/weapon/out-of-ammo.mp3"),new g("./asset/sound/weapon/charge-loop.mp3"),new g("./asset/sound/weapon/charge-complete.mp3"),new g("./asset/sound/combo/up.mp3"),new g("./asset/sound/combo/down.mp3"),new g("./asset/sound/item/ammo.mp3"),new g("./asset/sound/item/weapon.mp3"),new g("./asset/sound/item/key.mp3"),new g("./asset/sound/item/meat-1.mp3"),new g("./asset/sound/item/meat-2.mp3"),new g("./asset/sound/item/meat-3.mp3"),new g("./asset/sound/item/meat-mute.mp3"),new g("./asset/sound/item/armor.mp3"),new g("./asset/sound/item/stamina.mp3"),new g("./asset/sound/item/checkpoint.mp3"),new g("./asset/sound/item/spawn.mp3"),new g("./asset/sound/player/step-1.mp3"),new g("./asset/sound/player/step-2.mp3"),new g("./asset/sound/player/step-3.mp3"),new g("./asset/sound/player/step-4.mp3"),new g("./asset/sound/player/landing.mp3"),new g("./asset/sound/player/grab.mp3"),new g("./asset/sound/player/climb.mp3"),new g("./asset/sound/player/sliding.mp3"),new g("./asset/sound/player/wallrun.mp3"),new g("./asset/sound/player/open.mp3"),new g("./asset/sound/player/lock.mp3"),new g("./asset/sound/enemy/no-damage.mp3"),new g("./asset/sound/enemy/find-pistol-1.mp3"),new g("./asset/sound/enemy/find-pistol-2.mp3"),new g("./asset/sound/enemy/find-pistol-3.mp3"),new g("./asset/sound/enemy/find-pistol-4.mp3"),new g("./asset/sound/enemy/find-shotgun-1.mp3"),new g("./asset/sound/enemy/find-shotgun-2.mp3"),new g("./asset/sound/enemy/find-shotgun-3.mp3"),new g("./asset/sound/enemy/find-shotgun-4.mp3"),new g("./asset/sound/enemy/find-shotgun-5.mp3"),new g("./asset/sound/enemy/find-machingun-1.mp3"),new g("./asset/sound/enemy/find-machingun-2.mp3"),new g("./asset/sound/enemy/find-machingun-3.mp3"),new g("./asset/sound/enemy/find-melee-1.mp3"),new g("./asset/sound/enemy/find-melee-2.mp3"),new g("./asset/sound/enemy/find-melee-3.mp3"),new g("./asset/sound/enemy/pain-pistol-1.mp3"),new g("./asset/sound/enemy/pain-pistol-2.mp3"),new g("./asset/sound/enemy/pain-shotgun-1.mp3"),new g("./asset/sound/enemy/pain-shotgun-2.mp3"),new g("./asset/sound/enemy/pain-machingun-1.mp3"),new g("./asset/sound/enemy/pain-machingun-2.mp3"),new g("./asset/sound/enemy/pain-melee-1.mp3"),new g("./asset/sound/enemy/pain-melee-2.mp3"),new g("./asset/sound/enemy/death-pistol-1.mp3"),new g("./asset/sound/enemy/death-shotgun-1.mp3"),new g("./asset/sound/enemy/death-machingun-1.mp3"),new g("./asset/sound/enemy/death-melee-1.mp3"),new g("./asset/sound/enemy/death-armor.mp3"),new g("./asset/sound/enemy/fire-melee.mp3"),new g("./asset/sound/enemy/fire-magic.mp3"),new g("./asset/sound/system/help.mp3"),new r("./asset/wall/default.albedo.png",0),new r("./asset/wall/default.albedo.png",1),new r("./asset/wall/default.albedo.png",2),new r("./asset/wall/default.albedo.png",3),new r("./asset/wall/default.albedo.png",4),new r("./asset/wall/default.albedo.png",5),new r("./asset/wall/default.albedo.png",6),new r("./asset/wall/default.albedo.png",7),new r("./asset/wall/default.albedo.png",8),new r("./asset/wall/default.albedo.png",9),new r("./asset/wall/default.albedo.png",10),new r("./asset/wall/default.albedo.png",11),new r("./asset/wall/default.albedo.png",14),new r("./asset/wall/default.albedo.png",15),new r("./asset/wall/default.albedo.png",16),new r("./asset/wall/default.albedo.png",17),new r("./asset/wall/default.albedo.png",18),new r("./asset/wall/desert.albedo.png",1),new r("./asset/wall/desert.albedo.png",2),new r("./asset/wall/desert.albedo.png",3),new r("./asset/wall/desert.albedo.png",4),new r("./asset/wall/desert.albedo.png",5),new r("./asset/wall/desert.albedo.png",6),new r("./asset/wall/desert.albedo.png",7),new r("./asset/wall/desert.albedo.png",8),new r("./asset/wall/desert.albedo.png",9),new r("./asset/wall/desert.albedo.png",14),new r("./asset/wall/desert.albedo.png",15),new r("./asset/wall/desert.albedo.png",16),new r("./asset/wall/desert.albedo.png",17),new r("./asset/wall/desert.albedo.png",18),new r("./asset/hud/hand.albedo.png",0),new r("./asset/hud/hand.albedo.png",1),new r("./asset/hud/hand.albedo.png",2),new r("./asset/hud/hand.albedo.png",3),new r("./asset/hud/hand.albedo.png",4),new r("./asset/hud/hand.albedo.png",5),new r("./asset/hud/hand.albedo.png",6),new r("./asset/hud/hand.albedo.png",7),new r("./asset/hud/foot.albedo.png",0),new r("./asset/hud/foot.albedo.png",1),new r("./asset/hud/slowball.albedo.png",0),new r("./asset/hud/slowball.albedo.png",1),new r("./asset/hud/binoculars.albedo.png",0),new r("./asset/hud/energyshield.albedo.png",0),new r("./asset/hud/energyshield.albedo.png",1),new r("./asset/hud/energyshield.albedo.png",2),new r("./asset/hud/combobooster.albedo.png",0),new r("./asset/hud/combobooster.albedo.png",1),new r("./asset/hud/hookshot.albedo.png",0),new r("./asset/hud/pistol.albedo.png",0),new r("./asset/hud/pistol.albedo.png",1),new r("./asset/hud/pistol.albedo.png",2),new r("./asset/hud/handcannon.albedo.png",0),new r("./asset/hud/handcannon.albedo.png",1),new r("./asset/hud/handcannon.albedo.png",2),new r("./asset/hud/machingun.albedo.png",0),new r("./asset/hud/machingun.albedo.png",1),new r("./asset/hud/machingun.albedo.png",2),new r("./asset/hud/chainshotgun.albedo.png",0),new r("./asset/hud/chainshotgun.albedo.png",1),new r("./asset/hud/chainshotgun.albedo.png",2),new r("./asset/hud/shotgun.albedo.png",0),new r("./asset/hud/shotgun.albedo.png",1),new r("./asset/hud/shotgun.albedo.png",2),new r("./asset/hud/heavycannon.albedo.png",0),new r("./asset/hud/heavycannon.albedo.png",1),new r("./asset/hud/heavycannon.albedo.png",2),new r("./asset/hud/launcher.albedo.png",0),new r("./asset/hud/launcher.albedo.png",1),new r("./asset/hud/launcher.albedo.png",2),new r("./asset/hud/clusterbow.albedo.png",0),new r("./asset/hud/clusterbow.albedo.png",1),new r("./asset/hud/plasmagun.albedo.png",0),new r("./asset/hud/plasmagun.albedo.png",1),new r("./asset/hud/plasmagun.albedo.png",2),new r("./asset/hud/plasmasmg.albedo.png",0),new r("./asset/hud/plasmasmg.albedo.png",1),new r("./asset/hud/plasmasmg.albedo.png",2),new r("./asset/entity/debug.albedo.png",0),new r("./asset/entity/ui.albedo.png",0),new r("./asset/entity/ui.albedo.png",1),new r("./asset/entity/ui.albedo.png",2),new r("./asset/entity/ui.albedo.png",3),new r("./asset/entity/ui.albedo.png",4),new r("./asset/entity/ui.albedo.png",5),new r("./asset/entity/bullet.albedo.png",0),new r("./asset/entity/bullet.albedo.png",1),new r("./asset/entity/bullet.albedo.png",2),new r("./asset/entity/bullet.albedo.png",3),new r("./asset/entity/bullet.albedo.png",3),new r("./asset/entity/bullet.albedo.png",4),new r("./asset/entity/bullet.albedo.png",5),new r("./asset/entity/bullet.albedo.png",6),new r("./asset/entity/bullet.albedo.png",7),new r("./asset/entity/bullet.albedo.png",8),new r("./asset/entity/bullet.albedo.png",9),new r("./asset/entity/blood.albedo.png",0),new r("./asset/entity/blood.albedo.png",1),new r("./asset/entity/blood.albedo.png",2),new r("./asset/entity/blood.albedo.png",3),new r("./asset/entity/blood.albedo.png",4),new r("./asset/entity/blood.albedo.png",5),new r("./asset/entity/acid.albedo.png",0),new r("./asset/entity/gib.albedo.png",0),new r("./asset/entity/gib.albedo.png",1),new r("./asset/entity/gib.albedo.png",2),new r("./asset/entity/gib.albedo.png",3),new r("./asset/entity/hit.albedo.png",0),new r("./asset/entity/hit.albedo.png",1),new r("./asset/entity/hit.albedo.png",2),new r("./asset/entity/hit.albedo.png",3),new r("./asset/entity/hit.albedo.png",4),new r("./asset/entity/hit.albedo.png",5),new r("./asset/entity/ring.albedo.png",0),new r("./asset/entity/ring.albedo.png",1),new r("./asset/entity/ring.albedo.png",2),new r("./asset/entity/ring.albedo.png",3),new r("./asset/entity/ring.albedo.png",4),new r("./asset/entity/ring.albedo.png",5),new r("./asset/entity/ring.albedo.png",6),new r("./asset/entity/ring.albedo.png",7),new r("./asset/entity/ring.albedo.png",8),new r("./asset/entity/ring.albedo.png",9),new r("./asset/entity/ring.albedo.png",10),new r("./asset/entity/ring.albedo.png",11),new r("./asset/entity/stuff.albedo.png",0),new r("./asset/entity/spark.albedo.png",0),new r("./asset/entity/spark.albedo.png",1),new r("./asset/entity/spark.albedo.png",2),new r("./asset/entity/spark.albedo.png",3),new r("./asset/entity/explode.albedo.png",0),new r("./asset/entity/explode.albedo.png",1),new r("./asset/entity/explode.albedo.png",2),new r("./asset/entity/explode.albedo.png",3),new r("./asset/entity/explode.albedo.png",4),new r("./asset/entity/explode.albedo.png",5),new r("./asset/entity/explode.albedo.png",6),new r("./asset/entity/explode.albedo.png",7),new r("./asset/entity/explode.albedo.png",8),new r("./asset/entity/explode.albedo.png",9),new r("./asset/entity/explode.albedo.png",10),new r("./asset/entity/explode.albedo.png",11),new r("./asset/entity/explode.albedo.png",12),new r("./asset/entity/explode.albedo.png",13),new r("./asset/entity/explode.albedo.png",14),new r("./asset/entity/explode.albedo.png",15),new r("./asset/entity/explode.albedo.png",16),new r("./asset/entity/explode.albedo.png",17),new r("./asset/entity/explode.albedo.png",18),new r("./asset/entity/explode.albedo.png",19),new r("./asset/entity/explode.albedo.png",20),new r("./asset/entity/explode.albedo.png",21),new r("./asset/entity/explode.albedo.png",22),new r("./asset/entity/explode.albedo.png",23),new r("./asset/entity/explode.albedo.png",24),new r("./asset/entity/explode.albedo.png",25),new r("./asset/entity/explode.albedo.png",26),new r("./asset/entity/explode.albedo.png",27),new r("./asset/entity/flame.albedo.png",0),new r("./asset/entity/flame.albedo.png",1),new r("./asset/entity/flame.albedo.png",2),new r("./asset/entity/flame.albedo.png",3),new r("./asset/entity/flame.albedo.png",4),new r("./asset/entity/enemy-guy.albedo.png",0),new r("./asset/entity/enemy-guy.albedo.png",2),new r("./asset/entity/enemy-guy.albedo.png",3),new r("./asset/entity/enemy-guy.albedo.png",4),new r("./asset/entity/enemy-guy.albedo.png",5),new r("./asset/entity/enemy-guy.albedo.png",6),new r("./asset/entity/enemy-guy.albedo.png",7),new r("./asset/entity/enemy-guy.albedo.png",8),new r("./asset/entity/enemy-guy.albedo.png",9),new r("./asset/entity/enemy-guy.albedo.png",10),new r("./asset/entity/enemy-guy.albedo.png",11),new r("./asset/entity/enemy-guy.albedo.png",12),new r("./asset/entity/enemy-guy.albedo.png",13),new r("./asset/entity/enemy-guy.albedo.png",14),new r("./asset/entity/enemy-guy.albedo.png",15),new r("./asset/entity/enemy-guy.albedo.png",16),new r("./asset/entity/enemy-guy.albedo.png",17),new r("./asset/entity/enemy-guy.albedo.png",18),new r("./asset/entity/enemy-guy.albedo.png",19),new r("./asset/entity/enemy-guy.albedo.png",20),new r("./asset/entity/enemy-guy.albedo.png",21),new r("./asset/entity/enemy-guy.albedo.png",22),new r("./asset/entity/enemy-guy.albedo.png",23),new r("./asset/entity/enemy-guy.albedo.png",24),new r("./asset/entity/enemy-guy.albedo.png",25),new r("./asset/entity/enemy-guy.albedo.png",26),new r("./asset/entity/enemy-guy.albedo.png",27),new r("./asset/entity/enemy-guy.albedo.png",30),new r("./asset/entity/enemy-guy.albedo.png",31),new r("./asset/entity/enemy-guy.albedo.png",32),new r("./asset/entity/enemy-guy.albedo.png",35),new r("./asset/entity/enemy-guy.albedo.png",36),new r("./asset/entity/enemy-guy.albedo.png",37),new r("./asset/entity/enemy-guy.albedo.png",40),new r("./asset/entity/enemy-guy.albedo.png",41),new r("./asset/entity/enemy-guy.albedo.png",42),new r("./asset/entity/enemy-guy.albedo.png",45),new r("./asset/entity/enemy-guy.albedo.png",46),new r("./asset/entity/enemy-guy.albedo.png",47),new r("./asset/entity/enemy-guy.albedo.png",50),new r("./asset/entity/enemy-guy.albedo.png",51),new r("./asset/entity/enemy-guy.albedo.png",52),new r("./asset/entity/helmet.albedo.png",0),new r("./asset/entity/helmet.albedo.png",1),new r("./asset/entity/enemy-armor.albedo.png",0),new r("./asset/entity/enemy-armor.albedo.png",1),new r("./asset/entity/enemy-armor.albedo.png",2),new r("./asset/entity/enemy-armor.albedo.png",3),new r("./asset/entity/enemy-armor.albedo.png",4),new r("./asset/entity/object.albedo.png",0),new r("./asset/entity/object.albedo.png",1),new r("./asset/entity/object.albedo.png",2),new r("./asset/entity/object.albedo.png",3),new r("./asset/entity/checkpoint.albedo.png",0),new r("./asset/entity/checkpoint.albedo.png",1),new r("./asset/entity/spawner.albedo.png",0),new r("./asset/entity/health.albedo.png",0),new r("./asset/entity/health.albedo.png",1),new r("./asset/entity/health.albedo.png",2),new r("./asset/entity/armor.albedo.png",0),new r("./asset/entity/stamina.albedo.png",0),new r("./asset/entity/ammo.albedo.png",0),new r("./asset/entity/ammo.albedo.png",1),new r("./asset/entity/ammo.albedo.png",2),new r("./asset/entity/ammo.albedo.png",3),new r("./asset/entity/ammo.albedo.png",4),new r("./asset/entity/weapon.albedo.png",0),new r("./asset/entity/weapon.albedo.png",6),new r("./asset/entity/weapon.albedo.png",12),new r("./asset/entity/weapon.albedo.png",18),new r("./asset/entity/weapon.albedo.png",24),new r("./asset/entity/weapon.albedo.png",30),new r("./asset/entity/weapon.albedo.png",36),new r("./asset/entity/weapon.albedo.png",1),new r("./asset/entity/weapon.albedo.png",7),new r("./asset/entity/weapon.albedo.png",2),new r("./asset/entity/weapon.albedo.png",8),new r("./asset/entity/weapon.albedo.png",3),new r("./asset/entity/weapon.albedo.png",9),new r("./asset/entity/weapon.albedo.png",4),new r("./asset/entity/weapon.albedo.png",10),new r("./asset/entity/weapon.albedo.png",5),new r("./asset/entity/weapon.albedo.png",11),new r("./asset/entity/key.albedo.png",0),new r("./asset/entity/key.albedo.png",1),new r("./asset/entity/key.albedo.png",2),new r("./asset/entity/key.albedo.png",3),new s(.5,.5,.5,"NONE","NONE","NONE","NONE","NONE","NONE")),v=new s(.5,.5,.5,"NONE","NONE","NONE","NONE","NONE","NONE");new s(.5,.5,.5,"WALL","WALL","WALL","WALL","CEIL","FLOOR"),new s(.5,.5,.5,"DOOR_DEFAULT","DOOR_DEFAULT","DOOR_DEFAULT","DOOR_DEFAULT","DOOR_DEFAULT","DOOR_DEFAULT"),new s(.5,.5,.5,"DOOR_RED","DOOR_RED","DOOR_RED","DOOR_RED","DOOR_RED","DOOR_RED"),new s(.5,.5,.5,"DOOR_BLUE","DOOR_BLUE","DOOR_BLUE","DOOR_BLUE","DOOR_BLUE","DOOR_BLUE"),new s(.5,.5,.5,"DOOR_YELLOW","DOOR_YELLOW","DOOR_YELLOW","DOOR_YELLOW","DOOR_YELLOW","DOOR_YELLOW"),new s(.5,.5,.5,"EDIT_BLOCK","EDIT_BLOCK","EDIT_BLOCK","EDIT_BLOCK","EDIT_BLOCK","EDIT_BLOCK")},7764:(t,e,n)=>{"use strict";n.d(e,{mI:()=>a,rw:()=>o,y3:()=>s});var r=n(2983);const i=new r.zv("window"),o=new r.zv("display-log"),s=new r.zv("worker-tick"),a=new r.zv("worker-paint");"window"in self&&i.addEventListener("message",(t=>{const{data:e}=t;if(e instanceof Object)switch(e.method){case"shatdown":self.close();break;case"reload":self.location.reload()}}))},2276:(t,e,n)=>{"use strict";n.d(e,{N:()=>r});const r=.23964497041420119},9459:(t,e,n)=>{"use strict";n.d(e,{x:()=>i});var r=n(3437);class i{constructor(){this.data=Array(),this.locations=new Array,this.isTransfer=!1;for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this.src=e}async load(){0===this.data.length&&(this.data=await Promise.all(this.src.map((async t=>(await(0,r.hn)(t)).source))))}hasTransfer(){return this.isTransfer}createTransferData(){return this.isTransfer=!0,{src:this.src,locations:this.locations}}}},1727:(t,e,n)=>{"use strict";n.d(e,{s:()=>o});var r=n(9459),i=n(1388);class o extends r.x{async load(){0===this.data.length&&(this.data=await Promise.all(this.src.map((async t=>await(0,i.B)(t)))))}}},9764:(t,e,n)=>{"use strict";n.d(e,{g:()=>i});var r=n(1727);class i extends r.s{}},5352:(t,e,n)=>{"use strict";n.a(t,(async(t,r)=>{try{n.d(e,{l:()=>h});var i=n(4402),o=n(1276),s=n(46),a=n(1388),l=n(2574),c=t([s]);s=(c.then?(await c)():c)[0];class d{constructor(t,e){this.buffer=(0,s.vL)(t,e)}get width(){return this.buffer.width}set width(t){this.buffer.width=t}get height(){return this.buffer.height}set height(t){this.buffer.height=t}getContext(){return this.buffer.getContext("2d")}async toDataURL(){const t=this.buffer;let e;return 0===t.width||0===t.height?"data:,":(s.aE&&t instanceof OffscreenCanvas?e=await t.convertToBlob():t instanceof HTMLCanvasElement&&(e=await new Promise((e=>t.toBlob((t=>{t instanceof Blob&&e(t)}))))),await new Promise((t=>{const n=new FileReader;n.onload=()=>{const e=n.result;"string"==typeof e&&t(e)},n.readAsDataURL(e)})))}async transferToImageBitmap(){const t=this.buffer;return s.aE&&t instanceof OffscreenCanvas?t.transferToImageBitmap():await(0,a.B)(await this.toDataURL())}getBuffer(){return this.buffer}}class u{constructor(t,e,n){this.id=t,this.position=new o.FM(e,n)}}class h{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64;this.bufferIDCount=0,this.isUpdate=!0,this.albedoBuffer=new d(0,0),this.pbrBuffer=new d(0,0),this.normalBuffer=new d(0,0),this.unloadBufferIDCache=new Array,this.tile_size=64,this.tile_size=t}getID(){(0,l.qr)(this.unloadBufferIDCache).asc();let t=this.unloadBufferIDCache.shift();return void 0===t&&(t=this.bufferIDCount++),t}unloadID(t){this.unloadBufferIDCache.push(t)}getSize(){return[this.albedoBuffer.width,this.albedoBuffer.height]}getTileSize(){return this.tile_size}getBuffer(){return{albedo:this.albedoBuffer.getBuffer(),pbr:this.pbrBuffer.getBuffer(),normal:this.normalBuffer.getBuffer()}}checkUpdate(){const t=this.isUpdate;return this.isUpdate=!1,t}load(t,e,n){const r=new Array,o=new Array,s=new Array;[...new Array(t.width/this.tile_size*t.height/this.tile_size).fill(null)].forEach((()=>{const t=this.getID(),[e,n]=(0,i.sS)(t);r.push(t),o.push(e*this.tile_size),s.push(n*this.tile_size)}));const a=r.map(((r,i)=>[{source:t,buffer:this.albedoBuffer},{source:e,buffer:this.pbrBuffer},{source:n,buffer:this.normalBuffer}].map((t=>{let{source:e,buffer:n}=t;const a=o[i],l=s[i],c=Math.max(...o),h=Math.max(...s),f=Math.max(e.width,c+this.tile_size,e.height,h+this.tile_size);if(0===n.width||0===n.height)n.width=f,n.height=f;else if(f>n.width||f>n.height){const t=new d(f,f),e=t.getContext();null!==e&&(e.imageSmoothingEnabled=!1,e.drawImage(n.getBuffer(),0,0)),n.width=f,n.height=f;const r=n.getContext();null!==r&&(r.imageSmoothingEnabled=!0,r.clearRect(0,0,n.width,n.height),r.drawImage(t.getBuffer(),0,0))}let g,m;e.width<=i*this.tile_size?(g=this.tile_size*i%e.width,m=Math.floor(this.tile_size*i/e.width)*this.tile_size):(g=i*this.tile_size,m=0);const p=n.getContext();return null!==p&&(p.imageSmoothingEnabled=!1,p.drawImage(e,g,m,this.tile_size,this.tile_size,a,l,this.tile_size,this.tile_size)),new u(r,a,l)}))));return this.isUpdate=!0,a}unload(t){[this.albedoBuffer,this.pbrBuffer,this.normalBuffer].forEach((e=>{t.forEach((t=>{const n=new Array,r=new Array;t.forEach((t=>{n.push(t.position.x),r.push(t.position.y),this.unloadID(t.id)}));const i=0===n.length?0:Math.min(...n),o=0===r.length?0:Math.min(...r),s=Math.max(Math.min(e.width,i),Math.min(e.height,o));if(0===s||0===s)e.width=0,e.height=0;else if(s<e.width||s<e.height){const t=new d(s,s),n=t.getContext();null!==n&&(n.imageSmoothingEnabled=!1,n.drawImage(e.getBuffer(),0,0)),e.width=t.width,e.height=t.height;const r=e.getContext();null!==r&&(r.imageSmoothingEnabled=!0,r.clearRect(0,0,e.width,e.height),r.drawImage(t.getBuffer(),0,0))}this.isUpdate=!0,0!==e.width&&0!==e.height&&t.forEach((t=>{const n=t.position.x,r=t.position.y;if(n<e.width&&r<e.height){const t=e.getContext();null!==t&&(t.imageSmoothingEnabled=!1,t.clearRect(n,r,this.tile_size,this.tile_size))}}))}))}))}}r()}catch(t){r(t)}}))},2279:(t,e,n)=>{"use strict";n.a(t,(async(t,r)=>{try{n.d(e,{m:()=>l});var i=n(5352),o=n(9764),s=n(2574),a=t([i]);i=(a.then?(await a)():a)[0];class l{constructor(t,e){this.assets={},this.isUpdate=!0,this.buffer=new i.l(t),e.forEach((t=>t.src.forEach((e=>this.assets[e.toLowerCase()]=t))))}getBuffer(){return this.buffer}getBufferLocation(t,e){const n=this.assets.hasOwnProperty(t)?this.assets[t]:null;if(null===n)return 0;const r=void 0!==n.locations[e]?n.locations[e][0]:null;return null===r?0:r.id}getAssetSource(t){return this.assets.hasOwnProperty(t)?this.assets[t].data[0]:null}hasAsset(t){return this.assets.hasOwnProperty(t)}getAssetLenght(){return Object.keys(this.assets).length}async load(t){const e=Object.keys(this.assets);await Promise.all(e.map((e=>this.assets[e].load().then(t))));for(const t in this.assets){const e=this.assets[t];e instanceof o.g&&e.locations.push(...this.buffer.load(e.data[0],e.data[1],e.data[2]))}this.isUpdate=!0}async unload(){for(const t in this.assets){const e=this.assets[t];e instanceof o.g&&this.buffer.unload(e.locations),(0,s.vF)(e.locations)}this.isUpdate=!0}checkUpdate(){const{isUpdate:t}=this;return this.isUpdate=!1,t}createTransferData(){const t={};for(const e in this.assets){const n=this.assets[e];n.hasTransfer()||(t[e]=n.createTransferData())}return{assets:t,isUpdate:this.isUpdate}}}r()}catch(t){r(t)}}))},2574:(t,e,n)=>{"use strict";n.d(e,{vF:()=>g,Sy:()=>m,qr:()=>f});var r=n(9790),i=function(t){return function(e,n,r){return t(e,n,r)*r}},o=function(t,e){if(t)throw Error("Invalid sort config: "+e)},s=function(t){var e=t||{},n=e.asc,r=e.desc,s=n?1:-1,a=n||r;return o(!a,"Expected `asc` or `desc` property"),o(n&&r,"Ambiguous object with `asc` and `desc` config properties"),{order:s,sortBy:a,comparer:t.comparer&&i(t.comparer)}};function a(t,e,n){if(void 0===t||!0===t)return function(t,r){return e(t,r,n)};if("string"==typeof t)return o(t.includes("."),"String syntax not allowed for nested properties."),function(r,i){return e(r[t],i[t],n)};if("function"==typeof t)return function(r,i){return e(t(r),t(i),n)};if(Array.isArray(t)){var r=function(t){return function e(n,r,i,o,a,l,c){var d,u;if("string"==typeof n)d=l[n],u=c[n];else{if("function"!=typeof n){var h=s(n);return e(h.sortBy,r,i,h.order,h.comparer||t,l,c)}d=n(l),u=n(c)}var f=a(d,u,o);return(0===f||null==d&&null==u)&&r.length>i?e(r[i],r,i+1,o,a,l,c):f}}(e);return function(i,o){return r(t[0],t,1,n,e,i,o)}}var i=s(t);return a(i.sortBy,i.comparer||e,i.order)}var l=function(t,e,n,r){return Array.isArray(e)?(Array.isArray(n)&&n.length<2&&(n=n[0]),e.sort(a(n,r,t))):e};function c(t){var e=i(t.comparer);return function(n){var r=Array.isArray(n)&&!t.inPlaceSorting?n.slice():n;return{asc:function(t){return l(1,r,t,e)},desc:function(t){return l(-1,r,t,e)},by:function(t){return l(1,r,t,e)}}}}var d=function(t,e,n){return null==t?n:null==e?-n:t<e?-1:t>e?1:0},u=(c({comparer:d}),c({comparer:d,inPlaceSorting:!0}));class h{constructor(t){this.sorter=null,this.sorter=u(t)}asc(t){this.sorter.asc(t)}desc(t){this.sorter.desc(t)}}function f(t){return new h(t)}function g(t){if(r.D1)for(;t.length>0;)t.pop();else t.length=0}function m(t){for(let e=t.length-1|0,n=0;e>n;e--){const n=Math.floor(Math.random()*(e+1)),r=t[e];t[e]=t[n],t[n]=r}}},9790:(t,e,n)=>{"use strict";n.d(e,{D1:()=>o});var r=n(4762);const i=self.navigator.userAgent.length>0?(0,r.getParser)(self.navigator.userAgent):null,o=(i&&i.isBrowser("chrome"),i&&i.getOS().name,i&&i.isBrowser("firefox"));i&&i.isBrowser("safari")},46:(t,e,n)=>{"use strict";n.a(t,(async(t,r)=>{try{n.d(e,{aE:()=>i,vL:()=>o});const t=new(n(1052).V)(Worker,(function(){postMessage(!(!("OffscreenCanvas"in self)||!new OffscreenCanvas(1,1).getContext("2d")),[])})),i="OffscreenCanvas"in self;await t.exec();function o(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return"OffscreenCanvas"in self?new OffscreenCanvas(t,e):(()=>{const n=document.createElement("canvas");return n.width=t,n.height=e,n})()}t.terminate(),r()}catch(t){r(t)}}),1)},7062:(t,e,n)=>{"use strict";function r(){return"localhost"===location.hostname}n.d(e,{O:()=>r})},6749:(t,e,n)=>{"use strict";n.d(e,{j:()=>i});const r=new WeakMap;class i{constructor(t,e){this.type=e,this.timestamp=performance.now(),this.target=t}on(t){let e=r.get(this.target);void 0===e&&r.set(this.target,e=new Map),e.has(this.type)||e.set(this.type,new Array);const n=e.get(this.type);void 0!==n&&n.push(t)}off(t){const e=r.get(this.target);if(void 0===e||!e.has(this.type))return;const n=e.get(this.type);void 0!==n&&n.includes(t)&&n.splice(n.indexOf(t))}trigger(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const e=r.get(this.target)||null,n=this.target["on".concat(this.type)];if(null===e&&!(n instanceof Function))return;for(const e in t)Object.defineProperty(this,e,{writable:!1,enumerable:!0,configurable:!0,value:t[e]});n instanceof Function&&n.call(this.target,this);const i=null!==e&&e.get(this.type)||null;if(null!==i)for(let t=0,e=0|i.length;t<e;t=t+1|0)i[t].call(this.target,this)}async triggerAsync(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const e=r.get(this.target),n=this.target["on".concat(this.type)];if(void 0===e&&!(n instanceof Function))return;for(const e in t)Object.defineProperty(this,e,{writable:!1,enumerable:!0,configurable:!0,value:t[e]});n instanceof Function&&await n.call(this.target,this);const i=void 0!==e?e.get(this.type):void 0;if(void 0!==i)for(let t=0,e=0|i.length;t<e;t=t+1|0){const e=(0,i[t])(this);e instanceof Promise&&await e}}}},3437:(t,e,n)=>{"use strict";function r(t){return btoa(unescape(encodeURIComponent(t)))}n.d(e,{hn:()=>f});var i=n(5326),o=n(2983),s=n(5666);let a=!1;const l=new o.zv("file");function c(t,e){switch(t.toLowerCase()){case"text":return e.text();case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"json":return e.json();case"xml":return e.text().then((t=>(new DOMParser).parseFromString(t,"text/xml")));case"html":return e.text().then((t=>(new DOMParser).parseFromString(t,"text/html")))}return null}async function d(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"text",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{method:"GET",mode:"cors",cache:"no-store",credentials:"same-origin"};try{return await(0,i.h)(t,n).then((async t=>t.ok?await c(e,t):null))}catch(t){return console.error(t),null}}async function u(t){let e=null;a=!0;try{const n=prompt(t);null!==n&&(e=await d(n,"text"))}catch(t){console.error(t)}finally{a=!1}return e}async function h(t,e,n,i,o){let s=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const l=s?t:"".concat(prompt("enter file name")||t).concat(n?"."+n[0]:"");switch(a=!0,i){case"text":o="data:".concat(e?e[0]:"",";charset=utf-8;base64,").concat(r(o));break;case"blob":o=URL.createObjectURL(new Blob([o],{type:e[0]}))}const c=document.createElement("a");c.href=o,c.download=l,document.body.appendChild(c),c.click(),c.remove(),"blob"===i&&URL.revokeObjectURL(o),await new Promise((t=>{const e=()=>{self.removeEventListener("focus",e,!1),t(null)};self.addEventListener("focus",e,!1)})),a=!1}async function f(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"text",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=t;if(/^(data|blob):/.test(t)||new RegExp("^".concat(location.origin)).test(t))r=t;else if("file:"!==location.protocol){const e=/^http:\/\/[^\/]+\/$|^file:\/\/[^\/]+\/$|^http:\/\/$|^file:\/\/$/.test(location.origin)?location.origin.substring(0,location.origin.length-1):location.origin,n=(/^http:\/\/|^file:\/\//.test(location.pathname)||0===location.pathname.length?"/":location.pathname).replace(/\/[^\/]+$/,"/");r="".concat(e).concat(n).concat(t.replace(/^\.\/|^\//,""))}const i=await d(r,e,n);if(null===i)throw new Error("Not found file is ".concat(t));return{source:i,src:r}}(0,s.nq)()||l.addEventListener("message",(async t=>{const{data:e}=t;if(!(e instanceof Object))return;let n=null;switch(e.method){case"open":n=await async function(t,e,n){return(0,s.nq)()?await new Promise((r=>{const i=t=>{const{data:e}=t;if(e instanceof Object&&(l.removeEventListener("message",i),"return"===e.method))e.data&&r(e.data)};l.addEventListener("message",i),l.postMessage({method:"open",description:t,mimeTypes:e,extensions:n})})):"showOpenFilePicker"in window&&self.isSecureContext?await async function(t,e,n){let r=null;a=!0;try{const i=(await showOpenFilePicker({types:[{description:t,accept:(()=>{const t={};return t[e[0]]=n.map((t=>".".concat(t))),t})()}]}))[0];if("granted"===await i.requestPermission({mode:"read"})){const t=await i.getFile();r=await t.text()}else u(t)}catch(t){console.error(t.message)}finally{a=!1}return r}(t,e,n):u(t)}(e.description,e.mimeTypes,e.extensions);break;case"save":await async function(t,e,n,r,i){(0,s.nq)()?await new Promise((o=>{const s=t=>{l.removeEventListener("message",s),o(null)};l.addEventListener("message",s),l.postMessage({method:"save",description:t,mimeTypes:e,extensions:n,type:r,text:i})})):"showSaveFilePicker"in self&&self.isSecureContext?await async function(t,e,n,r,i){let o="boxengine-file".concat(n?"."+n[0]:""),s=null;a=!0;try{const l=await window.showSaveFilePicker({types:[{description:t,accept:(()=>{const t={};return t[e[0]]=n.map((t=>".".concat(t))),t})()}]});o=l.name,"granted"===await l.requestPermission({mode:"readwrite"})?(s=await l.createWritable(),await s.truncate(0),await s.write(i)):await h(o,e,n,r,i instanceof Function?i():i,!0)}catch(t){console.error("Cannot save complete.")}finally{null!==s&&await s.close(),a=!1}}(t,e,n,r,i):h("boxengine-file",e,n,r,i instanceof Function?i():i)}(e.description,e.mimeTypes,e.extensions,e.type,e.text)}l.postMessage({method:"return",data:n})}))},9858:(t,e,n)=>{"use strict";n.a(t,(async(t,r)=>{try{n.d(e,{f:()=>d});var i=n(8211),o=n(827),s=n(1316),a=n(2315),l=t([i]);i=(l.then?(await l)():l)[0];const c=new WeakMap;function d(t){if(c.has(t))return c.get(t)||null;const e=t.getContext("webgl2");if(null===e)return null;const n=new WeakMap,r=(0,i.FN)(e,s.Z,a.Z),l=new Float32Array([0,0,1,0,0,1,1,1]),d=e.createBuffer();if(null===d)throw new Error("");e.bindBuffer(e.ARRAY_BUFFER,d),e.bufferData(e.ARRAY_BUFFER,l,e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,null);const u=e.createVertexArray();if(null===u)throw new Error("");e.bindVertexArray(u),e.enableVertexAttribArray(0),e.bindBuffer(e.ARRAY_BUFFER,d),e.vertexAttribPointer(0,2,e.FLOAT,!1,0,0),e.bindBuffer(e.ARRAY_BUFFER,null),e.viewport(0,0,e.canvas.width,e.canvas.height),e.useProgram(r),e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA);const h=e.getUniformLocation(r,"matrix"),f=e.getUniformLocation(r,"textureMatrix"),g=e.getUniformLocation(r,"image"),m=e.getUniformLocation(r,"alpha"),p=e.getUniformLocation(r,"enableColor"),v=e.getUniformLocation(r,"color"),b=e.TEXTURE_2D,y=e.UNSIGNED_BYTE,x=e.RGBA,_=e.RGBA;let w=null;const E={canvas:t,gl:e,color:[-1,-1,-1],globalAlpha:1,uploadImage:!1,drawImage(i,s,a,l,c,d,u,O,R){let S=null;if(!n.has(i)){const t=e.createTexture();if(null===t)return;this.uploadImage=!0,n.set(i,t)}if(S=n.get(i)||null,null===S)return;this.uploadImage&&(e.bindTexture(b,S),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),e.pixelStorei(e.UNPACK_ALIGNMENT,1),e.texImage2D(b,0,x,i.width,i.height,0,_,y,i),e.texParameteri(b,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(b,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(b,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(b,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),this.uploadImage=!1);const T=i.width,L=i.height;void 0===l&&(l=T),void 0===c&&(c=L),void 0===d&&(d=s,s=0),void 0===u&&(u=a,a=0),void 0===O&&(O=l,l=T),void 0===R&&(R=c,c=L),function(t,n,i,s,a,l,c,d,u,y,x,_,O){if(null===e)return;const R=o.yR(),S=o.yR();o.Iu(S,s/n,a/i,0,S),o.bA(S,l/n,c/i,1,S),o.Iu(R,-1,1,0,R),o.bA(R,2/_,-2/O,1,R),o.Iu(R,d,u,0,R),o.bA(R,y,x,1,R),e.useProgram(r),null!==h&&e.uniformMatrix4fv(h,!1,R),null!==f&&e.uniformMatrix4fv(f,!1,S),null!==g&&w!==t&&(e.activeTexture(e.TEXTURE0),e.bindTexture(b,t),e.uniform1i(g,0),w=t),null!==m&&e.uniform1f(m,E.globalAlpha);const T=-1!==E.color[0]&&-1!==E.color[1]&&-1!==E.color[2];null!==p&&e.uniform1i(p,T?1:0),T&&null!==v&&e.uniform3f(v,E.color[0],E.color[1],E.color[2]),e.drawArrays(e.TRIANGLE_STRIP,0,4)}(S,T,L,s,a,l,c,d,u,O,R,t.width,t.height)},begin(){e.viewport(0,0,e.canvas.width,e.canvas.height),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT),e.bindVertexArray(u),e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA)},close(){e.bindVertexArray(null),e.useProgram(null),e.flush()}};return c.set(t,E),E}r()}catch(t){r(t)}}))},5326:(t,e,n)=>{"use strict";n.d(e,{h:()=>l});var r=n(7062),i=n(2424),o=n(2983),s=n(5666);let a;a=(0,s.nq)(!1)?async function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise(((n,r)=>{const s=(0,i.D)();addEventListener("message",(function t(e){const{data:i}=e;i instanceof Object&&s===i.key&&"fetch"===i.method&&(removeEventListener("message",t),i.error?r():n(new Response(i.data,{status:200})))})),(0,o.gC)({method:"fetch",type:"arraybuffer",options:e,url:t,key:s},[])}))}:(0,s.Vp)()&&!(0,r.O)()?async function(t){const e=await("api"in self?self.api.request(t):null);return new Response(e,{status:e?200:404})}:self.fetch;const l=a},1388:(t,e,n)=>{"use strict";n.d(e,{B:()=>i});var r=n(3437);async function i(t){let e;if("createImageBitmap"in self){const n=(await(0,r.hn)(t,"blob")).source;e=await createImageBitmap(n)}else Image.prototype.decode?(e=new Image,await e.decode()):e=await new Promise((e=>{const n=new Image;n.onload=()=>{e(n)},n.onerror=()=>{throw new Error("Not found image to ".concat(t))},n.src=t}));return e}},5580:(t,e,n)=>{"use strict";n.d(e,{X0:()=>d,nL:()=>u});var r=n(2983),i=n(2424),o=n(5666);const s=new r.zv("local-storage"),a={};(0,o.nq)()?s.addEventListener("message",(t=>{const{data:e}=t;if(e instanceof Object&&"save"===e.method){const t=a[e.name]||{};for(const e in t)delete t[e];for(const n in e.data)t[n]=e.data[n];a[e.name]=t}})):s.addEventListener("message",(t=>{const{data:e}=t;if(e instanceof Object)switch(e.method){case"load":d(e.name).then((t=>{s.postMessage({method:"load",name:e.name,data:t,key:e.key})}));break;case"save":d(e.name).then((t=>{for(const n in e.data)t[n]=e.data[n];u(e.name).then((t=>{s.postMessage({method:"save",name:e.name,data:e.data,key:e.key})}))}));break;case"delete":(async function(t){if((0,o.nq)()){if(!a.hasOwnProperty(t))return;let e=(0,i.D)();return delete a[t],await new Promise((n=>{function r(t){const{data:i}=t;if(i instanceof Object&&i.key===e&&"delete"===i.method)s.removeEventListener("message",r),a[i.name]=i.data,e=null,n(i.data)}s.addEventListener("message",r),s.postMessage({method:"delete",name:t,key:e})}))}{const e=await d(t);for(const t in e)delete e[t];await u(t)}})(e.name).then((()=>{s.postMessage({method:"delete",name:e.name,key:e.key})}))}}));const l=function(t,e){switch(!0){case void 0===e:case null===e:return{__extendData__:!0,type:"null",value:""};case Number.isNaN(e):return{__extendData__:!0,type:"number",value:"NaN"};case Number.POSITIVE_INFINITY===e:return{__extendData__:!0,type:"number",value:"Infinity"};case Number.NEGATIVE_INFINITY===e:return{__extendData__:!0,type:"number",value:"-Infinity"};case e instanceof Date:return{__extendData__:!0,type:"date",value:e.toISOString()};case"symbol"==typeof e:return{__extendData__:!0,type:"symbol",value:Symbol.keyFor(e)}}return e},c=function(t,e){if("object"!=typeof e||!e.__extendData__)return e;switch(e.type){case"undefined":return;case"null":return null;case"number":switch(e.value){case"NaN":return Number.NaN;case"Infinity":case"+Infinity":return Number.POSITIVE_INFINITY;case"-Infinity":return Number.NEGATIVE_INFINITY}case"date":return new Date(e.value);case"symbol":return Symbol.for(e.value)}};async function d(t){let e={};if((0,o.nq)()){if(a.hasOwnProperty(t))return a[t];let n=(0,i.D)();e=await new Promise((e=>{const r=t=>{const{data:i}=t;if(i instanceof Object&&i.key===n&&"load"===i.method)s.removeEventListener("message",r),a[i.name]=i.data,n=null,e(i.data)};s.addEventListener("message",r),s.postMessage({method:"load",name:t,key:n})}))}else if(a.hasOwnProperty(t))e=a[t];else{const n=localStorage.getItem(t);if(n&&n.length>0)try{e=JSON.parse(n,c)}catch(n){localStorage.removeItem(t),e={}}a[t]=e}return e}async function u(t){if((0,o.nq)()){if(!a.hasOwnProperty(t))return;let e=(0,i.D)();await new Promise((n=>{const r=t=>{const{data:i}=t;if(i instanceof Object&&i.key===e&&"save"===i.method)s.removeEventListener("message",r),e=null,n(null)};s.addEventListener("message",r),s.postMessage({method:"save",name:t,data:a[t],key:e})}))}else if(a.hasOwnProperty(t))try{localStorage.setItem(t,JSON.stringify(a[t],l))}catch(t){}}},4402:(t,e,n)=>{"use strict";function r(t){let e=t;return e=16711935&(e|e<<8),e=252645135&(e|e<<4),e=858993459&(e|e<<2),e=1431655765&(e|e<<1),e}function i(t){let e=t;return e&=1023,e=4278190335&(e^e<<16),e=50393103&(e^e<<8),e=51130563&(e^e<<4),e=153391689&(e^e<<2),e}function o(t){let e=t;return e&=1431655765,e=858993459&(e|e>>1),e=252645135&(e|e>>2),e=16711935&(e|e>>4),e=65535&(e|e>>8),e}function s(t){return t}function a(t,e){return r(0|t)|r(0|e)<<1}function l(t,e,n){return i(0|t)|i(0|e)<<1|i(0|n)<<2}function c(t){return[o(t>>0),o(t>>1)]}n.d(e,{Hq:()=>l,mY:()=>s,nI:()=>a,sS:()=>c})},5666:(t,e,n)=>{"use strict";n.d(e,{Pe:()=>f,Vp:()=>h,nq:()=>u});var r=n(8121),i=n.n(r),o=n(317),s=n.n(o);let a=i()(),l=s()(),c="api"in self&&self.api.hasSteam(),d="api"in self&&self.api.hasOpenSteamOverlay();function u(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!t)return"postMessage"in self&&"importScripts"in self;try{return!!importScripts}catch(t){return!1}}function h(){return a}function f(){return l}setInterval((()=>{a=i()(),l=s()(),c="api"in self&&self.api.hasSteam(),d="api"in self&&self.api.hasOpenSteamOverlay()}))},2983:(t,e,n)=>{"use strict";n.d(e,{zv:()=>ut,GK:()=>gt,gC:()=>ht,Kk:()=>ft});n(6749);Promise.resolve(!1),Promise.resolve(!0);var r=Promise.resolve();function i(t,e){return t||(t=0),new Promise((function(n){return setTimeout((function(){return n(e)}),t)}))}function o(){return Math.random().toString(36).substring(2)}var s=0,a=0;function l(){var t=(new Date).getTime();return t===s?1e3*t+ ++a:(s=t,a=0,1e3*t)}var c="[object process]"===Object.prototype.toString.call("undefined"!=typeof process?process:0);const d={create:function(t){var e={messagesCallback:null,bc:new BroadcastChannel(t),subFns:[]};return e.bc.onmessage=function(t){e.messagesCallback&&e.messagesCallback(t.data)},e},close:function(t){t.bc.close(),t.subFns=[]},onMessage:function(t,e){t.messagesCallback=e},postMessage:function(t,e){try{return t.bc.postMessage(e,!1),r}catch(t){return Promise.reject(t)}},canBeUsed:function(){if(c&&"undefined"==typeof window)return!1;if("function"==typeof BroadcastChannel){if(BroadcastChannel._pubkey)throw new Error("BroadcastChannel: Do not overwrite window.BroadcastChannel with this module, this is not a polyfill");return!0}return!1},type:"native",averageResponseTime:function(){return 150},microSeconds:l};var u=function(){function t(t){this.ttl=t,this.set=new Set,this.timeMap=new Map}return t.prototype.has=function(t){return this.set.has(t)},t.prototype.add=function(t){var e=this;this.timeMap.set(t,h()),this.set.add(t),setTimeout((function(){!function(t){var e=h()-t.ttl,n=t.set[Symbol.iterator]();for(;;){var r=n.next().value;if(!r)return;if(!(t.timeMap.get(r)<e))return;t.timeMap.delete(r),t.set.delete(r)}}(e)}),0)},t.prototype.clear=function(){this.set.clear(),this.timeMap.clear()},t}();function h(){return(new Date).getTime()}function f(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=JSON.parse(JSON.stringify(t));return void 0===e.webWorkerSupport&&(e.webWorkerSupport=!0),e.idb||(e.idb={}),e.idb.ttl||(e.idb.ttl=45e3),e.idb.fallbackInterval||(e.idb.fallbackInterval=150),t.idb&&"function"==typeof t.idb.onclose&&(e.idb.onclose=t.idb.onclose),e.localstorage||(e.localstorage={}),e.localstorage.removeTimeout||(e.localstorage.removeTimeout=6e4),t.methods&&(e.methods=t.methods),e.node||(e.node={}),e.node.ttl||(e.node.ttl=12e4),e.node.maxParallelWrites||(e.node.maxParallelWrites=2048),void 0===e.node.useFastPath&&(e.node.useFastPath=!0),e}var g="messages",m={durability:"relaxed"};function p(){if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof window){if(void 0!==window.mozIndexedDB)return window.mozIndexedDB;if(void 0!==window.webkitIndexedDB)return window.webkitIndexedDB;if(void 0!==window.msIndexedDB)return window.msIndexedDB}return!1}function v(t){t.commit&&t.commit()}function b(t,e){var n=t.transaction(g,"readonly",m),r=n.objectStore(g),i=[],o=IDBKeyRange.bound(e+1,1/0);if(r.getAll){var s=r.getAll(o);return new Promise((function(t,e){s.onerror=function(t){return e(t)},s.onsuccess=function(e){t(e.target.result)}}))}return new Promise((function(t,s){var a=function(){try{return o=IDBKeyRange.bound(e+1,1/0),r.openCursor(o)}catch(t){return r.openCursor()}}();a.onerror=function(t){return s(t)},a.onsuccess=function(r){var o=r.target.result;o?o.value.id<e+1?o.continue(e+1):(i.push(o.value),o.continue()):(v(n),t(i))}}))}function y(t,e){return function(t,e){var n=(new Date).getTime()-e,r=t.transaction(g,"readonly",m),i=r.objectStore(g),o=[];return new Promise((function(t){i.openCursor().onsuccess=function(e){var i=e.target.result;if(i){var s=i.value;if(!(s.time<n))return v(r),void t(o);o.push(s),i.continue()}else t(o)}}))}(t,e).then((function(e){return function(t,e){var n=t.transaction([g],"readwrite",m).objectStore(g);return Promise.all(e.map((function(t){var e=n.delete(t);return new Promise((function(t){e.onsuccess=function(){return t()}}))})))}(t,e.map((function(t){return t.id})))}))}function x(t){t.closed||_(t).then((function(){return i(t.options.idb.fallbackInterval)})).then((function(){return x(t)}))}function _(t){return t.closed?r:t.messagesCallback?b(t.db,t.lastCursorId).then((function(e){var n=e.filter((function(t){return!!t})).map((function(e){return e.id>t.lastCursorId&&(t.lastCursorId=e.id),e})).filter((function(e){return function(t,e){return!(t.uuid===e.uuid||e.eMIs.has(t.id)||t.data.time<e.messagesCallbackTime)}(e,t)})).sort((function(t,e){return t.time-e.time}));return n.forEach((function(e){t.messagesCallback&&(t.eMIs.add(e.id),t.messagesCallback(e.data))})),r})):r}const w={create:function(t,e){return e=f(e),function(t){var e="pubkey.broadcast-channel-0-"+t,n=p().open(e);return n.onupgradeneeded=function(t){t.target.result.createObjectStore(g,{keyPath:"id",autoIncrement:!0})},new Promise((function(t,e){n.onerror=function(t){return e(t)},n.onsuccess=function(){t(n.result)}}))}(t).then((function(n){var i={closed:!1,lastCursorId:0,channelName:t,options:e,uuid:o(),eMIs:new u(2*e.idb.ttl),writeBlockPromise:r,messagesCallback:null,readQueuePromises:[],db:n};return n.onclose=function(){i.closed=!0,e.idb.onclose&&e.idb.onclose()},x(i),i}))},close:function(t){t.closed=!0,t.db.close()},onMessage:function(t,e,n){t.messagesCallbackTime=n,t.messagesCallback=e,_(t)},postMessage:function(t,e){return t.writeBlockPromise=t.writeBlockPromise.then((function(){return function(t,e,n){var r={uuid:e,time:(new Date).getTime(),data:n},i=t.transaction([g],"readwrite",m);return new Promise((function(t,e){i.oncomplete=function(){return t()},i.onerror=function(t){return e(t)},i.objectStore(g).add(r),v(i)}))}(t.db,t.uuid,e)})).then((function(){var e,n;0===(e=0,n=10,Math.floor(Math.random()*(n-e+1)+e))&&y(t.db,t.options.idb.ttl)})),t.writeBlockPromise},canBeUsed:function(){return!c&&!!p()},type:"idb",averageResponseTime:function(t){return 2*t.idb.fallbackInterval},microSeconds:l};function E(){var t;if("undefined"==typeof window)return null;try{t=window.localStorage,t=window["ie8-eventlistener/storage"]||window.localStorage}catch(t){}return t}function O(t){return"pubkey.broadcastChannel-"+t}function R(){if(c)return!1;var t=E();if(!t)return!1;try{var e="__broadcastchannel_check";t.setItem(e,"works"),t.removeItem(e)}catch(t){return!1}return!0}const S={create:function(t,e){if(e=f(e),!R())throw new Error("BroadcastChannel: localstorage cannot be used");var n=o(),r=new u(e.localstorage.removeTimeout),i={channelName:t,uuid:n,eMIs:r};return i.listener=function(t,e){var n=O(t),r=function(t){t.key===n&&e(JSON.parse(t.newValue))};return window.addEventListener("storage",r),r}(t,(function(t){i.messagesCallback&&t.uuid!==n&&t.token&&!r.has(t.token)&&(t.data.time&&t.data.time<i.messagesCallbackTime||(r.add(t.token),i.messagesCallback(t.data)))})),i},close:function(t){var e;e=t.listener,window.removeEventListener("storage",e)},onMessage:function(t,e,n){t.messagesCallbackTime=n,t.messagesCallback=e},postMessage:function(t,e){return new Promise((function(n){i().then((function(){var r=O(t.channelName),i={token:o(),time:(new Date).getTime(),data:e,uuid:t.uuid},s=JSON.stringify(i);E().setItem(r,s);var a=document.createEvent("Event");a.initEvent("storage",!0,!0),a.key=r,a.newValue=s,window.dispatchEvent(a),n()}))}))},canBeUsed:R,type:"localstorage",averageResponseTime:function(){var t=navigator.userAgent.toLowerCase();return t.includes("safari")&&!t.includes("chrome")?240:120},microSeconds:l};var T=l,L=new Set;const M={create:function(t){var e={name:t,messagesCallback:null};return L.add(e),e},close:function(t){L.delete(t)},onMessage:function(t,e){t.messagesCallback=e},postMessage:function(t,e){return new Promise((function(n){return setTimeout((function(){Array.from(L).filter((function(e){return e.name===t.name})).filter((function(e){return e!==t})).filter((function(t){return!!t.messagesCallback})).forEach((function(t){return t.messagesCallback(e)})),n()}),5)}))},canBeUsed:function(){return!0},type:"simulate",averageResponseTime:function(){return 5},microSeconds:T};var P=[d,w,S];var I,B=new Set,C=0,A=function(t,e){var n,r,i;this.id=C++,B.add(this),this.name=t,I&&(e=I),this.options=f(e),this.method=function(t){var e=[].concat(t.methods,P).filter(Boolean);if(t.type){if("simulate"===t.type)return M;var n=e.find((function(e){return e.type===t.type}));if(n)return n;throw new Error("method-type "+t.type+" not found")}t.webWorkerSupport||c||(e=e.filter((function(t){return"idb"!==t.type})));var r=e.find((function(t){return t.canBeUsed()}));if(r)return r;throw new Error("No useable method found in "+JSON.stringify(P.map((function(t){return t.type}))))}(this.options),this._iL=!1,this._onML=null,this._addEL={message:[],internal:[]},this._uMP=new Set,this._befC=[],this._prepP=null,r=(n=this).method.create(n.name,n.options),(i=r)&&"function"==typeof i.then?(n._prepP=r,r.then((function(t){n._state=t}))):n._state=r};function k(t,e,n){var i={time:t.method.microSeconds(),type:e,data:n};return(t._prepP?t._prepP:r).then((function(){var e=t.method.postMessage(t._state,i);return t._uMP.add(e),e.catch().then((function(){return t._uMP.delete(e)})),e}))}function D(t){return t._addEL.message.length>0||t._addEL.internal.length>0}function F(t,e,n){t._addEL[e].push(n),function(t){if(!t._iL&&D(t)){var e=function(e){t._addEL[e.type].forEach((function(t){var n=1e5,r=t.time-n;e.time>=r&&t.fn(e.data)}))},n=t.method.microSeconds();t._prepP?t._prepP.then((function(){t._iL=!0,t.method.onMessage(t._state,e,n)})):(t._iL=!0,t.method.onMessage(t._state,e,n))}}(t)}function z(t,e,n){t._addEL[e]=t._addEL[e].filter((function(t){return t!==n})),function(t){if(t._iL&&!D(t)){t._iL=!1;var e=t.method.microSeconds();t.method.onMessage(t._state,null,e)}}(t)}A._pubkey=!0,A.prototype={postMessage:function(t){if(this.closed)throw new Error("BroadcastChannel.postMessage(): Cannot post message after channel has closed "+JSON.stringify(t));return k(this,"message",t)},postInternal:function(t){return k(this,"internal",t)},set onmessage(t){var e={time:this.method.microSeconds(),fn:t};z(this,"message",this._onML),t&&"function"==typeof t?(this._onML=e,F(this,"message",e)):this._onML=null},addEventListener:function(t,e){F(this,t,{time:this.method.microSeconds(),fn:e})},removeEventListener:function(t,e){z(this,t,this._addEL[t].find((function(t){return t.fn===e})))},close:function(){var t=this;if(!this.closed){B.delete(this),this.closed=!0;var e=this._prepP?this._prepP:r;return this._onML=null,this._addEL.message=[],e.then((function(){return Promise.all(Array.from(t._uMP))})).then((function(){return Promise.all(t._befC.map((function(t){return t()})))})).then((function(){return t.method.close(t._state)}))}},get type(){return this.method.type},get isClosed(){return this.closed}};var N=n(5666);n(5326);const U=self,X=self.requestAnimationFrame&&self.requestAnimationFrame||setTimeout,V=self.cancelAnimationFrame||clearTimeout,G=[];let H,j,Y,W,q=0,Z=!1,J=7,K=35,Q=125,$=0,tt=0,et=0;const nt={get didTimeout(){return!1},timeRemaining(){var t=J-(Date.now()-tt);return Math.max(0,t)}},rt=function(t){let e,n;const r=()=>{var i=Date.now()-n;i<99?e=setTimeout(r,99-i):(e=null,t())};return()=>{n=Date.now(),e||(e=setTimeout(r,99))}}((()=>{J=22,Q=66,K=0}));function it(){125!=Q&&(J=7,Q=125,K=35,Z&&(Z&&(W&&V(W),Y&&clearTimeout(Y),Z=!1),at())),rt()}function ot(){W=null,Y=setTimeout(lt,0)}function st(){Y=null,X(ot)}function at(){Z||(j=Q-(Date.now()-tt),H=Date.now(),Z=!0,K&&j<K&&(j=K),j>9?Y=setTimeout(st,j):(j=0,st()))}function lt(){let t;const e=J>9?9:1;if(tt=Date.now(),Z=!1,Y=null,q>2||tt-j-50<H)for(let n=0,r=0|G.length;n<r&&nt.timeRemaining()>e;n=n+1|0)t=G.shift()||null,et++,t&&t(nt);G.length?at():q=0}function ct(t){return $++,G.push(t),at(),$}function dt(t){var e=t-1-et;G[e]&&(G[e]=null)}if("requestIdleCallback"in U&&"cancelIdleCallback"in U)try{self.requestIdleCallback((()=>{}),{timeout:0})}catch(t){(t=>{let e,n;if(self.requestIdleCallback=function(e,n){return n&&"number"==typeof n.timeout?t(e,{timeout:n.timeout}):t(e)},self.IdleDeadline&&(e=self.IdleDeadline.prototype)){if(n=Object.getOwnPropertyDescriptor(e,"timeRemaining"),!n||!n.configurable||!n.get)return;Object.defineProperty(e,"timeRemaining",{value:function(){return n.get.call(this)},enumerable:!0,configurable:!0})}})(self.requestIdleCallback)}else self.requestIdleCallback=ct,self.cancelIdleCallback=dt,self.document&&document.addEventListener&&(self.addEventListener("scroll",it,!0),self.addEventListener("resize",it),document.addEventListener("focus",it,!0),document.addEventListener("mouseover",it,!0),["click","keypress","touchstart","mousedown"].forEach((function(t){document.addEventListener(t,it,{capture:!0,passive:!0})})),self.MutationObserver&&new MutationObserver(it).observe(document.documentElement,{childList:!0,subtree:!0,attributes:!0}));const ut="BroadcastChannel"in self?self.BroadcastChannel:class extends A{addEventListener(t,e){super.addEventListener(t,(n=>{e(new MessageEvent(t,{data:n}))}))}};const ht=(0,N.nq)(!1)?U.postMessage:postMessage,ft=self.requestIdleCallback||ct,gt=self.cancelIdleCallback||dt},7292:(t,e,n)=>{"use strict";n.d(e,{O:()=>i});var r=n(1276);function i(t){return(0,r.B8)(t+Math.PI/2*3)}},2424:(t,e,n)=>{"use strict";function r(){const t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".split("");for(let e=0,n=0|t.length;e<n;e=e+1|0)switch(t[e]){case"x":t[e]=Math.floor(16*Math.random()).toString(16);break;case"y":t[e]=(Math.floor(4*Math.random())+8).toString(16)}return t.join("")}n.d(e,{D:()=>r})},1276:(t,e,n)=>{"use strict";n.d(e,{B8:()=>x,FM:()=>o,KO:()=>b,LW:()=>h,P:()=>s,X6:()=>f,XC:()=>R,c6:()=>M,c8:()=>v,fB:()=>O,gJ:()=>S,iV:()=>T,oK:()=>c,t6:()=>p,tL:()=>m,tx:()=>y,uB:()=>i,vr:()=>E,xv:()=>L,xw:()=>a});const r=2*Math.PI,i=(Math.PI,Math.PI/2);Math.PI;class o{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=t,this.y=e}}class s{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.x=t,this.y=e,this.z=n}}function a(t,e,n,r){return[t-n,e-r]}function l(t,e,n,r,i,o){return[t-r,e-i,n-o]}function c(t,e,n,r){return t*n+e*r}function d(t,e,n,r,i,o){return t*r+e*i+n*o}function u(t,e,n,r,i,o){return[e*o-i*n,n*r-o*t,t*i-r*e]}function h(t,e,n,r){const[i,o]=a(t,e,n,r);return Math.sqrt(c(i,o,i,o))}function f(t,e,n,r,i,o){const[s,a,c]=l(t,e,n,r,i,o);return Math.sqrt(d(s,a,c,s,a,c))}function g(t){return[Math.cos(x(t)),Math.sin(x(t))]}function m(t,e){const n=Math.sin(x(e)),r=Math.cos(x(e)),i=Math.sin(x(t)),o=Math.cos(x(t)),s=Math.abs(r);return[o*s,-n,i*s]}function p(t,e,n){let r=0,i=0;const[o,s]=g(t-Math.PI/2);r+=e*o,i+=e*s;const[a,l]=g(t);return r+=n*a,i+=n*l,[r,i]}function v(t,e,n,r,i){let o=0,s=0,a=0;const[l,c]=g(t-Math.PI/2);if(o+=n*l,a+=n*c,e>0){const[n,i,l]=m(t,e-Math.PI/2);o+=r*n,s+=r*i,a+=r*l}else{const[n,i,l]=m(t,e+Math.PI/2);o-=r*n,s-=r*i,a-=r*l}const[d,u,h]=m(t,e);return o+=i*d,s+=i*u,a+=i*h,[o,s,a]}function b(t,e,n,r){const[i,o]=a(t,e,n,r);return Math.atan2(o,i)}function y(t,e,n,r,i,o){const[s,a,c]=l(t,e,n,r,i,o);return[Math.atan2(c,s),-Math.atan2(a,Math.sqrt(s*s+c*c))]}function x(t){return(t%=r)<0&&(t+=r),6123233995736766e-32===t?0:t}function _(t,e,n){let r=t*t+e*e+n*n;return r>0&&(r=1/Math.sqrt(r)),[t*r,e*r,n*r]}function w(t,e){let n=(t=x(t))-(e=x(e));return n-=Math.floor(n/r)*r,n-=n>Math.PI?r:0,n}function E(t,e,n,r){const[i,o]=function(t,e,n,r){const i=w(t,n);return[i,w(Math.abs(i)<Math.PI/4*3?e:Math.PI/2*(e/Math.abs(e))-e+Math.PI/2*(e/Math.abs(e)),r)]}(t,e,n,r);return[Math.abs(i),Math.abs(o)]}function O(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.5;const o=Math.cos(t),s=Math.sin(t),a=Math.cos(e-Math.PI/2),l=Math.sin(e-Math.PI/2),c=r-.5,d=i-.5,u=n,h=u*a+d*l;return _(h*o-c*s,d*a-u*l,c*o+h*s)}function R(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.5;const o=Math.cos(t),s=Math.sin(t),a=Math.cos(e),l=Math.sin(e),c=r-.5,d=i-.5,u=n,h=u*a+d*l;return _(h*o-c*s,d*a-u*l,c*o+h*s)}function S(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.5;const[o,s,a]=O(t,e,n,r,i),[l,c,d]=R(t,e,n,r,i),[h,f,g]=u(l,c,d,o,s,a);return[h,f,g,o,s,a,l,c,d]}function T(t,e,n,r,i,o,s,a,l,c,u,f,g,m,p,v){let b=arguments.length>16&&void 0!==arguments[16]?arguments[16]:0,y=arguments.length>17&&void 0!==arguments[17]?arguments[17]:1;const x=r-t,_=i-e,w=o-n,E=d(x,_,w,a,l,c),O=d(x,_,w,u,f,g),R=d(x,_,w,m,p,v),S=2*y,T=E/R*S,L=O/R*S,M=s*h(0,0,1,1)/R*S,P=Math.sin(-b),I=Math.cos(-b);return[I*T-P*L,P*T+I*L,M]}function L(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];const r=1/t*2,i=1/e*2;let o=0;for(let s=0,a=0|e;s<a;s=s+1|0)for(let e=0,a=0|t;e<a;e=e+1|0){let t=e*r+r/2,a=s*i+i/2;n[2*o]=t-1,n[2*o+1]=a-1,o++}return[n,r,i]}function M(t){return 90/t/(t/90*2)}},8211:(t,e,n)=>{"use strict";n.a(t,(async(t,r)=>{try{n.d(e,{$r:()=>d,D8:()=>f,FN:()=>b,cE:()=>x,k$:()=>E,r0:()=>h,rP:()=>w,xE:()=>O});var i=n(46),o=n(2343),s=t([i]);i=(s.then?(await s)():s)[0];const a=(0,i.vL)(0,0).getContext("webgl2");class l{constructor(t,e){this.init=!1,this.old_width=0,this.old_height=0,this.old_depth=0,this.old_attachment={},this.color_buller_float=null,this.level=0;const{width:n,height:r,depth:i}=e;let o=!1,s=0,a=null;if(e.hasOwnProperty("attachment"))s=2,a=t.TEXTURE_2D,void 0!==n&&void 0!==r||(o=!0);else switch(!0){case void 0===r:s=1,a=t.TEXTURE_1D;break;case void 0===i:s=2,a=t.TEXTURE_2D;break;default:s=3,a=t.TEXTURE_2D_ARRAY}let l=null,c=null,d=null;switch(e.format){case 1:switch(e.type){case"8i":l=t.INT,c=t.R8I,d=t.RED_INTEGER;break;case"8ui":l=t.UNSIGNED_BYTE,c=t.R8UI,d=t.RED_INTEGER;break;case"16i":l=t.INT,c=t.R16I,d=t.RED_INTEGER;break;case"16ui":l=t.UNSIGNED_BYTE,c=t.R16UI,d=t.RED_INTEGER;break;case"16f":l=t.HALF_FLOAT,c=t.R16F,d=t.RED;break;case"32i":l=t.INT,c=t.R32I,d=t.RED_INTEGER;break;case"32ui":l=t.UNSIGNED_BYTE,c=t.R32UI,d=t.RED_INTEGER;break;case"32f":l=t.FLOAT,c=t.R32F,d=t.RED;break;case"int":l=t.INT,c=t.RED,d=t.RED;break;default:case"uint":l=t.UNSIGNED_BYTE,c=t.RED,d=t.RED;break;case"float":l=t.FLOAT,c=t.RED,d=t.RED}break;case 2:switch(e.type){case"8i":l=t.INT,c=t.RG8I,d=t.RG_INTEGER;break;case"8ui":l=t.UNSIGNED_BYTE,c=t.RG8UI,d=t.RG_INTEGER;break;case"16i":l=t.INT,c=t.RG16I,d=t.RG_INTEGER;break;case"16ui":l=t.UNSIGNED_BYTE,c=t.RG16UI,d=t.RG_INTEGER;break;case"16f":l=t.HALF_FLOAT,c=t.RG16F,d=t.RG;break;case"32i":l=t.INT,c=t.RG32I,d=t.RG_INTEGER;break;case"32ui":l=t.UNSIGNED_BYTE,c=t.RG32UI,d=t.RG_INTEGER;break;case"32f":l=t.FLOAT,c=t.RG32F,d=t.RG;break;case"int":l=t.INT,c=t.RG,d=t.RG;break;default:case"uint":l=t.UNSIGNED_BYTE,c=t.RG,d=t.RG;break;case"float":l=t.FLOAT,c=t.RG,d=t.RG}break;case 3:switch(e.type){case"8i":l=t.INT,c=t.RGB8I,d=t.RGB_INTEGER;break;case"8ui":l=t.UNSIGNED_BYTE,c=t.RGB8UI,d=t.RGB_INTEGER;break;case"16i":l=t.INT,c=t.RGB16I,d=t.RGB_INTEGER;break;case"16ui":l=t.UNSIGNED_BYTE,c=t.RGB16UI,d=t.RGB_INTEGER;break;case"16f":l=t.HALF_FLOAT,c=t.RGB16F,d=t.RGB;break;case"32i":l=t.INT,c=t.RGB32I,d=t.RGB_INTEGER;break;case"32ui":l=t.UNSIGNED_BYTE,c=t.RGB32UI,d=t.RGB_INTEGER;break;case"32f":l=t.FLOAT,c=t.RGB32F,d=t.RGB;break;case"int":l=t.INT,c=t.RGB,d=t.RGB;break;default:case"uint":l=t.UNSIGNED_BYTE,c=t.RGB,d=t.RGB;break;case"float":l=t.FLOAT,c=t.RGB,d=t.RGB}break;default:switch(e.type){case"8i":l=t.INT,c=t.RGBA8I,d=t.RGBA_INTEGER;break;case"8ui":l=t.UNSIGNED_BYTE,c=t.RGBA8UI,d=t.RGBA_INTEGER;break;case"16i":l=t.INT,c=t.RGBA16I,d=t.RGBA_INTEGER;break;case"16ui":l=t.UNSIGNED_BYTE,c=t.RGBA16UI,d=t.RGBA_INTEGER;break;case"16f":l=t.HALF_FLOAT,c=t.RGBA16F,d=t.RGBA;break;case"32i":l=t.INT,c=t.RGBA32I,d=t.RGBA_INTEGER;break;case"32ui":l=t.UNSIGNED_BYTE,c=t.RGBA32UI,d=t.RGBA_INTEGER;break;case"32f":l=t.FLOAT,c=t.RGBA32F,d=t.RGBA;break;case"int":l=t.INT,c=t.RGBA,d=t.RGBA;break;default:case"uint":l=t.UNSIGNED_BYTE,c=t.RGBA,d=t.RGBA;break;case"float":l=t.FLOAT,c=t.RGBA,d=t.RGBA}}const u=t.createTexture();if(null===u)throw new Error("");this.auto_resolution_fix=o,this.dimension=s,this.texture_type=a,this.texture=u,this.tex=e,this.iformat=c,this.format=d,this.type=l}}class c{constructor(t,e,n){this.textures=new Array,this.attachs=new Array,this.width=-1,this.height=-1,this.screen_texture=null,this.attachScreenUniform=!1,this.isScreenBuffer=!1,this.id=e,this.buffer=t.createFramebuffer(),t.useProgram(n),this.screen=t.getUniformLocation(n,"screen"),this.resolution=t.getUniformLocation(n,"resolution"),this.viewport=t.getUniformLocation(n,"viewport"),t.useProgram(null)}}class d{constructor(t,e,n){this.textureMipMapGeneraters=new Array,this.has_init=!1,this.program=null,this.frame=null,this.uniforms=null,this.gl=null,this.id=t,this.vertex=e,this.fragment=n}initProgram(t){const{vertex:e,fragment:n}=this;this.program=b(t,e,n)}init(t,e){this.program&&(this.has_init=!0,this.gl=t,this.frame=new c(t,this.id,this.program),this.uniforms=y(t,this.program,e))}hasInit(){return this.has_init}getID(){return this.id}getProgram(){if(null===this.program)throw new Error("");return this.program}getFrame(){if(null===this.frame)throw new Error("");return this.frame}getUniforms(){if(null===this.uniforms)throw new Error("");return this.uniforms}addTextureMipMapGenerater(t){this.textureMipMapGeneraters.push(t)}execTextureMipMapGenerators(){for(var t;this.textureMipMapGeneraters.length>0;)null===(t=this.textureMipMapGeneraters.shift())||void 0===t||t.call(null)}destroy(){const{gl:t,program:e,frame:n}=this;if(null!==t&&(e&&t.deleteProgram(e),null!==n)){t.deleteFramebuffer(n.buffer),null!==n.screen_texture&&t.deleteTexture(n.screen_texture);for(let e=0,r=0|n.textures.length;e<r;e=e+1|0)t.deleteTexture(n.textures[e])}}}const u=null==a?null:a.getExtension("EXT_texture_filter_anisotropic")||a.getExtension("MOZ_EXT_texture_filter_anisotropic")||a.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),h=null===a?0:a.MAX_TEXTURE_SIZE,f=null===a?0:a.MAX_3D_TEXTURE_SIZE;null===a||a.MAX_COLOR_ATTACHMENTS,null!==a&&null!==u&&a.getParameter(u.MAX_TEXTURE_MAX_ANISOTROPY_EXT);function g(t){const e=t.createProgram();if(null===e)throw new Error("");return e}function m(t,e,n,r){const i=t.createShader(n);if(null===i)throw new Error("");if(t.shaderSource(i,r),t.compileShader(i),!t.getShaderParameter(i,35713))throw t.getShaderInfoLog(i);return t.attachShader(e,i),t.deleteShader(i),i}function p(t,e,n){return m(t,e,t.VERTEX_SHADER,n)}function v(t,e,n){return m(t,e,t.FRAGMENT_SHADER,n)}function b(t,e,n){const r=g(t);if(p(t,r,e),v(t,r,n),t.getProgramParameter(r,35714))throw t.getProgramInfoLog(r);return t.linkProgram(r),r}function y(t,e,n){const r={};t.useProgram(e);for(let i in n){const n=t.getUniformLocation(e,i);null!==n&&(r[i]={location:n})}return t.useProgram(null),r}function x(t,e){const n={};for(const r in e){const i=e[r];n[r]=new l(t,i)}return n}function _(t,e,n,r,i){const{old_width:o,old_height:s,old_depth:a,auto_resolution_fix:l,dimension:c,texture_type:d,texture:u,iformat:h,format:f,type:g}=n;let{width:m,height:p,depth:v}=e;const b=!n.init||!!e.sync||!!e.generateMipmap;if(t.bindTexture(d,u),(b||l)&&0!==m&&0!==p&&0!==v){l&&(m=t.canvas.width,p=t.canvas.height);const y=m!==o||void 0!==p&&p!==s||void 0!==v&&v!==a;if(b||!l||y){t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,e.flip_y||!1),t.pixelStorei(t.UNPACK_ALIGNMENT,e.aligment||1);const o=e.level||0;if(!n.init||y)switch(c){case 1:t.texImage2D(d,o,h,m,1,0,f,g,e.data||null);break;case 2:void 0!==p&&t.texImage2D(d,o,h,m,p,0,f,g,e.data||null);break;case 3:void 0!==p&&void 0!==v&&t.texImage3D(d,o,h,m,p,v,0,f,g,e.data||null)}else if(e.data)switch(c){case 1:t.texSubImage2D(d,o,0,0,m,1,f,g,e.data||null);break;case 2:void 0!==p&&t.texSubImage2D(d,o,0,0,m,p,f,g,e.data||null);break;case 3:void 0!==p&&void 0!==v&&t.texSubImage3D(d,o,0,0,0,m,p,v,f,g,e.data||null)}let s=t.CLAMP_TO_EDGE;switch(e.wrap){case"clamp":s=t.CLAMP_TO_EDGE;break;case"repeat":s=t.REPEAT;break;case"mirror":s=t.MIRRORED_REPEAT}t.texParameteri(d,t.TEXTURE_WRAP_S,s),t.texParameteri(d,t.TEXTURE_WRAP_T,s);let a=!1;if(e.anisotropic){const n=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");n&&(t.texParameterf(t.TEXTURE_2D,n.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT),e.anisotropic)),a=!0)}if(!a){let n=t.NEAREST;switch(e.mag){case"nearest":n=t.NEAREST;break;case"linear":n=t.LINEAR}let r=e.mipmap?t.NEAREST_MIPMAP_LINEAR:t.NEAREST;switch(e.min){case"nearest":r=e.mipmap?"linear"===e.mag?t.LINEAR_MIPMAP_NEAREST:t.NEAREST_MIPMAP_NEAREST:t.NEAREST;break;case"linear":r=e.mipmap?"linear"===e.mag?t.LINEAR_MIPMAP_LINEAR:t.NEAREST_MIPMAP_LINEAR:t.LINEAR}t.texParameteri(d,t.TEXTURE_MAG_FILTER,n),t.texParameteri(d,t.TEXTURE_MIN_FILTER,r)}if(e.attachment)for(let o=0,s=0|r.length;o<s;o=o+1|0){const s=r[o],a=s.getID(),l=e.attachment[a],c=s.getFrame();if(void 0===l)continue;0===l&&(c.isScreenBuffer=!1,n.init=!1);const h=t["COLOR_ATTACHMENT".concat(l)],{buffer:f,attachs:v,textures:b}=c,y=i[a]||{width:m,height:p};if(null===n.color_buller_float&&(g===t.FLOAT||g===t.HALF_FLOAT)&&(n.color_buller_float=t.getExtension("EXT_color_buffer_float")||null,null===n.color_buller_float))throw new Error("Not supported color buffer float.");t.bindFramebuffer(t.FRAMEBUFFER,f),n.init||(t.framebufferTexture2D(t.FRAMEBUFFER,h,d,u,0),v.includes(h)||v.push(h),b.push(u)),void 0!==p&&(t.viewport(0,0,y.width||m,y.height||p),t.clearColor(0,0,0,1),t.clear(t.COLOR_BUFFER_BIT)),t.bindFramebuffer(t.FRAMEBUFFER,null)}}t.bindTexture(d,null),n.init=!0,n.old_width=m,n.old_height=p||1,n.old_depth=v||1}function y(){if(t.bindTexture(d,u),e.mipmap&&e.generateMipmap){if(null===n.color_buller_float&&(g===t.FLOAT||g===t.HALF_FLOAT)&&(n.color_buller_float=t.getExtension("EXT_color_buffer_float")||null,null===n.color_buller_float))throw new Error("Not supported color buffer float.");t.generateMipmap(d)}t.bindTexture(d,null)}let x=!1;if(e.attachment&&e.generateMipmap){const t=Object.keys(e.attachment);for(let e=0,n=0|r.length;e<n;e=e+1|0){const n=r[e];t.includes(n.getID())&&(n.addTextureMipMapGenerater(y),x=!0)}}return x||y(),!0}function w(t,e,n,r,i){for(const o in n){_(t,e[parseInt(o)],n[o],r,i)}}function E(t,e,n){for(var r=arguments.length,i=new Array(r>3?r-3:0),o=3;o<r;o++)i[o-3]=arguments[o];t["uniform".concat(n)](e,...i)}function O(t,e,n,r,i,s){let a=0;for(const l in e){const{location:c}=e[l],d=n[l],u=r[l];if((!d.program||d.program.includes(s))&&c)if(d.hasOwnProperty("unit")){if(!i.hasOwnProperty(d.unit))continue;const{texture:e,texture_type:n}=i[d.unit];t.activeTexture(t["TEXTURE".concat(a)]),t.bindTexture(n,e),E(t,c,"1i",a),a++}else(void 0===u||(0,o.v)(d.value,u.value))&&E(t,c,d.type,...d.value)}return a}r()}catch(t){r(t)}}))},1052:(t,e,n)=>{"use strict";n.d(e,{V:()=>r});class r{constructor(t,e){const n=e.toString().match(/^function\s*\w*\s*\([\w\s,]*\)\s*{([\w\W]*?)}$/),r=function(t,e){return URL.createObjectURL(new Blob([e],{type:t}))}("text/ecmascript",null!==n?n.length>2?"\n\t\t\tonmessage = (".concat(n[1],") =>\n\t\t\t{\n\t\t\t\t").concat(n[2],"\n\n\t\t\t};\n\t\t"):"\n\t\t\tonmessage = () =>\n\t\t\t{\n\t\t\t\t".concat(n[1],"\n\n\t\t\t};\n\t\t"):"");this.source=r,this.worker=new t(r)}exec(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new Promise(((e,n)=>{const r=t=>{this.worker.removeEventListener("message",r),this.worker.removeEventListener("error",i),e(t.data)},i=t=>{this.worker.removeEventListener("message",r),this.worker.removeEventListener("error",i),n(t)};this.worker.addEventListener("message",r),this.worker.addEventListener("error",i),this.worker.postMessage(t)}))}terminate(){URL.revokeObjectURL(this.source),this.worker.terminate()}}},2343:(t,e,n)=>{"use strict";function r(t,e){return t.length!==e.length||void 0!==t.find(((t,n)=>t!==e[n]))}n.d(e,{v:()=>r})},827:(t,e,n)=>{"use strict";n.d(e,{Iu:()=>o,bA:()=>s,yR:()=>i});let r=Float32Array;function i(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new r(16);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function o(t,e,n,i){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new r(16);const s=t[0],a=t[1],l=t[2],c=t[3],d=t[4],u=t[5],h=t[6],f=t[7],g=t[8],m=t[9],p=t[10],v=t[11],b=t[12],y=t[13],x=t[14],_=t[15];return t!==o&&(o[0]=s,o[1]=a,o[2]=l,o[3]=c,o[4]=d,o[5]=u,o[6]=h,o[7]=f,o[8]=g,o[9]=m,o[10]=p,o[11]=v),o[12]=s*e+d*n+g*i+b,o[13]=a*e+u*n+m*i+y,o[14]=l*e+h*n+p*i+x,o[15]=c*e+f*n+v*i+_,o}function s(t,e,n,i){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new r(16);return o[0]=e*t[0],o[1]=e*t[1],o[2]=e*t[2],o[3]=e*t[3],o[4]=n*t[4],o[5]=n*t[5],o[6]=n*t[6],o[7]=n*t[7],o[8]=i*t[8],o[9]=i*t[9],o[10]=i*t[10],o[11]=i*t[11],t!==o&&(o[12]=t[12],o[13]=t[13],o[14]=t[14],o[15]=t[15]),o}},1864:(t,e,n)=>{"use strict";n.a(t,(async(t,r)=>{try{n.d(e,{u:()=>d});var i=n(4600),o=n(46),s=n(2574),a=n(9858),l=t([i,o,a]);[i,o,a]=l.then?(await l)():l;const c=(0,o.vL)(0,0);class d extends i.T{constructor(){super(...arguments),this.uis=new Array}render(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];e.forEach((t=>{t instanceof Array?this.render(...t):this.uis.push(t)}))}paint(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.uis;const r=Math.min(t.canvas.width,t.canvas.height),i=r/300,o=(0,a.f)(c);c.width===t.canvas.width&&c.height===t.canvas.height||(c.width=t.canvas.width,c.height=t.canvas.height),null!==o&&0!==c.width&&0!==c.height&&o.begin(),t.clearRect(0,0,t.canvas.width,t.canvas.height),n.forEach((n=>{if(t.save(),t.imageSmoothingEnabled=!1,null!==n)if(n instanceof Array)this.paint(t,e,n);else if("line"===n.type){const e=n;t.globalAlpha=1,t.strokeStyle=e.color,t.lineWidth=Math.max(1,e.bold*i),t.globalCompositeOperation="source-over",t.beginPath(),t.lineTo(t.canvas.width/2+r/2*e.start.x|0,t.canvas.height/2+r/2*e.start.y|0),t.lineTo(t.canvas.width/2+r/2*e.end.x|0,t.canvas.height/2+r/2*e.end.y|0),t.closePath(),t.stroke()}else if("rect"===n.type){const e=n,o=Math.max(1,Math.floor(300*e.width*i)),s=Math.max(1,Math.floor(300*e.height*i));t.globalAlpha=1,t.globalCompositeOperation="source-over",e.fill?(t.fillStyle=e.color,t.fillRect(t.canvas.width/2+r/2*e.x-o/2+e.offsetX*(o/2)|0,t.canvas.height/2+r/2*e.y-s/2+e.offsetY*(s/2)|0,0|Math.max(1,o),0|Math.max(1,s))):(t.strokeStyle=e.color,t.lineWidth=Math.max(1,e.bold*i),t.strokeRect(t.canvas.width/2+r/2*e.x-o/2+e.offsetX*(o/2)|0,t.canvas.height/2+r/2*e.y-s/2+e.offsetY*(s/2)|0,0|Math.max(1,o),0|Math.max(1,s)))}else if("arc"===n.type){const e=n,o=Math.max(1,Math.floor(300*e.width*i)),s=Math.max(1,Math.floor(300*e.height*i));t.globalAlpha=1,t.globalCompositeOperation="source-over";const a=0|Math.round(t.canvas.width/2+r/2*e.x+e.offsetX*(o/2)),l=0|Math.round(t.canvas.height/2+r/2*e.y+e.offsetY*(s/2));if(t.beginPath(),t.arc(a,l,0|o,e.startAngle,e.endAngle,e.clockWise),e.gradiant.length>0){const n=t.createRadialGradient(a,l,0,a,l,0|o);e.gradiant.forEach(((t,r)=>{n.addColorStop(r/(e.gradiant.length-1)*e.gradiantPar,t)})),t.fillStyle=n,t.fill()}else e.fill?(t.fillStyle=e.color,t.fill()):(t.strokeStyle=e.color,t.lineWidth=Math.max(1,e.bold*(r/300)),t.stroke())}else if(null!==e&&null!==o)if("image"===n.type){const s=n,a=e.getAssetSource(s.image);if(!a)return;const l=Math.max(1,Math.floor(s.width*(s.clipWidth||a.width)*i)),c=Math.max(1,Math.floor(s.height*(s.clipHeight||a.height)*i));o.globalAlpha=s.alpha,o.color=[-1,-1,-1],null===s.width||null===s.height?o.drawImage(a,Math.round(r*s.x+(s.offsetX+1)*(a.width/2)),Math.round(r*s.y+(s.offsetY+1)*(a.height/2))):null===s.clipX||null===s.clipY||null===s.clipWidth||null===s.clipHeight?o.drawImage(a,0|Math.round(t.canvas.width/2+r/2*s.x-l/2+s.offsetX*(l/2)),0|Math.round(t.canvas.height/2+r/2*s.y-c/2+s.offsetY*(c/2)),0|l,0|c):o.drawImage(a,0|s.clipX,0|s.clipY,0|Math.max(1,s.clipWidth),0|Math.max(1,s.clipHeight),0|Math.round(t.canvas.width/2+r/2*s.x-l/2+s.offsetX*(l/2)),0|Math.round(t.canvas.height/2+r/2*s.y-c/2+s.offsetY*(c/2)),0|l,0|c)}else if("font"===n.type&&null!==o){const t=n,i=e.getAssetSource(t.image);if(!i)return;let s=Math.max(t.clipWidth,t.clipWidth*(r/300)),a=Math.max(t.clipHeight,t.clipHeight*(r/300));const l=Math.min(1,r/300);s-=s%t.clipWidth,a-=a%t.clipHeight;let c=s*l,d=a*l;c-=c%t.clipWidth,d-=d%t.clipHeight,s=Math.max(t.clipWidth,s*t.size*(c/s)),a=Math.max(t.clipHeight,a*t.size*(d/a));const u=t.text.toLocaleLowerCase();o.color=t.color||[-1,-1,-1],o.globalAlpha=t.alpha;let h=0,f=0;const g=u.split("\n");for(let e=0,n=0|u.length;e<n;e=e+1|0){const l=u[e];if("\n"===l){h=0,f++;continue}const c=t.order.indexOf(l);if(-1===c)continue;const d=c*t.clipWidth%i.width,m=Math.floor(c*t.clipWidth/i.width)*t.clipHeight,p=o.canvas.width/2+r/2*t.x-s/2*g[f].length+h*s+t.offsetX*(s*n/2),v=o.canvas.height/2+r/2*t.y-a/2+f*a+t.offsetY*(a/2);o.drawImage(i,0|d,0|m,0|t.clipWidth,0|t.clipHeight,0|p,0|v,0|s,0|a),h++}}t.restore()})),null!==o&&0!==c.width&&0!==c.height&&(o.close(),t.drawImage(c,0,0)),(0,s.vF)(this.uis)}destroy(){const t=this.getScreen().getContext("2d");null!==t&&t.clearRect(0,0,t.canvas.width,t.canvas.height)}rendering(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.getScreen().getContext("2d");return!(null===n||n instanceof WebGL2RenderingContext||n instanceof WebGLRenderingContext)&&(this.paint(n,e),!0)}}r()}catch(t){r(t)}}))},3650:(t,e,n)=>{"use strict";n.d(e,{T:()=>o});var r=n(3601),i=n(6749);class o{constructor(t,e,n){this.setting=t,this.resolutions=e,this.renderers=n}hasCRT(){return!!this.setting.isCRT}getSubPixel(){return this.hasCRT()&&this.setting.crtSubPixel||1}getRenderer(t){return this.renderers[t]}getRenderers(){return Object.values(this.renderers)}resize(t){const e=this.getRenderer("ui").getScreen(),[n,o]=(0,r.u)(this.setting,this.resolutions),s=Math.floor(n/this.getSubPixel()),a=Math.floor(o/this.getSubPixel());if(e.width!==s||e.height!==a){const r=this.getRenderer("crt");e.width=n,e.height=o,this.hasCRT()?(r.setScreenSize(n,o),this.getRenderers().filter((t=>t!==r)).forEach((t=>t.setScreenSize(s,a)))):this.getRenderers().forEach((t=>t.setScreenSize(s,a))),t=!0}t&&new i.j(this,"resize").trigger({width:n,height:o})}createTransferData(){const[t,e]=(0,r.u)(this.setting,this.resolutions);return{size:{width:t,height:e}}}postData(t,e){this.getRenderers().forEach((n=>n.postData(t,e,null)))}rendering(t,e){this.getRenderers().forEach((n=>n.rendering(t,e,null)))}update(){}}},4600:(t,e,n)=>{"use strict";n.a(t,(async(t,r)=>{try{n.d(e,{T:()=>s});var i=n(46),o=t([i]);i=(o.then?(await o)():o)[0];class s{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,i.vL)(0,0);this.name=t,this.screen=e}getName(){return this.name}getScreen(){return this.screen}setScreenSize(t,e){const[n,r]=this.getScreenSize();n===t&&r===e||(this.screen.width=0|t,this.screen.height=0|e)}getScreenSize(){return[this.screen.width,this.screen.height]}destroy(){}postData(t){return!1}rendering(t,e,n){return!1}}r()}catch(t){r(t)}}))},1141:(t,e,n)=>{"use strict";n.a(t,(async(t,r)=>{try{n.d(e,{CP:()=>b});var i=n(4600),o=n(1242),s=n.n(o),a=n(46),l=n(6749),c=n(2574),d=n(8211),u=n(2343),h=t([i,a,d]);[i,a,d]=h.then?(await h)():h;const f="#version 300 es\n\tprecision highp float;\n\tprecision highp int;\n\n\tlayout(location = 0) in vec2 pos;\n\n\tvoid main()\n\t{\n\t\tgl_Position = vec4(pos, 0.0, 1.0);\n\t\t\n\t}\n";function g(t){const e=new Float32Array([-1,-1,1,-1,-1,1,1,1]),n=t.createBuffer();if(null===n)throw new Error("");t.bindBuffer(t.ARRAY_BUFFER,n),t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,null);const r=new Float32Array([0,1,1,1,0,0,1,0]),i=t.createBuffer();if(null===i)throw new Error("");t.bindBuffer(t.ARRAY_BUFFER,i),t.bufferData(t.ARRAY_BUFFER,r,t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,null);const o=t.createVertexArray();if(null===o)throw new Error("");t.bindVertexArray(o),t.enableVertexAttribArray(0),t.bindBuffer(t.ARRAY_BUFFER,n),t.vertexAttribPointer(0,2,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,null);return t.enableVertexAttribArray(1),t.bindBuffer(t.ARRAY_BUFFER,i),t.vertexAttribPointer(1,2,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,null),t.bindVertexArray(null),{vertexArray:o,vertexPosBuffer:n,vertexTexBuffer:i}}function m(t,e,n,r,i,o){const{resolution:s,viewport:a}=e;null!==s&&t.uniform2f(s,n,r),null!==a&&t.uniform2f(a,i,o)}function p(t,e,n,r,i){const{screen:o}=n;if(!e||null===o||null===e.screen_texture)return;const{screen_texture:s}=e,a=t.TEXTURE_2D;t.activeTexture(t["TEXTURE".concat(i)]),t.bindTexture(a,s),(0,d.k$)(t,o,"1i",i)}function v(t,e,n,r,i){const o=e.getFrame(),{buffer:s,attachs:a,textures:l,width:c,height:d,screen_texture:u}=o,h=t.TEXTURE_2D,f=t.UNSIGNED_BYTE,g=t.RGBA,m=t.RGBA,p=t.COLOR_ATTACHMENT0,v=i?u||t.createTexture():null;null===v||!i&&v?(t.bindFramebuffer(t.FRAMEBUFFER,s),t.framebufferTexture2D(t.FRAMEBUFFER,p,h,null,0),t.bindFramebuffer(t.FRAMEBUFFER,null),o.isScreenBuffer&&a.splice(a.indexOf(p),1),v&&l.splice(l.indexOf(v),1),o.isScreenBuffer=!1):-1===a.indexOf(p)?(t.bindTexture(h,v),t.pixelStorei(t.UNPACK_ALIGNMENT,1),t.texImage2D(h,0,g,n,r,0,m,f,null),t.texParameteri(h,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(h,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(h,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(h,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.bindFramebuffer(t.FRAMEBUFFER,s),t.framebufferTexture2D(t.FRAMEBUFFER,p,h,v,0),t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindTexture(h,null),o.isScreenBuffer=!0,a.push(p),l.push(v)):!u||n===c&&r===d||(t.bindTexture(h,v),t.pixelStorei(t.UNPACK_ALIGNMENT,1),t.texImage2D(h,0,g,n,r,0,m,f,null),t.bindFramebuffer(t.FRAMEBUFFER,s),t.viewport(0,0,n,r),t.clearColor(0,0,0,1),t.clear(t.COLOR_BUFFER_BIT),t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindTexture(h,null)),o.screen_texture=v,o.width=n,o.height=r}class b extends i.T{constructor(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:(0,a.vL)(0,0);super(t,r),this.isInit=!1,this.vertex=f,this.sync=null,this.sync_mode=!1,this.kernel=null,this.gl=null,this.old_order=new Array,this.old_order_init=new Array,this.old_uniforms={},this.triggerRecompile=!1,this.programs=new Array,this.fragments={},this.vertex=e||this.vertex,this.fragments=n,this.handleLostContext=t=>{new l.j(this,"lostcontext").trigger({})},this.handleContextRestored=t=>{new l.j(this,"contextrestored").trigger({})};const i=r.getContext("webgl2");null!==i&&(this.initPrograms(i),this.gl=i)}_init(t){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},r=arguments.length>4?arguments[4]:void 0;if(null===t)return;let{old_order_init:i}=this;!this.isInit||null===this.gl||this.gl!==t&&this.gl.canvas!==t.canvas?(this.triggerRecompile=!0,this.gl&&this.destroy(),this.init(t,e,n),this.isInit=!0):i.length>0&&(0,u.v)(r,i)&&(this.triggerRecompile=!0),this.old_order_init=s()(r)}_rendering(t,e,n,r,i,o){if(!this.kernel)return!1;const{sync_mode:s,sync:a,kernel:l}=this,{vertexArray:{vertexArray:c},units:u}=l,{width:h,height:f}=t.canvas,g=new Array;for(let t=0,e=0|o.length;t<e;t=t+1|0){const e=o[t],n=this.programs.find((t=>t.getID()===e));void 0!==n&&g.push(n)}for(let n=0,r=0|g.length;n<r;n=n+1|0){const r=g[n],i=g.indexOf(r),o=e[r.getID()]||{width:h,height:f},s=-1!==i&&!!g[i+1];v(t,r,o.width||h,o.height||f,s)}if((0,d.rP)(t,n,u,g,e),s&&a&&!this.hasFinish())return!1;t.bindVertexArray(c);for(let n=0,o=0|g.length;n<o;n=n+1|0){const o=g[n],s=o.getUniforms(),a=o.getFrame(),l=e[o.getID()]||{width:h,height:f};t.viewport(0,0,l.width||h,l.height||f),a.attachs.length>0?(t.bindFramebuffer(t.FRAMEBUFFER,a.buffer),t.drawBuffers(a.attachs)):(t.bindFramebuffer(t.FRAMEBUFFER,null),t.drawBuffers([t.BACK]),t.clearColor(0,0,0,1),t.clear(t.COLOR_BUFFER_BIT)),t.useProgram(o.getProgram());const c=(0,d.xE)(t,s,r,this.old_order.includes(o.getID())?i:{},u,o.getID()),v=g[n-1],b=v?v.getFrame():null;b&&p(t,b,a,0,c),m(t,a,h,f,l.width||h,l.height||f),t.drawArrays(t.TRIANGLE_STRIP,0,4),o.execTextureMipMapGenerators(),t.useProgram(null)}return t.bindVertexArray(null),!0}initPrograms(t){const{fragments:e,vertex:n}=this;(0,c.vF)(this.programs);for(const r in e){const i=new d.$r(r,n,e[r]);i.initProgram(t),this.programs.push(i)}}init(t,e,n){const r=(0,d.cE)(t,e),i=g(t);this.kernel={vertexArray:i,units:r};for(const t in this.old_uniforms)delete this.old_uniforms[t];t.canvas.addEventListener("webglcontextlost",this.handleLostContext,!1),t.canvas.addEventListener("webglcontextrestored",this.handleContextRestored,!1),this.gl===t&&this.gl.canvas===t.canvas||this.initPrograms(t),this.gl=t;for(let e=0,r=0|this.programs.length;e<r;e=e+1|0){this.programs[e].init(t,n)}t.enable(t.CULL_FACE),t.cullFace(t.BACK)}destroy(){super.destroy();const{gl:t}=this;for(let t=0,e=0|this.programs.length;t<e;t=t+1|0){this.programs[t].destroy()}if((0,c.vF)(this.programs),null!==t&&null!==this.kernel){if(t.CONTEXT_LOST_WEBGL!==t.getError()){const{units:e,vertexArray:{vertexArray:n,vertexTexBuffer:r,vertexPosBuffer:i}}=this.kernel;t.deleteVertexArray(n),t.deleteBuffer(r),t.deleteBuffer(i);for(const n in e){const{texture:r}=e[n];t.deleteTexture(r)}this.sync||(t.deleteSync(this.sync),this.sync=null)}t.canvas.removeEventListener("webglcontextlost",this.handleLostContext,!1),t.canvas.removeEventListener("webglcontextrestored",this.handleContextRestored,!1)}for(const t in this.old_uniforms)delete this.old_uniforms[t];(0,c.vF)(this.old_order),this.kernel=null,this.gl=null}hasFinish(){const{gl:t,sync:e}=this;return!t||!e||t.getSyncParameter(e,t.SYNC_STATUS)===t.SIGNALED}getTexturePixelsFromUnit(t,e){if(!this.kernel)return null;const{units:n}=this.kernel;if(!n||!n.hasOwnProperty(e))return null;const{dimension:r,texture:i,format:o,type:s}=n[e],a=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,a),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,r,i,0);let l,c=0;switch(o){case t.RED:c=1;break;case t.RG:c=2;break;case t.RGB:c=3;break;case t.RGBA:c=4}switch(s){case t.UNSIGNED_BYTE:l=new Uint8Array(t.canvas.width*t.canvas.height*c);break;case t.INT:l=new Int32Array(t.canvas.width*t.canvas.height*c);break;case t.FLOAT:l=new Float32Array(t.canvas.width*t.canvas.height*c)}return l&&0!==l.length?(t.readPixels(0,0,t.canvas.width,t.canvas.height,o,s,l),t.bindFramebuffer(t.FRAMEBUFFER,null),l):null}getTexturePixelsFromUniform(t,e){const n=this.programs.find((t=>t.getUniforms().hasOwnProperty(e)));if(void 0===n)return null;const{unit:r}=n.getUniforms()[e];return Number.isInteger(r)&&r?this.getTexturePixelsFromUnit(t,r):null}postDataGL(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getScreen().getContext("webgl2"),e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=arguments.length>4?arguments[4]:void 0;if(null===t)return!1;if(this._init(t,e,n,r,i),!this.kernel)return!1;const{kernel:o}=this,{units:s}=o,{width:a,height:l}=t.canvas,c=new Array;for(let t=0,e=0|i.length;t<e;t=t+1|0){const e=i[t],n=this.programs.find((t=>t.getID()===e));void 0!==n&&c.push(n)}for(let n=0,r=0|c.length;n<r;n=n+1|0){const r=this.programs[n],i=c.indexOf(r),o=e[r.getID()]||{width:a,height:l},s=-1!==i&&!!c[i+1];v(t,r,o.width||a,o.height||l,s)}return(0,d.rP)(t,n,s,c,e),!1}renderingGL(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getScreen().getContext("webgl2"),e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new Array;if(null===t)return!1;const{width:o,height:a}=t.canvas;if(0===o||0===a)return!1;let{old_uniforms:c}=this;this._init(t,e,n,r,i),this.triggerRecompile&&(new l.j(this,"recompile").trigger(),this.triggerRecompile=!1);let d=!1;if(i=i&&i.length>0?i:Object.keys(this.fragments),this._rendering(t,e,n,r,c,i)){const{sync:e}=this;d=!0,(null===e||this.hasFinish())&&(null!==e&&t.deleteSync(e),this.sync=t.fenceSync(t.SYNC_GPU_COMMANDS_COMPLETE,0)),t.flush()}return this.gl=t,this.old_order=s()(i),this.old_uniforms=s()(r),d}}r()}catch(t){r(t)}}))},9210:(t,e,n)=>{"use strict";n.a(t,(async(t,r)=>{try{n.d(e,{f:()=>s});var i=n(1864),o=t([i]);i=(o.then?(await o)():o)[0];class s extends i.u{constructor(){super("ui")}rendering(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return null!==t&&null!==t.ui&&(this.render(...t.ui),super.rendering(t,e,void 0),!0)}}r()}catch(t){r(t)}}))},2221:(t,e,n)=>{"use strict";n.a(t,(async(t,r)=>{try{n.d(e,{O:()=>_});var i=n(1141),o=n(8211),s=n(1276),a=n(7292),l=n(1038),c=n(6878),d=n(8013),u=n(8803),h=n(9106),f=n(7988),g=n(5900),m=n(6815),p=n(2276),v=t([i,o]);function b(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function y(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?b(Object(n),!0).forEach((function(e){x(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):b(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function x(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}[i,o]=v.then?(await v)():v;class _ extends i.CP{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0;super("voxel",l.Z,{raycast:c.Z,lighting:d.Z,stackLighting:u.Z,blurLighting:h.Z,stackBloom:f.Z,blurBloom:g.Z,composite:m.Z}),this.oldBufferWidth=0,this.oldBufferHeight=0,this.oldScreen=null,this.ctx=null,this.oldLightingDotScale=2,this.setting=t,this.maxDrawDistance=e}hasCRT(){return!!this.setting.isCRT}getLightingDotScale(){return this.hasCRT()?1:this.setting.lightingDotScale||1}getBlurDotScale(){return this.hasCRT()?1:this.setting.blurDotScale||1}hasShadow(){return!!this.setting.isShadow}hasSoftShadow(){return!!this.setting.isSoftShadow}hasRoughness(){return!!this.setting.isRoughness}hasBloom(){return!!this.setting.isBloom}getReflectionCount(){return this.setting.reflectionCount||0}hasMuzzleFlash(){return!!this.setting.isMuzzleFlash}hasPixelizedLighting(){return!!this.setting.isPixelizedLighting}calcGlobalSunLight(t){const e=Math.PI/2,n=Math.PI/2+Math.PI/2*.025,r=Math.PI/2*3-Math.PI/2*.025,i=Math.PI/2*3;let o=t%(2*Math.PI);return o<0&&(o=2*Math.PI-o%(2*Math.PI)),n<=o&&r>=o?1:r<o&&i>o?Math.cos((o-r)/(i-r)*(Math.PI/2)):e<o&&n>o?1-Math.cos((o-e)/(n-e)*(Math.PI/2)):0}calcGlobalMoonLight(t){const e=Math.PI/2-Math.PI/2*.025,n=Math.PI/2,r=Math.PI/2*3,i=Math.PI/2*3+Math.PI/2*.025;let o=t%(2*Math.PI);return o<0&&(o=2*Math.PI-o%(2*Math.PI)),n<=o&&r>=o?0:r<o&&i>o?1-Math.cos((o-r)/(i-r)*(Math.PI/2)):e<o&&n>o?Math.cos((o-e)/(n-e)*(Math.PI/2)):1}createBuffer(t){return{raycast:{width:t.canvas.width/2,height:t.canvas.height},lighting:{width:t.canvas.width/(2*this.getLightingDotScale()),height:t.canvas.height/(1*this.getLightingDotScale())},blurLighting:{width:t.canvas.width/(2*this.getLightingDotScale()),height:t.canvas.height/(1*this.getLightingDotScale())},stackLighting:{width:t.canvas.width*this.getLightingDotScale(),height:t.canvas.height*this.getLightingDotScale()},blurBloom:{width:t.canvas.width/(2*this.getLightingDotScale()),height:t.canvas.height/(1*this.getLightingDotScale())},stackBloom:{width:t.canvas.width*this.getLightingDotScale(),height:t.canvas.height*this.getLightingDotScale()},composite:{width:t.canvas.width,height:t.canvas.height}}}createTexture(t,e,n){const{map:r,distance_field:i,materials:o,voxels:s,cluster_list:a,item_list:l,billboard_parameters:c}=e,{oldBufferWidth:d,oldBufferHeight:u}=this,h=n.getBuffer(),f=t.canvas.width,g=t.canvas.height;let m=!1;f===d&&g===u||(m=!0),this.oldBufferWidth=f,this.oldBufferHeight=g;const p=this.oldLightingDotScale!==this.getLightingDotScale();this.oldLightingDotScale=this.getLightingDotScale();const{albedo:v,pbr:b,normal:x}=h.getBuffer(),_=h.checkUpdate();return{0:y(y({type:"32i",format:1},r),{},{sync:null!==r.data}),1:y(y({type:"32i",format:1},i||{width:0}),{},{sync:null!==i}),2:{format:4,data:v,width:h.getSize()[0],height:h.getSize()[1],sync:_},3:{format:4,data:b,width:h.getSize()[0],height:h.getSize()[1],sync:_},4:{format:4,data:x,width:h.getSize()[0],height:h.getSize()[1],sync:_},5:y(y({type:"32i",format:1},o||{width:0}),{},{sync:null!==o}),6:y(y({type:"32f",format:1},s||{width:0}),{},{sync:null!==s}),7:y(y({type:"32f",format:1},c||{width:0}),{},{sync:null!==c}),8:y(y({type:"32i",format:1},a||{width:0}),{},{sync:null!==a}),9:y(y({type:"32i",format:1},l||{width:0}),{},{sync:null!==l}),10:{attachment:{raycast:0},format:4,width:t.canvas.width/2,height:t.canvas.height,sync:m},11:{attachment:{raycast:1},format:4,width:t.canvas.width/2,height:t.canvas.height,sync:m},12:{attachment:{raycast:2},type:"32f",format:4,width:t.canvas.width/2,height:t.canvas.height,sync:m},13:{attachment:{raycast:3},type:"32f",format:4,width:t.canvas.width/2,height:t.canvas.height,sync:m},14:{attachment:{raycast:4},type:"32f",format:4,width:t.canvas.width/2,height:t.canvas.height,sync:m},15:{attachment:{raycast:5},type:"32f",format:4,width:t.canvas.width/2,height:t.canvas.height,sync:m},16:{attachment:{raycast:6},type:"32f",format:4,width:t.canvas.width/2,height:t.canvas.height,sync:m},17:{attachment:{lighting:0},type:"32f",format:4,width:t.canvas.width/(2*this.getLightingDotScale()),height:t.canvas.height/(1*this.getLightingDotScale()),sync:p||m},18:{attachment:{lighting:1},format:4,width:t.canvas.width/(2*this.getLightingDotScale()),height:t.canvas.height/(1*this.getLightingDotScale()),sync:p||m},19:{attachment:{lighting:2},type:"32f",format:4,width:t.canvas.width/(2*this.getLightingDotScale()),height:t.canvas.height/(1*this.getLightingDotScale()),sync:p||m},20:{attachment:{lighting:3},type:"32f",format:4,width:t.canvas.width/(2*this.getLightingDotScale()),height:t.canvas.height/(1*this.getLightingDotScale()),sync:p||m},21:{attachment:{lighting:4},format:4,width:t.canvas.width/(2*this.getLightingDotScale()),height:t.canvas.height/(1*this.getLightingDotScale()),sync:p||m},22:{attachment:{lighting:5},type:"32f",format:4,width:t.canvas.width/(2*this.getLightingDotScale()),height:t.canvas.height/(1*this.getLightingDotScale()),sync:p||m},23:{attachment:{lighting:6},type:"32f",format:4,width:t.canvas.width/(2*this.getLightingDotScale()),height:t.canvas.height/(1*this.getLightingDotScale()),sync:p||m},24:{attachment:{stackLighting:0},type:"16f",format:4,mipmap:!0,min:"linear",mag:"linear",width:t.canvas.width*this.getLightingDotScale(),height:t.canvas.height*this.getLightingDotScale(),generateMipmap:!0,sync:p||m},25:{attachment:{stackLighting:1},type:"16f",format:4,mipmap:!0,min:"linear",mag:"linear",width:t.canvas.width*this.getLightingDotScale(),height:t.canvas.height*this.getLightingDotScale(),generateMipmap:!0,sync:p||m},26:{attachment:{stackLighting:2},type:"16f",format:4,mipmap:!0,min:"linear",mag:"linear",width:t.canvas.width*this.getLightingDotScale(),height:t.canvas.height*this.getLightingDotScale(),generateMipmap:!0,sync:p||m},27:{attachment:{stackLighting:3},type:"16f",format:4,mipmap:!0,min:"linear",mag:"linear",width:t.canvas.width*this.getLightingDotScale(),height:t.canvas.height*this.getLightingDotScale(),generateMipmap:!0,sync:p||m},28:{attachment:{blurLighting:0},type:"32f",format:4,width:t.canvas.width/(2*this.getLightingDotScale()),height:t.canvas.height/(1*this.getLightingDotScale()),sync:p||m},29:{attachment:{blurLighting:1},type:"32f",format:4,width:t.canvas.width/(2*this.getLightingDotScale()),height:t.canvas.height/(1*this.getLightingDotScale()),sync:p||m},30:{attachment:{blurLighting:2},type:"32f",format:4,width:t.canvas.width/(2*this.getLightingDotScale()),height:t.canvas.height/(1*this.getLightingDotScale()),sync:p||m},31:{attachment:{blurLighting:3},format:4,width:t.canvas.width/(2*this.getLightingDotScale()),height:t.canvas.height/(1*this.getLightingDotScale()),sync:p||m},32:{attachment:{stackBloom:0},format:4,mipmap:!0,min:"linear",mag:"linear",width:t.canvas.width*this.getLightingDotScale(),height:t.canvas.height*this.getLightingDotScale(),generateMipmap:!0,sync:p||m},33:{attachment:{blurBloom:0},format:4,width:t.canvas.width/(2*this.getLightingDotScale()),height:t.canvas.height/(1*this.getLightingDotScale()),sync:p||m}}}createUniform(t,e){const{camera:n,sun:r,map:i,cluster_resolution:l,background:c,lateTime:d}=t,u=e.getBuffer(),h=Math.min(i.distance,this.maxDrawDistance);return{max_2d_texture_size:{program:["raycast","lighting"],type:"1i",value:[o.r0]},max_3d_texture_size:{program:["raycast","lighting"],type:"1i",value:[o.D8]},map_size:{program:["raycast","lighting"],type:"3i",value:[i.width,i.height,i.depth]},max_draw_distance:{program:["raycast","lighting","blurLighting","stackBloom","composite"],type:"1f",value:[h]},reflection_count:{program:["lighting","stackBloom","composite"],type:"1i",value:[this.getReflectionCount()]},tile_resolution:{program:["raycast","lighting","blurLighting"],type:"1i",value:[u.getTileSize()]},cluster_resolution:{program:["raycast"],type:"2i",value:l||[1,1]},map_data:{program:["raycast","lighting"],unit:0},distance_field:{program:["raycast","lighting"],unit:1},texture_albedo_data:{program:["raycast","lighting"],unit:2},texture_pbr_data:{program:["raycast","lighting"],unit:3},texture_normal_data:{program:["raycast","lighting"],unit:4},material_data:{program:["raycast","lighting"],unit:5},voxel_data:{program:["raycast","lighting"],unit:6},billboard_data:{program:["raycast","lighting"],unit:7},cluster_list:{program:["raycast"],unit:8},item_list:{program:["raycast"],unit:9},time:{type:"1f",value:[d]},position:{type:"3f",value:null!==n?[n.position.x,n.position.y,n.position.z]:[0,0,0]},direction:{type:"3f",value:null!==n?[n.direction.x,n.direction.y,n.direction.z]:[0,0,0]},ray_dir_y:{type:"3f",value:null!==n?(0,s.fB)(n.direction.x,n.direction.y):[0,0,0]},ray_dir_z:{type:"3f",value:null!==n?(0,s.XC)(n.direction.x,n.direction.y):[0,0,0]},fov:{type:"1f",value:null!==n?[n.fov*n.zoom]:[1]},fov_hud:{type:"1f",value:null!==n?[p.N*n.zoom]:[p.N]},Albedo:{program:["lighting","composite"],unit:10},Normal:{program:["lighting","blurLighting","composite"],unit:11},World:{program:["composite"],unit:12},Material:{program:["lighting","blurLighting","stackBloom","blurBloom","composite"],unit:13},Location:{program:["lighting","blurLighting","composite"],unit:14},Mask:{program:["lighting"],unit:15},BillboardUV:{program:["lighting","blurLighting"],unit:16},Lighting:{program:["stackLighting"],unit:17},Skybox:{program:["composite"],unit:18},Reflection:{program:["stackLighting","blurLighting","stackBloom","composite"],unit:22},ClipAlbedo:{program:["stackBloom"],unit:19},ClipLighting:{program:["stackLighting"],unit:20},ClipReflection:{program:["stackLighting","blurLighting"],unit:23},ClipSkybox:{program:["stackBloom"],unit:21},StackLighting:{program:["blurLighting"],unit:24},StackReflection:{program:["blurLighting"],unit:25},StackClipLighting:{program:["blurLighting"],unit:26},StackClipReflection:{program:["blurLighting"],unit:27},SoftShadow:{program:["composite"],unit:this.hasShadow()&&this.hasSoftShadow()?28:17},Roughness:{program:["stackBloom","composite"],unit:this.getReflectionCount()>0&&this.hasRoughness()?29:22},ClipSoftShadow:{program:["stackBloom"],unit:this.hasShadow()&&this.hasSoftShadow()?30:20},ClipRoughness:{program:["stackBloom"],unit:this.getReflectionCount()>0&&this.hasRoughness()?31:23},StackBloom:{program:["blurBloom"],unit:32},Bloom:{program:["composite"],unit:33},sun_direction:{program:["raycast","lighting","composite"],type:"3f",value:r?(0,s.XC)(r.direction.x,r.direction.y):[0,0,0]},global_sun_light:{program:["raycast","lighting","blurLighting","stackBloom","composite"],type:"1f",value:[null!==r?this.calcGlobalSunLight((0,a.O)(r.direction.y)):0]},global_moon_light:{program:["raycast","lighting","blurLighting","stackBloom","composite"],type:"1f",value:[null!==r?this.calcGlobalMoonLight((0,a.O)(r.direction.y)):0]},sun_light_force:{program:["lighting"],type:"1f",value:[3.75]},moon_light_force:{program:["lighting"],type:"1f",value:[3.75]},player_light_radius:{program:["lighting"],type:"1f",value:[10]},player_light_force:{program:["lighting"],type:"1f",value:[null!==n&&this.hasMuzzleFlash()?n.light:0]},is_shadow:{program:["lighting"],type:"1i",value:[this.hasShadow()?1:0]},is_soft_shadow:{program:["lighting","stackLighting","blurLighting"],type:"1i",value:[this.hasSoftShadow()?1:0]},is_reflection:{program:["lighting"],type:"1i",value:[this.getReflectionCount()>0?1:0]},is_roughness:{program:["stackLighting","blurLighting","stackBloom","composite"],type:"1i",value:[this.hasRoughness()?1:0]},is_bloom:{program:["blurLighting","composite"],type:"1i",value:[this.hasBloom()?1:0]},is_pixelized_lighting:{type:"1i",value:[this.hasPixelizedLighting()?1:0]},background_theme:{type:"1i",program:["raycast","lighting"],value:[(null==c?void 0:c.theme)||0]},background_rise_up_color:{type:"3f",program:["raycast","lighting"],value:(null==c?void 0:c.rise_up_color)||[0,0,0]},backgorund_night_up_color:{type:"3f",program:["raycast","lighting"],value:(null==c?void 0:c.night_up_color)||[0,0,0]},background_rise_down_color:{type:"3f",program:["raycast","lighting"],value:(null==c?void 0:c.rise_down_color)||[0,0,0]},backgorund_night_down_color:{type:"3f",program:["raycast","lighting"],value:(null==c?void 0:c.night_down_color)||[0,0,0]},backgorund_material_up:{type:"3f",program:["raycast","lighting"],value:(null==c?void 0:c.material_up)||[0,0,0]},background_material_down:{type:"3f",program:["raycast","lighting"],value:(null==c?void 0:c.material_down)||[0,0,0]},background_noise_size:{type:"1f",program:["raycast","lighting"],value:[(null==c?void 0:c.noise_size)||0]},background_noise_length:{type:"1f",program:["raycast","lighting"],value:[(null==c?void 0:c.noise_length)||0]}}}getOrder(){return["raycast","lighting",...this.hasShadow()&&this.hasSoftShadow()||this.getReflectionCount()>0&&this.hasRoughness()?["stackLighting","blurLighting"]:[],...this.hasBloom()?["stackBloom","blurBloom"]:[],"composite"]}postData(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const r=this.getScreen();if(r!==this.oldScreen&&(this.ctx=r.getContext("webgl2")),this.oldScreen=r,n=this.ctx,null===t||null===t.voxel||null===e||null===n||"CanvasRenderingContext2D"in self&&n instanceof CanvasRenderingContext2D||"OffscreenCanvasRenderingContext2D"in self&&n instanceof OffscreenCanvasRenderingContext2D||!("WebGL2RenderingContext"in self&&n instanceof WebGL2RenderingContext))return!1;const i=t.voxel,o=this.createBuffer(n),s=this.createTexture(n,i,e),a=this.createUniform(i,e);return this.postDataGL(n,o,s,a,this.getOrder())}rendering(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const r=this.getScreen();if(r!==this.oldScreen&&(this.ctx=r.getContext("webgl2")),this.oldScreen=r,n=this.ctx,null===t||null===t.voxel||null===e||null===n||"CanvasRenderingContext2D"in self&&n instanceof CanvasRenderingContext2D||"OffscreenCanvasRenderingContext2D"in self&&n instanceof OffscreenCanvasRenderingContext2D||!("WebGL2RenderingContext"in self&&n instanceof WebGL2RenderingContext))return!1;const i=t.voxel,o=this.createBuffer(n),s=this.createTexture(n,i,e),a=this.createUniform(i,e);return this.renderingGL(n,o,s,a,this.getOrder())}}r()}catch(t){r(t)}}))},3601:(t,e,n)=>{"use strict";n.d(e,{u:()=>x});var r=n(2983),i=n(2424),o=n(5666);let s=!1,a=!1,l=!1,c=!1;const d=new r.zv("fullscreen"),u=new Array;function h(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return(0,o.nq)()?u.length>0?c:(0,o.Vp)()?a:t?l||s:l:(0,o.Vp)()?a:null!==document.fullscreenElement||!!t&&f()}function f(){return(0,o.nq)()?s:window.innerHeight>=window.outerHeight||window.innerHeight>=window.outerWidth}(0,o.nq)()?d.addEventListener("message",(t=>{const{data:e}=t;if(e instanceof Object)switch(e.method){case"browser":l=e.value;break;case"hack":s=e.value;break;case"electron":a=e.value;break;case"success":u.includes(e.key)&&u.splice(u.indexOf(e.key),1)}})):(d.addEventListener("message",(async t=>{const{data:e}=t;if(e instanceof Object){if("exec"===e.method)await(e.value?function(){const t=async e=>{if((0,o.nq)()){const t=(0,i.D)(),n=r=>{const{data:i}=r;if(i instanceof Object&&i.key===t&&"success"===i.method)u.includes(i.key)&&u.splice(u.indexOf(i.key),1),d.removeEventListener("message",n),e(null)};c=!0,u.push(t),d.addEventListener("message",n),d.postMessage({method:"exec",value:!0,key:t})}else if((0,o.Vp)())a||("api"in self&&self.api.fullscreen(!0),a=!0,window.dispatchEvent(new UIEvent("resize")),d.postMessage({method:"electron",value:a})),e(null);else if(h(!(0,o.Vp)()))e(null);else if(null!==document.body){function t(){d.postMessage({method:"browser",value:h()}),e(null)}document.body.requestFullscreen().then(t).catch(t)}else window.addEventListener("load",(()=>t(e)))};return new Promise(t)}():async function(){(0,o.nq)()?await new Promise((t=>{const e=(0,i.D)(),n=r=>{const{data:i}=r;if(i instanceof Object&&i.key===e&&"success"===i.method)u.includes(i.key)&&u.splice(u.indexOf(i.key),1),d.removeEventListener("message",n),t(null)};c=!1,u.push(e),d.addEventListener("message",n),d.postMessage({method:"exec",value:!1,key:e})})):h(!(0,o.Vp)())&&((0,o.Vp)()?a&&("api"in self&&self.api.fullscreen(!1),a=!1,window.dispatchEvent(new UIEvent("resize")),d.postMessage({method:"electron",value:a})):h(!1)&&await document.exitFullscreen())}());d.postMessage({method:"success",key:e.key})}})),document.addEventListener("fullscreenchange",(t=>{l=!!document.fullscreenElement,d.postMessage({method:"browser",value:l})})));var g=n(1276);const m=new r.zv("screen"),p=new g.FM(0,0);let v=!1,b=1;if((0,o.nq)())m.addEventListener("message",(t=>{const{data:e}=t;if(e instanceof Object)switch(e.method){case"resolution":p.x=e.width,p.y=e.height;break;case"pixel-ratio":b=e.value;break;case"blur":v=e.value}})),m.postMessage({method:"init"});else{let t=!1;function e(){function t(){return(0,o.Vp)()&&h(!0)?[self.screen.width,self.screen.height]:[self.innerWidth,self.innerHeight]}function e(t){v!==t&&(v=t,m.postMessage({method:"blur",value:t}))}const n=()=>{const[n,r]=t();p.x=n,p.y=r,b=self.devicePixelRatio,e(!1),m.postMessage({method:"resolution",width:n,height:r}),m.postMessage({method:"pixel-ratio",value:self.devicePixelRatio})};function r(){document.body.addEventListener("mousedown",n),document.body.addEventListener("touchstart",n),n()}self.addEventListener("resize",n),self.addEventListener("orientationchange",(()=>setTimeout(n,100))),self.addEventListener("fullscreenchange",n),self.addEventListener("fullscreenerror",n),document.addEventListener("pointerlockchange",n),document.addEventListener("pointerlockerror",n),self.addEventListener("focus",(()=>e(!1))),self.addEventListener("blur",(()=>e(!0)));const[i,s]=t();p.x=0|i,p.y=0|s,document.body?r():self.addEventListener("load",r)}m.addEventListener("message",(n=>{const{data:r}=n;if(r instanceof Object&&"init"===r.method)t||e(),t=!0}))}function y(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const{x:e,y:n}=p;return[Math.floor(e*((0,o.Pe)()||!t?1:b)),Math.floor(n/((0,o.Pe)()&&e<n?2:1)*((0,o.Pe)()||!t?1:b))]}function x(t,e){const[n,r]=h(!0)&&e[t.resolutionIndex]||y();return[0|n,0|r]}},4451:(t,e,n)=>{"use strict";n.d(e,{V:()=>r});const r=[[1920,1080],[1280,720],[800,600],[900,600],[300,200]]},4762:function(t){t.exports=function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=90)}({17:function(t,e,n){"use strict";e.__esModule=!0,e.default=void 0;var r=n(18),i=function(){function t(){}return t.getFirstMatch=function(t,e){var n=e.match(t);return n&&n.length>0&&n[1]||""},t.getSecondMatch=function(t,e){var n=e.match(t);return n&&n.length>1&&n[2]||""},t.matchAndReturnConst=function(t,e,n){if(t.test(e))return n},t.getWindowsVersionName=function(t){switch(t){case"NT":return"NT";case"XP":case"NT 5.1":return"XP";case"NT 5.0":return"2000";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}},t.getMacOSVersionName=function(t){var e=t.split(".").splice(0,2).map((function(t){return parseInt(t,10)||0}));if(e.push(0),10===e[0])switch(e[1]){case 5:return"Leopard";case 6:return"Snow Leopard";case 7:return"Lion";case 8:return"Mountain Lion";case 9:return"Mavericks";case 10:return"Yosemite";case 11:return"El Capitan";case 12:return"Sierra";case 13:return"High Sierra";case 14:return"Mojave";case 15:return"Catalina";default:return}},t.getAndroidVersionName=function(t){var e=t.split(".").splice(0,2).map((function(t){return parseInt(t,10)||0}));if(e.push(0),!(1===e[0]&&e[1]<5))return 1===e[0]&&e[1]<6?"Cupcake":1===e[0]&&e[1]>=6?"Donut":2===e[0]&&e[1]<2?"Eclair":2===e[0]&&2===e[1]?"Froyo":2===e[0]&&e[1]>2?"Gingerbread":3===e[0]?"Honeycomb":4===e[0]&&e[1]<1?"Ice Cream Sandwich":4===e[0]&&e[1]<4?"Jelly Bean":4===e[0]&&e[1]>=4?"KitKat":5===e[0]?"Lollipop":6===e[0]?"Marshmallow":7===e[0]?"Nougat":8===e[0]?"Oreo":9===e[0]?"Pie":void 0},t.getVersionPrecision=function(t){return t.split(".").length},t.compareVersions=function(e,n,r){void 0===r&&(r=!1);var i=t.getVersionPrecision(e),o=t.getVersionPrecision(n),s=Math.max(i,o),a=0,l=t.map([e,n],(function(e){var n=s-t.getVersionPrecision(e),r=e+new Array(n+1).join(".0");return t.map(r.split("."),(function(t){return new Array(20-t.length).join("0")+t})).reverse()}));for(r&&(a=s-Math.min(i,o)),s-=1;s>=a;){if(l[0][s]>l[1][s])return 1;if(l[0][s]===l[1][s]){if(s===a)return 0;s-=1}else if(l[0][s]<l[1][s])return-1}},t.map=function(t,e){var n,r=[];if(Array.prototype.map)return Array.prototype.map.call(t,e);for(n=0;n<t.length;n+=1)r.push(e(t[n]));return r},t.find=function(t,e){var n,r;if(Array.prototype.find)return Array.prototype.find.call(t,e);for(n=0,r=t.length;n<r;n+=1){var i=t[n];if(e(i,n))return i}},t.assign=function(t){for(var e,n,r=t,i=arguments.length,o=new Array(i>1?i-1:0),s=1;s<i;s++)o[s-1]=arguments[s];if(Object.assign)return Object.assign.apply(Object,[t].concat(o));var a=function(){var t=o[e];"object"==typeof t&&null!==t&&Object.keys(t).forEach((function(e){r[e]=t[e]}))};for(e=0,n=o.length;e<n;e+=1)a();return t},t.getBrowserAlias=function(t){return r.BROWSER_ALIASES_MAP[t]},t.getBrowserTypeByAlias=function(t){return r.BROWSER_MAP[t]||""},t}();e.default=i,t.exports=e.default},18:function(t,e,n){"use strict";e.__esModule=!0,e.ENGINE_MAP=e.OS_MAP=e.PLATFORMS_MAP=e.BROWSER_MAP=e.BROWSER_ALIASES_MAP=void 0,e.BROWSER_ALIASES_MAP={"Amazon Silk":"amazon_silk","Android Browser":"android",Bada:"bada",BlackBerry:"blackberry",Chrome:"chrome",Chromium:"chromium",Electron:"electron",Epiphany:"epiphany",Firefox:"firefox",Focus:"focus",Generic:"generic","Google Search":"google_search",Googlebot:"googlebot","Internet Explorer":"ie","K-Meleon":"k_meleon",Maxthon:"maxthon","Microsoft Edge":"edge","MZ Browser":"mz","NAVER Whale Browser":"naver",Opera:"opera","Opera Coast":"opera_coast",PhantomJS:"phantomjs",Puffin:"puffin",QupZilla:"qupzilla",QQ:"qq",QQLite:"qqlite",Safari:"safari",Sailfish:"sailfish","Samsung Internet for Android":"samsung_internet",SeaMonkey:"seamonkey",Sleipnir:"sleipnir",Swing:"swing",Tizen:"tizen","UC Browser":"uc",Vivaldi:"vivaldi","WebOS Browser":"webos",WeChat:"wechat","Yandex Browser":"yandex",Roku:"roku"},e.BROWSER_MAP={amazon_silk:"Amazon Silk",android:"Android Browser",bada:"Bada",blackberry:"BlackBerry",chrome:"Chrome",chromium:"Chromium",electron:"Electron",epiphany:"Epiphany",firefox:"Firefox",focus:"Focus",generic:"Generic",googlebot:"Googlebot",google_search:"Google Search",ie:"Internet Explorer",k_meleon:"K-Meleon",maxthon:"Maxthon",edge:"Microsoft Edge",mz:"MZ Browser",naver:"NAVER Whale Browser",opera:"Opera",opera_coast:"Opera Coast",phantomjs:"PhantomJS",puffin:"Puffin",qupzilla:"QupZilla",qq:"QQ Browser",qqlite:"QQ Browser Lite",safari:"Safari",sailfish:"Sailfish",samsung_internet:"Samsung Internet for Android",seamonkey:"SeaMonkey",sleipnir:"Sleipnir",swing:"Swing",tizen:"Tizen",uc:"UC Browser",vivaldi:"Vivaldi",webos:"WebOS Browser",wechat:"WeChat",yandex:"Yandex Browser"},e.PLATFORMS_MAP={tablet:"tablet",mobile:"mobile",desktop:"desktop",tv:"tv"},e.OS_MAP={WindowsPhone:"Windows Phone",Windows:"Windows",MacOS:"macOS",iOS:"iOS",Android:"Android",WebOS:"WebOS",BlackBerry:"BlackBerry",Bada:"Bada",Tizen:"Tizen",Linux:"Linux",ChromeOS:"Chrome OS",PlayStation4:"PlayStation 4",Roku:"Roku"},e.ENGINE_MAP={EdgeHTML:"EdgeHTML",Blink:"Blink",Trident:"Trident",Presto:"Presto",Gecko:"Gecko",WebKit:"WebKit"}},90:function(t,e,n){"use strict";e.__esModule=!0,e.default=void 0;var r,i=(r=n(91))&&r.__esModule?r:{default:r},o=n(18);function s(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var a=function(){function t(){}var e,n,r;return t.getParser=function(t,e){if(void 0===e&&(e=!1),"string"!=typeof t)throw new Error("UserAgent should be a string");return new i.default(t,e)},t.parse=function(t){return new i.default(t).getResult()},e=t,r=[{key:"BROWSER_MAP",get:function(){return o.BROWSER_MAP}},{key:"ENGINE_MAP",get:function(){return o.ENGINE_MAP}},{key:"OS_MAP",get:function(){return o.OS_MAP}},{key:"PLATFORMS_MAP",get:function(){return o.PLATFORMS_MAP}}],(n=null)&&s(e.prototype,n),r&&s(e,r),t}();e.default=a,t.exports=e.default},91:function(t,e,n){"use strict";e.__esModule=!0,e.default=void 0;var r=l(n(92)),i=l(n(93)),o=l(n(94)),s=l(n(95)),a=l(n(17));function l(t){return t&&t.__esModule?t:{default:t}}var c=function(){function t(t,e){if(void 0===e&&(e=!1),null==t||""===t)throw new Error("UserAgent parameter can't be empty");this._ua=t,this.parsedResult={},!0!==e&&this.parse()}var e=t.prototype;return e.getUA=function(){return this._ua},e.test=function(t){return t.test(this._ua)},e.parseBrowser=function(){var t=this;this.parsedResult.browser={};var e=a.default.find(r.default,(function(e){if("function"==typeof e.test)return e.test(t);if(e.test instanceof Array)return e.test.some((function(e){return t.test(e)}));throw new Error("Browser's test function is not valid")}));return e&&(this.parsedResult.browser=e.describe(this.getUA())),this.parsedResult.browser},e.getBrowser=function(){return this.parsedResult.browser?this.parsedResult.browser:this.parseBrowser()},e.getBrowserName=function(t){return t?String(this.getBrowser().name).toLowerCase()||"":this.getBrowser().name||""},e.getBrowserVersion=function(){return this.getBrowser().version},e.getOS=function(){return this.parsedResult.os?this.parsedResult.os:this.parseOS()},e.parseOS=function(){var t=this;this.parsedResult.os={};var e=a.default.find(i.default,(function(e){if("function"==typeof e.test)return e.test(t);if(e.test instanceof Array)return e.test.some((function(e){return t.test(e)}));throw new Error("Browser's test function is not valid")}));return e&&(this.parsedResult.os=e.describe(this.getUA())),this.parsedResult.os},e.getOSName=function(t){var e=this.getOS().name;return t?String(e).toLowerCase()||"":e||""},e.getOSVersion=function(){return this.getOS().version},e.getPlatform=function(){return this.parsedResult.platform?this.parsedResult.platform:this.parsePlatform()},e.getPlatformType=function(t){void 0===t&&(t=!1);var e=this.getPlatform().type;return t?String(e).toLowerCase()||"":e||""},e.parsePlatform=function(){var t=this;this.parsedResult.platform={};var e=a.default.find(o.default,(function(e){if("function"==typeof e.test)return e.test(t);if(e.test instanceof Array)return e.test.some((function(e){return t.test(e)}));throw new Error("Browser's test function is not valid")}));return e&&(this.parsedResult.platform=e.describe(this.getUA())),this.parsedResult.platform},e.getEngine=function(){return this.parsedResult.engine?this.parsedResult.engine:this.parseEngine()},e.getEngineName=function(t){return t?String(this.getEngine().name).toLowerCase()||"":this.getEngine().name||""},e.parseEngine=function(){var t=this;this.parsedResult.engine={};var e=a.default.find(s.default,(function(e){if("function"==typeof e.test)return e.test(t);if(e.test instanceof Array)return e.test.some((function(e){return t.test(e)}));throw new Error("Browser's test function is not valid")}));return e&&(this.parsedResult.engine=e.describe(this.getUA())),this.parsedResult.engine},e.parse=function(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this},e.getResult=function(){return a.default.assign({},this.parsedResult)},e.satisfies=function(t){var e=this,n={},r=0,i={},o=0;if(Object.keys(t).forEach((function(e){var s=t[e];"string"==typeof s?(i[e]=s,o+=1):"object"==typeof s&&(n[e]=s,r+=1)})),r>0){var s=Object.keys(n),l=a.default.find(s,(function(t){return e.isOS(t)}));if(l){var c=this.satisfies(n[l]);if(void 0!==c)return c}var d=a.default.find(s,(function(t){return e.isPlatform(t)}));if(d){var u=this.satisfies(n[d]);if(void 0!==u)return u}}if(o>0){var h=Object.keys(i),f=a.default.find(h,(function(t){return e.isBrowser(t,!0)}));if(void 0!==f)return this.compareVersion(i[f])}},e.isBrowser=function(t,e){void 0===e&&(e=!1);var n=this.getBrowserName().toLowerCase(),r=t.toLowerCase(),i=a.default.getBrowserTypeByAlias(r);return e&&i&&(r=i.toLowerCase()),r===n},e.compareVersion=function(t){var e=[0],n=t,r=!1,i=this.getBrowserVersion();if("string"==typeof i)return">"===t[0]||"<"===t[0]?(n=t.substr(1),"="===t[1]?(r=!0,n=t.substr(2)):e=[],">"===t[0]?e.push(1):e.push(-1)):"="===t[0]?n=t.substr(1):"~"===t[0]&&(r=!0,n=t.substr(1)),e.indexOf(a.default.compareVersions(i,n,r))>-1},e.isOS=function(t){return this.getOSName(!0)===String(t).toLowerCase()},e.isPlatform=function(t){return this.getPlatformType(!0)===String(t).toLowerCase()},e.isEngine=function(t){return this.getEngineName(!0)===String(t).toLowerCase()},e.is=function(t,e){return void 0===e&&(e=!1),this.isBrowser(t,e)||this.isOS(t)||this.isPlatform(t)},e.some=function(t){var e=this;return void 0===t&&(t=[]),t.some((function(t){return e.is(t)}))},t}();e.default=c,t.exports=e.default},92:function(t,e,n){"use strict";e.__esModule=!0,e.default=void 0;var r,i=(r=n(17))&&r.__esModule?r:{default:r},o=/version\/(\d+(\.?_?\d+)+)/i,s=[{test:[/googlebot/i],describe:function(t){var e={name:"Googlebot"},n=i.default.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,t)||i.default.getFirstMatch(o,t);return n&&(e.version=n),e}},{test:[/opera/i],describe:function(t){var e={name:"Opera"},n=i.default.getFirstMatch(o,t)||i.default.getFirstMatch(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/opr\/|opios/i],describe:function(t){var e={name:"Opera"},n=i.default.getFirstMatch(/(?:opr|opios)[\s/](\S+)/i,t)||i.default.getFirstMatch(o,t);return n&&(e.version=n),e}},{test:[/SamsungBrowser/i],describe:function(t){var e={name:"Samsung Internet for Android"},n=i.default.getFirstMatch(o,t)||i.default.getFirstMatch(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/Whale/i],describe:function(t){var e={name:"NAVER Whale Browser"},n=i.default.getFirstMatch(o,t)||i.default.getFirstMatch(/(?:whale)[\s/](\d+(?:\.\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/MZBrowser/i],describe:function(t){var e={name:"MZ Browser"},n=i.default.getFirstMatch(/(?:MZBrowser)[\s/](\d+(?:\.\d+)+)/i,t)||i.default.getFirstMatch(o,t);return n&&(e.version=n),e}},{test:[/focus/i],describe:function(t){var e={name:"Focus"},n=i.default.getFirstMatch(/(?:focus)[\s/](\d+(?:\.\d+)+)/i,t)||i.default.getFirstMatch(o,t);return n&&(e.version=n),e}},{test:[/swing/i],describe:function(t){var e={name:"Swing"},n=i.default.getFirstMatch(/(?:swing)[\s/](\d+(?:\.\d+)+)/i,t)||i.default.getFirstMatch(o,t);return n&&(e.version=n),e}},{test:[/coast/i],describe:function(t){var e={name:"Opera Coast"},n=i.default.getFirstMatch(o,t)||i.default.getFirstMatch(/(?:coast)[\s/](\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/opt\/\d+(?:.?_?\d+)+/i],describe:function(t){var e={name:"Opera Touch"},n=i.default.getFirstMatch(/(?:opt)[\s/](\d+(\.?_?\d+)+)/i,t)||i.default.getFirstMatch(o,t);return n&&(e.version=n),e}},{test:[/yabrowser/i],describe:function(t){var e={name:"Yandex Browser"},n=i.default.getFirstMatch(/(?:yabrowser)[\s/](\d+(\.?_?\d+)+)/i,t)||i.default.getFirstMatch(o,t);return n&&(e.version=n),e}},{test:[/ucbrowser/i],describe:function(t){var e={name:"UC Browser"},n=i.default.getFirstMatch(o,t)||i.default.getFirstMatch(/(?:ucbrowser)[\s/](\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/Maxthon|mxios/i],describe:function(t){var e={name:"Maxthon"},n=i.default.getFirstMatch(o,t)||i.default.getFirstMatch(/(?:Maxthon|mxios)[\s/](\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/epiphany/i],describe:function(t){var e={name:"Epiphany"},n=i.default.getFirstMatch(o,t)||i.default.getFirstMatch(/(?:epiphany)[\s/](\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/puffin/i],describe:function(t){var e={name:"Puffin"},n=i.default.getFirstMatch(o,t)||i.default.getFirstMatch(/(?:puffin)[\s/](\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/sleipnir/i],describe:function(t){var e={name:"Sleipnir"},n=i.default.getFirstMatch(o,t)||i.default.getFirstMatch(/(?:sleipnir)[\s/](\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/k-meleon/i],describe:function(t){var e={name:"K-Meleon"},n=i.default.getFirstMatch(o,t)||i.default.getFirstMatch(/(?:k-meleon)[\s/](\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/micromessenger/i],describe:function(t){var e={name:"WeChat"},n=i.default.getFirstMatch(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,t)||i.default.getFirstMatch(o,t);return n&&(e.version=n),e}},{test:[/qqbrowser/i],describe:function(t){var e={name:/qqbrowserlite/i.test(t)?"QQ Browser Lite":"QQ Browser"},n=i.default.getFirstMatch(/(?:qqbrowserlite|qqbrowser)[/](\d+(\.?_?\d+)+)/i,t)||i.default.getFirstMatch(o,t);return n&&(e.version=n),e}},{test:[/msie|trident/i],describe:function(t){var e={name:"Internet Explorer"},n=i.default.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/\sedg\//i],describe:function(t){var e={name:"Microsoft Edge"},n=i.default.getFirstMatch(/\sedg\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/edg([ea]|ios)/i],describe:function(t){var e={name:"Microsoft Edge"},n=i.default.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/vivaldi/i],describe:function(t){var e={name:"Vivaldi"},n=i.default.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/seamonkey/i],describe:function(t){var e={name:"SeaMonkey"},n=i.default.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/sailfish/i],describe:function(t){var e={name:"Sailfish"},n=i.default.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i,t);return n&&(e.version=n),e}},{test:[/silk/i],describe:function(t){var e={name:"Amazon Silk"},n=i.default.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/phantom/i],describe:function(t){var e={name:"PhantomJS"},n=i.default.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/slimerjs/i],describe:function(t){var e={name:"SlimerJS"},n=i.default.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(t){var e={name:"BlackBerry"},n=i.default.getFirstMatch(o,t)||i.default.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/(web|hpw)[o0]s/i],describe:function(t){var e={name:"WebOS Browser"},n=i.default.getFirstMatch(o,t)||i.default.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/bada/i],describe:function(t){var e={name:"Bada"},n=i.default.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/tizen/i],describe:function(t){var e={name:"Tizen"},n=i.default.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,t)||i.default.getFirstMatch(o,t);return n&&(e.version=n),e}},{test:[/qupzilla/i],describe:function(t){var e={name:"QupZilla"},n=i.default.getFirstMatch(/(?:qupzilla)[\s/](\d+(\.?_?\d+)+)/i,t)||i.default.getFirstMatch(o,t);return n&&(e.version=n),e}},{test:[/firefox|iceweasel|fxios/i],describe:function(t){var e={name:"Firefox"},n=i.default.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/electron/i],describe:function(t){var e={name:"Electron"},n=i.default.getFirstMatch(/(?:electron)\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/MiuiBrowser/i],describe:function(t){var e={name:"Miui"},n=i.default.getFirstMatch(/(?:MiuiBrowser)[\s/](\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/chromium/i],describe:function(t){var e={name:"Chromium"},n=i.default.getFirstMatch(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,t)||i.default.getFirstMatch(o,t);return n&&(e.version=n),e}},{test:[/chrome|crios|crmo/i],describe:function(t){var e={name:"Chrome"},n=i.default.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/GSA/i],describe:function(t){var e={name:"Google Search"},n=i.default.getFirstMatch(/(?:GSA)\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:function(t){var e=!t.test(/like android/i),n=t.test(/android/i);return e&&n},describe:function(t){var e={name:"Android Browser"},n=i.default.getFirstMatch(o,t);return n&&(e.version=n),e}},{test:[/playstation 4/i],describe:function(t){var e={name:"PlayStation 4"},n=i.default.getFirstMatch(o,t);return n&&(e.version=n),e}},{test:[/safari|applewebkit/i],describe:function(t){var e={name:"Safari"},n=i.default.getFirstMatch(o,t);return n&&(e.version=n),e}},{test:[/.*/i],describe:function(t){var e=-1!==t.search("\\(")?/^(.*)\/(.*)[ \t]\((.*)/:/^(.*)\/(.*) /;return{name:i.default.getFirstMatch(e,t),version:i.default.getSecondMatch(e,t)}}}];e.default=s,t.exports=e.default},93:function(t,e,n){"use strict";e.__esModule=!0,e.default=void 0;var r,i=(r=n(17))&&r.__esModule?r:{default:r},o=n(18),s=[{test:[/Roku\/DVP/],describe:function(t){var e=i.default.getFirstMatch(/Roku\/DVP-(\d+\.\d+)/i,t);return{name:o.OS_MAP.Roku,version:e}}},{test:[/windows phone/i],describe:function(t){var e=i.default.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,t);return{name:o.OS_MAP.WindowsPhone,version:e}}},{test:[/windows /i],describe:function(t){var e=i.default.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i,t),n=i.default.getWindowsVersionName(e);return{name:o.OS_MAP.Windows,version:e,versionName:n}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(t){var e={name:o.OS_MAP.iOS},n=i.default.getSecondMatch(/(Version\/)(\d[\d.]+)/,t);return n&&(e.version=n),e}},{test:[/macintosh/i],describe:function(t){var e=i.default.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,t).replace(/[_\s]/g,"."),n=i.default.getMacOSVersionName(e),r={name:o.OS_MAP.MacOS,version:e};return n&&(r.versionName=n),r}},{test:[/(ipod|iphone|ipad)/i],describe:function(t){var e=i.default.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,t).replace(/[_\s]/g,".");return{name:o.OS_MAP.iOS,version:e}}},{test:function(t){var e=!t.test(/like android/i),n=t.test(/android/i);return e&&n},describe:function(t){var e=i.default.getFirstMatch(/android[\s/-](\d+(\.\d+)*)/i,t),n=i.default.getAndroidVersionName(e),r={name:o.OS_MAP.Android,version:e};return n&&(r.versionName=n),r}},{test:[/(web|hpw)[o0]s/i],describe:function(t){var e=i.default.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,t),n={name:o.OS_MAP.WebOS};return e&&e.length&&(n.version=e),n}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(t){var e=i.default.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i,t)||i.default.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i,t)||i.default.getFirstMatch(/\bbb(\d+)/i,t);return{name:o.OS_MAP.BlackBerry,version:e}}},{test:[/bada/i],describe:function(t){var e=i.default.getFirstMatch(/bada\/(\d+(\.\d+)*)/i,t);return{name:o.OS_MAP.Bada,version:e}}},{test:[/tizen/i],describe:function(t){var e=i.default.getFirstMatch(/tizen[/\s](\d+(\.\d+)*)/i,t);return{name:o.OS_MAP.Tizen,version:e}}},{test:[/linux/i],describe:function(){return{name:o.OS_MAP.Linux}}},{test:[/CrOS/],describe:function(){return{name:o.OS_MAP.ChromeOS}}},{test:[/PlayStation 4/],describe:function(t){var e=i.default.getFirstMatch(/PlayStation 4[/\s](\d+(\.\d+)*)/i,t);return{name:o.OS_MAP.PlayStation4,version:e}}}];e.default=s,t.exports=e.default},94:function(t,e,n){"use strict";e.__esModule=!0,e.default=void 0;var r,i=(r=n(17))&&r.__esModule?r:{default:r},o=n(18),s=[{test:[/googlebot/i],describe:function(){return{type:"bot",vendor:"Google"}}},{test:[/huawei/i],describe:function(t){var e=i.default.getFirstMatch(/(can-l01)/i,t)&&"Nova",n={type:o.PLATFORMS_MAP.mobile,vendor:"Huawei"};return e&&(n.model=e),n}},{test:[/nexus\s*(?:7|8|9|10).*/i],describe:function(){return{type:o.PLATFORMS_MAP.tablet,vendor:"Nexus"}}},{test:[/ipad/i],describe:function(){return{type:o.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(){return{type:o.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/kftt build/i],describe:function(){return{type:o.PLATFORMS_MAP.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"}}},{test:[/silk/i],describe:function(){return{type:o.PLATFORMS_MAP.tablet,vendor:"Amazon"}}},{test:[/tablet(?! pc)/i],describe:function(){return{type:o.PLATFORMS_MAP.tablet}}},{test:function(t){var e=t.test(/ipod|iphone/i),n=t.test(/like (ipod|iphone)/i);return e&&!n},describe:function(t){var e=i.default.getFirstMatch(/(ipod|iphone)/i,t);return{type:o.PLATFORMS_MAP.mobile,vendor:"Apple",model:e}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe:function(){return{type:o.PLATFORMS_MAP.mobile,vendor:"Nexus"}}},{test:[/[^-]mobi/i],describe:function(){return{type:o.PLATFORMS_MAP.mobile}}},{test:function(t){return"blackberry"===t.getBrowserName(!0)},describe:function(){return{type:o.PLATFORMS_MAP.mobile,vendor:"BlackBerry"}}},{test:function(t){return"bada"===t.getBrowserName(!0)},describe:function(){return{type:o.PLATFORMS_MAP.mobile}}},{test:function(t){return"windows phone"===t.getBrowserName()},describe:function(){return{type:o.PLATFORMS_MAP.mobile,vendor:"Microsoft"}}},{test:function(t){var e=Number(String(t.getOSVersion()).split(".")[0]);return"android"===t.getOSName(!0)&&e>=3},describe:function(){return{type:o.PLATFORMS_MAP.tablet}}},{test:function(t){return"android"===t.getOSName(!0)},describe:function(){return{type:o.PLATFORMS_MAP.mobile}}},{test:function(t){return"macos"===t.getOSName(!0)},describe:function(){return{type:o.PLATFORMS_MAP.desktop,vendor:"Apple"}}},{test:function(t){return"windows"===t.getOSName(!0)},describe:function(){return{type:o.PLATFORMS_MAP.desktop}}},{test:function(t){return"linux"===t.getOSName(!0)},describe:function(){return{type:o.PLATFORMS_MAP.desktop}}},{test:function(t){return"playstation 4"===t.getOSName(!0)},describe:function(){return{type:o.PLATFORMS_MAP.tv}}},{test:function(t){return"roku"===t.getOSName(!0)},describe:function(){return{type:o.PLATFORMS_MAP.tv}}}];e.default=s,t.exports=e.default},95:function(t,e,n){"use strict";e.__esModule=!0,e.default=void 0;var r,i=(r=n(17))&&r.__esModule?r:{default:r},o=n(18),s=[{test:function(t){return"microsoft edge"===t.getBrowserName(!0)},describe:function(t){if(/\sedg\//i.test(t))return{name:o.ENGINE_MAP.Blink};var e=i.default.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i,t);return{name:o.ENGINE_MAP.EdgeHTML,version:e}}},{test:[/trident/i],describe:function(t){var e={name:o.ENGINE_MAP.Trident},n=i.default.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:function(t){return t.test(/presto/i)},describe:function(t){var e={name:o.ENGINE_MAP.Presto},n=i.default.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:function(t){var e=t.test(/gecko/i),n=t.test(/like gecko/i);return e&&!n},describe:function(t){var e={name:o.ENGINE_MAP.Gecko},n=i.default.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/(apple)?webkit\/537\.36/i],describe:function(){return{name:o.ENGINE_MAP.Blink}}},{test:[/(apple)?webkit/i],describe:function(t){var e={name:o.ENGINE_MAP.WebKit},n=i.default.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}}];e.default=s,t.exports=e.default}})},1242:function(t,e,n){t.exports=function(){"use strict";var t=Function.prototype.toString,e=Object.create,r=Object.defineProperty,i=Object.getOwnPropertyDescriptor,o=Object.getOwnPropertyNames,s=Object.getOwnPropertySymbols,a=Object.getPrototypeOf,l=Object.prototype,c=l.hasOwnProperty,d=l.propertyIsEnumerable,u="function"==typeof s,h="function"==typeof WeakMap,f=function(){if(h)return function(){return new WeakMap};var t=function(){function t(){this._keys=[],this._values=[]}return t.prototype.has=function(t){return!!~this._keys.indexOf(t)},t.prototype.get=function(t){return this._values[this._keys.indexOf(t)]},t.prototype.set=function(t,e){this._keys.push(t),this._values.push(e)},t}();return function(){return new t}}(),g=function(n,r){var i=n.__proto__||a(n);if(!i)return e(null);var o=i.constructor;if(o===r.Object)return i===r.Object.prototype?{}:e(i);if(~t.call(o).indexOf("[native code]"))try{return new o}catch(t){}return e(i)},m=function(t,e,n,r){var i=g(t,e);for(var o in r.set(t,i),t)c.call(t,o)&&(i[o]=n(t[o],r));if(u)for(var a=s(t),l=0,h=a.length,f=void 0;l<h;++l)f=a[l],d.call(t,f)&&(i[f]=n(t[f],r));return i},p=function(t,e,n,a){var l=g(t,e);a.set(t,l);for(var c=u?o(t).concat(s(t)):o(t),d=0,h=c.length,f=void 0,m=void 0;d<h;++d)if("callee"!==(f=c[d])&&"caller"!==f)if(m=i(t,f)){m.get||m.set||(m.value=n(t[f],a));try{r(l,f,m)}catch(t){l[f]=m.value}}else l[f]=n(t[f],a);return l},v=function(t){var e="";return t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),t.unicode&&(e+="u"),t.sticky&&(e+="y"),e},b=Array.isArray,y=Object.getPrototypeOf,x=function(){return"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==n.g?n.g:(console&&console.error&&console.error('Unable to locate global object, returning "this".'),this)}();function _(t,e){var n=!(!e||!e.isStrict),r=e&&e.realm||x,i=n?p:m,o=function(t,e){if(!t||"object"!=typeof t)return t;if(e.has(t))return e.get(t);var s,a=t.__proto__||y(t),l=a&&a.constructor;if(!l||l===r.Object)return i(t,r,o,e);if(b(t)){if(n)return p(t,r,o,e);s=new l,e.set(t,s);for(var c=0,d=t.length;c<d;++c)s[c]=o(t[c],e);return s}if(t instanceof r.Date)return new l(t.getTime());if(t instanceof r.RegExp)return(s=new l(t.source,t.flags||v(t))).lastIndex=t.lastIndex,s;if(r.Map&&t instanceof r.Map)return s=new l,e.set(t,s),t.forEach((function(t,n){s.set(n,o(t,e))})),s;if(r.Set&&t instanceof r.Set)return s=new l,e.set(t,s),t.forEach((function(t){s.add(o(t,e))})),s;if(r.Blob&&t instanceof r.Blob)return t.slice(0,t.size,t.type);if(r.Buffer&&r.Buffer.isBuffer(t))return s=r.Buffer.allocUnsafe?r.Buffer.allocUnsafe(t.length):new l(t.length),e.set(t,s),t.copy(s),s;if(r.ArrayBuffer){if(r.ArrayBuffer.isView(t))return s=new l(t.buffer.slice(0)),e.set(t,s),s;if(t instanceof r.ArrayBuffer)return s=t.slice(0),e.set(t,s),s}return"function"==typeof t.then||t instanceof Error||r.WeakMap&&t instanceof r.WeakMap||r.WeakSet&&t instanceof r.WeakSet?t:i(t,r,o,e)};return o(t,f())}return _.default=_,_.strict=function(t,e){return _(t,{isStrict:!0,realm:e?e.realm:void 0})},_}()},8121:t=>{t.exports=function(){return"undefined"!=typeof window&&"object"==typeof window.process&&"renderer"===window.process.type||(!("undefined"==typeof process||"object"!=typeof process.versions||!process.versions.electron)||"object"==typeof navigator&&"string"==typeof navigator.userAgent&&navigator.userAgent.indexOf("Electron")>=0)}},317:t=>{"use strict";t.exports=i,t.exports.isMobile=i,t.exports.default=i;const e=/(android|bb\d+|meego).+mobile|armv7l|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series[46]0|samsungbrowser|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i,n=/CrOS/,r=/android|ipad|playbook|silk/i;function i(t){t||(t={});let i=t.ua;if(i||"undefined"==typeof navigator||(i=navigator.userAgent),i&&i.headers&&"string"==typeof i.headers["user-agent"]&&(i=i.headers["user-agent"]),"string"!=typeof i)return!1;let o=e.test(i)&&!n.test(i)||!!t.tablet&&r.test(i);return!o&&t.tablet&&t.featureDetect&&navigator&&navigator.maxTouchPoints>1&&-1!==i.indexOf("Macintosh")&&-1!==i.indexOf("Safari")&&(o=!0),o}},2315:(t,e,n)=>{"use strict";n.d(e,{Z:()=>r});const r="#version 300 es\r\n\r\nprecision highp float;\r\nprecision highp int;\r\nprecision highp sampler2D;\r\n\r\nuniform sampler2D image;\r\nuniform float alpha;\r\nuniform int enableColor;\r\nuniform vec3 color;\r\n\r\nin vec2 texcoord;\r\n\r\nout vec4 col;\r\n\r\nvoid main()\r\n{\r\n    vec4 c = texture( image, texcoord );\r\n\r\n    col = vec4((c.a > 0.0 && enableColor > 0 ? color : c.rgb), clamp( c.a * alpha, 0.0, 1.0 ));\r\n\r\n}"},1316:(t,e,n)=>{"use strict";n.d(e,{Z:()=>r});const r="#version 300 es\r\n\r\nprecision highp float;\r\nprecision highp int;\r\n\r\nuniform mat4 matrix;\r\nuniform mat4 textureMatrix;\r\n\r\nlayout(location = 0) in vec4 pos;\r\n\r\nout vec2 texcoord;\r\n\r\nvoid main ()\r\n{\r\n    gl_Position = matrix * pos;\r\n\r\n    texcoord = (textureMatrix * pos).xy;\r\n\r\n}"},5900:(t,e,n)=>{"use strict";n.d(e,{Z:()=>r});const r="#version 300 es\r\n\r\n#define FLT_MIN 1.175494351e-38\r\n#define FLT_MAX 3.402823466e38\r\n#define FADE_LENGTH 5.0\r\n\r\n#define QUATER 0.7853981633974483\r\n#define HALF 1.5707963267948966\r\n#define PI 3.141592653589793\r\n#define CIRCLE 6.283185307179586\r\n\r\n#define hasInOfUV(uv) all(bvec4(greaterThanEqual(uv,vec2(0.0)),lessThan(uv,vec2(1.0))))\r\n\r\n#define SHADOW vec3(0.25)\r\n#define SLIGHT vec3(1.0)\r\n#define NLIGHT vec3(0.375, 0.375, 0.5)\r\n\r\n#define OBJECT_NONE 0\r\n#define OBJECT_HIT_GROUND 1\r\n#define OBJECT_HIT_VOXEL 2\r\n#define OBJECT_HIT_BILLBOARD 3\r\n#define OBJECT_HIT_HUD 4\r\n\r\nprecision highp int;\r\nprecision highp float;\r\nprecision highp sampler2D;\r\n\r\nuniform vec2 viewport;\r\nuniform vec2 resolution;\r\n\r\nuniform vec3 direction;\r\n\r\nuniform sampler2D Material;\r\nuniform sampler2D StackBloom;\r\n\r\nin vec2 uv;\r\nin vec2 dirX;\r\nin vec2 dirY;\r\nin vec2 dirZ;\r\n\r\nlayout (location = 0) out vec4 Bloom;\r\n\r\nfloat modI ( const in float a, const in float b )\r\n{\r\n    float m = a - floor( (a + 0.5) / b ) * b;\r\n    \r\n    return floor( m + 0.5 );\r\n    \r\n}\r\n\r\nmat2 rotate ()\r\n{\r\n\tfloat c = dirZ.x;\r\n\tfloat s = dirZ.y;\r\n\r\n\treturn mat2(c, -s, s, c);\r\n\r\n}\r\n\r\nvec3 calcDirection ()\r\n{\r\n\tfloat xRotRads = direction.x;\r\n\tfloat yRotRads = direction.y;\r\n    vec3 dir;\r\n    float cosY = cos(yRotRads);\r\n\r\n    dir.x = sin(xRotRads) * cosY;\r\n    dir.y = -sin(yRotRads);\r\n    dir.z = cos(xRotRads) * cosY;\r\n\r\n    return dir;\r\n\t\r\n}\r\n\r\nvec2 aspectUV ( const in vec2 uv, const in vec2 viewport )\r\n{\r\n\tvec2 u = uv - 0.5;\r\n\r\n\tu *= viewport / viewport.y;\r\n\tu *= rotate();\r\n\t\r\n\treturn u + 0.5;\r\n\r\n}\r\n\r\nvec2 compactCheckerCoord ( const in vec2 uv, const in vec2 coord, const in vec2 resolution, const in vec2 viewport )\r\n{\r\n\treturn uv + (1.0 / resolution * vec2(modI( coord.y, 2.0 ) == 1.0, 0.0));\r\n\r\n}\r\n\r\nfloat weight( const in float t, const in float log2radius, const in float gamma )\r\n{\r\n    return exp( -gamma * pow( log2radius - t, 2.0 ) );\r\n\r\n}\r\n\r\nvoid main ()\r\n{\r\n\tvec2 u = compactCheckerCoord( uv, gl_FragCoord.xy, viewport * vec2(2.0, 1.0), viewport );\r\n\tfloat par = resolution.x < resolution.y ? (1280.0 / resolution.x) / (1280.0 / resolution.x) : (720.0 / resolution.y) / (720.0 / resolution.y);\r\n\t\r\n\tBloom = vec4(max( textureLod( StackBloom, u, 3.75 * par ).rgb, textureLod( StackBloom, u, 0.0 ).rgb ), 0.0);\r\n\r\n}"},9106:(t,e,n)=>{"use strict";n.d(e,{Z:()=>r});const r="#version 300 es\r\n\r\n#define FLT_MIN 1.175494351e-38\r\n#define FLT_MAX 3.402823466e38\r\n#define SHADOW_FOG_LENGTH 10.0\r\n#define ROUGHNESS_LENGTH 2.5\r\n#define HASHSCALE 443.8975\r\n\r\n#define QUATER 0.7853981633974483\r\n#define HALF 1.5707963267948966\r\n#define PI 3.141592653589793\r\n#define CIRCLE 6.283185307179586\r\n\r\n#define hasInOfUV(uv) all(bvec4(greaterThanEqual(uv,vec2(0.0)),lessThan(uv,vec2(1.0))))\r\n\r\n#define SHADOW vec3(0.5)\r\n#define SLIGHT vec3(1.0)\r\n#define NLIGHT vec3(0.375, 0.375, 0.5)\r\n\r\n#define OBJECT_NONE 0\r\n#define OBJECT_HIT_GROUND 1\r\n#define OBJECT_HIT_VOXEL 2\r\n#define OBJECT_HIT_BILLBOARD 3\r\n#define OBJECT_HIT_HUD 4\r\n\r\nprecision highp int;\r\nprecision highp float;\r\nprecision highp sampler2D;\r\n\r\nuniform vec2 viewport;\r\nuniform vec2 resolution;\r\n\r\nuniform vec3 position;\r\nuniform vec3 direction;\r\nuniform vec3 ray_dir_z;\r\nuniform float fov;\r\nuniform int tile_resolution;\r\n\r\nuniform bool is_soft_shadow;\r\nuniform bool is_roughness;\r\nuniform bool is_bloom;\r\nuniform bool is_pixelized_lighting;\r\nuniform float max_draw_distance;\r\nuniform float global_sun_light;\r\nuniform float global_moon_light;\r\n\r\nuniform sampler2D Material;\r\nuniform sampler2D Location;\r\nuniform sampler2D StackLighting;\r\nuniform sampler2D Reflection;\r\nuniform sampler2D StackClipLighting;\r\nuniform sampler2D ClipReflection;\r\nuniform sampler2D StackReflection;\r\nuniform sampler2D StackClipReflection;\r\nuniform sampler2D BillboardUV;\r\n\r\nin vec2 uv;\r\nin vec2 dirX;\r\nin vec2 dirY;\r\nin vec2 dirZ;\r\nin vec2 dirZI;\r\nin vec2 dirYY;\r\n\r\nlayout (location = 0) out vec4 SoftShadow;\r\nlayout (location = 1) out vec4 Roughness;\r\nlayout (location = 2) out vec4 ClipSoftShadow;\r\nlayout (location = 3) out vec4 ClipRoughness;\r\n\r\nfloat modI ( const in float a, const in float b )\r\n{\r\n    float m = a - floor( (a + 0.5) / b ) * b;\r\n    \r\n    return floor( m + 0.5 );\r\n    \r\n}\r\n\r\nmat4 setCamera ( in vec3 ro, in vec3 rd )\r\n{\r\n\tvec3 cw = rd;\r\n\tvec3 cp = vec3(0.0, 1.0, 0.0);\r\n\tvec3 cu = normalize( cross( cw, cp ) );\r\n\tvec3 cv = normalize( cross( cu, cw ) );\r\n\r\n    return mat4(\r\n\t\tcu.x, cu.y, cu.z, 0.0,\r\n        cv.x, cv.y, cv.z, 0.0,\r\n        cw.x, cw.y, cw.z, 0.0,\r\n        ro.x, ro.y, ro.z, 1.0\r\n\t);\r\n}\r\n\r\nmat4 setCamera ( in vec3 ro, in vec3 rd, float rot )\r\n{\r\n\tvec3 cw = rd;\r\n\tvec3 cp = vec3(sin( rot ), cos( rot ), 0.0);\r\n\tvec3 cu = normalize( cross( cw, cp ) );\r\n\tvec3 cv = normalize( cross( cu, cw ) );\r\n\r\n    return mat4(\r\n\t\tcu.x, cu.y, cu.z, 0.0,\r\n        cv.x, cv.y, cv.z, 0.0,\r\n        cw.x, cw.y, cw.z, 0.0,\r\n        ro.x, ro.y, ro.z, 1.0\r\n\t);\r\n\t\r\n}\r\n\r\nvec2 project ( const in vec3 point, const in mat4 cam, const in float fov )\r\n{\r\n\tvec3 o = (cam * vec4(point, 1.0)).xyz;\r\n\tfloat z2 = o.z * o.z;\r\n\t\r\n\treturn fov * o.z * o.xy / z2;\r\n\r\n}\r\n\r\nmat2 rotate ( const in bool inv )\r\n{\r\n\tfloat c = inv ? dirZI.x : dirZ.x;\r\n\tfloat s = inv ? dirZI.y : dirZ.y;\r\n\r\n\treturn mat2(c, -s, s, c);\r\n\r\n}\r\n\r\nmat2 rotate ( const in float angle )\r\n{\r\n\tfloat c = cos(angle);\r\n\tfloat s = sin(angle);\r\n\r\n\treturn mat2(c, -s, s, c);\r\n\r\n}\r\n\r\nmat3 rotate ( const in vec3 axis, float angle )\r\n{\r\n\tvec3 a = normalize(axis);\r\n    float s = sin( angle );\r\n    float c = cos( angle );\r\n    float oc = 1.0 - c;\r\n    \r\n    return mat3(\r\n\t\toc * a.x * a.x + c, oc * a.x * a.y - a.z * s, oc * a.z * a.x + a.y * s,\r\n        oc * a.x * a.y + a.z * s, oc * a.y * a.y + c, oc * a.y * a.z - a.x * s,\r\n\t\toc * a.z * a.x - a.y * s, oc * a.y * a.z + a.x * s, oc * a.z * a.z + c\r\n\t);\r\n}\r\n\r\nvec3 calcDirectionUV_X ( const in vec3 rdY, const in vec3 rdZ )\r\n{\r\n\treturn normalize( cross( rdZ, rdY ) );\r\n\t\r\n}\r\n\r\nvec3 calcDirectionUV_Y ( const in vec2 uv )\r\n{\r\n\tfloat gggxd = uv.x - 0.5;\r\n\tfloat ggyd = uv.y - 0.5;\r\n\tfloat ggzd = fov;\r\n\t\r\n\tfloat gggzd = ggzd * dirYY.x + ggyd * dirYY.y;\r\n\t\r\n\treturn normalize( vec3(\r\n\t\tgggzd * dirX.x - gggxd * dirX.y,\r\n\t\tggyd * dirYY.x - ggzd * dirYY.y,\r\n\t\tgggxd * dirX.x + gggzd * dirX.y\r\n\t) );\r\n\r\n}\r\n\r\nvec3 calcDirectionUV_Z ( const in vec2 uv )\r\n{\t\r\n\tfloat gggxd = uv.x - 0.5;\r\n\tfloat ggyd = uv.y - 0.5;\r\n\tfloat ggzd = fov;\r\n\t\r\n\tfloat gggzd = ggzd * dirY.x + ggyd * dirY.y;\r\n\t\r\n\treturn normalize( vec3(\r\n\t\tgggzd * dirX.x - gggxd * dirX.y,\r\n\t\tggyd * dirY.x - ggzd * dirY.y,\r\n\t\tgggxd * dirX.x + gggzd * dirX.y\r\n\t) );\r\n\r\n}\r\n\r\nvec2 aspectUV ( const in vec2 uv, const in vec2 viewport )\r\n{\r\n\tvec2 u = uv - 0.5;\r\n\r\n\tu *= viewport / viewport.y;\r\n\tu *= rotate( false );\r\n\t\r\n\treturn u + 0.5;\r\n\r\n}\r\n\r\nvec2 compactCheckerCoord ( const in vec2 uv, const in vec2 coord, const in vec2 resolution, const in vec2 viewport )\r\n{\r\n\treturn uv + (1.0 / resolution * vec2(modI( coord.y, 2.0 ) == 1.0, 0.0));\r\n\r\n}\r\n\r\nconst vec2 offset[3] = vec2[3](\r\n    vec2(-1, 0),\r\n    vec2( 0, 1),\r\n    vec2( 0,-1)\r\n);\r\n\r\nvec4 restoreHalfCheckerboardBuffer ( const in sampler2D tex, const in vec2 coord )\r\n{\r\n\tvec2 texSize = vec2(textureSize( tex, 0 ));\r\n\tfloat m = texSize.x * 2.0 / resolution.x;\r\n\tvec2 cd = floor( coord * m );\r\n\r\n\tivec2 pos = ivec2(floor( max( vec2(0.0), cd.xy - vec2(cd.x, 0.0) / vec2(2.0, 1.0) ) ));\r\n\r\n\tvec4 outCol = texelFetch(\r\n\t\ttex,\r\n\t\tpos,\r\n\t\t0\r\n\t);\r\n\r\n\tfloat div = 1.0;\r\n\r\n\tif (int(modI( cd.x, floor( 2.0 * m ) )) == int(modI( cd.y, floor( 2.0 * m ) )))\r\n\t{\r\n\t\tfor (int i = 0; i < 3; i++)\r\n\t\t{\r\n\t\t\tivec2 pos = ivec2(floor( max( vec2(0.0), cd.xy - (vec2(cd.x, 0.0) + offset[i] * vec2(m, 1.0)) / vec2(2.0, 1.0) ) ));\r\n\r\n\t\t\tif (all( bvec4(greaterThanEqual( vec2(pos), vec2(0.0) ), lessThan( vec2(pos), texSize ) ) ))\r\n\t\t\t{\r\n\t\t\t\toutCol += texelFetch(\r\n\t\t\t\t\ttex,\r\n\t\t\t\t\tpos,\r\n\t\t\t\t\t0\r\n\t\t\t\t);\r\n\r\n\t\t\t\tdiv++;\r\n\r\n\t\t\t}\r\n\t\t\r\n\t\t}\r\n\t\t\r\n\t}\r\n\r\n\treturn outCol / div;\r\n\r\n}\r\n\r\nvec3 calcPixelizePosition ( const in vec3 loc )\r\n{\r\n\tfloat rez = 1.0 / float(tile_resolution);\r\n\tvec3 diff = abs( vec3(loc.x - round( loc.x ), loc.y - round( loc.y ), loc.z - round( loc.z )) );\r\n\t\r\n\tvec3 sub = mod( loc, rez );\r\n\tfloat center = rez * 0.5;\r\n\tvec3 par = 1.0 - vec3(equal( vec3(min( diff.x, min( diff.y, diff.z ) )), diff ));\r\n\r\n\treturn loc - sub + center * par;\r\n\r\n}\r\n\r\nfloat softShadow ( const in vec3 rd, const in vec3 ro, const in vec3 loc, const in int object, const in vec2 uv, const in float par, out float distShadow, out float hideShadow, out vec3 bloomCol, out float hideBloom )\r\n{\r\n\tfloat global_light = max( global_sun_light, global_moon_light );\r\n\tvec4 lig = textureLod( StackLighting, uv, 0.0 );\r\n\tvec4 clig = textureLod( StackClipLighting, uv, 0.0 );\r\n\r\n\tfloat bloomCount = 1.0;\r\n\r\n\tvec3 p = loc - ro;\r\n\tfloat cz = dot( p, rd );\r\n\tfloat fix = 2.0 * fov;\r\n\r\n\tfloat rad = clamp( lig.z / SHADOW_FOG_LENGTH, 0.0, 1.0 );\r\n\tfloat radi = min( 4.25, ((75.0 * rad) / cz) * fix ) * par;\r\n\r\n\tvec4 l = textureLod( StackLighting, uv, radi );\r\n\tvec4 cl = textureLod( StackClipLighting, uv, radi );\r\n\r\n\tif (\r\n\t\tobject == OBJECT_NONE ||\r\n\t\tobject == OBJECT_HIT_GROUND ||\r\n\t\tlig.z < 0.1 ||\r\n\t\tl.w <= 0.0 ||\r\n\t\tl.x >= global_light\r\n\t)\r\n\t{\r\n\t\tdistShadow = lig.z;\r\n\t\thideShadow = lig.w;\r\n\t\tbloomCol = clig.rgb;\r\n\t\thideBloom = clig.w;\r\n\r\n\t\treturn lig.x;\r\n\r\n\t}\r\n\telse\r\n\t{\r\n\t\tdistShadow = l.z;\r\n\t\thideShadow = l.w;\r\n\t\tbloomCol = cl.rgb;\r\n\t\thideBloom = cl.w;\r\n\r\n\t\treturn min( l.x, lig.x );\r\n\r\n\t}\r\n\r\n}\r\n\r\nfloat weight( const in float t, const in float log2radius, const in float gamma )\r\n{\r\n    return exp( -gamma * pow( log2radius - t, 2.0 ) );\r\n\r\n}\r\n\r\nvoid main ()\r\n{\r\n\tvec2 u = compactCheckerCoord( uv, gl_FragCoord.xy, resolution * vec2(2.0, 1.0), viewport );\r\n\tvec2 uu = aspectUV( u, resolution );\r\n\r\n\tvec3 rd = calcDirectionUV_Z( uu );\r\n\tvec3 ro = position;\r\n\tvec2 v = u * resolution;\r\n\r\n\tvec4 material = restoreHalfCheckerboardBuffer( Material, v );\r\n\tvec4 location = restoreHalfCheckerboardBuffer( Location, v );\r\n\tint object = int(ceil( material.w ));\r\n\tvec3 point = location.xyz;\r\n\tvec2 uuu = u;\r\n\r\n\tif (\r\n\t\tis_pixelized_lighting &&\r\n\t\tobject != OBJECT_NONE\r\n\t)\r\n\t{\r\n\t\tvec3 p;\r\n\t\tvec3 r;\r\n\t\t\r\n\t\tvec3 loc = location.xyz;\r\n\r\n\t\tif (\r\n\t\t\tobject == OBJECT_HIT_BILLBOARD ||\r\n\t\t\tobject == OBJECT_HIT_HUD\r\n\t\t)\r\n\t\t{\r\n\t\t\tp = restoreHalfCheckerboardBuffer( BillboardUV, v ).xyz;\r\n\t\t\tr = normalize( point - ro );\r\n\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tp = calcPixelizePosition( loc );\r\n\t\t\tr = normalize( p - ro );\r\n\r\n\t\t}\r\n\r\n\t\tmat4 cam = inverse( setCamera( ro, ray_dir_z ) );\r\n\t\tvec2 uv = project( p, cam, fov ) * rotate( true ) * 2.0 / (resolution / resolution.y) / 2.0 + 0.5;\r\n\t\r\n\t\tpoint = p;\r\n\t\trd = r;\r\n\t\t\r\n\t\tif (hasInOfUV(uv))\r\n\t\t{\r\n\t\t\tuuu = uv;\r\n\t\t\t\r\n\t\t}\r\n\r\n\t}\r\n\t\r\n\tfloat par = resolution.x < resolution.y ? (1280.0 / resolution.x) / (1280.0 / resolution.x) : (720.0 / resolution.y) / (720.0 / resolution.y);\r\n\r\n\tif (is_soft_shadow)\r\n\t{\r\n\t\tfloat hideShadow;\r\n\t\tvec3 clipSoftShadowCol;\r\n\t\tfloat distShadow;\r\n\t\tfloat hideClipSoftShadow;\r\n\r\n\t\tvec4 sha = textureLod( StackLighting, u, 0.0 );\r\n\t\tfloat s = softShadow( rd, ro, location.xyz, object, uuu, par, distShadow, hideShadow, clipSoftShadowCol, hideClipSoftShadow );\r\n\r\n\t\tSoftShadow = vec4(s, sha.y, distShadow, hideShadow);\r\n\t\tClipSoftShadow = vec4(clipSoftShadowCol.rgb, hideClipSoftShadow);\r\n\r\n\t}\r\n\r\n\tif (is_roughness)\r\n\t{\r\n\t\tfloat roughness = material.y;\r\n\t\tfloat len = restoreHalfCheckerboardBuffer( Reflection, uv * resolution ).w;\r\n\t\tfloat rad = clamp( min( len / (ROUGHNESS_LENGTH * (1.0 - roughness)), roughness ), 0.0, 1.0 );\r\n\t\tfloat level = rad * 15.0 * par;\r\n\t\t\r\n\t\tRoughness = textureLod( StackReflection, uv, level );\r\n\t\tClipRoughness = textureLod( StackClipReflection, uv, level );\r\n\r\n\t}\r\n\r\n}"},6815:(t,e,n)=>{"use strict";n.d(e,{Z:()=>r});const r="#version 300 es\r\n\r\n#define FLT_MIN 1.175494351e-38\r\n#define FLT_MAX 3.402823466e38\r\n#define AO_LIGHT 0.125\r\n#define FADE_LENGTH 5.0\r\n\r\n#define QUATER 0.7853981633974483\r\n#define HALF 1.5707963267948966\r\n#define PI 3.141592653589793\r\n#define CIRCLE 6.283185307179586\r\n\r\n#define hasInOfUV(uv) all(bvec4(greaterThanEqual(uv,vec2(0.0)),lessThan(uv,vec2(1.0))))\r\n\r\n#define SHADOW vec3(0.25)\r\n#define SLIGHT vec3(1.0)\r\n#define NLIGHT vec3(0.375, 0.375, 0.5)\r\n\r\n#define OBJECT_NONE 0\r\n#define OBJECT_HIT_GROUND 1\r\n#define OBJECT_HIT_VOXEL 2\r\n#define OBJECT_HIT_BILLBOARD 3\r\n#define OBJECT_HIT_HUD 4\r\n\r\n#define FOG_LENGTH 1500.0\r\n\r\n#define iSteps 3\r\n#define jSteps 1\r\n\r\nprecision highp int;\r\nprecision highp float;\r\nprecision highp sampler2D;\r\n\r\nuniform vec2 viewport;\r\nuniform vec2 resolution;\r\nuniform float global_sun_light;\r\nuniform float global_moon_light;\r\nuniform int reflection_count;\r\nuniform bool is_roughness;\r\nuniform bool is_bloom;\r\n\r\nuniform vec3 position;\r\nuniform vec3 direction;\r\nuniform vec3 sun_direction;\r\nuniform float fov;\r\nuniform float max_draw_distance;\r\n\r\nuniform sampler2D Albedo;\r\nuniform sampler2D Normal;\r\nuniform sampler2D Material;\r\nuniform sampler2D Location;\r\nuniform sampler2D World;\r\nuniform sampler2D Skybox;\r\nuniform sampler2D Reflection;\r\nuniform sampler2D SoftShadow;\r\nuniform sampler2D Roughness;\r\nuniform sampler2D Bloom;\r\n\r\nin vec2 uv;\r\nin vec2 dirX;\r\nin vec2 dirY;\r\nin vec2 dirZ;\r\n\r\nout vec4 dest;\r\n\r\nconst float a = 2.51;\r\nconst float b = 0.03;\r\nconst float c = 2.43;\r\nconst float d = 0.59;\r\nconst float e = 0.14;\r\n\r\nvec3 toneMaping ( const in vec3 x )\r\n{\r\n    return (x * (a * x + b)) / (x * (c * x + d) + e);\r\n\r\n}\r\n\r\nvec3 calcDirectionUV ( const in vec2 uv )\r\n{\t\r\n\tfloat gggxd = uv.x - 0.5;\r\n\tfloat ggyd = uv.y - 0.5;\r\n\tfloat ggzd = fov;\r\n\t\r\n\tfloat gggzd = ggzd * dirY.x + ggyd * dirY.y;\r\n\t\r\n\treturn normalize( vec3(\r\n\t\tgggzd * dirX.x - gggxd * dirX.y,\r\n\t\tggyd * dirY.x - ggzd * dirY.y,\r\n\t\tgggxd * dirX.x + gggzd * dirX.y\r\n\t) );\r\n\r\n}\r\n\r\nvec3 calcDirection ()\r\n{\r\n\tfloat xRotRads = direction.x;\r\n\tfloat yRotRads = direction.y;\r\n    vec3 dir;\r\n    float cosY = cos(yRotRads);\r\n\r\n    dir.x = sin(xRotRads) * cosY;\r\n    dir.y = -sin(yRotRads);\r\n    dir.z = cos(xRotRads) * cosY;\r\n\r\n    return dir;\r\n\r\n}\r\n\r\nfloat modI ( const in float a, const in float b )\r\n{\r\n    float m = a - floor( (a + 0.5) / b ) * b;\r\n    \r\n    return floor( m + 0.5 );\r\n    \r\n}\r\n\r\nmat2 rotate ()\r\n{\r\n\tfloat c = dirZ.x;\r\n\tfloat s = dirZ.y;\r\n\r\n\treturn mat2(c, -s, s, c);\r\n\r\n}\r\n\r\nvec2 aspectUV ( const in vec2 uv, const in vec2 viewport )\r\n{\r\n\tvec2 u = uv - 0.5;\r\n\r\n\tu *= viewport / viewport.y;\r\n\tu *= rotate();\r\n\t\r\n\treturn u + 0.5;\r\n\r\n}\r\n\r\nbool hasGround ( const in vec3 rd, const in vec3 ro, const in float height )\r\n{\r\n\tfloat d = -(ro.y - height) / rd.y;\r\n\r\n\td = min( 100000.0, d );\r\n\r\n\treturn d > 0.0;\r\n\r\n}\r\n\r\nconst vec2 offset[3] = vec2[3](\r\n    vec2(-1, 0),\r\n    vec2( 0, 1),\r\n    vec2( 0,-1)\r\n);\r\n\r\nvec4 restoreHalfCheckerboardBuffer ( const in sampler2D tex, const in vec2 coord )\r\n{\r\n\tvec2 texSize = vec2(textureSize( tex, 0 ));\r\n\tfloat m = texSize.x * 2.0 / resolution.x;\r\n\tvec2 cd = floor( coord * m );\r\n\r\n\tivec2 pos = ivec2(floor( max( vec2(0.0), cd.xy - vec2(cd.x, 0.0) / vec2(2.0, 1.0) ) ));\r\n\r\n\tvec4 outCol = texelFetch(\r\n\t\ttex,\r\n\t\tpos,\r\n\t\t0\r\n\t);\r\n\r\n\tfloat div = 1.0;\r\n\r\n\tif (int(modI( cd.x, floor( 2.0 * m ) )) == int(modI( cd.y, floor( 2.0 * m ) )))\r\n\t{\r\n\t\tfor (int i = 0; i < 3; i++)\r\n\t\t{\r\n\t\t\tivec2 pos = ivec2(floor( max( vec2(0.0), cd.xy - (vec2(cd.x, 0.0) + offset[i] * vec2(m, 1.0)) / vec2(2.0, 1.0) ) ));\r\n\r\n\t\t\tif (all( bvec4(greaterThanEqual( vec2(pos), vec2(0.0) ), lessThan( vec2(pos), texSize ) ) ))\r\n\t\t\t{\r\n\t\t\t\toutCol += texelFetch(\r\n\t\t\t\t\ttex,\r\n\t\t\t\t\tpos,\r\n\t\t\t\t\t0\r\n\t\t\t\t);\r\n\r\n\t\t\t\tdiv++;\r\n\r\n\t\t\t}\r\n\t\t\r\n\t\t}\r\n\t\t\r\n\t}\r\n\r\n\treturn outCol / div;\r\n\r\n}\r\n\r\nvec4 restoreHalfCheckerboardBufferMax ( const in sampler2D tex, const in vec2 coord )\r\n{\r\n\tvec2 texSize = vec2(textureSize( tex, 0 ));\r\n\tfloat m = texSize.x * 2.0 / resolution.x;\r\n\tvec2 cd = floor( coord * m );\r\n\r\n\tivec2 pos = ivec2(floor( max( vec2(0.0), cd.xy - vec2(cd.x, 0.0) / vec2(2.0, 1.0) ) ));\r\n\r\n\tvec4 outCol = texelFetch(\r\n\t\ttex,\r\n\t\tpos,\r\n\t\t0\r\n\t);\r\n\r\n\tfloat div = 1.0;\r\n\r\n\tif (int(modI( cd.x, floor( 2.0 * m ) )) == int(modI( cd.y, floor( 2.0 * m ) )))\r\n\t{\r\n\t\tfor (int i = 0; i < 3; i++)\r\n\t\t{\r\n\t\t\tivec2 pos = ivec2(floor( max( vec2(0.0), cd.xy - (vec2(cd.x, 0.0) + offset[i] * vec2(m, 1.0)) / vec2(2.0, 1.0) ) ));\r\n\r\n\t\t\tif (all( bvec4(greaterThanEqual( vec2(pos), vec2(0.0) ), lessThan( vec2(pos), texSize ) ) ))\r\n\t\t\t{\r\n\t\t\t\toutCol = max( outCol, texelFetch(\r\n\t\t\t\t\ttex,\r\n\t\t\t\t\tpos,\r\n\t\t\t\t\t0\r\n\t\t\t\t) );\r\n\r\n\t\t\t}\r\n\t\t\r\n\t\t}\r\n\t\t\r\n\t}\r\n\r\n\treturn outCol / div;\r\n\r\n}\r\n\r\nvoid main ()\r\n{\r\n\tvec4 albedo = restoreHalfCheckerboardBuffer( Albedo, gl_FragCoord.xy );\r\n\tvec3 point = restoreHalfCheckerboardBuffer( Location, gl_FragCoord.xy ).xyz;\r\n\tvec4 n = restoreHalfCheckerboardBuffer( Normal, gl_FragCoord.xy );\r\n\tvec3 normal = n.rgb * 2.0 - 1.0;\r\n\tvec3 material = restoreHalfCheckerboardBuffer( Material, gl_FragCoord.xy ).rgb;\r\n\tvec4 skybox = restoreHalfCheckerboardBuffer( Skybox, gl_FragCoord.xy );\r\n\tvec4 softshadow = restoreHalfCheckerboardBuffer( SoftShadow, gl_FragCoord.xy );\r\n\tvec4 roughness = restoreHalfCheckerboardBuffer( Roughness, gl_FragCoord.xy );\r\n\tfloat refLen = restoreHalfCheckerboardBufferMax( Reflection, gl_FragCoord.xy ).w;\r\n\tvec3 bloom = restoreHalfCheckerboardBuffer( Bloom, gl_FragCoord.xy ).rgb;\r\n\tint object = int(restoreHalfCheckerboardBuffer( Material, gl_FragCoord.xy ).a);\r\n\tvec3 world = restoreHalfCheckerboardBuffer( World, gl_FragCoord.xy ).xyz * 2.0 - 1.0;\r\n\tvec3 color = albedo.rgb;\r\n\r\n\tvec3 rd = calcDirectionUV( aspectUV( uv, resolution ) );\r\n\tvec3 ro = position;\r\n\tfloat lig = softshadow.x;\r\n\tfloat ao = softshadow.y;\r\n\r\n\tfloat len = length( point - position );\r\n\tfloat grad = clamp( len / FOG_LENGTH, 0.0, 1.0 );\r\n\tfloat sh = object == OBJECT_HIT_VOXEL && (world.z > 0.5 || world.z < -0.5 || world.y < -0.5) ? 0.125 : 0.5;\r\n\r\n\tlig = lig < 1.0 ? mix( max( 0.0, lig - sh - AO_LIGHT ) + sh + AO_LIGHT, lig, ao ) : lig;\r\n\t\r\n\tfloat refDist = max( 0.0, roughness.w - refLen );\r\n\tfloat refMax = max( 0.0, max_draw_distance - refLen );\r\n\tfloat refCover =  min( 1.0, refDist / refMax );\r\n\tfloat cover = min( 1.0, reflection_count <= 0 ? 1.0 : is_roughness ? refLen == max_draw_distance && refCover == 0.0 ? 1.0 : refCover : (max_draw_distance <= roughness.w ? 1.0 : 0.0) );\r\n\r\n\tfloat rl = max( 0.0, lig - 1.0 ) * cover;\r\n\tvec3 b = (is_bloom ? bloom * max( bloom.r, max( bloom.g, bloom.b ) ) : vec3(0.0));\r\n\tvec3 g = mix( NLIGHT, SLIGHT, max( 0.0, min( 1.0, global_sun_light - global_moon_light ) ) );\r\n\tvec3 light = !all( equal( material, vec3(0.0) ) ) ? mix( SHADOW, g + vec3(rl), min( 1.0, lig ) ) : vec3(1.0);\r\n\t\r\n\tvec3 color1 = color * light;\r\n\tvec3 color2 = (reflection_count > 0 ? mix( color * light, roughness.rgb, material.z ) : color * light);\r\n\t\r\n\tcolor = max( color1, color2 );\r\n\tcolor = mix( object == OBJECT_HIT_GROUND ? max( color + b, b ) : color + b, max( skybox.rgb, b ), object == OBJECT_NONE ? 1.0 : object == OBJECT_HIT_GROUND  ? grad : 0.0 );\r\n\tcolor = clamp( color, vec3(0.0), vec3(1.0) );\r\n\tdest = vec4( /*n.rgb*/ /*bloom*/ toneMaping( color ), 1.0);\r\n\t\r\n}"},8013:(t,e,n)=>{"use strict";n.d(e,{Z:()=>r});const r="#version 300 es\r\n\r\n#define EPSILON 0.00001\r\n#define FLT_MIN 1.175494351e-38\r\n#define FLT_MAX 3.402823466e38\r\n#define BACKGROUND_RAB_LENGTH 250.0\r\n#define AO_LIGHT 0.125\r\n#define MAX_LOOP 9999\r\n\r\n#define QUATER 0.7853981633974483\r\n#define HALF 1.5707963267948966\r\n#define PI 3.141592653589793\r\n#define CIRCLE 6.283185307179586\r\n\r\n#define sampler3D sampler2DArray\r\n#define isampler3D isampler2DArray\r\n#define usampler3D usampler2DArray\r\n\r\n#define BILLBOARD_PROP_POSITION_X 0\r\n#define BILLBOARD_PROP_POSITION_Y 1\r\n#define BILLBOARD_PROP_POSITION_Z 2\r\n#define BILLBOARD_PROP_SCALE 3\r\n#define BILLBOARD_PROP_BOUNDING 4\r\n#define BILLBOARD_PROP_AXIS_X 5\r\n#define BILLBOARD_PROP_AXIS_Y 6\r\n#define BILLBOARD_PROP_AXIS_Z 7\r\n#define BILLBOARD_PROP_ROTATE 8\r\n#define BILLBOARD_PROP_FLIP_X 9\r\n#define BILLBOARD_PROP_FLIP_Y 10\r\n#define BILLBOARD_PROP_HUD_FIX 11\r\n#define BILLBOARD_PROP_HUD_ROTATE 12\r\n#define BILLBOARD_PROP_TILE 13\r\n#define BILLBOARD_PROP_LENGTH 14\r\n\r\n#define VOXEL_PROP_POSITION_X 0\r\n#define VOXEL_PROP_POSITION_Y 1\r\n#define VOXEL_PROP_POSITION_Z 2\r\n#define VOXEL_PROP_TEXTURE_FRONT 3\r\n#define VOXEL_PROP_TEXTURE_BACK 4\r\n#define VOXEL_PROP_TEXTURE_RIGHT 5\r\n#define VOXEL_PROP_TEXTURE_LEFT 6\r\n#define VOXEL_PROP_TEXTURE_TOP 7\r\n#define VOXEL_PROP_TEXTURE_BOTTOM 8\r\n#define VOXEL_PROP_TEXTURE_FLIP_X_FRONT 9\r\n#define VOXEL_PROP_TEXTURE_FLIP_Y_FRONT 10\r\n#define VOXEL_PROP_TEXTURE_FLIP_X_BACK 11\r\n#define VOXEL_PROP_TEXTURE_FLIP_Y_BACK 12\r\n#define VOXEL_PROP_TEXTURE_FLIP_X_RIGHT 13\r\n#define VOXEL_PROP_TEXTURE_FLIP_Y_RIGHT 14\r\n#define VOXEL_PROP_TEXTURE_FLIP_X_LEFT 15\r\n#define VOXEL_PROP_TEXTURE_FLIP_Y_LEFT 16\r\n#define VOXEL_PROP_TEXTURE_FLIP_X_TOP 17\r\n#define VOXEL_PROP_TEXTURE_FLIP_Y_TOP 18\r\n#define VOXEL_PROP_TEXTURE_FLIP_X_BOTTOM 19\r\n#define VOXEL_PROP_TEXTURE_FLIP_Y_BOTTOM 20\r\n#define VOXEL_PROP_LENGTH 21\r\n\r\n#define SURFACE_NONE -1\r\n#define SURFACE_FRONT 0\r\n#define SURFACE_BACK 1\r\n#define SURFACE_RIGHT 2\r\n#define SURFACE_LEFT 3\r\n#define SURFACE_TOP 4\r\n#define SURFACE_BOTTOM 5\r\n\r\n#define DIMENSION_X 0\r\n#define DIMENSION_Y 1\r\n#define DIMENSION_Z 2\r\n\r\n#define OBJECT_NONE 0\r\n#define OBJECT_HIT_GROUND 1\r\n#define OBJECT_HIT_VOXEL 2\r\n#define OBJECT_HIT_BILLBOARD 3\r\n#define OBJECT_HIT_HUD 4\r\n\r\n#define WALL_NONE 0\r\n#define WALL_BLOCK 1\r\n#define WALL_WALLX 2\r\n#define WALL_WALLZ 3\r\n\r\n#define FOG_LENGTH 1500.0\r\n\r\n#define BACKGROUND_NOISE 0\r\n#define BACKGROUND_LIQUID 1\r\n\r\n#define iSteps 3\r\n#define jSteps 1\r\n\r\n#define VOXEL_EMPTY 1\r\n\r\n#define SHADOW vec3(0.25)\r\n#define SLIGHT vec3(1.0)\r\n#define NLIGHT vec3(0.375, 0.375, 0.5)\r\n#define SKY_COLOR vec3(0.000003, 0.0000075, 0.0000175)\r\n\r\n#define CHECKER_COORD vec2(modI(gl_FragCoord.y,2.0)==1.0?1.0:0.0,0.0)\r\n\r\nprecision highp int;\r\nprecision highp float;\r\nprecision highp sampler2D;\r\nprecision highp isampler2D;\r\nprecision highp usampler2D;\r\nprecision highp sampler3D;\r\nprecision highp isampler3D;\r\nprecision highp usampler3D;\r\n\r\nuniform vec2 viewport;\r\nuniform vec2 resolution;\r\nuniform ivec3 map_size;\r\nuniform int max_2d_texture_size;\r\nuniform int max_3d_texture_size;\r\nuniform float max_draw_distance;\r\nuniform int tile_resolution;\r\nuniform int reflection_count;\r\n\r\nuniform isampler3D map_data;\r\nuniform isampler3D distance_field;\r\nuniform sampler2D texture_albedo_data;\r\nuniform sampler2D texture_pbr_data;\r\nuniform sampler2D texture_normal_data;\r\nuniform isampler3D material_data;\r\nuniform sampler3D voxel_data;\r\n\r\nuniform float time;\r\nuniform vec3 position;\r\nuniform vec3 direction;\r\nuniform vec3 ray_dir_z;\r\nuniform vec3 sun_direction;\r\nuniform float fov;\r\nuniform float global_sun_light;\r\nuniform float global_moon_light;\r\nuniform float sun_light_force;\r\nuniform float moon_light_force;\r\nuniform float player_light_radius;\r\nuniform float player_light_force;\r\n\r\nuniform bool is_shadow;\r\nuniform bool is_reflection;\r\nuniform bool is_roughness;\r\nuniform bool is_pixelized_lighting;\r\nuniform int background_theme;\r\nuniform vec3 background_rise_up_color;\r\nuniform vec3 backgorund_night_up_color;\r\nuniform vec3 background_rise_down_color;\r\nuniform vec3 backgorund_night_down_color;\r\nuniform vec3 backgorund_material_up;\r\nuniform vec3 background_material_down;\r\nuniform float background_noise_size;\r\nuniform float background_noise_length;\r\n\r\nuniform sampler2D Albedo;\r\nuniform sampler2D Normal;\r\nuniform sampler2D Material;\r\nuniform sampler2D Location;\r\nuniform sampler2D Mask;\r\nuniform sampler2D BillboardUV;\r\n\r\nin vec2 uv;\r\nin vec2 dirX;\r\nin vec2 dirY;\r\nin vec2 dirZ;\r\nin vec2 dirZI;\r\n\r\nlayout (location = 0) out vec4 Lighting;\r\nlayout (location = 1) out vec4 Skybox;\r\nlayout (location = 2) out vec4 ClipAlbedo;\r\nlayout (location = 3) out vec4 ClipLighting;\r\nlayout (location = 4) out vec4 ClipSkybox;\r\nlayout (location = 5) out vec4 Reflection;\r\nlayout (location = 6) out vec4 ClipReflection;\r\n\r\nivec2 TEXTURE_RESOLUTION;\r\nint TILE_RESOLUTION;\r\nfloat NOISE;\r\n\r\n#define collideBounding(rd,ro,pos,scale) (length(cross(rd,pos-ro))<scale)\r\n#define fixTexturePosition(index) ivec3(modI(float(index),float(max_3d_texture_size)),modI(floor(float(index)/float(max_3d_texture_size)),float(max_3d_texture_size)),floor(floor(float(index)/float(max_3d_texture_size))/float(max_3d_texture_size)))\r\n#define hasInOfUV(uv) all(bvec4(greaterThanEqual(uv,vec2(0.0)),lessThan(uv,vec2(1.0))))\r\n#define getFade(dist,len,depth) clamp((depth-(dist-len))/len,0.0,1.0)\r\n#define hasChecker() all(equal(mod(ceil(uv*resolution+CHECKER_COORD),vec2(2.0)),vec2(0.0)))\r\n#define vertexAO(side,corner) ((side.x+side.y+max(corner,side.x*side.y))/3.0)\r\n\r\n#define getDimension(max) max.x<max.y?(max.x<max.z?DIMENSION_X:DIMENSION_Z):(max.y<max.z?DIMENSION_Y:DIMENSION_Z)\r\n\r\n#define getMapData(point) int(texelFetch(map_data,ivec3(point),0).r)\r\n#define getDistanceField(point) int(texelFetch(distance_field,ivec3(point),0).r)\r\n#define getMaterialData(point) texelFetch(material_data,point,0)\r\n#define getVoxelData(point) texelFetch(voxel_data,point,0).r\r\n#define getImageData(point) texelFetch(texture_albedo_data,point,0)\r\n#define getPBRData(point) texelFetch(texture_pbr_data,point,0).rgb\r\n#define getNormalData(point) texelFetch(texture_normal_data,point,0).rgb*2.0-1.0\r\n\r\n#define getMaterialID(tile) int(getMaterialData(fixTexturePosition(tile)).x)\r\n#define getVoxel(index,id) getVoxelData(fixTexturePosition(VOXEL_PROP_LENGTH*index+id))\r\n#define getClusterLength(cluster) getClusterData(fixTexturePosition(cluster))\r\n#define getBillboard(index,id) getBillboardData(fixTexturePosition(BILLBOARD_PROP_LENGTH*index+id))\r\n\r\n#define getVoxelPosition(index) vec3(getVoxel(index,VOXEL_PROP_POSITION_X),getVoxel(index,VOXEL_PROP_POSITION_Y),getVoxel(index,VOXEL_PROP_POSITION_Z))\r\n\r\n#define getVoxelFront(index) int(getVoxel(index,VOXEL_PROP_TEXTURE_FRONT))\r\n#define getVoxelBack(index) int(getVoxel(index,VOXEL_PROP_TEXTURE_BACK))\r\n#define getVoxelRight(index) int(getVoxel(index,VOXEL_PROP_TEXTURE_RIGHT))\r\n#define getVoxelLeft(index) int(getVoxel(index,VOXEL_PROP_TEXTURE_LEFT))\r\n#define getVoxelTop(index) int(getVoxel(index,VOXEL_PROP_TEXTURE_TOP))\r\n#define getVoxelBottom(index) int(getVoxel(index,VOXEL_PROP_TEXTURE_BOTTOM))\r\n\r\n#define getVoxelFlipFront(index) sign(vec2(getVoxel(index,VOXEL_PROP_TEXTURE_FLIP_X_FRONT),getVoxel(index,VOXEL_PROP_TEXTURE_FLIP_Y_FRONT)))\r\n#define getVoxelFlipBack(index) sign(vec2(-getVoxel(index,VOXEL_PROP_TEXTURE_FLIP_X_BACK),getVoxel(index,VOXEL_PROP_TEXTURE_FLIP_Y_BACK)))\r\n#define getVoxelFlipRight(index) sign(vec2(getVoxel(index,VOXEL_PROP_TEXTURE_FLIP_X_RIGHT),getVoxel(index,VOXEL_PROP_TEXTURE_FLIP_Y_RIGHT)))\r\n#define getVoxelFlipLeft(index) sign(vec2(-getVoxel(index,VOXEL_PROP_TEXTURE_FLIP_X_LEFT),getVoxel(index,VOXEL_PROP_TEXTURE_FLIP_Y_LEFT)))\r\n#define getVoxelFlipTop(index) sign(vec2(-getVoxel(index,VOXEL_PROP_TEXTURE_FLIP_X_TOP),-getVoxel(index,VOXEL_PROP_TEXTURE_FLIP_Y_TOP)))\r\n#define getVoxelFlipBottom(index) sign(vec2(getVoxel(index,VOXEL_PROP_TEXTURE_FLIP_X_BOTTOM),-getVoxel(index,VOXEL_PROP_TEXTURE_FLIP_Y_BOTTOM)))\r\n\r\nfloat rand ( const in float co )\r\n{\r\n\treturn fract( cos( co * 43758.5453 ) );\r\n\r\n}\r\n\r\nfloat rand ( const in vec2 co )\r\n{\r\n    return fract( sin( dot( co.yx, vec2(12.9898, 78.233) ) ) * 43758.5453 );\r\n\r\n}\r\n\r\nfloat rand ( const in vec3 co )\r\n{\r\n    return fract( sin( dot( co.zxy, vec3(12.9898, 78.233, 25.3245) ) ) * 43758.5453 );\r\n\r\n}\r\n\r\nvec2 g ( const in vec2 n ) { return sin(n.x*n.y*vec2(12,17)+vec2(1,2)); }\r\n\r\nfloat noise ( const in vec2 p, const in float kF )\r\n{\r\n    vec2 i = floor(p);\r\n\tvec2 f = fract(p);\r\n    f = f*f*(3.0-2.0*f);\r\n\r\n    return (mix(mix(sin(kF*dot(p,g(i+vec2(0,0)))),\r\n               \t   sin(kF*dot(p,g(i+vec2(1,0)))),f.x),\r\n               mix(sin(kF*dot(p,g(i+vec2(0,1)))),\r\n               \t   sin(kF*dot(p,g(i+vec2(1,1)))),f.x),f.y) + 1.0) / 2.0;\r\n}\r\n\r\nfloat modI ( const in float a, const in float b )\r\n{\r\n    float m = a - floor( (a + 0.5) / b ) * b;\r\n    \r\n    return floor( m + 0.5 );\r\n    \r\n}\r\n\r\nvec2 modI ( const in vec2 a, const in vec2 b )\r\n{\r\n    vec2 m = a - floor( (a + 0.5) / b ) * b;\r\n    \r\n    return floor( m + 0.5 );\r\n    \r\n}\r\n\r\nmat2 rotate ( const in bool inv )\r\n{\r\n\tfloat c = inv ? dirZI.x : dirZ.x;\r\n\tfloat s = inv ? dirZI.y : dirZ.y;\r\n\r\n\treturn mat2(c, -s, s, c);\r\n\r\n}\r\n\r\nmat2 rotate ( const in float angle )\r\n{\r\n\tfloat c = cos(angle);\r\n\tfloat s = sin(angle);\r\n\r\n\treturn mat2(c, -s, s, c);\r\n\r\n}\r\n\r\nmat3 rotate ( const in vec3 axis, float angle )\r\n{\r\n\tvec3 a = normalize(axis);\r\n    float s = sin( angle );\r\n    float c = cos( angle );\r\n    float oc = 1.0 - c;\r\n    \r\n    return mat3(\r\n\t\toc * a.x * a.x + c,        oc * a.x * a.y - a.z * s,  oc * a.z * a.x + a.y * s,\r\n        oc * a.x * a.y + a.z * s,  oc * a.y * a.y + c,        oc * a.y * a.z - a.x * s,\r\n        oc * a.z * a.x - a.y * s,  oc * a.y * a.z + a.x * s,  oc * a.z * a.z + c\r\n\t);\r\n\r\n}\r\n\r\nmat4 setCamera ( in vec3 ro, in vec3 rd )\r\n{\r\n\tvec3 cw = rd;\r\n\tvec3 cp = vec3(0.0, 1.0, 0.0);\r\n\tvec3 cu = normalize( cross( cw, cp ) );\r\n\tvec3 cv = normalize( cross( cu, cw ) );\r\n\r\n    return mat4(\r\n\t\tcu.x, cu.y, cu.z, 0.0,\r\n        cv.x, cv.y, cv.z, 0.0,\r\n        cw.x, cw.y, cw.z, 0.0,\r\n        ro.x, ro.y, ro.z, 1.0\r\n\t);\r\n}\r\n\r\nmat4 setCamera ( in vec3 ro, in vec3 rd, float rot )\r\n{\r\n\tvec3 cw = rd;\r\n\tvec3 cp = vec3(sin( rot ), cos( rot ), 0.0);\r\n\tvec3 cu = normalize( cross( cw, cp ) );\r\n\tvec3 cv = normalize( cross( cu, cw ) );\r\n\r\n    return mat4(\r\n\t\tcu.x, cu.y, cu.z, 0.0,\r\n        cv.x, cv.y, cv.z, 0.0,\r\n        cw.x, cw.y, cw.z, 0.0,\r\n        ro.x, ro.y, ro.z, 1.0\r\n\t);\r\n\r\n}\r\n\r\nvec2 project ( const in vec3 point, const in mat4 cam, const in float fov )\r\n{\r\n\tvec3 o = (cam * vec4(point, 1.0)).xyz;\r\n\tfloat z2 = o.z * o.z;\r\n\t\r\n\treturn fov * o.z * o.xy / z2;\r\n\r\n}\r\n\r\nvec2 rotateUV ( const in vec2 uv, const in vec2 viewport )\r\n{\r\n\tvec2 u = (uv - 0.5) * viewport / min( viewport.x, viewport.y );\r\n\r\n\tu *= rotate( false );\r\n\tu += 0.5;\r\n\r\n\treturn u;\r\n\r\n}\r\n\r\nmat2 scale ( const in vec2 size )\r\n{\r\n    return mat2(size.x, 0.0, 0.0, size.y);\r\n\r\n}\r\n\r\nvec3 calcNormal ( const in vec3 point )\r\n{\r\n    vec3 dx = normalize( dFdx( point ) );\r\n    vec3 dy = normalize( dFdy( point ) );\r\n\t\r\n\treturn normalize( cross( dx, dy ) );\r\n\r\n}\r\n\r\nfloat normalizeDirection1d ( const in float direction )\r\n{\r\n\tfloat dir = mod( direction, CIRCLE );\r\n\t// 0.0 > dir ? dir + CIRCLE : dir\r\n\tdir = mix( dir, dir + CIRCLE, step( dir, 0.0 ) );\r\n\r\n\treturn dir;\r\n\r\n}\r\n\r\nfloat directionDiff2d ( const in float direction1, const in float direction2 )\r\n{\r\n\tfloat dir1 = normalizeDirection1d( direction1 );\r\n\tfloat dir2 = normalizeDirection1d( direction2 );\r\n\r\n\tfloat diff = dir1 - dir2;\r\n\t\t\t\r\n\tdiff -= floor( diff / CIRCLE ) * CIRCLE;\r\n\t// diff > PI ? CIRCLE : 0.0\r\n\tdiff -= mix( 0.0, CIRCLE, step( PI, diff ) );\r\n\r\n\treturn diff;\r\n\r\n}\r\n\r\nint combineBit2D32 ( const in int num )\r\n{\r\n\tint n = num;\r\n\r\n    n = n & 0x55555555;\r\n    n = (n | (n >> 1)) & 0x33333333;\r\n    n = (n | (n >> 2)) & 0x0f0f0f0f;\r\n    n = (n | (n >> 4)) & 0x00ff00ff;\r\n    n = (n | (n >> 8)) & 0x0000ffff;\r\n\r\n    return n;\r\n}\r\n\r\nivec2 decodeMorton2d ( const in int morton )\r\n{\r\n    return ivec2(\r\n\t\tcombineBit2D32( morton >> 0 ),\r\n\t\tcombineBit2D32( morton >> 1 )\r\n\t);\r\n\t\r\n}\r\n\r\nmat3 lookAt ( const in vec3 origin, const in vec3 target, const in float roll )\r\n{\r\n\tvec3 rr = vec3(sin(roll), cos(roll), 0.0);\r\n\tvec3 ww = normalize(target - origin);\r\n\tvec3 uu = normalize(cross(ww, rr));\r\n\tvec3 vv = normalize(cross(uu, ww));\r\n\r\n\treturn mat3(uu, vv, ww);\r\n\r\n}\r\n\r\nmat4 lookAt ( const in vec3 eye, const in vec3 center, const in vec3 up )\r\n{\r\n\tvec3 w = normalize(eye - center);\r\n\tvec3 u = normalize(cross(up, w));\r\n\tvec3 v = normalize(cross(w, u));\r\n\r\n\treturn mat4(\r\n\t\tu.x, v.x, w.x, 0,\r\n\t\tu.y, v.y, w.y, 0,\r\n\t\tu.z, v.z, w.z, 0,\r\n\t\t-dot(u, eye), -dot(u, eye), -dot(w, eye), 1\r\n\t);\r\n}\r\n\r\nmat4 perspective ( const in float fov, const in float aspect, const in float near, const in float far )\r\n{\r\n    float v = 1./tan(radians(fov/2.)), u = v/aspect, w = near-far;\r\n\r\n    return mat4(u,0,0,0,0,v,0,0,0,0,(near+far)/w,-1,0,0,near*far*2./w,1);\r\n\t\r\n}\r\n\r\nvec3 ground ( const in vec3 p, const in vec3 d, const in float depth ) \r\n{\r\n    vec3 n = vec3(0.0, depth, 0.0);\r\n    float f = dot(-n * 0.8 - p, n) / dot(n, d);\r\n\r\n    return p + d * f;\r\n\r\n}\r\n\r\nvec3 blendNormal ( const in vec3 n2, const in vec3 n1 )\r\n{\r\n\tvec3 world_n = normalize( n2 );\r\n\tvec3 t = cross( world_n, vec3(0.0, 1.0, 0.0) ); \r\n\t\r\n\tif (length( t ) == 0.0)\r\n\t{\r\n\t\tt = cross( world_n, vec3(0.0, 0.0, 1.0) );\r\n\r\n\t}\r\n\r\n\tif (length( t ) == 0.0)\r\n\t{\r\n\t\tt = cross( world_n, vec3(1.0, 0.0, 0.0) );\r\n\r\n\t}\r\n\r\n\tt = normalize( t );\r\n\r\n\tvec3 b = normalize( cross( world_n, t ) );\r\n\tmat3 tbn = mat3(t, b, world_n);\r\n\tvec3 map_n = normalize( n1 );\r\n\t\r\n\treturn normalize( tbn * map_n );\r\n\r\n}\r\n\r\nconst vec2 offset[3] = vec2[3](\r\n    vec2(-1, 0),\r\n    vec2( 0, 1),\r\n    vec2( 0,-1)\r\n);\r\n\r\nvec4 restoreHalfCheckerboardBuffer ( const in sampler2D tex, const in vec2 coord )\r\n{\r\n\tvec2 texSize = vec2(textureSize( tex, 0 ));\r\n\tfloat m = texSize.x * 2.0 / resolution.x;\r\n\tvec2 cd = floor( coord * m );\r\n\r\n\tivec2 pos = ivec2(floor( max( vec2(0.0), cd.xy - vec2(cd.x, 0.0) / vec2(2.0, 1.0) ) ));\r\n\r\n\tvec4 outCol = texelFetch(\r\n\t\ttex,\r\n\t\tpos,\r\n\t\t0\r\n\t);\r\n\r\n\tfloat div = 1.0;\r\n\r\n\tif (int(modI( cd.x, floor( 2.0 * m ) )) == int(modI( cd.y, floor( 2.0 * m ) )))\r\n\t{\r\n\t\tfor (int i = 0; i < 3; i++)\r\n\t\t{\r\n\t\t\tivec2 pos = ivec2(floor( max( vec2(0.0), cd.xy - (vec2(cd.x, 0.0) + offset[i] * vec2(m, 1.0)) / vec2(2.0, 1.0) ) ));\r\n\r\n\t\t\tif (all( bvec4(greaterThanEqual( vec2(pos), vec2(0.0) ), lessThan( vec2(pos), texSize ) ) ))\r\n\t\t\t{\r\n\t\t\t\toutCol += texelFetch(\r\n\t\t\t\t\ttex,\r\n\t\t\t\t\tpos,\r\n\t\t\t\t\t0\r\n\t\t\t\t);\r\n\r\n\t\t\t\tdiv++;\r\n\r\n\t\t\t}\r\n\t\t\r\n\t\t}\r\n\t\t\r\n\t}\r\n\r\n\treturn outCol / div;\r\n\r\n}\r\n\r\nvoid getTexture ( const in vec2 uv, const in int id, out vec4 col, out vec3 pbr, out vec3 nor )\r\n{\r\n\tfloat tile = float(tile_resolution);\r\n\tivec2 p = decodeMorton2d( id );\r\n\tivec2 pos = ivec2(uv * tile + vec2(p) * tile);\r\n\r\n\tcol = getImageData( pos );\r\n\tpbr = getPBRData( pos );\r\n\tnor = getNormalData( pos );\r\n}\r\n\r\nfloat noiseFade ( const in vec2 p )\r\n{\r\n    return fract( cos( mod( 123456789.0, 256.0 * dot( p, vec2(23.140692632779,2.6651441426902) ) ) ) );\r\n    \r\n}\r\n\r\nfloat diffuse ( const in vec3 light, const in vec3 normal )\r\n{\r\n\treturn clamp( dot( normal, light ), 0.0, 1.0 );\r\n\r\n}\r\n\r\nfloat phong ( const in vec3 posg, const in vec3 light, const in vec3 normal, const in vec3 parametes )\r\n{\r\n\tvec3 n = normal;\r\n\tvec3 invLight = light;\r\n\tvec3 invEye = posg;\r\n\tvec3 halfLE = normalize( invLight - invEye );\r\n\r\n\tfloat rough = parametes.y;\r\n\tfloat alpha2 = pow( rough, 4.0 );\r\n\tfloat D = alpha2 / (PI * pow( dot( n, halfLE ) * dot( n, halfLE ) * (alpha2 - 1.0) + 1.0, 2.0 ));\r\n\tfloat fre = parametes.x + (1.0 - parametes.x) * pow( clamp( dot( invEye, halfLE ), 0.0, 1.0 ), 5.0 );\r\n\tfloat nv = clamp( dot( invEye, n ), 0.0, 1.0 );\r\n\tfloat nl = clamp( dot( invLight, n ), 0.0, 1.0 );\r\n\tfloat G = 1.0 / (nv + sqrt( alpha2 + (1.0 - alpha2) * nv * nv) ) / (nl + sqrt( alpha2 + (1.0 - alpha2) * nl * nl ));\r\n\tfloat specular = D * fre * G;\r\n\tfloat diffuse = (1.0 - fre) * clamp( dot( n, invLight ), 0.0, 1.0 ) / PI;\r\n\tfloat meta = parametes.z;\r\n\r\n\treturn clamp( mix( diffuse, specular, meta ), 0.0, 1.0 );\r\n\r\n}\r\n\r\n/*\r\nint getDimension ( const in vec3 max )\r\n{\r\n\tif (max.x < max.y)\r\n\t{\r\n\t\tif (max.x < max.z)\r\n\t\t{\r\n\t\t\treturn DIMENSION_X;\r\n\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\treturn DIMENSION_Z;\r\n\r\n\t\t}\r\n\t}\r\n\telse\r\n\t{\r\n\t\tif (max.y < max.z)\r\n\t\t{\r\n\t\t\treturn DIMENSION_Y;\r\n\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\treturn DIMENSION_Z;\r\n\t\t\t\r\n\t\t}\r\n\r\n\t}\r\n\r\n\treturn int(mix( mix( float(DIMENSION_Z), float(DIMENSION_Y), step( max.y, max.z ) ), mix( float(DIMENSION_Z), float(DIMENSION_X), step( max.x, max.z ) ), step( max.x, max.y ) ));\r\n\treturn max.x < max.y ? (max.x < max.z ? DIMENSION_X : DIMENSION_Z) : (max.y < max.z ? DIMENSION_Y : DIMENSION_Z);\r\n\t\r\n}\r\n*/\r\n\r\nint getSurface ( const in int dimension, const in vec3 ray )\r\n{\r\n\tswitch (dimension)\r\n\t{\r\n\t\tcase DIMENSION_X:\r\n\t\t\treturn 0.0 < ray.x ? SURFACE_FRONT : SURFACE_BACK;\r\n\t\t\t//return int(mix( float(SURFACE_FRONT), float(SURFACE_BACK), step( ray.x, 0.0 ) ));\r\n\r\n\t\tcase DIMENSION_Y:\r\n\t\t\treturn 0.0 < ray.y ? SURFACE_TOP : SURFACE_BOTTOM;\r\n\t\t\t//return int(mix( float(SURFACE_TOP), float(SURFACE_BOTTOM), step( ray.y, 0.0 ) ));\r\n\r\n\t\tcase DIMENSION_Z:\r\n\t\t\treturn 0.0 < ray.z ? SURFACE_LEFT : SURFACE_RIGHT;\r\n\t\t\t//return int(mix( float(SURFACE_LEFT), float(SURFACE_RIGHT), step( ray.z, 0.0 ) ));\r\n\t}\r\n\r\n\treturn SURFACE_NONE;\r\n\r\n\t/*\r\n\tfloat surface = 0.0;\r\n\r\n\tsurface = mix( surface, mix( float(SURFACE_BACK), float(SURFACE_FRONT), step( 0.0, ray.x ) ), step( float(DIMENSION_X), float(dimension) ) );\r\n\tsurface = mix( surface, mix( float(SURFACE_TOP), float(SURFACE_BOTTOM), step( 0.0, ray.y ) ), step( float(DIMENSION_Y), float(dimension) ) );\r\n\tsurface = mix( surface, mix( float(SURFACE_LEFT), float(SURFACE_RIGHT), step( 0.0, ray.z ) ), step( float(DIMENSION_Z), float(dimension) ) );\r\n\r\n\treturn int(surface);\r\n\t*/\r\n\r\n}\r\n\r\nvoid getVoxelTile ( const in int surface, const in int id, out int tile, out vec2 flip )\r\n{\r\n\tswitch (surface)\r\n\t{\r\n\t\tcase SURFACE_FRONT:\r\n\t\t\ttile = getVoxelFront(id);\r\n\t\t\tflip = getVoxelFlipFront(id);\r\n\t\t\tbreak;\r\n\r\n\t\tcase SURFACE_BACK:\r\n\t\t\ttile = getVoxelBack(id);\r\n\t\t\tflip = getVoxelFlipBack(id);\r\n\t\t\tbreak;\r\n\r\n\t\tcase SURFACE_RIGHT:\r\n\t\t\ttile = getVoxelRight(id);\r\n\t\t\tflip = getVoxelFlipRight(id);\r\n\t\t\tbreak;\r\n\r\n\t\tcase SURFACE_LEFT:\r\n\t\t\ttile = getVoxelLeft(id);\r\n\t\t\tflip = getVoxelFlipLeft(id);\r\n\t\t\tbreak;\r\n\r\n\t\tcase SURFACE_TOP:\r\n\t\t\ttile = getVoxelTop(id);\r\n\t\t\tflip = getVoxelFlipTop(id);\r\n\t\t\tbreak;\r\n\r\n\t\tcase SURFACE_BOTTOM:\r\n\t\t\ttile = getVoxelBottom(id);\r\n\t\t\tflip = getVoxelFlipBottom(id);\r\n\t\t\tbreak;\r\n\r\n\t}\r\n\t\r\n\t/*\r\n\tfloat tile = float(SURFACE_NONE);\r\n\tfloat s = float(surface);\r\n\r\n\ttile = mix( tile, getVoxelFront(id), step( float(SURFACE_FRONT), s ) );\r\n\ttile = mix( tile, getVoxelBack(id), step( float(SURFACE_BACK), s ) );\r\n\ttile = mix( tile, getVoxelLeft(id), step( float(SURFACE_RIGHT), s ) );\r\n\ttile = mix( tile, getVoxelLeft(id), step( float(SURFACE_LEFT), s ) );\r\n\ttile = mix( tile, getVoxelTop(id), step( float(SURFACE_TOP), s ) );\r\n\ttile = mix( tile, getVoxelBottom(id), step( float(SURFACE_BOTTOM), s ) );\r\n\ttile = mix( tile, getVoxelFront(id), step( float(SURFACE_WALL_FRONT), s ) );\r\n\ttile = mix( tile, getVoxelBack(id), step( float(SURFACE_WALL_BACK), s ) );\r\n\t\r\n\treturn int(tile);\r\n\t*/\r\n\r\n}\r\n\r\nint raycast ( const in vec3 rd, const in vec3 ro, const in float limit, out vec3 ray, out vec3 mask, out vec3 odist, out vec3 point, out vec3 normal, out ivec3 map, out float len )\r\n{\r\n\tray = 1.0 / rd;\r\n\r\n\tvec3 delta = abs( ray );\r\n\tvec3 dray = abs( vec3(length( rd )) / rd );\r\n\tivec3 sray = ivec3(sign( rd ));\r\n\tvec3 add = floor( vec3(sray) );\r\n\r\n\tmap = ivec3(floor( ro + 0.0 ));\r\n\r\n\tvec3 dist = (sign( rd ) * (vec3(map) - ro) + (sign( rd ) * 0.5) + 0.5) * dray;\r\n\tint st = getDistanceField( map );\r\n\r\n\tfor (int i = 0; i < int(max_draw_distance); i++)\r\n\t{\r\n\t\tvec3 m = floor( max( 0.0, float(st - 1) ) / delta );\r\n\t\t\r\n\t\tdist += m * dray;\r\n\t\tmap += ivec3(m) * sray;\r\n        \r\n\t\t// mask = step( dist.xyz, dist.yzx ) * step( dist.xyz, dist.zxy );\r\n\t\t// mask = step( dist.xyz, dist.yxy ) * step( dist.xyz, dist.zzx );\r\n\t\t// mask = step( dist, dist.yzx ) * (1.0 - step( dist.zxy, dist ));\r\n\t\t// mask = vec3(lessThanEqual( dist.xyz, min( dist.yzx, dist.zxy ) ));\r\n\t\t// mask = step( dist.xyz, dist.yzx );\r\n\t\t// mask *= (1.0 - mask.zxy);\r\n\t\tmask = vec3(lessThanEqual( dist.xyz, min( dist.yzx, dist.zxy ) ));\r\n\t\t\t\r\n\t\todist = dist;\r\n\t\tdist += mask * dray;\r\n\t\tmap += ivec3(mask) * sray;\r\n\t\tst = getDistanceField( map );\r\n\r\n\t\tfloat dis = min( min( odist.x, odist.y ), odist.z );\r\n\t\t\r\n\t\tif (st < 1)\r\n\t\t{\r\n\t\t\tpoint = ro + dis / delta * add;\r\n\t\t\tlen = length( point - ro );\r\n\r\n\t\t\tnormal = normalize( -mask * vec3(sray) );\r\n\r\n\t\t\treturn getMapData( map );\r\n\r\n\t\t}\r\n\t\telse if (limit < dis)\r\n\t\t{\r\n\t\t\tbreak;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\treturn VOXEL_EMPTY;\r\n\r\n}\r\n\r\nvoid getColorEmpty ( inout vec3 point, inout ivec3 map, inout vec4 color, inout int object, inout vec3 material, inout vec3 mask )\r\n{\r\n\tpoint = vec3(0.0);\r\n\tmap = ivec3(0.0);\r\n\tobject = OBJECT_NONE;\r\n\tcolor = vec4(0.0);\r\n\tmaterial = vec3(0.0);\r\n\tmask = vec3(0.0);\r\n\r\n}\r\n\r\nbool getColorVoxel ( const in vec3 rd, const in vec3 ro, const in float limit, inout float len, inout vec3 point, inout ivec3 map, inout vec4 color, inout vec3 normal, inout vec3 world, inout int object, inout vec3 material, inout vec3 mask, inout int dimention )\r\n{\r\n\tvec3 ray;\r\n\tvec3 odist;\r\n\tvec3 p;\r\n\tvec3 n;\r\n\tint dimension;\r\n\r\n\tint id = raycast( rd, ro, limit, ray, mask, odist, p, n, map, len );\r\n\r\n\tif (id <= VOXEL_EMPTY)\r\n\t{\r\n\t\treturn false;\r\n\r\n\t}\r\n\r\n\tdimension = getDimension( odist );\r\n\tint surface = getSurface( dimension, ray );\r\n\r\n\tint tile;\r\n\tvec2 flip;\r\n\t\r\n\tgetVoxelTile( surface, id - 1, tile, flip );\r\n\r\n\tint mat = getMaterialID( tile );\r\n\r\n\tswitch (dimension) {\r\n\t\tcase DIMENSION_X:\r\n\t\t\tp.x = p.x > float(map.x) + 0.5 ? float(map.x + 1) + 0.01 : float(map.x) - 0.01;\r\n\t\t\tbreak;\r\n\r\n\t\tcase DIMENSION_Y:\r\n\t\t\tp.y = p.y > float(map.y) + 0.5 ? float(map.y + 1) + 0.01 : float(map.y) - 0.01;\r\n\t\t\tbreak;\r\n\r\n\t\tcase DIMENSION_Z:\r\n\t\t\tp.z = p.z > float(map.z) + 0.5 ? float(map.z + 1) + 0.01 : float(map.z) - 0.01;\r\n\t\t\tbreak;\r\n\r\n\t}\r\n\t\r\n\tvec2 uv = vec2(\r\n\t\tfract( dimension == DIMENSION_X ? p.z : p.x ),\r\n\t\tdimension == DIMENSION_Y ? fract( p.z ) : 1.0 - fract( p.y )\r\n\t);\r\n\t\r\n\tuv.x = flip.x < 0.0 ? 1.0 - uv.x : uv.x;\r\n\tuv.y = flip.y < 0.0 ? 1.0 - uv.y : uv.y;\r\n\r\n\tvec4 col;\r\n\tvec3 pbr;\r\n\tvec3 nor;\r\n\r\n\tgetTexture( uv, mat, col, pbr, nor );\r\n\r\n\tif (col.a <= 0.0)\r\n\t{\r\n\t\treturn false;\r\n\r\n\t}\r\n\r\n\tnor.xy *= flip;\r\n\r\n\tworld = n;\r\n\r\n\tif (\r\n\t\tworld.x != 0.0 ||\r\n\t\tworld.z != 0.0\r\n\t)\r\n\t{\r\n\t\tnor.y = -nor.y;\r\n\t\t\r\n\t}\r\n\r\n\tif (\r\n\t\tworld.y < 0.0 ||\r\n\t\tworld.z > 0.0 ||\r\n\t\tworld.x < 0.0\r\n\t)\r\n\t{\r\n\t\tnor.x = -nor.x;\r\n\r\n\t}\r\n\r\n\tpoint = p;\r\n\tobject = OBJECT_HIT_VOXEL;\r\n\tcolor = col;\r\n\tnormal = blendNormal( world, nor );\r\n\tmaterial = pbr;\r\n\r\n\treturn true;\r\n\t\r\n}\r\n\r\nvec3 calcDirectionUV_Z ( const in vec2 uv )\r\n{\r\n\tfloat gggxd = uv.x - 0.5;\r\n\tfloat ggyd = uv.y - 0.5;\r\n\tfloat ggzd = fov;\r\n\t\r\n\tfloat gggzd = ggzd * dirY.x + ggyd * dirY.y;\r\n\t\r\n\treturn normalize( vec3(\r\n\t\tgggzd * dirX.x - gggxd * dirX.y,\r\n\t\tggyd * dirY.x - ggzd * dirY.y,\r\n\t\tgggxd * dirX.x + gggzd * dirX.y\r\n\t) );\r\n\r\n}\r\n\r\nvec3 calcDirection ()\r\n{\r\n\tfloat xRotRads = direction.x;\r\n\tfloat yRotRads = direction.y;\r\n    vec3 dir;\r\n    float cosY = cos(yRotRads);\r\n\r\n    dir.x = sin(xRotRads) * cosY;\r\n    dir.y = -sin(yRotRads);\r\n    dir.z = cos(xRotRads) * cosY;\r\n\r\n    return dir;\r\n}\r\n\r\nvec2 aspectUV ( const in vec2 uv, const in vec2 viewport )\r\n{\r\n\tvec2 u = uv - 0.5;\r\n\r\n\tu *= viewport / viewport.y;\r\n\tu *= rotate( false );\r\n\t\r\n\treturn u + 0.5;\r\n\r\n}\r\n\r\nbool hasGround ( const in vec3 rd, const in vec3 ro, const in float height )\r\n{\r\n\tfloat d = -(ro.y - height) / rd.y;\r\n\r\n\td = min( 100000.0, d );\r\n\r\n\treturn d > 0.0;\r\n\r\n}\r\n\r\nbool hasShadow ( const in vec3 rd, const in vec3 ro, const in float limit, inout float len )\r\n{\r\n\tvec3 ray;\r\n\tvec3 mask;\r\n\tvec3 odist;\r\n\tvec3 p;\r\n\tvec3 n;\r\n\tivec3 map;\r\n\r\n\tint id = raycast( rd, ro, limit, ray, mask, odist, p, n, map, len );\r\n\t\r\n\tif (id > VOXEL_EMPTY)\r\n\t{\r\n\t\treturn true;\r\n\r\n\t}\r\n\t\r\n\treturn false;\r\n\r\n}\r\n\r\nvec2 rsi ( const in vec3 ro, const in vec3 rd, const in float sr )\r\n{\r\n\tfloat a = dot( rd, rd );\r\n\tfloat b = 2.0 * dot( rd, ro );\r\n\tfloat c = dot( ro, ro ) - (sr * sr);\r\n\tfloat d = (b * b) - 4.0 * a * c;\r\n\r\n\tfloat sd = sqrt( d );\r\n\tfloat a2 = 2.0 * a;\r\n\r\n\treturn vec2(\r\n\t\t(-b - sd),\r\n\t\t(-b + sd)\r\n\t) / (a2);\r\n\r\n}\r\n\r\nvec3 atmosphere ( vec3 rd, vec3 ro, vec3 pSun, float iSun, float rPlanet, float rAtmos, vec3 kRlh, float kMie, float shRlh, float shMie, float g )\r\n{\r\n\tvec2 p = rsi(ro, rd, rAtmos);\r\n\t\r\n\tif (p.x > p.y)\r\n\t{\r\n\t\treturn vec3(0.0, 0.0, 0.0);\r\n\r\n\t}\r\n\r\n\tfloat iStepSize = (rAtmos - rPlanet) / float(iSteps);\r\n\tfloat iTime = 0.0;\r\n\r\n\tvec3 totalRlh = vec3(0.0);\r\n\tvec3 totalMie = vec3(0.0);\r\n\r\n\tfloat iOdRlh = 0.0;\r\n\tfloat iOdMie = 0.0;\r\n\r\n\tfloat mu = dot( rd, pSun );\r\n\tfloat mumu = mu / 5.0;\r\n\tfloat gg = g * g;\r\n\tfloat pRlh = 3.0 / (16.0 * PI) * (1.0 + mumu);\r\n\tfloat pMie = 3.0 / (8.0 * PI) * ((1.0 - gg) * (mumu + 1.0)) / (pow( 1.0 + gg - 2.0 * mu * g, 1.5 ) * (2.0 + gg));\r\n\r\n\tfor (int i = 0; i < iSteps; i++)\r\n\t{\r\n\t\tvec3 iPos = ro + rd * (iTime + iStepSize * 0.5);\r\n\t\tfloat iHeight = length( iPos ) - rPlanet;\r\n\r\n\t\tfloat odStepRlh = exp( -iHeight / shRlh ) * iStepSize;\r\n\t\tfloat odStepMie = exp( -iHeight / shMie ) * iStepSize;\r\n\r\n\t\tiOdRlh += odStepRlh;\r\n\t\tiOdMie += odStepMie;\r\n\r\n\t\tfloat jStepSize = rsi( iPos, pSun, rAtmos ).y / float(jSteps);\r\n\r\n\t\tfloat jTime = 0.0;\r\n\r\n\t\tfloat jOdRlh = 0.0;\r\n\t\tfloat jOdMie = 0.0;\r\n\r\n\t\tfor (int j = 0; j < jSteps; j++)\r\n\t\t{\r\n\t\t\tvec3 jPos = iPos + pSun * (jTime + jStepSize * 0.5);\r\n\r\n\t\t\tfloat jHeight = length( jPos ) - rPlanet;\r\n\r\n\t\t\tjOdRlh += exp( -jHeight / shRlh ) * jStepSize;\r\n\t\t\tjOdMie += exp( -jHeight / shMie ) * jStepSize;\r\n\r\n\t\t\tjTime += jStepSize;\r\n\t\t\t\r\n\t\t}\r\n\r\n\t\tvec3 attn = exp( -(kMie * (iOdMie + jOdMie) + kRlh * (iOdRlh + jOdRlh)) );\r\n\r\n\t\ttotalRlh += odStepRlh * attn;\r\n\t\ttotalMie += odStepMie * attn;\r\n\r\n\t\tiTime += iStepSize;\r\n\r\n\t}\r\n\r\n\treturn clamp( iSun * (pRlh * kRlh * totalRlh + pMie * kMie * totalMie), vec3(0.0), vec3(1.0) );\r\n\r\n}\r\n\r\nvoid shadingNone ( const in vec3 rd, const in vec3 ro, inout float l, inout vec4 albedo, inout vec3 normal, inout vec3 material, inout vec3 point, inout int object )\r\n{\r\n\tif (hasGround( ro, rd, 0.001 ))\r\n\t{\r\n\t\tvec3 pos = ground( ro, rd, 0.001 );\r\n\t\tvec3 n = vec3(0.0, 1.0, 0.0);\r\n\t\tfloat t = float(TILE_RESOLUTION);\r\n\t\tfloat ran = (rand( pos - mod( pos, vec3(1.0 / t) ) ) - 0.5) / 0.5;\r\n\t\tfloat add = time / (0.0000001 * 60.0);\r\n\t\tfloat len = min( BACKGROUND_RAB_LENGTH, length( pos - ro ) ) / BACKGROUND_RAB_LENGTH;\r\n\t\t\r\n\t\tl = length( ro - pos );\r\n\t\tobject = OBJECT_HIT_GROUND;\r\n\t\tpoint = pos + vec3(0.0, 0.001, 0.0);\r\n\t\tvec3 p = pos * background_noise_size;\r\n\t\t\r\n\t\tswitch (background_theme) {\r\n\t\t\tcase BACKGROUND_NOISE:\r\n\t\t\t\tvec3 rab_noise = vec3(noise( p.xz - mod( p.xz, vec2(1.0 / t) ), background_noise_length ), 0.0, noise( p.zx - mod( p.zx, vec2(1.0 / t) ), background_noise_length ));\r\n\r\n\t\t\t\talbedo = vec4(mix(\r\n\t\t\t\t\tmix( background_rise_up_color, backgorund_night_up_color, global_moon_light ),\r\n\t\t\t\t\tmix( background_rise_down_color, backgorund_night_down_color, global_moon_light ),\r\n\t\t\t\t\tmax( rab_noise.x, rab_noise.z )\r\n\t\t\t\t), 1.0);\r\n\t\t\t\tnormal = n - rab_noise * rd * 0.25 * len;\r\n\t\t\t\tmaterial = mix( backgorund_material_up, background_material_down, (1.0 - max( rab_noise.x, rab_noise.y ) * (1.0 - len)) );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase BACKGROUND_LIQUID:\r\n\t\t\t\tvec3 rab_liquid = mix(\r\n\t\t\t\t\tvec3(noise( (p.xz - mod( p.xz, vec2(1.0 / t) )) + add, background_noise_length ), 0.0, noise( (p.zx - mod( p.zx, vec2(1.0 / t) )) + add, background_noise_length )),\r\n\t\t\t\t\tvec3(noise( (p.xz - mod( p.xz, vec2(1.0 / t) )) - vec2(add, -add), background_noise_length ), 0.0, noise( (p.zx - mod( p.zx, vec2(1.0 / t) )) - vec2(-add, add), background_noise_length )),\r\n\t\t\t\t\t0.5\r\n\t\t\t\t);\r\n\r\n\t\t\t\talbedo = vec4(mix(\r\n\t\t\t\t\tmix( background_rise_up_color, backgorund_night_up_color, global_moon_light ),\r\n\t\t\t\t\tmix( background_rise_down_color, backgorund_night_down_color, global_moon_light ),\r\n\t\t\t\t\tmax( rab_liquid.x, rab_liquid.z )\r\n\t\t\t\t), 1.0);\r\n\t\t\t\tnormal = n - rab_liquid * rd * 0.25 * (1.0 - len);\r\n\t\t\t\tmaterial = mix( backgorund_material_up, background_material_down, (1.0 - max( rab_liquid.x, rab_liquid.y ) * (1.0 - len)) );\r\n\t\t\t\tbreak;\r\n\r\n\t\t}\r\n\t}\r\n\telse\r\n\t{\r\n\t\tl = max_draw_distance;\r\n\t\talbedo = vec4(0.0);\r\n\t\tmaterial = vec3(0.0);\r\n\t\tnormal = vec3(0.0);\r\n\t\tobject = OBJECT_NONE;\r\n\t\tpoint = vec3(0.0);\r\n\r\n\t}\r\n\r\n}\r\n\r\nvec4 voxelAO ( const in vec3 pos, const in vec3 d1, const in vec3 d2 )\r\n{\r\n\tvec4 side = vec4(bvec4(max( vec4(0.0), vec4(getMapData( pos + d1 ), getMapData( pos + d2 ), getMapData( pos - d1 ), getMapData( pos - d2 )) - 1.0) ));\r\n\tvec4 corner = vec4(bvec4(max( vec4(0.0), vec4(getMapData( pos + d1 + d2 ), getMapData( pos - d1 + d2 ), getMapData( pos - d1 - d2 ), getMapData( pos + d1 - d2 )) - 1.0 )));\r\n\tvec4 ao = vec4(\r\n\t\tvertexAO( side.xy, corner.x ),\r\n\t\tvertexAO( side.yz, corner.y ),\r\n\t\tvertexAO( side.zw, corner.z ),\r\n\t\tvertexAO( side.wx, corner.w )\r\n\t);\r\n\r\n\treturn ao;\r\n\r\n}\r\n\r\nfloat calcAO ( const vec3 rd, const ivec3 map, const in vec3 point, const in vec3 mask )\r\n{\r\n\tvec4 ambient = voxelAO( vec3(map) - sign( rd ) * sign( mask ), sign( mask.zxy ), sign( mask.yzx ) );\r\n\tvec2 ambientUV = mod( vec2(dot( sign( mask ) * point.yzx, vec3(1.0) ), dot( sign( mask ) * point.zxy, vec3(1.0) )), vec2(1.0) );\r\n\t\r\n\treturn mix( mix( ambient.z, ambient.w, ambientUV.x ), mix( ambient.y, ambient.x, ambientUV.x ), ambientUV.y );\r\n\r\n}\r\n\r\nfloat calcSunLighting ( const vec3 rd, const in vec3 sun_dir, const in vec3 normal, const in vec3 material, const in vec3 point )\r\n{\r\n\treturn phong( rd, sun_dir, normal, all( equal( material, vec3(0.0) ) ) ? material : max( vec3(0.01), material ) ) * sun_light_force * global_sun_light;\r\n\r\n}\r\n\r\nfloat calcMoonLighting ( const vec3 rd, const in vec3 moon_dir, const in vec3 normal, const in vec3 material, const in vec3 point )\r\n{\r\n\treturn phong( rd, moon_dir, normal, all( equal( material, vec3(0.0) ) ) ? material : max( vec3(0.01), material ) ) * moon_light_force * global_moon_light;\r\n\r\n}\r\n\r\nfloat calcPlayerLighting ( const vec3 rd, const in vec3 normal, const in vec3 material, const in vec3 point )\r\n{\r\n    vec3 dir = normalize( position - point );\r\n\tfloat force = player_light_force / mix( max( NLIGHT.r, max( NLIGHT.g, NLIGHT.b ) ), max( SLIGHT.r, max( SLIGHT.g, SLIGHT.b ) ), max( 0.0, min( 1.0, global_sun_light - global_moon_light ) ) );\r\n    float power = (1.0 - min( 1.0, length( position - point ) / player_light_radius )) * force;\r\n\r\n\treturn min( force * power, phong( rd, normalize( position - point ), normal, all( equal( material, vec3(0.0) ) ) ? material : max( vec3(0.01), material ) ) * diffuse( dir, normal ) * power * 25.0 );\r\n\t\r\n}\r\n\r\nvoid calcSkybox ( inout vec3 rd, inout vec3 ro, const in int object, const in vec3 point, out vec3 skybox )\r\n{\r\n\tbool isSkybox = object == OBJECT_NONE;\r\n\tbool isGround = object == OBJECT_HIT_GROUND;\r\n\r\n\tskybox = vec3(global_sun_light);\r\n\r\n\tif (\r\n\t\tisSkybox ||\r\n\t\tisGround\r\n\t)\r\n\t{\r\n\t\tskybox = clamp( max(\r\n\t\t\tatmosphere(\r\n\t\t\t\trd,\t\t\t\t\t\t\t\t// normalized ray direction\r\n\t\t\t\tvec3(\r\n\t\t\t\t\t0.0,\r\n\t\t\t\t\t6365000.0,\r\n\t\t\t\t\t0.0\r\n\t\t\t\t) + ro,\t\t\t\t\t\t\t// ray origin\r\n\t\t\t\tsun_direction,\t\t\t\t\t// position of the sun\r\n\t\t\t\t80.0,\t\t\t\t\t\t\t// intensity of the sun\r\n\t\t\t\t6361000.0,\t\t\t\t\t\t// radius of the planet in meters\r\n\t\t\t\t6461000.0,\t\t\t\t\t\t// radius of the atmosphere in meters\r\n\t\t\t\tSKY_COLOR,\t\t\t\t\t\t// Rayleigh scattering coefficient\r\n\t\t\t\t0.00005,\t\t\t\t\t\t// Mie scattering coefficient\r\n\t\t\t\t10000.0,\t\t\t\t\t\t// Rayleigh scale height\r\n\t\t\t\t3500.0,\t\t\t\t\t\t\t// Mie scale height\r\n\t\t\t\t0.999\t\t\t\t\t\t\t// Mie preferred scattering direction\r\n\r\n\t\t\t),\r\n\t\t\tatmosphere(\r\n\t\t\t\trd,\t\t\t\t\t\t\t\t// normalized ray direction\r\n\t\t\t\tvec3(\r\n\t\t\t\t\t0.0,\r\n\t\t\t\t\t6355000.0,\r\n\t\t\t\t\t0.0\r\n\t\t\t\t) + ro,\t\t\t\t\t\t\t// ray origin\r\n\t\t\t\t-sun_direction,\t\t\t\t\t// position of the sun\r\n\t\t\t\t12.5,     \t\t\t\t\t\t// intensity of the sun\r\n\t\t\t\t6361000.0,\t\t\t\t\t\t// radius of the planet in meters\r\n\t\t\t\t6461000.0,\t\t\t\t\t\t// radius of the atmosphere in meters\r\n\t\t\t\tSKY_COLOR,\t\t\t\t\t\t// Rayleigh scattering coefficient\r\n\t\t\t\t0.00005,\t\t\t\t\t\t// Mie scattering coefficient\r\n\t\t\t\t10000.0,\t\t\t\t\t\t// Rayleigh scale height\r\n\t\t\t\t5000.0,\t\t\t\t\t\t\t// Mie scale height\r\n\t\t\t\t0.999\t\t\t\t\t\t\t// Mie preferred scattering direction\r\n\r\n\t\t\t) * vec3(0.5, 0.5, 0.75)\r\n\t\t), vec3(0.0), vec3(1.0) );\r\n\r\n\t}\r\n\r\n}\r\n\r\nvoid calcLighting ( inout vec3 rd, inout vec3 ro,  const in float limit, const in vec3 normal, const in vec3 material, const in vec3 mask, const in int object, const in vec3 point, out float ll, inout float dist, inout bool isShadow, inout bool isClip, inout bool isBloom, inout bool isNoMaterial )\r\n{\t\r\n\tbool isSkybox = object == OBJECT_NONE;\r\n\tbool isGround = object == OBJECT_HIT_GROUND;\r\n\r\n\tll = 0.0;\r\n\r\n\tif (!all( equal( material, vec3(0.0) ) ))\r\n\t{\r\n\t\tif (isGround)\r\n\t\t{\r\n\t\t\tif (global_sun_light > 0.0)\r\n\t\t\t{\r\n\t\t\t\tll = max( ll, max( global_sun_light, calcSunLighting( rd, sun_direction, normal, material, point ) ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif (global_moon_light > 0.0)\r\n\t\t\t{\r\n\t\t\t\tll = max( ll, max( global_moon_light, calcMoonLighting( rd, -sun_direction, normal, material, point ) ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tif (global_sun_light > 0.0)\r\n\t\t\t{\r\n\t\t\t\tfloat parallel = diffuse( sun_direction, normal );\r\n\r\n\t\t\t\tif (parallel <= 0.0)\r\n\t\t\t\t{\r\n\t\t\t\t\tll = min( ll, 0.0 );\r\n\t\t\t\t\tisShadow = isShadow || false;\r\n\t\t\t\t\tdist = 0.0;\r\n\r\n\t\t\t\t}\r\n\t\t\t\telse if (is_shadow && hasShadow( sun_direction, point, limit, dist ))\r\n\t\t\t\t{\r\n\t\t\t\t\tll = min( ll, 0.0 );\r\n\t\t\t\t\tisShadow = isShadow || true;\r\n\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tll = max( ll, max( global_sun_light, calcSunLighting( rd, sun_direction, normal, material, point ) ) );\r\n\t\t\t\t\tisShadow = isShadow || false;\r\n\t\t\t\t\tdist = max_draw_distance;\r\n\r\n\t\t\t\t}\r\n\t\t\t\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (global_moon_light > 0.0)\r\n\t\t\t{\r\n\t\t\t\tfloat parallel = diffuse( -sun_direction, normal );\r\n\r\n\t\t\t\tif (parallel <= 0.0)\r\n\t\t\t\t{\r\n\t\t\t\t\tll = min( ll, 0.0 );\r\n\t\t\t\t\tisShadow = isShadow || false;\r\n\t\t\t\t\tdist = 0.0;\r\n\r\n\t\t\t\t}\r\n\t\t\t\telse if (is_shadow && hasShadow( -sun_direction, point, limit, dist ))\r\n\t\t\t\t{\r\n\t\t\t\t\tll = min( ll, 0.0 );\r\n\t\t\t\t\tisShadow = isShadow || true;\r\n\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tll = max( ll, max( global_moon_light, calcMoonLighting( rd, -sun_direction, normal, material, point ) ) );\r\n\t\t\t\t\tisShadow = isShadow || false;\r\n\t\t\t\t\tdist = max_draw_distance;\r\n\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t\t\r\n\t\tll = isSkybox? 1.0 : object != OBJECT_HIT_HUD ? max( ll, calcPlayerLighting( rd, normal, material, point ) ) : ll;\r\n\t\r\n\t\tisClip = true;\r\n\t\tisBloom = ll > 1.0;\r\n\r\n\t}\r\n\telse\r\n\t{\r\n\t\tisBloom = true;\r\n\t\tisNoMaterial = true;\r\n\r\n\t}\r\n\t\r\n}\r\n\r\nvoid calcReflection ( inout vec3 rd, inout vec3 ro, inout float limit, inout vec3 dest, inout float ref, inout float ll, inout vec3 bloom, inout bool isBloom )\r\n{\r\n\tvec3 rdd;\r\n\tvec3 roo;\r\n\tfloat len;\r\n\tvec3 point;\r\n\tivec3 map;\r\n\tvec4 color; \r\n\tvec3 normal;\r\n\tvec3 world;\r\n\tint object;\r\n\tvec3 material;\r\n\tvec3 mask;\r\n\r\n\tfloat rr = 1.5;\r\n\r\n\tfor (int i = 0; i < reflection_count + 1; i++)\r\n\t{\r\n\t\tfloat l;\r\n\t\tvec3 p;\r\n\t\tivec3 m;\r\n\t\tvec4 c; \r\n\t\tvec3 n;\r\n\t\tvec3 w;\r\n\t\tint o;\r\n\t\tvec3 mat;\r\n\t\tvec3 msk;\r\n\t\tint dimention;\r\n\r\n\t\tbool isFirst = i == 0;\r\n\t\tbool isSky = object == OBJECT_NONE;\r\n\r\n\t\tif (\r\n\t\t\tisFirst ||\r\n\t\t\t!isSky\r\n\t\t)\r\n\t\t{\r\n\t\t\tgetColorEmpty( p, m, c, o, mat, msk );\r\n\t\t\t\r\n\t\t\tif (!getColorVoxel( rd, ro, limit, l, p, m, c, n, w, o, mat, msk, dimention ))\r\n\t\t\t{\r\n\t\t\t\tshadingNone( rd, ro, l, c, n, mat, p, o );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tbool br = false;\r\n\r\n\t\tif (isFirst) \r\n\t\t{\r\n\t\t\tll = l;\r\n\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tlimit = max( 0.0, limit - len );\r\n\t\t\r\n\t\t\tvec3 skybox;\r\n\t\t\tvec3 albedo;\r\n\r\n\t\t\tif (isSky)\r\n\t\t\t{\r\n\t\t\t\tcalcSkybox( rdd, roo, object, point, skybox );\r\n\r\n\t\t\t\talbedo = dest + skybox * ref;\r\n\t\t\t\tbloom += skybox * ref;\r\n\t\t\t\tbr = true;\r\n\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\trr = max( 0.0, rr - (1.0 - material.z) );\r\n\t\t\t\t\r\n\t\t\t\tfloat lig;\r\n\t\t\t\tfloat ao = 0.0;\r\n\t\t\t\tfloat dist = max_draw_distance;\r\n\t\t\t\tbool isShadow = false;\r\n\t\t\t\tbool isClip = false;\r\n\t\t\t\tbool isBloom = false;\r\n\t\t\t\tbool isNoMaterial = false;\r\n\t\t\t\t\r\n\t\t\t\tcalcSkybox( rdd, roo, object, point, skybox );\r\n\t\t\t\tcalcLighting( rdd, roo, limit, normal, material, mask, object, point, lig, dist, isShadow, isClip, isBloom, isNoMaterial );\r\n\r\n\t\t\t\tif (\r\n\t\t\t\t\tisClip &&\r\n\t\t\t\t\tobject == OBJECT_HIT_VOXEL &&\r\n\t\t\t\t\tlig < 1.0\r\n\t\t\t\t)\r\n\t\t\t\t{\r\n\t\t\t\t\tao = calcAO( rdd, map, point, mask );\r\n\t\t\t\t\t\r\n\t\t\t\t}\r\n\r\n\t\t\t\talbedo = color.rgb;\r\n\r\n\t\t\t\tfloat len = length( point - roo );\r\n\t\t\t\tfloat grad = clamp( len / FOG_LENGTH, 0.0, 1.0 );\r\n\t\t\t\tfloat sh = object == OBJECT_HIT_VOXEL && (world.z > 0.5 || world.z < -0.5 || world.y < -0.5) ? 0.125 : 0.5;\r\n\t\t\t\tlig = lig < 1.0 ? mix( max( 0.0, lig - sh - AO_LIGHT) + sh + AO_LIGHT, lig, ao ) : lig;\r\n\t\t\t\tfloat rl = max( 0.0, lig - 1.0 );\r\n\r\n\t\t\t\tvec3 g = mix( NLIGHT, SLIGHT, max( 0.0, min( 1.0, global_sun_light - global_moon_light ) ) );\r\n\t\t\t\tfloat cover = min( 1.0, reflection_count <= 0 ? 1.0 : is_roughness ? l / max_draw_distance : (max_draw_distance <= l ? 1.0 : 0.0) );\r\n\t\t\t\t\r\n\t\t\t\talbedo *= !all( equal( material, vec3(0.0) ) ) ? mix( SHADOW, g + vec3(rl * cover), min( 1.0, lig ) ) : vec3(1.0);\r\n\t\t\t\talbedo = mix( albedo, skybox, object == OBJECT_HIT_GROUND ? grad : 0.0 );\r\n\t\t\t\talbedo = dest + clamp( albedo, vec3(0.0), vec3(1.0) ) * ref;\r\n\t\t\t\tbloom += (!all( equal( material, vec3(0.0) ) ) ? vec3(rl * cover) : albedo.rgb) * ref;\r\n\r\n\t\t\t\tbr = rr < 0.25 || material.z <= 0.0;\r\n\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tref = material.z;\r\n\t\t\tdest = clamp( albedo, vec3(0.0), vec3(1.0) );\r\n\r\n\t\t}\r\n\t\t\r\n\t\tpoint = p;\r\n\t\tlen = l;\r\n\t\tmap = m;\r\n\t\tcolor = c;\r\n\t\tnormal = n;\r\n\t\tworld = w;\r\n\t\tobject = o;\r\n\t\tmaterial = mat;\r\n\t\tmask = msk;\r\n\r\n\t\tif (br)\r\n\t\t{\r\n\t\t\tbreak;\r\n\r\n\t\t}\r\n\r\n\t\trdd = rd;\r\n\t\troo = ro;\r\n\t\trd = normalize( reflect( rd, n ) );\r\n\t\tro = p;\r\n\t\t\r\n\t}\r\n\t\r\n}\r\n\r\nvec2 compactCheckerCoord ( const in vec2 uv, const in vec2 coord, const in vec2 resolution, const in vec2 viewport )\r\n{\r\n\treturn uv + (1.0 / resolution * vec2(modI( coord.y, 2.0 ) == 1.0, 0.0));\r\n\r\n}\r\n\r\nvec3 calcPixelizePosition ( const in vec3 loc )\r\n{\r\n\tfloat rez = 1.0 / float(tile_resolution);\r\n\tvec3 diff = abs(vec3(loc.x - round( loc.x ), loc.y - round( loc.y ), loc.z - round( loc.z )));\r\n\t\r\n\tvec3 sub = mod( loc, rez );\r\n\tfloat center = rez * 0.5;\r\n\tvec3 par = 1.0 - vec3(equal( vec3(min( diff.x, min( diff.y, diff.z ) )), diff ));\r\n\r\n\treturn loc - sub + center * par;\r\n\t\r\n}\r\n\r\nvoid main ()\r\n{\r\n\tvec2 u = compactCheckerCoord( uv, gl_FragCoord.xy, resolution * vec2(2.0, 1.0), viewport );\r\n\tvec3 rd = calcDirectionUV_Z( aspectUV( u, resolution ) );\r\n\tvec3 ro = position;\r\n\r\n\tvec4 mat = restoreHalfCheckerboardBuffer( Material, u * resolution );\r\n\tvec3 normal = restoreHalfCheckerboardBuffer( Normal, u * resolution ).rgb * 2.0 - 1.0;\r\n\tvec4 location = restoreHalfCheckerboardBuffer( Location, u * resolution );\r\n\r\n\tint object = int(ceil( mat.w ));\r\n\tvec3 point = location.xyz;\r\n\tvec3 material = mat.xyz;\r\n\r\n\tfloat lig;\r\n\tvec3 skybox;\r\n\tbool isShadow = false;\r\n\tbool isClip = false;\r\n\tbool _isBloom = false;\r\n\tbool isNoMaterial = false;\r\n\r\n\tcalcSkybox( rd, ro, object, point, skybox );\r\n\r\n\tif (\r\n\t\t!is_roughness &&\r\n\t\tis_pixelized_lighting &&\r\n\t\tobject != OBJECT_NONE\r\n\t)\r\n\t{\r\n\t\tvec3 p;\r\n\t\tvec3 r;\r\n\t\t\r\n\t\tvec3 loc = location.xyz;\r\n\r\n\t\tif (\r\n\t\t\tobject == OBJECT_HIT_BILLBOARD ||\r\n\t\t\tobject == OBJECT_HIT_HUD\r\n\t\t)\r\n\t\t{\r\n\t\t\tp = restoreHalfCheckerboardBuffer( BillboardUV, u * resolution ).xyz;\r\n\t\t\tr = normalize( point - ro );\r\n\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tp = calcPixelizePosition( loc );\r\n\t\t\tr = normalize( p - ro );\r\n\r\n\t\t}\r\n\r\n\t\tmat4 cam = inverse( setCamera( ro, ray_dir_z ) );\r\n\t\tvec2 uv = project( p, cam, fov ) * rotate( true ) * 2.0 / (resolution / resolution.y) / 2.0 + 0.5;\r\n\r\n\t\tpoint = p;\r\n\t\trd = r;\r\n\t\t\r\n\t\tif (hasInOfUV(uv))\r\n\t\t{\r\n\t\t\tu = uv;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tvec4 m = restoreHalfCheckerboardBuffer( Mask, u * resolution );\r\n\tvec3 mask = m.xyz;\r\n\tfloat dist = max_draw_distance;\r\n\tfloat ao = 0.0;\r\n\tfloat limit = max_draw_distance - location.w;\r\n\r\n\tif (object != OBJECT_NONE)\r\n\t{\r\n\t\tcalcLighting( rd, ro, limit, normal, material, mask, object, point, lig, dist, isShadow, isClip, _isBloom, isNoMaterial );\r\n\t\t\r\n\t}\r\n\r\n\tvec3 shading = vec3(0.0);\r\n\tvec3 bloom = vec3(0.0);\r\n\tfloat shadow = 0.0;\r\n\tfloat len = max_draw_distance;\r\n\r\n\tTEXTURE_RESOLUTION = textureSize( texture_albedo_data, 0 );\r\n\tTILE_RESOLUTION = max_2d_texture_size - int(modI( float(max_2d_texture_size), float(tile_resolution) ));\r\n\tNOISE = noiseFade( u );\r\n\r\n\tbool isBloom = false;\r\n\r\n\tif (\r\n\t\tis_reflection &&\r\n\t\tmaterial.z > 0.0\r\n\t)\r\n\t{\r\n\t\tvec3 ro = point;\r\n\r\n\t\tfloat d = location.w;\r\n\t\tfloat ref = 1.0;\r\n\t\tvec3 r = normalize( reflect( rd, normal ) );\r\n\r\n\t\tcalcReflection( r, ro, limit, shading, ref, len, bloom, isBloom );\r\n\t\t\r\n\t}\r\n\r\n\tif (isClip)\r\n\t{\r\n\t\tvec3 g = mix( NLIGHT, SLIGHT, max( 0.0, min( 1.0, global_sun_light - global_moon_light ) ) );\r\n\t\tvec3 l = mix( SHADOW, mix( g, vec3(lig - 1.0), max( 0.0, min( 1.0, lig - 1.0 ) ) ), min( 1.0, lig ) );\r\n\r\n\t\tClipLighting = vec4(max( vec3(0.0), l - 1.0 ), lig > 1.0);\r\n\r\n\t}\r\n\telse if (\r\n\t\t!isNoMaterial &&\r\n\t\tobject == OBJECT_NONE\r\n\t)\r\n\t{\r\n\t\tClipSkybox = vec4(skybox, 1.0);\r\n\r\n\t}\r\n\telse\r\n\t{\r\n\t\tClipAlbedo = vec4(restoreHalfCheckerboardBuffer( Albedo, u * resolution ).rgb, 1.0);\r\n\r\n\t}\r\n\r\n\tivec3 map;\r\n\tint dimension = int(m.w);\r\n\r\n\tswitch (dimension) {\r\n\t\tcase DIMENSION_X:\r\n\t\t\tmap = ivec3(\r\n\t\t\t\tround( location.x ) - (mod( location.x, 1.0 ) < 0.5 ? 1.0 : 0.0),\r\n\t\t\t\tlocation.y,\r\n\t\t\t\tlocation.z\r\n\t\t\t);\r\n\t\t\tbreak;\r\n\r\n\t\tcase DIMENSION_Y:\r\n\t\t\tmap = ivec3(\r\n\t\t\t\tlocation.x,\r\n\t\t\t\tround( location.y ) - (mod( location.y, 1.0 ) < 0.5 ? 1.0 : 0.0),\r\n\t\t\t\tlocation.z\r\n\t\t\t);\r\n\t\t\tbreak;\r\n\r\n\t\tcase DIMENSION_Z:\r\n\t\t\tmap = ivec3(\r\n\t\t\t\tlocation.x,\r\n\t\t\t\tlocation.y,\r\n\t\t\t\tround( location.z ) - (mod( location.z, 1.0 ) < 0.5 ? 1.0 : 0.0)\r\n\t\t\t);\r\n\t\t\tbreak;\r\n\r\n\t}\r\n\r\n\tif (\r\n\t\tisClip &&\r\n\t\tobject == OBJECT_HIT_VOXEL &&\r\n\t\tlig < 1.0\r\n\t)\r\n\t{\r\n\t\tao = calcAO( rd, map, point, mask );\r\n\t\t\r\n\t}\r\n\t\r\n\tLighting = vec4( object == OBJECT_NONE ? 1.0 : lig, ao, dist, isShadow);\r\n\tSkybox = vec4(skybox, 0.0);\r\n\tReflection = vec4( clamp( shading, vec3(0.0), vec3(1.0) ), len);\r\n\tClipReflection = vec4(bloom * mat.z, is_reflection ? isBloom : true);\r\n\r\n}"},6878:(t,e,n)=>{"use strict";n.d(e,{Z:()=>r});const r="#version 300 es\r\n\r\n#define EPSILON 0.00001\r\n#define FLT_MIN 1.175494351e-38\r\n#define FLT_MAX 3.402823466e38\r\n#define BACKGROUND_RAB_LENGTH 250.0\r\n#define FADE_LENGTH 5.0\r\n#define MAX_LOOP 9999\r\n\r\n#define QUATER 0.7853981633974483\r\n#define HALF 1.5707963267948966\r\n#define PI 3.141592653589793\r\n#define CIRCLE 6.283185307179586\r\n\r\n#define sampler3D sampler2DArray\r\n#define isampler3D isampler2DArray\r\n#define usampler3D usampler2DArray\r\n\r\n#define BILLBOARD_PROP_POSITION_X 0\r\n#define BILLBOARD_PROP_POSITION_Y 1\r\n#define BILLBOARD_PROP_POSITION_Z 2\r\n#define BILLBOARD_PROP_SCALE 3\r\n#define BILLBOARD_PROP_BOUNDING 4\r\n#define BILLBOARD_PROP_AXIS_X 5\r\n#define BILLBOARD_PROP_AXIS_Y 6\r\n#define BILLBOARD_PROP_AXIS_Z 7\r\n#define BILLBOARD_PROP_FIX_POSITION_X 5\r\n#define BILLBOARD_PROP_FIX_POSITION_Y 6\r\n#define BILLBOARD_PROP_FIX_POSITION_Z 7\r\n#define BILLBOARD_PROP_ROTATE 8\r\n#define BILLBOARD_PROP_FLIP_X 9\r\n#define BILLBOARD_PROP_FLIP_Y 10\r\n#define BILLBOARD_PROP_HUD_FIX 11\r\n#define BILLBOARD_PROP_HUD_ROTATE 12\r\n#define BILLBOARD_PROP_TILE 13\r\n#define BILLBOARD_PROP_LENGTH 14\r\n\r\n#define VOXEL_PROP_POSITION_X 0\r\n#define VOXEL_PROP_POSITION_Y 1\r\n#define VOXEL_PROP_POSITION_Z 2\r\n#define VOXEL_PROP_TEXTURE_FRONT 3\r\n#define VOXEL_PROP_TEXTURE_BACK 4\r\n#define VOXEL_PROP_TEXTURE_RIGHT 5\r\n#define VOXEL_PROP_TEXTURE_LEFT 6\r\n#define VOXEL_PROP_TEXTURE_TOP 7\r\n#define VOXEL_PROP_TEXTURE_BOTTOM 8\r\n#define VOXEL_PROP_TEXTURE_FLIP_X_FRONT 9\r\n#define VOXEL_PROP_TEXTURE_FLIP_Y_FRONT 10\r\n#define VOXEL_PROP_TEXTURE_FLIP_X_BACK 11\r\n#define VOXEL_PROP_TEXTURE_FLIP_Y_BACK 12\r\n#define VOXEL_PROP_TEXTURE_FLIP_X_RIGHT 13\r\n#define VOXEL_PROP_TEXTURE_FLIP_Y_RIGHT 14\r\n#define VOXEL_PROP_TEXTURE_FLIP_X_LEFT 15\r\n#define VOXEL_PROP_TEXTURE_FLIP_Y_LEFT 16\r\n#define VOXEL_PROP_TEXTURE_FLIP_X_TOP 17\r\n#define VOXEL_PROP_TEXTURE_FLIP_Y_TOP 18\r\n#define VOXEL_PROP_TEXTURE_FLIP_X_BOTTOM 19\r\n#define VOXEL_PROP_TEXTURE_FLIP_Y_BOTTOM 20\r\n#define VOXEL_PROP_LENGTH 21\r\n\r\n#define SURFACE_NONE -1\r\n#define SURFACE_FRONT 0\r\n#define SURFACE_BACK 1\r\n#define SURFACE_RIGHT 2\r\n#define SURFACE_LEFT 3\r\n#define SURFACE_TOP 4\r\n#define SURFACE_BOTTOM 5\r\n\r\n#define DIMENSION_X 0\r\n#define DIMENSION_Y 1\r\n#define DIMENSION_Z 2\r\n\r\n#define OBJECT_NONE 0\r\n#define OBJECT_HIT_GROUND 1\r\n#define OBJECT_HIT_VOXEL 2\r\n#define OBJECT_HIT_BILLBOARD 3\r\n#define OBJECT_HIT_HUD 4\r\n\r\n#define WALL_NONE 0\r\n#define WALL_BLOCK 1\r\n#define WALL_WALLX 2\r\n#define WALL_WALLZ 3\r\n\r\n#define BACKGROUND_NOISE 0\r\n#define BACKGROUND_LIQUID 1\r\n\r\n#define iSteps 3\r\n#define jSteps 1\r\n\r\n#define VOXEL_EMPTY 1\r\n\r\n#define CHECKER_COORD vec2(modI(gl_FragCoord.y,2.0)==1.0?1.0:0.0,0.0)\r\n\r\nprecision highp int;\r\nprecision highp float;\r\nprecision highp sampler2D;\r\nprecision highp isampler2D;\r\nprecision highp usampler2D;\r\nprecision highp sampler3D;\r\nprecision highp isampler3D;\r\nprecision highp usampler3D;\r\n\r\nuniform vec2 viewport;\r\nuniform vec2 resolution;\r\n\r\nuniform ivec3 map_size;\r\nuniform int max_2d_texture_size;\r\nuniform int max_3d_texture_size;\r\nuniform float max_draw_distance;\r\nuniform int tile_resolution;\r\nuniform ivec2 cluster_resolution;\r\n\r\nuniform isampler3D map_data;\r\nuniform isampler3D distance_field;\r\nuniform sampler2D texture_albedo_data;\r\nuniform sampler2D texture_pbr_data;\r\nuniform sampler2D texture_normal_data;\r\nuniform isampler3D material_data;\r\nuniform sampler3D voxel_data;\r\nuniform sampler3D billboard_data;\r\nuniform isampler3D cluster_list;\r\nuniform isampler3D item_list;\r\n\r\nuniform float time;\r\nuniform vec3 position;\r\nuniform vec3 direction;\r\nuniform vec3 ray_dir_y;\r\nuniform vec3 ray_dir_z;\r\nuniform vec3 sun_direction;\r\nuniform float global_sun_light;\r\nuniform float global_moon_light;\r\nuniform float fov;\r\nuniform float fov_hud;\r\n\r\nuniform bool is_pixelized_lighting;\r\nuniform int background_theme;\r\nuniform vec3 background_rise_up_color;\r\nuniform vec3 backgorund_night_up_color;\r\nuniform vec3 background_rise_down_color;\r\nuniform vec3 backgorund_night_down_color;\r\nuniform vec3 backgorund_material_up;\r\nuniform vec3 background_material_down;\r\nuniform float background_noise_size;\r\nuniform float background_noise_length;\r\n\r\nin vec2 uv;\r\nin vec2 dirX;\r\nin vec2 dirY;\r\nin vec2 dirZ;\r\nin vec2 dirZI;\r\n\r\nlayout (location = 0) out vec4 Albedo;\r\nlayout (location = 1) out vec4 Normal;\r\nlayout (location = 2) out vec4 World;\r\nlayout (location = 3) out vec4 Material;\r\nlayout (location = 4) out vec4 Location;\r\nlayout (location = 5) out vec4 Mask;\r\nlayout (location = 6) out vec4 BillboardUV;\r\n\r\nivec2 TEXTURE_RESOLUTION;\r\nint TILE_RESOLUTION;\r\nint CLUSTER_START;\r\nint BILLBOARD_LENGTH;\r\nfloat NOISE;\r\n\r\n#define collideBounding(rd,ro,pos,scale) (length(cross(rd,pos-ro))<scale)\r\n#define fixTexturePosition(index) ivec3(modI(float(index),float(max_3d_texture_size)),modI(floor(float(index)/float(max_3d_texture_size)),float(max_3d_texture_size)),floor(floor(float(index)/float(max_3d_texture_size))/float(max_3d_texture_size)))\r\n#define hasInOfUV(uv) all(bvec4(greaterThanEqual(uv,vec2(0.0)),lessThan(uv,vec2(1.0))))\r\n#define getFade(dist,len,depth) clamp((depth-(dist-len))/len,0.0,1.0)\r\n#define hasChecker() all(equal(mod(ceil(uv*resolution+CHECKER_COORD),vec2(2.0)),vec2(0.0)))\r\n\r\n#define getDimension(max) max.x<max.y?(max.x<max.z?DIMENSION_X:DIMENSION_Z):(max.y<max.z?DIMENSION_Y:DIMENSION_Z)\r\n\r\n#define getMapData(point) int(texelFetch(map_data,ivec3(point),0).r)\r\n#define getDistanceField(point) texelFetch(distance_field,ivec3(point),0).r\r\n#define getMaterialData(point) texelFetch(material_data,point,0)\r\n#define getVoxelData(point) texelFetch(voxel_data,point,0).r\r\n#define getClusterData(point) texelFetch(cluster_list,point,0).r\r\n#define getItemData(point) texelFetch(item_list,point,0).r\r\n#define getBillboardData(point) texelFetch(billboard_data,point,0).r\r\n#define getImageData(point) texelFetch(texture_albedo_data,point,0)\r\n#define getPBRData(point) texelFetch(texture_pbr_data,point,0).rgb\r\n#define getNormalData(point) texelFetch(texture_normal_data,point,0).rgb*2.0-1.0\r\n\r\n#define getMaterialID(tile) int(getMaterialData(fixTexturePosition(tile)).x)\r\n#define getVoxel(index,id) getVoxelData(fixTexturePosition(VOXEL_PROP_LENGTH*index+id))\r\n#define getClusterLength(cluster) getClusterData(fixTexturePosition(cluster))\r\n#define getBillboard(index,id) getBillboardData(fixTexturePosition(BILLBOARD_PROP_LENGTH*index+id))\r\n\r\n#define getBillboardPosition(index) vec3(getBillboard(index,BILLBOARD_PROP_POSITION_X),getBillboard(index,BILLBOARD_PROP_POSITION_Y),getBillboard(index,BILLBOARD_PROP_POSITION_Z))\r\n#define getBillboardScale(index) getBillboard(index,BILLBOARD_PROP_SCALE)\r\n#define getBillboardBounding(index) getBillboard(index,BILLBOARD_PROP_BOUNDING)\r\n#define getBillboardAxes(index) clamp(vec3(int(getBillboard(index,BILLBOARD_PROP_AXIS_X)),int(getBillboard(index,BILLBOARD_PROP_AXIS_Y)),int(getBillboard(index,BILLBOARD_PROP_AXIS_Z))),vec3(0.0),vec3(1.0))\r\n#define getBillboardFixPosition(index) vec3(getBillboard(index,BILLBOARD_PROP_FIX_POSITION_X),getBillboard(index,BILLBOARD_PROP_FIX_POSITION_Y),getBillboard(index,BILLBOARD_PROP_FIX_POSITION_Z))\r\n#define getBillboardRotate(index) getBillboard(index,BILLBOARD_PROP_ROTATE)\r\n#define getBillboardFlip(index) sign(vec2(getBillboard(index,BILLBOARD_PROP_FLIP_X),getBillboard(index,BILLBOARD_PROP_FLIP_Y)))\r\n#define getBillboardHUDFix(index) getBillboard(index,BILLBOARD_PROP_HUD_FIX)\r\n#define getBillboardHUDRotate(index) getBillboard(index,BILLBOARD_PROP_HUD_ROTATE)\r\n#define getBillboardImage(index) int(getBillboard(index,BILLBOARD_PROP_TILE))\r\n\r\n#define getVoxelPosition(index) vec3(getVoxel(index,VOXEL_PROP_POSITION_X),getVoxel(index,VOXEL_PROP_POSITION_Y),getVoxel(index,VOXEL_PROP_POSITION_Z))\r\n\r\n#define getVoxelFront(index) int(getVoxel(index,VOXEL_PROP_TEXTURE_FRONT))\r\n#define getVoxelBack(index) int(getVoxel(index,VOXEL_PROP_TEXTURE_BACK))\r\n#define getVoxelRight(index) int(getVoxel(index,VOXEL_PROP_TEXTURE_RIGHT))\r\n#define getVoxelLeft(index) int(getVoxel(index,VOXEL_PROP_TEXTURE_LEFT))\r\n#define getVoxelTop(index) int(getVoxel(index,VOXEL_PROP_TEXTURE_TOP))\r\n#define getVoxelBottom(index) int(getVoxel(index,VOXEL_PROP_TEXTURE_BOTTOM))\r\n\r\n#define getVoxelFlipFront(index) sign(vec2(getVoxel(index,VOXEL_PROP_TEXTURE_FLIP_X_FRONT),getVoxel(index,VOXEL_PROP_TEXTURE_FLIP_Y_FRONT)))\r\n#define getVoxelFlipBack(index) sign(vec2(-getVoxel(index,VOXEL_PROP_TEXTURE_FLIP_X_BACK),getVoxel(index,VOXEL_PROP_TEXTURE_FLIP_Y_BACK)))\r\n#define getVoxelFlipRight(index) sign(vec2(getVoxel(index,VOXEL_PROP_TEXTURE_FLIP_X_RIGHT),getVoxel(index,VOXEL_PROP_TEXTURE_FLIP_Y_RIGHT)))\r\n#define getVoxelFlipLeft(index) sign(vec2(-getVoxel(index,VOXEL_PROP_TEXTURE_FLIP_X_LEFT),getVoxel(index,VOXEL_PROP_TEXTURE_FLIP_Y_LEFT)))\r\n#define getVoxelFlipTop(index) sign(vec2(-getVoxel(index,VOXEL_PROP_TEXTURE_FLIP_X_TOP),-getVoxel(index,VOXEL_PROP_TEXTURE_FLIP_Y_TOP)))\r\n#define getVoxelFlipBottom(index) sign(vec2(getVoxel(index,VOXEL_PROP_TEXTURE_FLIP_X_BOTTOM),-getVoxel(index,VOXEL_PROP_TEXTURE_FLIP_Y_BOTTOM)))\r\n\r\nconst int MaxSamples = 10;\r\n\r\nfloat rand ( const in vec3 co )\r\n{\r\n\tfloat a = fract( dot( co, vec3(2.067390879775102, 12.451168662908249, 5.187923581090) ) ) - 0.5;\r\n\tfloat s = a * (6.182785114200511 + a*a * (-38.026512460676566 + a*a * 53.392573080032137));\r\n\t\r\n\treturn fract( s * 43758.5453 );\r\n\r\n}\r\n\r\nfloat rand ( const in float co )\r\n{\r\n\treturn fract( cos( co * 43758.5453 ) );\r\n\r\n}\r\n\r\nvec2 g ( const in vec2 n ) { return sin(n.x*n.y*vec2(12,17)+vec2(1,2)); }\r\n\r\nfloat noise ( const in vec2 p, const in float kF )\r\n{\r\n    vec2 i = floor(p);\r\n\tvec2 f = fract(p);\r\n    f = f*f*(3.0-2.0*f);\r\n\r\n    return (mix(mix(sin(kF*dot(p,g(i+vec2(0,0)))),\r\n               \t   sin(kF*dot(p,g(i+vec2(1,0)))),f.x),\r\n               mix(sin(kF*dot(p,g(i+vec2(0,1)))),\r\n               \t   sin(kF*dot(p,g(i+vec2(1,1)))),f.x),f.y) + 1.0) / 2.0;\r\n}\r\n\r\nfloat modI ( const in float a, const in float b )\r\n{\r\n    float m = a - floor( (a + 0.5) / b ) * b;\r\n    \r\n    return floor( m + 0.5 );\r\n    \r\n}\r\n\r\nvec2 modI ( const in vec2 a, const in vec2 b )\r\n{\r\n    vec2 m = a - floor( (a + 0.5) / b ) * b;\r\n    \r\n    return floor( m + 0.5 );\r\n    \r\n}\r\n\r\nmat2 rotate ( const in bool inv )\r\n{\r\n\tfloat c = inv ? dirZI.x : dirZ.x;\r\n\tfloat s = inv ? dirZI.y : dirZ.y;\r\n\r\n\treturn mat2(c, -s, s, c);\r\n\r\n}\r\n\r\nmat2 rotate ( const in float angle )\r\n{\r\n\tfloat c = cos(angle);\r\n\tfloat s = sin(angle);\r\n\r\n\treturn mat2(c, -s, s, c);\r\n\r\n}\r\n\r\nmat3 rotate ( const in vec3 axis, float angle )\r\n{\r\n\tvec3 a = normalize(axis);\r\n    float s = sin( angle );\r\n    float c = cos( angle );\r\n    float oc = 1.0 - c;\r\n    \r\n    return mat3(\r\n\t\toc * a.x * a.x + c,        oc * a.x * a.y - a.z * s,  oc * a.z * a.x + a.y * s,\r\n        oc * a.x * a.y + a.z * s,  oc * a.y * a.y + c,        oc * a.y * a.z - a.x * s,\r\n        oc * a.z * a.x - a.y * s,  oc * a.y * a.z + a.x * s,  oc * a.z * a.z + c\r\n\t);\r\n\r\n}\r\n\r\nmat3 rotate ( const in vec3 r )\r\n{\r\n\tfloat cx = cos( r.x );\r\n\tfloat sx = sin( r.x );\r\n\tfloat cy = cos( r.y );\r\n\tfloat sy = sin( r.y );\r\n\tfloat cz = cos( r.z );\r\n\tfloat sz = sin( r.z );\r\n\r\n\treturn mat3(\r\n\t\tcy * cz, \tcx * sz + sx * sy * cz, \tsx * sz - cx * sy * cz,\r\n\t\t-cy * sz,\tcx * cz - sx * sy * sz,\t\tsx * cz + cx * sy * sz,\r\n\t\tsy,\t\t\t-sx * cy,\t\t\t\t\tcx * cy\r\n\t);\r\n\t\r\n}\r\n\r\nvec2 rotateUV ( const in vec2 uv, const in vec2 viewport )\r\n{\r\n\tvec2 u = (uv - 0.5) * viewport / min( viewport.x, viewport.y );\r\n\r\n\tu *= rotate( false );\r\n\tu += 0.5;\r\n\r\n\treturn u;\r\n\r\n}\r\n\r\nmat2 scale ( const in vec2 size )\r\n{\r\n    return mat2(size.x, 0.0, 0.0, size.y);\r\n\r\n}\r\n\r\nfloat atan2 ( const in float y, const in float x )\r\n{\r\n    return x == 0.0 ? sign( y ) * PI / 2.0 : atan( y, x );\r\n    \r\n}\r\n\r\nvec3 calcNormal ( const in vec3 point )\r\n{\r\n    vec3 dx = normalize( dFdx( point ) );\r\n    vec3 dy = normalize( dFdy( point ) );\r\n\t\r\n\treturn normalize( cross( dx, dy ) );\r\n\r\n}\r\n\r\nfloat normalizeDirection1d ( const in float direction )\r\n{\r\n\tfloat dir = mod( direction, CIRCLE );\r\n\r\n\treturn 0.0 > dir ? dir + CIRCLE : dir;\r\n\r\n}\r\n\r\nfloat directionDiff2d ( const in float direction1, const in float direction2 )\r\n{\r\n\tfloat dir1 = normalizeDirection1d( direction1 );\r\n\tfloat dir2 = normalizeDirection1d( direction2 );\r\n\r\n\tfloat diff = dir1 - dir2;\r\n\t\t\t\r\n\tdiff -= floor( diff / CIRCLE ) * CIRCLE;\r\n\t// diff > PI ? CIRCLE : 0.0\r\n\tdiff -= mix( 0.0, CIRCLE, step( PI, diff ) );\r\n\r\n\treturn diff;\r\n\r\n}\r\n\r\nvec2 direction3d ( const in vec3 p1, const in vec3 p2 ) {\r\n    vec3 p = p1 - p2;\r\n\r\n    float directionX = atan2(p.z, p.x);\r\n    float directionY = -atan2(p.y, sqrt( p.x * p.x + p.z * p.z ));\r\n\r\n    return vec2(\r\n\t\tdirectionX,\r\n\t\tdirectionY\r\n\t);\r\n\r\n}\r\n\r\nint combineBit2D32 ( const in int num )\r\n{\r\n\tint n = num;\r\n\r\n    n = n & 0x55555555;\r\n    n = (n | (n >> 1)) & 0x33333333;\r\n    n = (n | (n >> 2)) & 0x0f0f0f0f;\r\n    n = (n | (n >> 4)) & 0x00ff00ff;\r\n    n = (n | (n >> 8)) & 0x0000ffff;\r\n\r\n    return n;\r\n}\r\n\r\nivec2 decodeMorton2d ( const in int morton )\r\n{\r\n    return ivec2(\r\n\t\tcombineBit2D32( morton >> 0 ),\r\n\t\tcombineBit2D32( morton >> 1 )\r\n\t);\r\n\t\r\n}\r\n\r\nmat3 lookAt ( const in vec3 origin, const in vec3 target, const in float roll )\r\n{\r\n\tvec3 rr = vec3(sin(roll), cos(roll), 0.0);\r\n\tvec3 ww = normalize(target - origin);\r\n\tvec3 uu = normalize(cross(ww, rr));\r\n\tvec3 vv = normalize(cross(uu, ww));\r\n\r\n\treturn mat3(uu, vv, ww);\r\n\r\n}\r\n\r\nmat4 lookAt ( const in vec3 eye, const in vec3 center, const in vec3 up )\r\n{\r\n\tvec3 w = normalize( eye - center );\r\n\tvec3 u = normalize( cross( up, w ) );\r\n\tvec3 v = normalize( cross( w, u ) );\r\n\r\n\treturn mat4(\r\n\t\tu.x, v.x, w.x, 0,\r\n\t\tu.y, v.y, w.y, 0,\r\n\t\tu.z, v.z, w.z, 0,\r\n\t\t-dot( u, eye ), -dot( u, eye ), -dot( w, eye ), 1\r\n\t);\r\n\r\n}\r\n\r\nmat4 perspective ( const in float fov, const in float aspect, const in float near, const in float far )\r\n{\r\n    float v = 1./tan(radians(fov/2.)), u = v/aspect, w = near-far;\r\n\r\n    return mat4(u,0,0,0,0,v,0,0,0,0,(near+far)/w,-1,0,0,near*far*2./w,1);\r\n\t\r\n}\r\n\r\nvec3 ground ( const in vec3 p, const in vec3 d, const in float depth ) \r\n{\r\n    vec3 n = vec3(0.0, depth, 0.0);\r\n    float f = dot(-n * 0.8 - p, n) / dot(n, d);\r\n\r\n    return p + d * f;\r\n\r\n}\r\n\r\nvec3 calcDirection ( const in vec2 d )\r\n{\r\n\tfloat xRotRads = -d.x - HALF;\r\n\tfloat yRotRads = -d.y;\r\n    float cosY = cos(yRotRads);\r\n\t\r\n\tvec3 dir = vec3(\r\n\t\tsin(xRotRads) * cosY,\r\n\t\t-sin(yRotRads),\r\n\t\tcos(xRotRads) * cosY\r\n\t);\r\n\r\n    return dir;\r\n}\r\n\r\nvec3 calcDirectionUV_Z ( const in vec2 uv )\r\n{\t\r\n\tfloat gggxd = uv.x - 0.5;\r\n\tfloat ggyd = uv.y - 0.5;\r\n\tfloat ggzd = fov;\r\n\t\r\n\tfloat gggzd = ggzd * dirY.x + ggyd * dirY.y;\r\n\t\r\n\treturn normalize( vec3(\r\n\t\tgggzd * dirX.x - gggxd * dirX.y,\r\n\t\tggyd * dirY.x - ggzd * dirY.y,\r\n\t\tgggxd * dirX.x + gggzd * dirX.y\r\n\t) );\r\n\r\n}\r\n\r\nvec3 calcDirectionHUD_UV_Z ( const in vec2 uv )\r\n{\t\r\n\tfloat gggxd = uv.x - 0.5;\r\n\tfloat ggyd = uv.y - 0.5;\r\n\tfloat ggzd = fov_hud;\r\n\t\r\n\tfloat gggzd = ggzd * dirY.x + ggyd * dirY.y;\r\n\t\r\n\treturn normalize( vec3(\r\n\t\tgggzd * dirX.x - gggxd * dirX.y,\r\n\t\tggyd * dirY.x - ggzd * dirY.y,\r\n\t\tgggxd * dirX.x + gggzd * dirX.y\r\n\t) );\r\n\r\n}\r\n\r\nvec2 aspectUV ( const in vec2 uv, const in vec2 viewport )\r\n{\r\n\tvec2 u = uv - 0.5;\r\n\r\n\tu *= viewport / viewport.y;\r\n\tu *= rotate( false );\r\n\t\r\n\treturn u + 0.5;\r\n\r\n}\r\n\r\nbool hasGround ( const in vec3 rd, const in vec3 ro, const in float height )\r\n{\r\n\tfloat d = -(ro.y - height) / rd.y;\r\n\r\n\td = min( 100000.0, d );\r\n\r\n\treturn d > 0.0;\r\n\r\n}\r\n\r\nvec3 normalizeNormalBlock ( const in vec3 material, const in vec3 world )\r\n{\r\n\tvec3 m = material;\r\n\r\n\tm = mix( m, vec3(-material.x, material.y, material.z), max( 0.0, world.x ) );\r\n\tm = mix( m, vec3(material.x, -material.y, material.z), max( 0.0, -world.x ) );\r\n\tm = mix( m, vec3(material.x, material.y, material.z), max( 0.0, world.y ) );\r\n\tm = mix( m, vec3(material.x, -material.y, material.z), max( 0.0, -world.y ) );\r\n\tm = mix( m, vec3(material.x, material.y, material.z), max( 0.0, world.z ) );\r\n\tm = mix( m, vec3(-material.xy, material.z), max( 0.0, -world.z ) );\r\n\r\n\treturn m;\r\n\r\n}\r\n\r\nvec3 normalizeNormalBillboard ( const in vec3 material, const in vec3 world )\r\n{\r\n\tvec3 m = material;\r\n\r\n\tm = mix( m, vec3(material.x, material.y, material.z), max( 0.0, world.x ) );\r\n\tm = mix( m, vec3(material.x, -material.y, material.z), max( 0.0, -world.x ) );\r\n\tm = mix( m, vec3(material.x, material.y, material.z), max( 0.0, world.y ) );\r\n\tm = mix( m, vec3(material.x, -material.y, material.z), max( 0.0, -world.y ) );\r\n\tm = mix( m, vec3(material.x, material.y, material.z), max( 0.0, world.z ) );\r\n\tm = mix( m, vec3(material.x, -material.y, material.z), max( 0.0, -world.z ) );\r\n\r\n\treturn m;\r\n\r\n}\r\n\r\nvec3 blendNormal ( const in vec3 n1, const in vec3 n2 )\r\n{\r\n\tvec3 world_n = normalize( n1 );\r\n\tvec3 map_n = normalize( n2 );\r\n\tvec3 t = cross( world_n, vec3(0.0, 1.0, 0.0) ); \r\n\t\r\n\tif (length( t ) == 0.0)\r\n\t{\r\n\t\tt = cross( world_n, vec3(0.0, 0.0, 1.0) );\r\n\r\n\t}\r\n\r\n\tt = normalize( t );\r\n\r\n\tvec3 b = normalize( cross( world_n, t ) );\r\n\tmat3 tbn = mat3(t, b, world_n);\r\n\t\r\n\treturn normalize( tbn * map_n );\r\n\r\n}\r\n\r\nvoid getTexture ( const in vec2 uv, const in int id, out vec4 col, out vec3 pbr, out vec3 nor )\r\n{\r\n\tfloat tile = float(tile_resolution);\r\n\tivec2 p = decodeMorton2d( id );\r\n\tivec2 pos = ivec2(uv * tile + vec2(p) * tile);\r\n\r\n\tcol = getImageData( pos );\r\n\tpbr = getPBRData( pos );\r\n\tnor = getNormalData( pos );\r\n\r\n}\r\n\r\nvec3 directionVectol3d ( const in vec3 p1, const in vec3 p2 ) {\r\n\tvec3 d = p1 - p2;\r\n\r\n\tfloat directionX = atan2(d.y, d.x);\r\n\tfloat directionY = atan2(d.z, d.y);\r\n\tfloat directionZ = atan2(d.x, d.z);\r\n\r\n\treturn vec3(\r\n\t\tdirectionX,\r\n\t\tdirectionY,\r\n\t\tdirectionZ\r\n\t);\r\n\r\n}\r\n\r\nfloat noiseFade (  const in vec2 p )\r\n{\r\n    return fract( cos( mod( 123456789.0, 256.0 * dot( p, vec2(23.140692632779,2.6651441426902) ) ) ) );\r\n    \r\n}\r\n\r\nint getClusterTile ( const in vec2 uv )\r\n{\r\n\tvec2 box = 1.0 / vec2(cluster_resolution);\r\n\r\n\treturn int(uv.y / box.y) * cluster_resolution.x + int(uv.x / box.x);\r\n\t\r\n}\r\n\r\nbool rayBillboard ( const in vec3 rd, const in vec3 rrd, const in vec3 ro, const in vec3 pos, const in vec3 ppos, const in float scale, const in bool isHUD, const in vec3 axes, const in vec3 up, out vec3 normal, out vec3 position, out vec2 uv )\r\n{\r\n\tvec3 v = pos - ro;\r\n\tvec3 n = normalize( axes * v );\r\n\tfloat z = dot( n, v ) / dot( n, rd );\r\n\r\n\tif (z <= 0.0)\r\n\t{\r\n\t\treturn false;\r\n\r\n\t}\r\n\r\n\tvec3 vv = ppos - ro;\r\n\tvec3 nn = normalize( axes * vv );\r\n\tfloat zz = dot( nn, vv ) / dot( nn, rrd );\r\n\r\n\tposition = ro + rrd * min( length( ppos - ro ) + scale / 2.0, zz );\r\n\tnormal = (isHUD ? -ray_dir_z : normalize( ro - ppos )) * axes;\r\n\r\n\tvec3 pp = ro + rd * min( length( pos - ro ) + scale / 2.0, z );\r\n\r\n\tvec3 p = pp - pos;\r\n\tvec3 x = normalize( cross( n, up ) );\r\n\tvec3 y = normalize( cross( n, x ) );\r\n\r\n\tuv = vec2(\r\n\t\tdot( p, x ),\r\n\t\tdot( p, y )\r\n\t);\r\n\r\n\treturn true;\r\n\r\n}\r\n\r\n/*\r\nint getDimension ( const in vec3 max )\r\n{\r\n\tif (max.x < max.y)\r\n\t{\r\n\t\tif (max.x < max.z)\r\n\t\t{\r\n\t\t\treturn DIMENSION_X;\r\n\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\treturn DIMENSION_Z;\r\n\r\n\t\t}\r\n\t}\r\n\telse\r\n\t{\r\n\t\tif (max.y < max.z)\r\n\t\t{\r\n\t\t\treturn DIMENSION_Y;\r\n\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\treturn DIMENSION_Z;\r\n\t\t\t\r\n\t\t}\r\n\r\n\t}\r\n\r\n\treturn int(mix( mix( float(DIMENSION_Z), float(DIMENSION_Y), step( max.y, max.z ) ), mix( float(DIMENSION_Z), float(DIMENSION_X), step( max.x, max.z ) ), step( max.x, max.y ) ));\r\n\treturn max.x < max.y ? (max.x < max.z ? DIMENSION_X : DIMENSION_Z) : (max.y < max.z ? DIMENSION_Y : DIMENSION_Z);\r\n\t\r\n}\r\n*/\r\n\r\nint getSurface ( const in int dimension, const in vec3 ray )\r\n{\r\n\tswitch (dimension)\r\n\t{\r\n\t\tcase DIMENSION_X:\r\n\t\t\treturn 0.0 < ray.x ? SURFACE_FRONT : SURFACE_BACK;\r\n\t\t\t//return int(mix( float(SURFACE_FRONT), float(SURFACE_BACK), step( ray.x, 0.0 ) ));\r\n\r\n\t\tcase DIMENSION_Y:\r\n\t\t\treturn 0.0 < ray.y ? SURFACE_TOP : SURFACE_BOTTOM;\r\n\t\t\t//return int(mix( float(SURFACE_TOP), float(SURFACE_BOTTOM), step( ray.y, 0.0 ) ));\r\n\r\n\t\tcase DIMENSION_Z:\r\n\t\t\treturn 0.0 < ray.z ? SURFACE_LEFT : SURFACE_RIGHT;\r\n\t\t\t//return int(mix( float(SURFACE_LEFT), float(SURFACE_RIGHT), step( ray.z, 0.0 ) ));\r\n\t}\r\n\r\n\treturn SURFACE_NONE;\r\n\r\n\t/*\r\n\tfloat surface = 0.0;\r\n\r\n\tsurface = mix( surface, mix( float(SURFACE_BACK), float(SURFACE_FRONT), step( 0.0, ray.x ) ), step( float(DIMENSION_X), float(dimension) ) );\r\n\tsurface = mix( surface, mix( float(SURFACE_TOP), float(SURFACE_BOTTOM), step( 0.0, ray.y ) ), step( float(DIMENSION_Y), float(dimension) ) );\r\n\tsurface = mix( surface, mix( float(SURFACE_LEFT), float(SURFACE_RIGHT), step( 0.0, ray.z ) ), step( float(DIMENSION_Z), float(dimension) ) );\r\n\r\n\treturn int(surface);\r\n\t*/\r\n\r\n}\r\n\r\nvoid getVoxelTile ( const in int surface, const in int id, out int tile, out vec2 flip )\r\n{\r\n\tswitch (surface)\r\n\t{\r\n\t\tcase SURFACE_FRONT:\r\n\t\t\ttile = getVoxelFront(id);\r\n\t\t\tflip = getVoxelFlipFront(id);\r\n\t\t\tbreak;\r\n\r\n\t\tcase SURFACE_BACK:\r\n\t\t\ttile = getVoxelBack(id);\r\n\t\t\tflip = getVoxelFlipBack(id);\r\n\t\t\tbreak;\r\n\r\n\t\tcase SURFACE_RIGHT:\r\n\t\t\ttile = getVoxelRight(id);\r\n\t\t\tflip = getVoxelFlipRight(id);\r\n\t\t\tbreak;\r\n\r\n\t\tcase SURFACE_LEFT:\r\n\t\t\ttile = getVoxelLeft(id);\r\n\t\t\tflip = getVoxelFlipLeft(id);\r\n\t\t\tbreak;\r\n\r\n\t\tcase SURFACE_BOTTOM:\r\n\t\t\ttile = getVoxelBottom(id);\r\n\t\t\tflip = getVoxelFlipBottom(id);\r\n\t\t\tbreak;\r\n\r\n\t\tcase SURFACE_TOP:\r\n\t\t\ttile = getVoxelTop(id);\r\n\t\t\tflip = getVoxelFlipTop(id);\r\n\t\t\tbreak;\r\n\r\n\t}\r\n\t\r\n\t/*\r\n\tfloat tile = float(SURFACE_NONE);\r\n\tfloat s = float(surface);\r\n\r\n\ttile = mix( tile, getVoxelFront(id), step( float(SURFACE_FRONT), s ) );\r\n\ttile = mix( tile, getVoxelBack(id), step( float(SURFACE_BACK), s ) );\r\n\ttile = mix( tile, getVoxelLeft(id), step( float(SURFACE_RIGHT), s ) );\r\n\ttile = mix( tile, getVoxelLeft(id), step( float(SURFACE_LEFT), s ) );\r\n\ttile = mix( tile, getVoxelTop(id), step( float(SURFACE_TOP), s ) );\r\n\ttile = mix( tile, getVoxelBottom(id), step( float(SURFACE_BOTTOM), s ) );\r\n\ttile = mix( tile, getVoxelFront(id), step( float(SURFACE_WALL_FRONT), s ) );\r\n\ttile = mix( tile, getVoxelBack(id), step( float(SURFACE_WALL_BACK), s ) );\r\n\t\r\n\treturn int(tile);\r\n\t*/\r\n\r\n}\r\n\r\nint raycast ( const in vec3 rd, const in vec3 ro, const in float limit, out vec3 ray, out vec3 mask, out vec3 odist, out vec3 point, out vec3 normal, out ivec3 map, out float len )\r\n{\r\n\tray = 1.0 / rd;\r\n\r\n\tvec3 delta = abs( ray );\r\n\tvec3 dray = abs( vec3(length( rd )) / rd );\r\n\tivec3 sray = ivec3(sign( rd ));\r\n\tvec3 add = floor( vec3(sray) );\r\n\r\n\tmap = ivec3(floor( ro + 0.0 ));\r\n\r\n\tvec3 dist = (sign( rd ) * (vec3(map) - ro) + (sign( rd ) * 0.5) + 0.5) * dray;\r\n\tint st = getDistanceField( map );\r\n\r\n\tfor (int i = 0; i < int(max_draw_distance); i++)\r\n\t{\r\n\t\tvec3 m = floor( max( 0.0, float(st - 1) ) / delta );\r\n\t\t\r\n\t\tdist += m * dray;\r\n\t\tmap += ivec3(m) * sray;\r\n        \r\n\t\t// mask = step( dist.xyz, dist.yzx ) * step( dist.xyz, dist.zxy );\r\n\t\t// mask = step( dist.xyz, dist.yxy ) * step( dist.xyz, dist.zzx );\r\n\t\t// mask = step( dist, dist.yzx ) * (1.0 - step( dist.zxy, dist ));\r\n\t\t// mask = vec3(lessThanEqual( dist.xyz, min( dist.yzx, dist.zxy ) ));\r\n\t\t// mask = step( dist.xyz, dist.yzx );\r\n\t\t// mask *= (1.0 - mask.zxy);\r\n\t\tmask = vec3(lessThanEqual( dist.xyz, min( dist.yzx, dist.zxy ) ));\r\n\t\t\t\r\n\t\todist = dist;\r\n\t\tdist += mask * dray;\r\n\t\tmap += ivec3(mask) * sray;\r\n\t\tst = getDistanceField( map );\r\n\r\n\t\tfloat dis = min( min( odist.x, odist.y ), odist.z );\r\n\t\t\r\n\t\tif (st < 1)\r\n\t\t{\r\n\t\t\tpoint = ro + dis / delta * add;\r\n\t\t\tlen = length( point - ro );\r\n\r\n\t\t\tnormal = normalize( -mask * vec3(sray) );\r\n\r\n\t\t\treturn getMapData( map );\r\n\r\n\t\t}\r\n\t\telse if (limit < dis)\r\n\t\t{\r\n\t\t\tbreak;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\treturn VOXEL_EMPTY;\r\n\r\n}\r\n\r\nvoid getColorEmpty ( inout vec3 point, inout ivec3 map, inout vec4 color, inout int object, inout vec3 material, inout vec3 mask )\r\n{\r\n\tpoint = vec3(0.0);\r\n\tmap = ivec3(0.0);\r\n\tobject = OBJECT_NONE;\r\n\tcolor = vec4(0.0);\r\n\tmaterial = vec3(0.0);\r\n\tmask = vec3(0.0);\r\n\r\n}\r\n\r\nbool getColorVoxel ( const in vec3 rd, const in vec3 ro, const in float limit, inout float len, inout vec3 point, inout ivec3 map, inout vec4 color, inout vec3 normal, inout vec3 world, inout int object, inout vec3 material, inout vec3 mask, inout int dimension )\r\n{\r\n\tvec3 ray;\r\n\tvec3 odist;\r\n\tvec3 p;\r\n\tvec3 n;\r\n\r\n\tint id = raycast( rd, ro, limit, ray, mask, odist, p, n, map, len );\r\n\r\n\tif (id <= VOXEL_EMPTY)\r\n\t{\r\n\t\treturn false;\r\n\r\n\t}\r\n\r\n\tdimension = getDimension( odist );\r\n\tint surface = getSurface( dimension, ray );\r\n\r\n\tint tile;\r\n\tvec2 flip;\r\n\t\r\n\tgetVoxelTile( surface, id - 1, tile, flip );\r\n\r\n\tint mat = getMaterialID( tile );\r\n\r\n\tswitch (dimension) {\r\n\t\tcase DIMENSION_X:\r\n\t\t\tp.x = p.x > float(map.x) + 0.5 ? float(map.x + 1) + 0.01 : float(map.x) - 0.01;\r\n\t\t\tbreak;\r\n\r\n\t\tcase DIMENSION_Y:\r\n\t\t\tp.y = p.y > float(map.y) + 0.5 ? float(map.y + 1) + 0.01 : float(map.y) - 0.01;\r\n\t\t\tbreak;\r\n\r\n\t\tcase DIMENSION_Z:\r\n\t\t\tp.z = p.z > float(map.z) + 0.5 ? float(map.z + 1) + 0.01 : float(map.z) - 0.01;\r\n\t\t\tbreak;\r\n\r\n\t}\r\n\t\r\n\tvec2 uv = vec2(\r\n\t\tfract( dimension == DIMENSION_X ? p.z : p.x ),\r\n\t\tdimension == DIMENSION_Y ? fract( p.z ) : 1.0 - fract( p.y )\r\n\t);\r\n\t\r\n\tuv.x = flip.x < 0.0 ? 1.0 - uv.x : uv.x;\r\n\tuv.y = flip.y < 0.0 ? 1.0 - uv.y : uv.y;\r\n\r\n\tvec4 col;\r\n\tvec3 pbr;\r\n\tvec3 nor;\r\n\r\n\tgetTexture( uv, mat, col, pbr, nor );\r\n\r\n\tif (col.a <= 0.0)\r\n\t{\r\n\t\treturn false;\r\n\r\n\t}\r\n\r\n\tworld = n;\r\n\r\n\tif (\r\n\t\tworld.x != 0.0 ||\r\n\t\tworld.z != 0.0\r\n\t)\r\n\t{\r\n\t\tnor.y = -nor.y;\r\n\t\t\r\n\t}\r\n\r\n\tif (\r\n\t\tworld.y < 0.0 ||\r\n\t\tworld.z > 0.0 ||\r\n\t\tworld.x < 0.0\r\n\t)\r\n\t{\r\n\t\tnor.x = -nor.x;\r\n\r\n\t}\r\n\r\n\tnor.xy *= flip;\r\n\r\n\tpoint = p;\r\n\tobject = OBJECT_HIT_VOXEL;\r\n\tcolor = vec4(col.rgb, 1.0);\r\n\tnormal = blendNormal( world, nor );\r\n\tmaterial = pbr;\r\n\r\n\treturn true;\r\n\t\r\n}\r\n\r\nbool getColorBillboard ( const in vec3 rd, const in vec3 rd_hud, const in vec3 ro, inout float len, inout vec3 point, inout vec4 color, inout vec3 normal, inout vec3 world, inout int index, inout int object, inout vec3 material, inout vec3 bpos, inout float bscale )\r\n{\r\n\tfor (int i = 0; i < BILLBOARD_LENGTH; i++)\r\n\t{\r\n\t\tint ind = getItemData( fixTexturePosition( CLUSTER_START + i ) );\r\n\t\tfloat bounding = getBillboardBounding( ind );\r\n\t\tvec3 pos = getBillboardPosition( ind );\r\n\r\n\t\tfloat scale = getBillboardScale( ind );\r\n\t\t\r\n\t\tif (!collideBounding( rd, ro, pos, scale * bounding ))\r\n\t\t{\r\n\t\t\tcontinue;\r\n\r\n\t\t}\r\n\t\t\r\n\t\tbool isHUD = bool(getBillboardHUDFix( ind ));\r\n\t\tfloat dd = direction.y / HALF;\r\n\r\n\t\tvec3 axes = isHUD ? vec3(1.0, 1.0, 1.0) : getBillboardAxes( ind );\r\n\t\tvec3 up = (axes.x == 0.0 && axes.y > 0.0 && axes.z == 0.0) ? vec3(0.0, 0.0, 1.0) : (isHUD && direction.y >= 0.0) ? vec3(1.0, 0.0, 0.0) : vec3(0.0, 1.0, 0.0);\r\n\r\n\t\tvec3 ppos = isHUD ? getBillboardFixPosition( ind ) : pos;\r\n\t\r\n\t\tvec3 n;\r\n\t\tvec3 p;\r\n\t\tvec2 uv;\r\n\r\n\t\tif (!rayBillboard( isHUD ? rd_hud : rd, rd, ro, pos, ppos, scale, isHUD, axes, up, n, p, uv ))\r\n\t\t{\r\n\t\t\tcontinue;\r\n\r\n\t\t}\r\n\t\t\t\r\n\t\tfloat l = isHUD ? length( ro - pos ) : length( ro - p );\r\n\r\n\t\tif (l - scale / 2.0 > len)\r\n\t\t{\r\n\t\t\tbreak;\r\n\r\n\t\t}\r\n\t\telse if (l > len)\r\n\t\t{\r\n\t\t\tcontinue;\r\n\r\n\t\t}\r\n\r\n\t\tfloat angle = normalizeDirection1d( -getBillboardRotate( ind ) );\r\n\t\tfloat a = normalizeDirection1d( angle + (isHUD ? -getBillboardHUDRotate( ind ) : 0.0) );\r\n\t\tvec2 u = uv;\r\n\r\n\t\tu /= scale;\r\n\t\tu *= rotate( a );\r\n\t\tu += 0.5;\r\n\r\n\t\tif (!hasInOfUV( u ))\r\n\t\t{\r\n\t\t\tcontinue;\r\n\r\n\t\t}\r\n\r\n\t\tvec2 flip = getBillboardFlip( ind );\r\n\t\t\r\n\t\tu.x = flip.x < 0.0 ? 1.0 - u.x : u.x;\r\n\t\tu.y = flip.y < 0.0 ? 1.0 - u.y : u.y;\r\n\t\t\r\n\t\tint tile = getBillboardImage( ind );\r\n\t\tint id = getMaterialID( tile );\r\n\r\n\t\tvec4 col;\r\n\t\tvec3 pbr;\r\n\t\tvec3 nor;\r\n\r\n\t\tgetTexture( u, id, col, pbr, nor );\r\n\r\n\t\tif (col.a <= 0.0)\r\n\t\t{\r\n\t\t\tcontinue;\r\n\r\n\t\t}\r\n\r\n\t\tworld = normalize( n );\r\n\t\t\r\n\t\tnor.xy *= flip;\r\n\t\tnor.xy *= -1.0;\r\n\t\tnor.xy *= rotate( angle );\r\n\r\n\t\tindex = ind;\r\n\t\tlen = l;\r\n\t\tobject = isHUD ? OBJECT_HIT_HUD : OBJECT_HIT_BILLBOARD;\r\n\t\tcolor = vec4( col.rgb, 1.0);\r\n\t\tpoint = p;\r\n\t\tnormal = blendNormal( world, nor );\r\n\t\tmaterial = pbr;\r\n\r\n\t\tif (is_pixelized_lighting)\r\n\t\t{\r\n\t\t\t/*\r\n\t\t\tfloat rez = 1.0 / float(tile_resolution);\r\n\t\t\tvec2 sub = mod( uv, rez );\r\n\t\t\tfloat center = rez * 0.5;\r\n\t\t\tvec2 u = uv - sub + center;\r\n\t\t\tvec2 s = (u - 0.5) * 2.0 * rotate( a );\r\n\r\n\t\t\tbpos = pos + world * vec3(s.x, -s.y, 0.0) * (scale / 2.0);\r\n\t\t\t*/\r\n\r\n\t\t\tbpos = p;\r\n\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tbpos = p;\r\n\r\n\t\t}\r\n\r\n\t\tbscale = scale;\r\n\r\n\t}\r\n\r\n\treturn index != -1;\r\n\r\n}\r\n\r\nvoid shadingNone ( const in vec3 rd, const in vec3 ro, inout float l, inout vec4 albedo, inout vec3 normal, inout vec3 material, inout vec3 point, inout int object )\r\n{\r\n\tif (hasGround( ro, rd, 0.001 ))\r\n\t{\r\n\t\tvec3 pos = ground( ro, rd, 0.001 );\r\n\t\tvec3 n = vec3(0.0, 1.0, 0.0);\r\n\t\tfloat t = float(TILE_RESOLUTION);\r\n\t\tfloat ran = (rand( pos - mod( pos, vec3(1.0 / t) ) ) - 0.5) / 0.5;\r\n\t\tfloat add = time / (0.0000001 * 60.0);\r\n\t\tfloat len = min( BACKGROUND_RAB_LENGTH, length( pos - ro ) ) / BACKGROUND_RAB_LENGTH;\r\n\t\t\r\n\t\tl = length( ro - pos );\r\n\t\tobject = OBJECT_HIT_GROUND;\r\n\t\tpoint = pos + vec3(0.0, 0.001, 0.0);\r\n\t\tvec3 p = pos * background_noise_size;\r\n\t\t\r\n\t\tswitch (background_theme) {\r\n\t\t\tcase BACKGROUND_NOISE:\r\n\t\t\t\tvec3 rab_noise = vec3(noise( p.xz - mod( p.xz, vec2(1.0 / t) ), background_noise_length ), 0.0, noise( p.zx - mod( p.zx, vec2(1.0 / t) ), background_noise_length ));\r\n\r\n\t\t\t\talbedo = vec4(mix(\r\n\t\t\t\t\tmix( background_rise_up_color, backgorund_night_up_color, global_moon_light ),\r\n\t\t\t\t\tmix( background_rise_down_color, backgorund_night_down_color, global_moon_light ),\r\n\t\t\t\t\tmax( rab_noise.x, rab_noise.z )\r\n\t\t\t\t), 1.0);\r\n\t\t\t\tnormal = n - rab_noise * rd * 0.25 * len;\r\n\t\t\t\tmaterial = mix( backgorund_material_up, background_material_down, (1.0 - max( rab_noise.x, rab_noise.y ) * (1.0 - len)) );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase BACKGROUND_LIQUID:\r\n\t\t\t\tvec3 rab_liquid = mix(\r\n\t\t\t\t\tvec3(noise( (p.xz - mod( p.xz, vec2(1.0 / t) )) + add, background_noise_length ), 0.0, noise( (p.zx - mod( p.zx, vec2(1.0 / t) )) + add, background_noise_length )),\r\n\t\t\t\t\tvec3(noise( (p.xz - mod( p.xz, vec2(1.0 / t) )) - vec2(add, -add), background_noise_length ), 0.0, noise( (p.zx - mod( p.zx, vec2(1.0 / t) )) - vec2(-add, add), background_noise_length )),\r\n\t\t\t\t\t0.5\r\n\t\t\t\t);\r\n\r\n\t\t\t\talbedo = vec4(mix(\r\n\t\t\t\t\tmix( background_rise_up_color, backgorund_night_up_color, global_moon_light ),\r\n\t\t\t\t\tmix( background_rise_down_color, backgorund_night_down_color, global_moon_light ),\r\n\t\t\t\t\tmax( rab_liquid.x, rab_liquid.z )\r\n\t\t\t\t), 1.0);\r\n\t\t\t\tnormal = n - rab_liquid * rd * 0.25 * (1.0 - len);\r\n\t\t\t\tmaterial = mix( backgorund_material_up, background_material_down, (1.0 - max( rab_liquid.x, rab_liquid.y ) * (1.0 - len)) );\r\n\t\t\t\tbreak;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\telse\r\n\t{\r\n\t\tl = max_draw_distance;\r\n\t\talbedo = vec4(0.0);\r\n\t\tmaterial = vec3(0.0);\r\n\t\tnormal = vec3(0.0);\r\n\t\tobject = OBJECT_NONE;\r\n\t\tpoint = vec3(0.0);\r\n\r\n\t}\r\n\r\n}\r\n\r\nvec2 compactCheckerCoord ( const in vec2 uv, const in vec2 coord, const in vec2 resolution, const in vec2 viewport )\r\n{\r\n\treturn uv + (1.0 / resolution * vec2(modI( coord.y, 2.0 ) == 1.0, 0.0));\r\n\r\n}\r\n\r\nfloat destObject ( const in int object )\r\n{\r\n\treturn float(object);\r\n\r\n}\r\n\r\nvec3 destNormal ( const in vec3 normal )\r\n{\r\n\treturn normal * 0.5 + 0.5;\r\n\r\n}\r\n\r\nvoid main ()\r\n{\r\n\tTEXTURE_RESOLUTION = textureSize( texture_albedo_data, 0 );\r\n\tTILE_RESOLUTION = max_2d_texture_size - int(modI( float(max_2d_texture_size), float(tile_resolution) ));\r\n\r\n\tvec2 u = compactCheckerCoord( uv, gl_FragCoord.xy, resolution * vec2(2.0, 1.0), viewport );\r\n\tvec2 uu = aspectUV( u, resolution );\r\n\tint tile = getClusterTile( u );\r\n\r\n\tCLUSTER_START = tile == 0 ? 0 : getClusterLength( tile - 1 );\r\n\tBILLBOARD_LENGTH = getClusterLength( tile ) - CLUSTER_START;\r\n\tNOISE = noiseFade( u );\r\n\r\n\tvec3 rd = calcDirectionUV_Z( uu );\r\n\tvec3 rd_hud = calcDirectionHUD_UV_Z( uu );\r\n\tvec3 ro = position;\r\n\r\n\tfloat len = max_draw_distance;\r\n\tvec3 point;\r\n\tivec3 map;\r\n\tvec4 color; \r\n\tvec3 normal;\r\n\tvec3 world;\r\n\tint object;\r\n\tvec3 material;\r\n\tvec3 mask;\r\n\tint dimension;\r\n\tint index = -1;\r\n\tvec3 bpos;\r\n\tfloat bscale;\r\n\tfloat ao = 0.0;\r\n\r\n\tfloat limit = max_draw_distance;\r\n\r\n\tgetColorEmpty( point, map, color, object, material, mask );\r\n\tgetColorVoxel( rd, ro, limit, len, point, map, color, normal, world, object, material, mask, dimension );\r\n\r\n\tif (BILLBOARD_LENGTH > 0)\r\n\t{\r\n\t\tgetColorBillboard( rd, rd_hud, ro, len, point, color, normal, world, index, object, material, bpos, bscale );\r\n\r\n\t}\r\n\r\n\tif (object == OBJECT_NONE)\r\n\t{\r\n\t\tshadingNone( rd, ro, len, color, normal, material, point, object );\r\n\r\n\t}\r\n\r\n\tAlbedo = color;\r\n\tNormal = vec4(destNormal( normal ), 0.0);\r\n\tWorld = vec4(destNormal( world ), 0.0);\r\n\tMaterial = vec4(material, object);\r\n\tLocation = vec4(point, len);\r\n\tMask = vec4(mask, dimension);\r\n\tBillboardUV = vec4(bpos, bscale);\r\n\r\n}"},7988:(t,e,n)=>{"use strict";n.d(e,{Z:()=>r});const r="#version 300 es\r\n\r\n#define FLT_MIN 1.175494351e-38\r\n#define FLT_MAX 3.402823466e38\r\n#define FADE_LENGTH 5.0\r\n\r\n#define QUATER 0.7853981633974483\r\n#define HALF 1.5707963267948966\r\n#define PI 3.141592653589793\r\n#define CIRCLE 6.283185307179586\r\n\r\n#define hasInOfUV(uv) all(bvec4(greaterThanEqual(uv,vec2(0.0)),lessThan(uv,vec2(1.0))))\r\n\r\n#define SHADOW vec3(0.25)\r\n#define SLIGHT vec3(1.0)\r\n#define NLIGHT vec3(0.375, 0.375, 0.5)\r\n\r\n#define OBJECT_NONE 0\r\n#define OBJECT_HIT_GROUND 1\r\n#define OBJECT_HIT_VOXEL 2\r\n#define OBJECT_HIT_BILLBOARD 3\r\n#define OBJECT_HIT_HUD 4\r\n\r\nprecision highp int;\r\nprecision highp float;\r\nprecision highp sampler2D;\r\n\r\nuniform vec2 viewport;\r\nuniform vec2 resolution;\r\n\r\nuniform vec3 direction;\r\n\r\nuniform bool is_roughness;\r\nuniform float global_sun_light;\r\nuniform float global_moon_light;\r\nuniform int reflection_count;\r\nuniform float max_draw_distance;\r\n\r\nuniform sampler2D Material;\r\nuniform sampler2D Reflection;\r\nuniform sampler2D Roughness;\r\nuniform sampler2D ClipAlbedo;\r\nuniform sampler2D ClipSoftShadow;\r\nuniform sampler2D ClipRoughness;\r\nuniform sampler2D ClipSkybox;\r\n\r\nin vec2 uv;\r\nin vec2 dirX;\r\nin vec2 dirY;\r\nin vec2 dirZ;\r\n\r\nlayout (location = 0) out vec4 StackBloom;\r\n\r\nfloat modI ( const in float a, const in float b )\r\n{\r\n    float m = a - floor( (a + 0.5) / b ) * b;\r\n    \r\n    return floor( m + 0.5 );\r\n    \r\n}\r\n\r\nmat2 rotate ()\r\n{\r\n\tfloat c = dirZ.x;\r\n\tfloat s = dirZ.y;\r\n\r\n\treturn mat2(c, -s, s, c);\r\n\r\n}\r\n\r\nvec3 calcDirection ()\r\n{\r\n\tfloat xRotRads = direction.x;\r\n\tfloat yRotRads = direction.y;\r\n    vec3 dir;\r\n    float cosY = cos(yRotRads);\r\n\r\n    dir.x = sin(xRotRads) * cosY;\r\n    dir.y = -sin(yRotRads);\r\n    dir.z = cos(xRotRads) * cosY;\r\n\r\n    return dir;\r\n}\r\n\r\nvec2 aspectUV ( const in vec2 uv, const in vec2 viewport )\r\n{\r\n\tvec2 u = uv - 0.5;\r\n\r\n\tu *= viewport / viewport.y;\r\n\tu *= rotate();\r\n\t\r\n\treturn u + 0.5;\r\n\r\n}\r\n\r\nvec2 compactCheckerCoord ( const in vec2 uv, const in vec2 coord, const in vec2 resolution, const in vec2 viewport )\r\n{\r\n\treturn uv + (1.0 / resolution * vec2(modI( coord.y, 2.0 ) == 1.0, 0.0));\r\n\r\n}\r\n\r\nconst vec2 offset[3] = vec2[3](\r\n    vec2(-1, 0),\r\n    vec2( 0, 1),\r\n    vec2( 0,-1)\r\n);\r\n\r\nvec4 restoreHalfCheckerboardBuffer ( const in sampler2D tex, const in vec2 coord )\r\n{\r\n\tvec2 texSize = vec2(textureSize( tex, 0 ));\r\n\tfloat m = texSize.x * 2.0 / resolution.x;\r\n\tvec2 cd = floor( coord * m );\r\n\r\n\tivec2 pos = ivec2(floor( max( vec2(0.0), cd.xy - vec2(cd.x, 0.0) / vec2(2.0, 1.0) ) ));\r\n\r\n\tvec4 outCol = texelFetch(\r\n\t\ttex,\r\n\t\tpos,\r\n\t\t0\r\n\t);\r\n\r\n\tfloat div = 1.0;\r\n\r\n\tif (int(modI( cd.x, floor( 2.0 * m ) )) == int(modI( cd.y, floor( 2.0 * m ) )))\r\n\t{\r\n\t\tfor (int i = 0; i < 3; i++)\r\n\t\t{\r\n\t\t\tivec2 pos = ivec2(floor( max( vec2(0.0), cd.xy - (vec2(cd.x, 0.0) + offset[i] * vec2(m, 1.0)) / vec2(2.0, 1.0) ) ));\r\n\r\n\t\t\tif (all( bvec4(greaterThanEqual( vec2(pos), vec2(0.0) ), lessThan( vec2(pos), texSize ) ) ))\r\n\t\t\t{\r\n\t\t\t\toutCol += texelFetch(\r\n\t\t\t\t\ttex,\r\n\t\t\t\t\tpos,\r\n\t\t\t\t\t0\r\n\t\t\t\t);\r\n\r\n\t\t\t\tdiv++;\r\n\r\n\t\t\t}\r\n\t\t\r\n\t\t}\r\n\t}\r\n\r\n\treturn outCol / div;\r\n\t\r\n}\r\n\r\nvec4 restoreHalfCheckerboardBufferMax ( const in sampler2D tex, const in vec2 coord )\r\n{\r\n\tvec2 texSize = vec2(textureSize( tex, 0 ));\r\n\tfloat m = texSize.x * 2.0 / resolution.x;\r\n\tvec2 cd = floor( coord * m );\r\n\r\n\tivec2 pos = ivec2(floor( max( vec2(0.0), cd.xy - vec2(cd.x, 0.0) / vec2(2.0, 1.0) ) ));\r\n\r\n\tvec4 outCol = texelFetch(\r\n\t\ttex,\r\n\t\tpos,\r\n\t\t0\r\n\t);\r\n\r\n\tfloat div = 1.0;\r\n\r\n\tif (int(modI( cd.x, floor( 2.0 * m ) )) == int(modI( cd.y, floor( 2.0 * m ) )))\r\n\t{\r\n\t\tfor (int i = 0; i < 3; i++)\r\n\t\t{\r\n\t\t\tivec2 pos = ivec2(floor( max( vec2(0.0), cd.xy - (vec2(cd.x, 0.0) + offset[i] * vec2(m, 1.0)) / vec2(2.0, 1.0) ) ));\r\n\r\n\t\t\tif (all( bvec4(greaterThanEqual( vec2(pos), vec2(0.0) ), lessThan( vec2(pos), texSize ) ) ))\r\n\t\t\t{\r\n\t\t\t\toutCol = max( outCol, texelFetch(\r\n\t\t\t\t\ttex,\r\n\t\t\t\t\tpos,\r\n\t\t\t\t\t0\r\n\t\t\t\t) );\r\n\r\n\t\t\t}\r\n\t\t\r\n\t\t}\r\n\t\t\r\n\t}\r\n\r\n\treturn outCol / div;\r\n\r\n}\r\n\r\nvec3 bloom ( const in int low, const in int high, const in float radius, const in float quality, const in vec2 uv )\r\n{\r\n\tvec4 mat = restoreHalfCheckerboardBuffer( Material, uv * resolution );\r\n\tint object1 = int(ceil( mat.w ));\r\n\t\r\n\tbool isSky = object1 == OBJECT_NONE;\r\n\r\n\tbool isNone = object1 == OBJECT_NONE;\r\n\tbool isBright = all( equal( mat.rgb, vec3(0.0) ) );\r\n\r\n\tvec2 u = uv * resolution;\r\n\r\n\tif (\r\n\t\t!isSky &&\r\n\t\tisBright\r\n\t)\r\n\t{\r\n\t\treturn restoreHalfCheckerboardBuffer( ClipAlbedo, u ).rgb;\r\n\r\n\t}\r\n\telse\r\n\t{\r\n\t\tvec4 csky = restoreHalfCheckerboardBuffer( ClipSkybox, u );\r\n\t\tvec4 cbli2 = restoreHalfCheckerboardBuffer( ClipAlbedo, u );\r\n\t\tvec4 csha2 = restoreHalfCheckerboardBuffer( ClipSoftShadow, u );\r\n\t\tvec4 cref2 = restoreHalfCheckerboardBuffer( ClipRoughness, u );\r\n\t\tvec4 ref2 = restoreHalfCheckerboardBuffer( Roughness, u );\r\n\t\tfloat refLen = restoreHalfCheckerboardBufferMax( Reflection, u * resolution ).w;\r\n\r\n\t\tfloat refDist = max( 0.0, ref2.w - refLen );\r\n\t\tfloat refMax = max( 0.0, max_draw_distance - refLen );\r\n\t\tfloat refCover =  min( 1.0, refDist / refMax );\r\n\r\n\t\tcsha2 *= min( 1.0, reflection_count <= 0 ? 1.0 : is_roughness ? refLen == max_draw_distance && refCover == 0.0 ? 1.0 : refCover : (max_draw_distance <= ref2.w ? 1.0 : 0.0) );\r\n\t\tcsha2.rgb *= bool(csha2.w) && !isNone && !isBright ? min( 1.0,  reflection_count <= 0 ? 1.0 : is_roughness ? ref2.w / max_draw_distance : (max_draw_distance <= ref2.w ? 1.0 : 0.0) ) : 1.0;\r\n\r\n\t\treturn max( csky.rgb, max( cbli2.rgb, max( csha2.rgb, cref2.rgb ) ) );\r\n\r\n\t}\r\n\r\n}\r\n\r\nvoid main ()\r\n{\r\n\tvec2 u = gl_FragCoord.xy / viewport.xy;\r\n\r\n    StackBloom = vec4(bloom( 1, 8, 0.0125, 2.0, u ), 0.0);\r\n\r\n}"},8803:(t,e,n)=>{"use strict";n.d(e,{Z:()=>r});const r="#version 300 es\r\n\r\n#define FLT_MIN 1.175494351e-38\r\n#define FLT_MAX 3.402823466e38\r\n#define FADE_LENGTH 5.0\r\n#define SHADOW_FOG_LENGTH 10.0\r\n#define ROUGHNESS_LENGTH 2.5\r\n#define HASHSCALE 443.8975\r\n\r\n#define QUATER 0.7853981633974483\r\n#define HALF 1.5707963267948966\r\n#define PI 3.141592653589793\r\n#define CIRCLE 6.283185307179586\r\n\r\n#define hasInOfUV(uv) all(bvec4(greaterThanEqual(uv,vec2(0.0)),lessThan(uv,vec2(1.0))))\r\n\r\n#define SHADOW vec3(0.5)\r\n#define SLIGHT vec3(1.0)\r\n#define NLIGHT vec3(0.375, 0.375, 0.5)\r\n\r\n#define OBJECT_NONE 0\r\n#define OBJECT_HIT_GROUND 1\r\n#define OBJECT_HIT_VOXEL 2\r\n#define OBJECT_HIT_BILLBOARD 3\r\n#define OBJECT_HIT_HUD 4\r\n\r\nprecision highp int;\r\nprecision highp float;\r\nprecision highp sampler2D;\r\n\r\nuniform vec2 viewport;\r\nuniform vec2 resolution;\r\n\r\nuniform vec3 position;\r\nuniform vec3 direction;\r\n\r\nuniform sampler2D Lighting;\r\nuniform sampler2D ClipLighting;\r\nuniform sampler2D Reflection;\r\nuniform sampler2D ClipReflection;\r\n\r\nin vec2 uv;\r\n\r\nlayout (location = 0) out vec4 StackLighting;\r\nlayout (location = 1) out vec4 StackReflection;\r\nlayout (location = 2) out vec4 StackClipLighting;\r\nlayout (location = 3) out vec4 StackClipReflection;\r\n\r\nfloat modI ( const in float a, const in float b )\r\n{\r\n    float m = a - floor( (a + 0.5) / b ) * b;\r\n    \r\n    return floor( m + 0.5 );\r\n    \r\n}\r\n\r\nvec2 compactCheckerCoord ( const in vec2 uv, const in vec2 coord, const in vec2 resolution, const in vec2 viewport )\r\n{\r\n\treturn uv + (1.0 / resolution * vec2(modI( coord.y, 2.0 ) == 1.0, 0.0));\r\n\r\n}\r\n\r\nconst vec2 offset[3] = vec2[3](\r\n    vec2(-1, 0),\r\n    vec2( 0, 1),\r\n    vec2( 0,-1)\r\n);\r\n\r\nvec4 restoreHalfCheckerboardBuffer ( const in sampler2D tex, const in vec2 coord )\r\n{\r\n\tvec2 texSize = vec2(textureSize( tex, 0 ));\r\n\tfloat m = texSize.x * 2.0 / resolution.x;\r\n\tvec2 cd = floor( coord * m );\r\n\r\n\tivec2 pos = ivec2(floor( max( vec2(0.0), cd.xy - vec2(cd.x, 0.0) / vec2(2.0, 1.0) ) ));\r\n\r\n\tvec4 outCol = texelFetch(\r\n\t\ttex,\r\n\t\tpos,\r\n\t\t0\r\n\t);\r\n\r\n\tfloat div = 1.0;\r\n\r\n\tif (int(modI( cd.x, floor( 2.0 * m ) )) == int(modI( cd.y, floor( 2.0 * m ) )))\r\n\t{\r\n\t\tfor (int i = 0; i < 3; i++)\r\n\t\t{\r\n\t\t\tivec2 pos = ivec2(floor( max( vec2(0.0), cd.xy - (vec2(cd.x, 0.0) + offset[i] * vec2(m, 1.0)) / vec2(2.0, 1.0) ) ));\r\n\r\n\t\t\tif (all( bvec4(greaterThanEqual( vec2(pos), vec2(0.0) ), lessThan( vec2(pos), texSize ) ) ))\r\n\t\t\t{\r\n\t\t\t\toutCol += texelFetch(\r\n\t\t\t\t\ttex,\r\n\t\t\t\t\tpos,\r\n\t\t\t\t\t0\r\n\t\t\t\t);\r\n\r\n\t\t\t\tdiv++;\r\n\r\n\t\t\t}\r\n\t\t\r\n\t\t}\r\n\t}\r\n\r\n\treturn outCol / div;\r\n\t\r\n}\r\n\r\nvoid main ()\r\n{\r\n\tvec2 uv = gl_FragCoord.xy / viewport.xy;\r\n\r\n\tStackLighting = restoreHalfCheckerboardBuffer( Lighting, uv * resolution );\r\n\tStackReflection = restoreHalfCheckerboardBuffer( Reflection, uv * resolution );\r\n\tStackClipLighting = restoreHalfCheckerboardBuffer( ClipLighting, uv * resolution );\r\n\tStackClipReflection = restoreHalfCheckerboardBuffer( ClipReflection, uv * resolution );\r\n\r\n}"},1038:(t,e,n)=>{"use strict";n.d(e,{Z:()=>r});const r="#version 300 es\r\n\r\n#define EPSILON 0.00001\r\n#define FLT_MIN 1.175494351e-38\r\n#define FLT_MAX 3.402823466e38\r\n#define FADE_LENGTH 5.0\r\n#define MAX_LOOP 9999\r\n\r\n#define QUATER 0.7853981633974483\r\n#define HALF 1.5707963267948966\r\n#define PI 3.141592653589793\r\n#define CIRCLE 6.283185307179586\r\n\r\nprecision highp float;\r\nprecision highp int;\r\n\r\nuniform vec2 viewport;\r\nuniform vec2 resolution;\r\nuniform vec3 direction;\r\nuniform float fov;\r\nuniform float zoom;\r\n\r\nlayout(location = 0) in vec2 pos;\r\nlayout(location = 1) in vec2 tex;\r\n\r\nout vec2 uv;\r\nout vec2 dirX;\r\nout vec2 dirY;\r\nout vec2 dirZ;\r\nout vec2 dirZI;\r\nout vec2 dirYY;\r\n\r\nvoid main()\r\n{\r\n\tvec3 dir = vec3(\r\n\t\tdirection.x < EPSILON && direction.x > -EPSILON ? EPSILON : direction.x,\r\n\t\tdirection.y < EPSILON && direction.y > -EPSILON ? -EPSILON : direction.y,\r\n\t\tdirection.z\r\n\t);\r\n\r\n\tuv = vec2(tex.x, 1.0 - tex.y);\r\n\r\n\tdirX = vec2(\r\n\t\tcos( dir.x ),\r\n\t\tsin( dir.x )\r\n\t);\r\n\r\n\tdirY = vec2(\r\n\t\tcos( dir.y ),\r\n\t\tsin( dir.y )\r\n\t);\r\n\t\r\n\tdirZ = vec2(\r\n\t\tcos( dir.z ),\r\n\t\tsin( dir.z )\r\n\t);\r\n\t\r\n\tdirZI = vec2(\r\n\t\tcos( -dir.z ),\r\n\t\tsin( -dir.z )\r\n\t);\r\n\t\r\n\tdirYY = vec2(\r\n\t\tcos( dir.y - HALF ),\r\n\t\tsin( dir.y - HALF )\r\n\t);\r\n\t\r\n\tgl_Position = vec4(pos, 0.0, 1.0);\r\n\t\r\n}"},3484:(t,e,n)=>{"use strict";n.d(e,{Z:()=>r});const r="#version 300 es\r\n\r\nprecision highp int;\r\nprecision highp float;\r\nprecision highp sampler2D;\r\n\r\n#define QUATER 0.7853981633974483\r\n#define HALF 1.5707963267948966\r\n#define PI 3.141592653589793\r\n#define CIRCLE 6.283185307179586\r\n\r\nuniform sampler2D crt;\r\nuniform vec2 resolution;\r\nuniform float line;\r\nuniform float lens;\r\nuniform float deep;\r\nuniform float edge;\r\n\r\nin vec2 uv;\r\n\r\nout vec4 dest;\r\n\r\nbool hasOutScreen ( const in vec2 uv )\r\n{\r\n\treturn uv.x < 0.0 || uv.x > 1.0 || uv.y < 0.0 || uv.y > 1.0;\r\n\r\n}\r\n\r\nfloat udRoundBox ( const in vec2 p, const in vec2 b, const in float r )\r\n{\r\n\treturn length( max( abs( p ) - b + r, 0.0 ) ) - r;\r\n\r\n}\r\n\r\nbool hasOut ( vec2 fuv )\r\n{\r\n\treturn hasOutScreen( fuv ) || udRoundBox( fuv * resolution - resolution * 0.5, resolution * 0.5, min( resolution.x, resolution.y ) * edge ) > 0.0;\r\n\r\n}\r\n\r\nvec2 calcLensUV ( const in vec2 uv )\r\n{\r\n\tvec2 u = (uv - 0.5) * 2.0;\r\n\r\n\tvec2 par = vec2(\r\n\t\t(1.0 - abs( cos( u.y * QUATER ) )),\r\n\t\t(1.0 - abs( cos( u.x * QUATER ) ))\r\n\t\t\r\n\t);\r\n\r\n\tvec2 aspect = vec2(\r\n\t\t1.0 / (resolution.x / resolution.y),\r\n\t\t1.0 / (resolution.y / resolution.x)\r\n\r\n\t);\r\n\r\n\tpar.x = par.x * lens + (uv.y * deep);\r\n\tpar.y = par.y * (lens + par.x * uv.y * deep) + deep / 2.0;\r\n\r\n\tfloat depth = deep * lens;\r\n\r\n\tu *= 1.0 + par * aspect;\t\r\n\tu.y += (1.0 - abs( cos( u.x * QUATER ) )) * (1.0 - abs( u.y )) * (depth) - (depth) / 2.0;\r\n\r\n\treturn (u + 1.0) / 2.0;\r\n\t\r\n}\r\n\r\nfloat calcUV ( const in vec2 uv, const in float m )\r\n{\t\r\n\tfloat vig = (0.0 + 1.0 * 16.0 * uv.x * uv.y * (1.0 - uv.x) * (1.0 - uv.y));\r\n\t\r\n\treturn max( m, 1.0 - pow( vig, 1.0 ) );\r\n\r\n}\r\n\r\nvoid main ()\r\n{\r\n\tvec2 u = calcLensUV( uv );\r\n\tfloat vig = clamp( calcUV( u, 0.0 ), 0.25, 1.0 );\r\n\tfloat par = resolution.x < resolution.y ? resolution.x / 1280.0 : resolution.y / 720.0;\r\n\tvec3 b = textureLod( crt, uv, 5.0 * par ).rgb;\r\n\tvec3 color = min(\r\n\t\ttextureLod( crt, uv, 0.0 ).rgb,\r\n\t\tmin(\r\n\t\t\ttextureLod( crt, uv, vig * 2.5 ).rgb,\r\n\t\t\ttextureLod( crt, uv, vig * 5.0 ).rgb\r\n\t\t)\r\n\t);\r\n\r\n\tcolor += b * max( b.r, max( b.g, b.b ) ) * (line / 1.0);\r\n\tdest = vec4(color, 1.0);\r\n\t\r\n}\r\n"},3390:(t,e,n)=>{"use strict";n.d(e,{Z:()=>r});const r="#version 300 es\r\n\r\nprecision highp int;\r\nprecision highp float;\r\nprecision highp sampler2D;\r\n\r\nuniform vec2 resolution;\r\nuniform sampler2D screen;\r\n\r\nuniform float contrast;\r\nuniform float brightness;\r\n\r\nin vec2 uv;\r\n\r\nout vec4 dest;\r\n\r\nvoid main ()\r\n{\r\n    vec4 color = texture( screen, vec2(uv.x, 1.0 - uv.y) );\r\n    \r\n\tcolor.rgb *= brightness;\r\n\tcolor.rgb += color.rgb * (contrast - 1.0);\r\n\r\n    dest = color;\r\n\r\n}"},1321:(t,e,n)=>{"use strict";n.d(e,{Z:()=>r});const r="#version 300 es\r\n\r\nprecision highp int;\r\nprecision highp float;\r\nprecision highp sampler2D;\r\n\r\n#define QUATER 0.7853981633974483\r\n#define HALF 1.5707963267948966\r\n#define PI 3.141592653589793\r\n#define CIRCLE 6.283185307179586\r\n\r\nuniform sampler2D screen;\r\n\r\nuniform vec2 resolution;\r\nuniform float time;\r\n\r\nuniform float blink_force;\r\nuniform float blink_time;\r\nuniform float gamma;\r\nuniform float line;\r\nuniform float scanline;\r\nuniform float scanline_count;\r\nuniform float scanline_speed;\r\nuniform float disorder;\r\nuniform float disorder_count;\r\nuniform float vig;\r\nuniform vec2 sub;\r\nuniform float ca;\r\nuniform int shadowMask;\r\nuniform float lens;\r\nuniform float deep;\r\nuniform float edge;\r\n\r\nin vec2 uv;\r\n\r\nlayout (location = 0) out vec4 dest;\r\n\r\nfloat calcUV ( const in vec2 uv, const in float m )\r\n{\t\r\n\tfloat s = (0.0 + 1.0 * 16.0 * uv.x * uv.y * (1.0 - uv.x) * (1.0 - uv.y));\r\n\t\r\n\treturn max( m, s );\r\n\r\n}\r\n\r\nbool hasOutScreen ( const in vec2 uv )\r\n{\r\n\treturn uv.x < 0.0 || uv.x > 1.0 || uv.y < 0.0 || uv.y > 1.0;\r\n\r\n}\r\n\r\nfloat udRoundBox ( const in vec2 p, const in vec2 b, const in float r )\r\n{\r\n\treturn length( max( abs( p ) - b + r, 0.0 ) ) - r;\r\n\r\n}\r\n\r\nbool hasOut ( vec2 fuv )\r\n{\r\n\treturn hasOutScreen( fuv ) || udRoundBox( fuv * resolution - resolution * 0.5, resolution * 0.5, min( resolution.x, resolution.y ) * edge ) > 0.0;\r\n\r\n}\r\n\r\nbool hasCRTShadowMaskX ( const vec2 uv )\r\n{\r\n\treturn shadowMask == 1 && mod( uv.x * resolution.x, sub.x * 2.0 ) / sub.x > 1.0;\r\n\r\n}\r\n\r\nbool hasCRTShadowMaskY ( const vec2 uv )\r\n{\r\n\treturn shadowMask == 1 && mod( uv.y * resolution.y, sub.y * 2.0 ) / sub.y > 1.0;\r\n\r\n}\r\n\r\nvec3 calcCRTX ( const in vec3 color, const in vec2 uv )\r\n{\r\n\tfloat scan = mod(uv.x * resolution.x, sub.x) / sub.x * PI;\r\n\tfloat scansY = clamp( sin( scan ), 0.0, 1.0 );\r\n\tfloat sy = 0.5 + scansY * line * 0.5;\r\n\r\n\treturn color * sy;\r\n\r\n}\r\n\r\nvec3 calcCRTY ( const in vec3 color, const in vec2 uv )\r\n{   \r\n\tfloat scan = mod(uv.y * resolution.y, sub.y) / sub.y * PI;\r\n\tfloat scansX = clamp( sin( scan ), 0.0, 1.0 );\r\n\tfloat sx = 0.5 + scansX * line * 0.5;\r\n\r\n\treturn color * sx;\r\n\r\n}\r\n\r\nvec3 calcScanLine ( const in vec3 color, const in vec2 uv )\r\n{\r\n\tfloat scan = uv.y * scanline_count;\r\n\tfloat scansX = clamp( 0.35 + 0.35 * cos( scan + (time * scanline_speed * PI) ), 0.0, 1.0 );\r\n\tfloat sx = pow( scansX * scanline, 1.7 );\r\n\r\n\treturn color * vec3(0.4 + 0.75 * sx);\r\n\r\n}\r\n\r\nvec3 getColor ( const in vec2 uv )\r\n{\r\n\tvec3 color = hasOut( uv ) ? vec3(0.0) : texture( screen, vec2(uv.x, 1.0 - uv.y)).rgb;\r\n\r\n\tcolor = pow( color, vec3(1.0 / gamma) );\r\n\tcolor = color + color * 1.625 / (line / 1.0);\r\n\r\n\tcolor = calcCRTX( color, uv );\r\n\tcolor = calcCRTY( color, uv );\r\n\r\n\treturn color;\r\n\r\n}\r\n\r\nvec2 calcLensUV ( const in vec2 uv )\r\n{\r\n\tvec2 u = (uv - 0.5) * 2.0;\r\n\r\n\tvec2 par = vec2(\r\n\t\t(1.0 - abs( cos( u.y * QUATER ) )),\r\n\t\t(1.0 - abs( cos( u.x * QUATER ) ))\r\n\t\t\r\n\t);\r\n\r\n\tvec2 aspect = vec2(\r\n\t\t1.0 / (resolution.x / resolution.y),\r\n\t\t1.0 / (resolution.y / resolution.x)\r\n\r\n\t);\r\n\r\n\tpar.x = par.x * lens + (uv.y * deep);\r\n\tpar.y = par.y * (lens + par.x * uv.y * deep) + deep / 2.0;\r\n\r\n\tfloat depth = deep * lens;\r\n\r\n\tu *= 1.0 + par * aspect;\t\r\n\tu.y += (1.0 - abs( cos( u.x * QUATER ) )) * (1.0 - abs( u.y )) * depth;\r\n\r\n\treturn (u + 1.0) / 2.0;\r\n\t\r\n}\r\n\r\nvec3 calcChromaticAberration ( const in vec2 fuv )\r\n{\r\n    vec2 texel = 1.0 / resolution;\r\n    vec2 coords = (fuv - 0.5) * 2.0;\r\n    float coordDot = dot( coords, coords );\r\n    vec2 precompute = ca * coordDot * coords;\r\n\r\n    bool x = hasCRTShadowMaskX( fuv );\r\n\tbool y = hasCRTShadowMaskY( fuv );\r\n    \r\n    vec2 u = fuv + vec2(0.0, x ? 0.0 : 1.0 / resolution.y * sub.y / 2.0 );\r\n    \r\n\tvec2 red = u - texel.xy * precompute;\r\n\tvec2 green = u;\r\n\tvec2 blue = u + texel.xy * precompute;\r\n    \r\n    vec3 o = getColor( fuv );\r\n    \r\n    if (!hasOut( red ))\r\n    {\r\n        o.r = getColor( red ).r;\r\n\r\n    }\r\n\r\n    if (!hasOut( green ))\r\n    {\r\n        o.g = getColor( green ).g;\r\n\r\n    }\r\n\r\n    if (!hasOut( blue ))\r\n    {\r\n        o.b = getColor( blue ).b;\r\n\r\n    }\r\n    \r\n\treturn o;\r\n\r\n}\r\n\r\nvec3 calcVig ( const in vec3 color, const in vec2 uv )\r\n{\r\n\tfloat v = (0.0 + 1.0 * 16.0 * uv.x * uv.y * (1.0 - uv.x) * (1.0 - uv.y));\r\n\r\n\treturn color * vec3(pow( v, vig ));\r\n\t\r\n}\r\n\r\nvec3 calcBlink ( const in vec3 color, const in vec2 uv )\r\n{\r\n\tvec3 col = color;\r\n\r\n\tcol *= 1.0 + blink_force * sin( 110.0 * (time * blink_time) );\r\n\r\n\treturn col;\r\n\r\n}\r\n\r\nvoid main ()\r\n{\r\n\tvec2 u = calcLensUV( uv );\r\n\tvec3 color = vec3(0.0);\r\n\r\n\tif (!hasOut( u ))\r\n\t{\r\n\t\tcolor = calcChromaticAberration( u );\r\n\t\tcolor = calcScanLine( color, u );\r\n\t\tcolor = calcBlink( color, uv );\r\n\t\tcolor = calcVig( color, u );\r\n\t\t\r\n\t}\r\n\t\r\n\tdest = vec4(color, 1.0);\r\n}"},8355:(t,e,n)=>{"use strict";n.d(e,{Z:()=>r});const r="#version 300 es\r\n\r\nprecision highp int;\r\nprecision highp float;\r\nprecision highp sampler2D;\r\n\r\n#define PI 3.141592653589793\r\n#define CIRCLE 6.283185307179586\r\n\r\nuniform sampler2D screen;\r\nuniform vec2 resolution;\r\n\r\nuniform float contrast;\r\nuniform float brightness;\r\n\r\nin vec2 uv;\r\n\r\nlayout (location = 0) out vec4 dest;\r\n\r\nconst float factor = 32.0;\r\n\r\nconst mat4 table = mat4(\r\n    -4.0, 0.0, -3.0, 1.0,\r\n    2.0, -2.0, 3.0, -1.0,\r\n    -3.0, 1.0, -4.0, 0.0,\r\n    3.0, -1.0, 2.0, -2.0\r\n);\r\n\r\nvec3 calc ( const in vec3 color, const in vec2 uv )\r\n{\r\n    vec3 col = color;\r\n    \r\n    col += table[int(uv.x) % 4][int(uv.y) % 4] * 0.005;  \r\n\r\n    return floor( col * factor ) / factor; \r\n}\r\n\r\nvec3 getColor ( const in vec2 uv )\r\n{\r\n\treturn texture( screen, uv ).rgb;\r\n\t\r\n}\r\n\r\nvoid main ()\r\n{\r\n\tvec3 color = getColor( uv );\r\n\t\r\n\tcolor = calc( color, uv );\r\n\tcolor.rgb *= brightness;\r\n\tcolor.rgb += color.rgb * (contrast - 1.0);\r\n\t\r\n\tdest = vec4(color, 1.0);\r\n\t\r\n}"},5227:(t,e,n)=>{"use strict";n.d(e,{Z:()=>r});const r="#version 300 es\r\n\r\nprecision highp float;\r\nprecision highp int;\r\n\r\nlayout(location = 0) in vec2 pos;\r\nlayout(location = 1) in vec2 tex;\r\n\r\nout vec2 uv;\r\n\r\nvoid main()\r\n{\r\n\tuv = vec2(tex.x, 1.0 - tex.y);\r\n\tgl_Position = vec4(pos, 0.0, 1.0);\r\n\t\r\n}"}},a={};function l(t){var e=a[t];if(void 0!==e)return e.exports;var n=a[t]={exports:{}};return s[t].call(n.exports,n,n.exports,l),n.exports}t="function"==typeof Symbol?Symbol("webpack then"):"__webpack_then__",e="function"==typeof Symbol?Symbol("webpack exports"):"__webpack_exports__",n="function"==typeof Symbol?Symbol("webpack error"):"__webpack_error__",r=t=>{t&&(t.forEach((t=>t.r--)),t.forEach((t=>t.r--?t.r++:t())))},i=t=>!--t.r&&t(),o=(t,e)=>t?t.push(e):i(e),l.a=(s,a,l)=>{var c,d,u,h=l&&[],f=s.exports,g=!0,m=!1,p=(e,n,r)=>{m||(m=!0,n.r+=e.length,e.map(((e,i)=>e[t](n,r))),m=!1)},v=new Promise(((t,e)=>{u=e,d=()=>(t(f),r(h),h=0)}));v[e]=f,v[t]=(t,e)=>{if(g)return i(t);c&&p(c,t,e),o(h,t),v.catch(e)},s.exports=v,a((s=>{var a;c=(s=>s.map((s=>{if(null!==s&&"object"==typeof s){if(s[t])return s;if(s.then){var a=[];s.then((t=>{l[e]=t,r(a),a=0}),(t=>{l[n]=t,r(a),a=0}));var l={};return l[t]=(t,e)=>(o(a,t),s.catch(e)),l}}var c={};return c[t]=t=>i(t),c[e]=s,c})))(s);var l=()=>c.map((t=>{if(t[n])throw t[n];return t[e]})),d=new Promise(((t,e)=>{(a=()=>t(l)).r=0,p(c,a,e)}));return a.r?d:l()}),(t=>(t&&u(v[n]=t),d()))),g=!1},l.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return l.d(e,{a:e}),e},l.d=(t,e)=>{for(var n in e)l.o(e,n)&&!l.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},l.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),l.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);l(1528)})();