/*!
 * bowser@2.11.0 (MIT)
 *   author: Dustin Diaz <dustin@dustindiaz.com> (http://dustindiaz.com)
 *   url: git+https://github.com/lancedikson/bowser.git
 *   contributors:
 *     Denis Demchenko (http://twitter.com/lancedikson)
 *
 *   Copyright 2015, Dustin Diaz (the "Original Author")
 *   All rights reserved.
 *
 *   MIT License
 *
 *   Permission is hereby granted, free of charge, to any person
 *   obtaining a copy of this software and associated documentation
 *   files (the "Software"), to deal in the Software without
 *   restriction, including without limitation the rights to use,
 *   copy, modify, merge, publish, distribute, sublicense, and/or sell
 *   copies of the Software, and to permit persons to whom the
 *   Software is furnished to do so, subject to the following
 *   conditions:
 *
 *   The above copyright notice and this permission notice shall be
 *   included in all copies or substantial portions of the Software.
 *
 *   Distributions of all or part of the Software intended to be used
 *   by the recipients as they would use the unmodified Software,
 *   containing modifications that substantially alter, remove, or
 *   disable functionality of the Software, outside of the documented
 *   configuration mechanisms provided by the Software, shall be
 *   modified such that the Original Author's bug reporting email
 *   addresses and urls are either replaced with the contact information
 *   of the parties responsible for the changes, or removed entirely.
 *
 *   THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 *   EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
 *   OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 *   NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
 *   HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
 *   WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
 *   FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
 *   OTHER DEALINGS IN THE SOFTWARE.
 *
 *
 *   Except where noted, this license applies to any and all software
 *   programs and associated documentation files created by the
 *   Original Author, when distributed with the Software.
 *
 *
 *
 * fast-copy@2.1.3 (MIT)
 *   author: tony_quetano@planttheidea.com
 *   url: git+https://github.com/planttheidea/fast-copy.git
 *   contributors:
 *     Dariusz Rzepka <rzepkadarek@gmail.com>
 *
 *   MIT License
 *
 *   Copyright (c) 2018 Tony Quetano
 *
 *   Permission is hereby granted, free of charge, to any person obtaining a copy
 *   of this software and associated documentation files (the "Software"), to deal
 *   in the Software without restriction, including without limitation the rights
 *   to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 *   copies of the Software, and to permit persons to whom the Software is
 *   furnished to do so, subject to the following conditions:
 *
 *   The above copyright notice and this permission notice shall be included in all
 *   copies or substantial portions of the Software.
 *
 *   THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 *   IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 *   FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 *   AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 *   LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 *   OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 *   SOFTWARE.
 *
 *
 *
 * is-electron@2.2.1 (MIT)
 *   author: Cheton Wu <cheton@gmail.com>
 *   url: git@github.com:cheton/is-electron.git
 *
 *   The MIT License (MIT)
 *
 *   Copyright (c) 2016-2018 Cheton Wu
 *
 *   Permission is hereby granted, free of charge, to any person obtaining a copy
 *   of this software and associated documentation files (the "Software"), to deal
 *   in the Software without restriction, including without limitation the rights
 *   to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 *   copies of the Software, and to permit persons to whom the Software is
 *   furnished to do so, subject to the following conditions:
 *
 *   The above copyright notice and this permission notice shall be included in all
 *   copies or substantial portions of the Software.
 *
 *   THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 *   IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 *   FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 *   AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 *   LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 *   OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 *   SOFTWARE.
 *
 *
 *
 * is-mobile@3.1.1 (MIT)
 *   author: Julian Gruber (http://juliangruber.com)
 *   url: git://github.com/juliangruber/is-mobile.git
 *
 *
 */
/*! For license information please see worker.tick.js.LICENSE.txt */
(()=>{var e={762:function(e){e.exports=function(e){var t={};function n(i){if(t[i])return t[i].exports;var s=t[i]={i,l:!1,exports:{}};return e[i].call(s.exports,s,s.exports,n),s.l=!0,s.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)n.d(i,s,function(t){return e[t]}.bind(null,s));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=90)}({17:function(e,t,n){"use strict";t.__esModule=!0,t.default=void 0;var i=n(18),s=function(){function e(){}return e.getFirstMatch=function(e,t){var n=t.match(e);return n&&n.length>0&&n[1]||""},e.getSecondMatch=function(e,t){var n=t.match(e);return n&&n.length>1&&n[2]||""},e.matchAndReturnConst=function(e,t,n){if(e.test(t))return n},e.getWindowsVersionName=function(e){switch(e){case"NT":return"NT";case"XP":case"NT 5.1":return"XP";case"NT 5.0":return"2000";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}},e.getMacOSVersionName=function(e){var t=e.split(".").splice(0,2).map((function(e){return parseInt(e,10)||0}));if(t.push(0),10===t[0])switch(t[1]){case 5:return"Leopard";case 6:return"Snow Leopard";case 7:return"Lion";case 8:return"Mountain Lion";case 9:return"Mavericks";case 10:return"Yosemite";case 11:return"El Capitan";case 12:return"Sierra";case 13:return"High Sierra";case 14:return"Mojave";case 15:return"Catalina";default:return}},e.getAndroidVersionName=function(e){var t=e.split(".").splice(0,2).map((function(e){return parseInt(e,10)||0}));if(t.push(0),!(1===t[0]&&t[1]<5))return 1===t[0]&&t[1]<6?"Cupcake":1===t[0]&&t[1]>=6?"Donut":2===t[0]&&t[1]<2?"Eclair":2===t[0]&&2===t[1]?"Froyo":2===t[0]&&t[1]>2?"Gingerbread":3===t[0]?"Honeycomb":4===t[0]&&t[1]<1?"Ice Cream Sandwich":4===t[0]&&t[1]<4?"Jelly Bean":4===t[0]&&t[1]>=4?"KitKat":5===t[0]?"Lollipop":6===t[0]?"Marshmallow":7===t[0]?"Nougat":8===t[0]?"Oreo":9===t[0]?"Pie":void 0},e.getVersionPrecision=function(e){return e.split(".").length},e.compareVersions=function(t,n,i){void 0===i&&(i=!1);var s=e.getVersionPrecision(t),o=e.getVersionPrecision(n),a=Math.max(s,o),r=0,l=e.map([t,n],(function(t){var n=a-e.getVersionPrecision(t),i=t+new Array(n+1).join(".0");return e.map(i.split("."),(function(e){return new Array(20-e.length).join("0")+e})).reverse()}));for(i&&(r=a-Math.min(s,o)),a-=1;a>=r;){if(l[0][a]>l[1][a])return 1;if(l[0][a]===l[1][a]){if(a===r)return 0;a-=1}else if(l[0][a]<l[1][a])return-1}},e.map=function(e,t){var n,i=[];if(Array.prototype.map)return Array.prototype.map.call(e,t);for(n=0;n<e.length;n+=1)i.push(t(e[n]));return i},e.find=function(e,t){var n,i;if(Array.prototype.find)return Array.prototype.find.call(e,t);for(n=0,i=e.length;n<i;n+=1){var s=e[n];if(t(s,n))return s}},e.assign=function(e){for(var t,n,i=e,s=arguments.length,o=new Array(s>1?s-1:0),a=1;a<s;a++)o[a-1]=arguments[a];if(Object.assign)return Object.assign.apply(Object,[e].concat(o));var r=function(){var e=o[t];"object"==typeof e&&null!==e&&Object.keys(e).forEach((function(t){i[t]=e[t]}))};for(t=0,n=o.length;t<n;t+=1)r();return e},e.getBrowserAlias=function(e){return i.BROWSER_ALIASES_MAP[e]},e.getBrowserTypeByAlias=function(e){return i.BROWSER_MAP[e]||""},e}();t.default=s,e.exports=t.default},18:function(e,t,n){"use strict";t.__esModule=!0,t.ENGINE_MAP=t.OS_MAP=t.PLATFORMS_MAP=t.BROWSER_MAP=t.BROWSER_ALIASES_MAP=void 0,t.BROWSER_ALIASES_MAP={"Amazon Silk":"amazon_silk","Android Browser":"android",Bada:"bada",BlackBerry:"blackberry",Chrome:"chrome",Chromium:"chromium",Electron:"electron",Epiphany:"epiphany",Firefox:"firefox",Focus:"focus",Generic:"generic","Google Search":"google_search",Googlebot:"googlebot","Internet Explorer":"ie","K-Meleon":"k_meleon",Maxthon:"maxthon","Microsoft Edge":"edge","MZ Browser":"mz","NAVER Whale Browser":"naver",Opera:"opera","Opera Coast":"opera_coast",PhantomJS:"phantomjs",Puffin:"puffin",QupZilla:"qupzilla",QQ:"qq",QQLite:"qqlite",Safari:"safari",Sailfish:"sailfish","Samsung Internet for Android":"samsung_internet",SeaMonkey:"seamonkey",Sleipnir:"sleipnir",Swing:"swing",Tizen:"tizen","UC Browser":"uc",Vivaldi:"vivaldi","WebOS Browser":"webos",WeChat:"wechat","Yandex Browser":"yandex",Roku:"roku"},t.BROWSER_MAP={amazon_silk:"Amazon Silk",android:"Android Browser",bada:"Bada",blackberry:"BlackBerry",chrome:"Chrome",chromium:"Chromium",electron:"Electron",epiphany:"Epiphany",firefox:"Firefox",focus:"Focus",generic:"Generic",googlebot:"Googlebot",google_search:"Google Search",ie:"Internet Explorer",k_meleon:"K-Meleon",maxthon:"Maxthon",edge:"Microsoft Edge",mz:"MZ Browser",naver:"NAVER Whale Browser",opera:"Opera",opera_coast:"Opera Coast",phantomjs:"PhantomJS",puffin:"Puffin",qupzilla:"QupZilla",qq:"QQ Browser",qqlite:"QQ Browser Lite",safari:"Safari",sailfish:"Sailfish",samsung_internet:"Samsung Internet for Android",seamonkey:"SeaMonkey",sleipnir:"Sleipnir",swing:"Swing",tizen:"Tizen",uc:"UC Browser",vivaldi:"Vivaldi",webos:"WebOS Browser",wechat:"WeChat",yandex:"Yandex Browser"},t.PLATFORMS_MAP={tablet:"tablet",mobile:"mobile",desktop:"desktop",tv:"tv"},t.OS_MAP={WindowsPhone:"Windows Phone",Windows:"Windows",MacOS:"macOS",iOS:"iOS",Android:"Android",WebOS:"WebOS",BlackBerry:"BlackBerry",Bada:"Bada",Tizen:"Tizen",Linux:"Linux",ChromeOS:"Chrome OS",PlayStation4:"PlayStation 4",Roku:"Roku"},t.ENGINE_MAP={EdgeHTML:"EdgeHTML",Blink:"Blink",Trident:"Trident",Presto:"Presto",Gecko:"Gecko",WebKit:"WebKit"}},90:function(e,t,n){"use strict";t.__esModule=!0,t.default=void 0;var i,s=(i=n(91))&&i.__esModule?i:{default:i},o=n(18);function a(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var r=function(){function e(){}var t,n,i;return e.getParser=function(e,t){if(void 0===t&&(t=!1),"string"!=typeof e)throw new Error("UserAgent should be a string");return new s.default(e,t)},e.parse=function(e){return new s.default(e).getResult()},t=e,i=[{key:"BROWSER_MAP",get:function(){return o.BROWSER_MAP}},{key:"ENGINE_MAP",get:function(){return o.ENGINE_MAP}},{key:"OS_MAP",get:function(){return o.OS_MAP}},{key:"PLATFORMS_MAP",get:function(){return o.PLATFORMS_MAP}}],(n=null)&&a(t.prototype,n),i&&a(t,i),e}();t.default=r,e.exports=t.default},91:function(e,t,n){"use strict";t.__esModule=!0,t.default=void 0;var i=l(n(92)),s=l(n(93)),o=l(n(94)),a=l(n(95)),r=l(n(17));function l(e){return e&&e.__esModule?e:{default:e}}var h=function(){function e(e,t){if(void 0===t&&(t=!1),null==e||""===e)throw new Error("UserAgent parameter can't be empty");this._ua=e,this.parsedResult={},!0!==t&&this.parse()}var t=e.prototype;return t.getUA=function(){return this._ua},t.test=function(e){return e.test(this._ua)},t.parseBrowser=function(){var e=this;this.parsedResult.browser={};var t=r.default.find(i.default,(function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some((function(t){return e.test(t)}));throw new Error("Browser's test function is not valid")}));return t&&(this.parsedResult.browser=t.describe(this.getUA())),this.parsedResult.browser},t.getBrowser=function(){return this.parsedResult.browser?this.parsedResult.browser:this.parseBrowser()},t.getBrowserName=function(e){return e?String(this.getBrowser().name).toLowerCase()||"":this.getBrowser().name||""},t.getBrowserVersion=function(){return this.getBrowser().version},t.getOS=function(){return this.parsedResult.os?this.parsedResult.os:this.parseOS()},t.parseOS=function(){var e=this;this.parsedResult.os={};var t=r.default.find(s.default,(function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some((function(t){return e.test(t)}));throw new Error("Browser's test function is not valid")}));return t&&(this.parsedResult.os=t.describe(this.getUA())),this.parsedResult.os},t.getOSName=function(e){var t=this.getOS().name;return e?String(t).toLowerCase()||"":t||""},t.getOSVersion=function(){return this.getOS().version},t.getPlatform=function(){return this.parsedResult.platform?this.parsedResult.platform:this.parsePlatform()},t.getPlatformType=function(e){void 0===e&&(e=!1);var t=this.getPlatform().type;return e?String(t).toLowerCase()||"":t||""},t.parsePlatform=function(){var e=this;this.parsedResult.platform={};var t=r.default.find(o.default,(function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some((function(t){return e.test(t)}));throw new Error("Browser's test function is not valid")}));return t&&(this.parsedResult.platform=t.describe(this.getUA())),this.parsedResult.platform},t.getEngine=function(){return this.parsedResult.engine?this.parsedResult.engine:this.parseEngine()},t.getEngineName=function(e){return e?String(this.getEngine().name).toLowerCase()||"":this.getEngine().name||""},t.parseEngine=function(){var e=this;this.parsedResult.engine={};var t=r.default.find(a.default,(function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some((function(t){return e.test(t)}));throw new Error("Browser's test function is not valid")}));return t&&(this.parsedResult.engine=t.describe(this.getUA())),this.parsedResult.engine},t.parse=function(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this},t.getResult=function(){return r.default.assign({},this.parsedResult)},t.satisfies=function(e){var t=this,n={},i=0,s={},o=0;if(Object.keys(e).forEach((function(t){var a=e[t];"string"==typeof a?(s[t]=a,o+=1):"object"==typeof a&&(n[t]=a,i+=1)})),i>0){var a=Object.keys(n),l=r.default.find(a,(function(e){return t.isOS(e)}));if(l){var h=this.satisfies(n[l]);if(void 0!==h)return h}var p=r.default.find(a,(function(e){return t.isPlatform(e)}));if(p){var c=this.satisfies(n[p]);if(void 0!==c)return c}}if(o>0){var d=Object.keys(s),u=r.default.find(d,(function(e){return t.isBrowser(e,!0)}));if(void 0!==u)return this.compareVersion(s[u])}},t.isBrowser=function(e,t){void 0===t&&(t=!1);var n=this.getBrowserName().toLowerCase(),i=e.toLowerCase(),s=r.default.getBrowserTypeByAlias(i);return t&&s&&(i=s.toLowerCase()),i===n},t.compareVersion=function(e){var t=[0],n=e,i=!1,s=this.getBrowserVersion();if("string"==typeof s)return">"===e[0]||"<"===e[0]?(n=e.substr(1),"="===e[1]?(i=!0,n=e.substr(2)):t=[],">"===e[0]?t.push(1):t.push(-1)):"="===e[0]?n=e.substr(1):"~"===e[0]&&(i=!0,n=e.substr(1)),t.indexOf(r.default.compareVersions(s,n,i))>-1},t.isOS=function(e){return this.getOSName(!0)===String(e).toLowerCase()},t.isPlatform=function(e){return this.getPlatformType(!0)===String(e).toLowerCase()},t.isEngine=function(e){return this.getEngineName(!0)===String(e).toLowerCase()},t.is=function(e,t){return void 0===t&&(t=!1),this.isBrowser(e,t)||this.isOS(e)||this.isPlatform(e)},t.some=function(e){var t=this;return void 0===e&&(e=[]),e.some((function(e){return t.is(e)}))},e}();t.default=h,e.exports=t.default},92:function(e,t,n){"use strict";t.__esModule=!0,t.default=void 0;var i,s=(i=n(17))&&i.__esModule?i:{default:i},o=/version\/(\d+(\.?_?\d+)+)/i,a=[{test:[/googlebot/i],describe:function(e){var t={name:"Googlebot"},n=s.default.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,e)||s.default.getFirstMatch(o,e);return n&&(t.version=n),t}},{test:[/opera/i],describe:function(e){var t={name:"Opera"},n=s.default.getFirstMatch(o,e)||s.default.getFirstMatch(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/opr\/|opios/i],describe:function(e){var t={name:"Opera"},n=s.default.getFirstMatch(/(?:opr|opios)[\s/](\S+)/i,e)||s.default.getFirstMatch(o,e);return n&&(t.version=n),t}},{test:[/SamsungBrowser/i],describe:function(e){var t={name:"Samsung Internet for Android"},n=s.default.getFirstMatch(o,e)||s.default.getFirstMatch(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/Whale/i],describe:function(e){var t={name:"NAVER Whale Browser"},n=s.default.getFirstMatch(o,e)||s.default.getFirstMatch(/(?:whale)[\s/](\d+(?:\.\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/MZBrowser/i],describe:function(e){var t={name:"MZ Browser"},n=s.default.getFirstMatch(/(?:MZBrowser)[\s/](\d+(?:\.\d+)+)/i,e)||s.default.getFirstMatch(o,e);return n&&(t.version=n),t}},{test:[/focus/i],describe:function(e){var t={name:"Focus"},n=s.default.getFirstMatch(/(?:focus)[\s/](\d+(?:\.\d+)+)/i,e)||s.default.getFirstMatch(o,e);return n&&(t.version=n),t}},{test:[/swing/i],describe:function(e){var t={name:"Swing"},n=s.default.getFirstMatch(/(?:swing)[\s/](\d+(?:\.\d+)+)/i,e)||s.default.getFirstMatch(o,e);return n&&(t.version=n),t}},{test:[/coast/i],describe:function(e){var t={name:"Opera Coast"},n=s.default.getFirstMatch(o,e)||s.default.getFirstMatch(/(?:coast)[\s/](\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/opt\/\d+(?:.?_?\d+)+/i],describe:function(e){var t={name:"Opera Touch"},n=s.default.getFirstMatch(/(?:opt)[\s/](\d+(\.?_?\d+)+)/i,e)||s.default.getFirstMatch(o,e);return n&&(t.version=n),t}},{test:[/yabrowser/i],describe:function(e){var t={name:"Yandex Browser"},n=s.default.getFirstMatch(/(?:yabrowser)[\s/](\d+(\.?_?\d+)+)/i,e)||s.default.getFirstMatch(o,e);return n&&(t.version=n),t}},{test:[/ucbrowser/i],describe:function(e){var t={name:"UC Browser"},n=s.default.getFirstMatch(o,e)||s.default.getFirstMatch(/(?:ucbrowser)[\s/](\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/Maxthon|mxios/i],describe:function(e){var t={name:"Maxthon"},n=s.default.getFirstMatch(o,e)||s.default.getFirstMatch(/(?:Maxthon|mxios)[\s/](\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/epiphany/i],describe:function(e){var t={name:"Epiphany"},n=s.default.getFirstMatch(o,e)||s.default.getFirstMatch(/(?:epiphany)[\s/](\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/puffin/i],describe:function(e){var t={name:"Puffin"},n=s.default.getFirstMatch(o,e)||s.default.getFirstMatch(/(?:puffin)[\s/](\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/sleipnir/i],describe:function(e){var t={name:"Sleipnir"},n=s.default.getFirstMatch(o,e)||s.default.getFirstMatch(/(?:sleipnir)[\s/](\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/k-meleon/i],describe:function(e){var t={name:"K-Meleon"},n=s.default.getFirstMatch(o,e)||s.default.getFirstMatch(/(?:k-meleon)[\s/](\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/micromessenger/i],describe:function(e){var t={name:"WeChat"},n=s.default.getFirstMatch(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,e)||s.default.getFirstMatch(o,e);return n&&(t.version=n),t}},{test:[/qqbrowser/i],describe:function(e){var t={name:/qqbrowserlite/i.test(e)?"QQ Browser Lite":"QQ Browser"},n=s.default.getFirstMatch(/(?:qqbrowserlite|qqbrowser)[/](\d+(\.?_?\d+)+)/i,e)||s.default.getFirstMatch(o,e);return n&&(t.version=n),t}},{test:[/msie|trident/i],describe:function(e){var t={name:"Internet Explorer"},n=s.default.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/\sedg\//i],describe:function(e){var t={name:"Microsoft Edge"},n=s.default.getFirstMatch(/\sedg\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/edg([ea]|ios)/i],describe:function(e){var t={name:"Microsoft Edge"},n=s.default.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/vivaldi/i],describe:function(e){var t={name:"Vivaldi"},n=s.default.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/seamonkey/i],describe:function(e){var t={name:"SeaMonkey"},n=s.default.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/sailfish/i],describe:function(e){var t={name:"Sailfish"},n=s.default.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i,e);return n&&(t.version=n),t}},{test:[/silk/i],describe:function(e){var t={name:"Amazon Silk"},n=s.default.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/phantom/i],describe:function(e){var t={name:"PhantomJS"},n=s.default.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/slimerjs/i],describe:function(e){var t={name:"SlimerJS"},n=s.default.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(e){var t={name:"BlackBerry"},n=s.default.getFirstMatch(o,e)||s.default.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/(web|hpw)[o0]s/i],describe:function(e){var t={name:"WebOS Browser"},n=s.default.getFirstMatch(o,e)||s.default.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/bada/i],describe:function(e){var t={name:"Bada"},n=s.default.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/tizen/i],describe:function(e){var t={name:"Tizen"},n=s.default.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,e)||s.default.getFirstMatch(o,e);return n&&(t.version=n),t}},{test:[/qupzilla/i],describe:function(e){var t={name:"QupZilla"},n=s.default.getFirstMatch(/(?:qupzilla)[\s/](\d+(\.?_?\d+)+)/i,e)||s.default.getFirstMatch(o,e);return n&&(t.version=n),t}},{test:[/firefox|iceweasel|fxios/i],describe:function(e){var t={name:"Firefox"},n=s.default.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/electron/i],describe:function(e){var t={name:"Electron"},n=s.default.getFirstMatch(/(?:electron)\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/MiuiBrowser/i],describe:function(e){var t={name:"Miui"},n=s.default.getFirstMatch(/(?:MiuiBrowser)[\s/](\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/chromium/i],describe:function(e){var t={name:"Chromium"},n=s.default.getFirstMatch(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,e)||s.default.getFirstMatch(o,e);return n&&(t.version=n),t}},{test:[/chrome|crios|crmo/i],describe:function(e){var t={name:"Chrome"},n=s.default.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/GSA/i],describe:function(e){var t={name:"Google Search"},n=s.default.getFirstMatch(/(?:GSA)\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:function(e){var t=!e.test(/like android/i),n=e.test(/android/i);return t&&n},describe:function(e){var t={name:"Android Browser"},n=s.default.getFirstMatch(o,e);return n&&(t.version=n),t}},{test:[/playstation 4/i],describe:function(e){var t={name:"PlayStation 4"},n=s.default.getFirstMatch(o,e);return n&&(t.version=n),t}},{test:[/safari|applewebkit/i],describe:function(e){var t={name:"Safari"},n=s.default.getFirstMatch(o,e);return n&&(t.version=n),t}},{test:[/.*/i],describe:function(e){var t=-1!==e.search("\\(")?/^(.*)\/(.*)[ \t]\((.*)/:/^(.*)\/(.*) /;return{name:s.default.getFirstMatch(t,e),version:s.default.getSecondMatch(t,e)}}}];t.default=a,e.exports=t.default},93:function(e,t,n){"use strict";t.__esModule=!0,t.default=void 0;var i,s=(i=n(17))&&i.__esModule?i:{default:i},o=n(18),a=[{test:[/Roku\/DVP/],describe:function(e){var t=s.default.getFirstMatch(/Roku\/DVP-(\d+\.\d+)/i,e);return{name:o.OS_MAP.Roku,version:t}}},{test:[/windows phone/i],describe:function(e){var t=s.default.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,e);return{name:o.OS_MAP.WindowsPhone,version:t}}},{test:[/windows /i],describe:function(e){var t=s.default.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i,e),n=s.default.getWindowsVersionName(t);return{name:o.OS_MAP.Windows,version:t,versionName:n}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(e){var t={name:o.OS_MAP.iOS},n=s.default.getSecondMatch(/(Version\/)(\d[\d.]+)/,e);return n&&(t.version=n),t}},{test:[/macintosh/i],describe:function(e){var t=s.default.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,e).replace(/[_\s]/g,"."),n=s.default.getMacOSVersionName(t),i={name:o.OS_MAP.MacOS,version:t};return n&&(i.versionName=n),i}},{test:[/(ipod|iphone|ipad)/i],describe:function(e){var t=s.default.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,e).replace(/[_\s]/g,".");return{name:o.OS_MAP.iOS,version:t}}},{test:function(e){var t=!e.test(/like android/i),n=e.test(/android/i);return t&&n},describe:function(e){var t=s.default.getFirstMatch(/android[\s/-](\d+(\.\d+)*)/i,e),n=s.default.getAndroidVersionName(t),i={name:o.OS_MAP.Android,version:t};return n&&(i.versionName=n),i}},{test:[/(web|hpw)[o0]s/i],describe:function(e){var t=s.default.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,e),n={name:o.OS_MAP.WebOS};return t&&t.length&&(n.version=t),n}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(e){var t=s.default.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i,e)||s.default.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i,e)||s.default.getFirstMatch(/\bbb(\d+)/i,e);return{name:o.OS_MAP.BlackBerry,version:t}}},{test:[/bada/i],describe:function(e){var t=s.default.getFirstMatch(/bada\/(\d+(\.\d+)*)/i,e);return{name:o.OS_MAP.Bada,version:t}}},{test:[/tizen/i],describe:function(e){var t=s.default.getFirstMatch(/tizen[/\s](\d+(\.\d+)*)/i,e);return{name:o.OS_MAP.Tizen,version:t}}},{test:[/linux/i],describe:function(){return{name:o.OS_MAP.Linux}}},{test:[/CrOS/],describe:function(){return{name:o.OS_MAP.ChromeOS}}},{test:[/PlayStation 4/],describe:function(e){var t=s.default.getFirstMatch(/PlayStation 4[/\s](\d+(\.\d+)*)/i,e);return{name:o.OS_MAP.PlayStation4,version:t}}}];t.default=a,e.exports=t.default},94:function(e,t,n){"use strict";t.__esModule=!0,t.default=void 0;var i,s=(i=n(17))&&i.__esModule?i:{default:i},o=n(18),a=[{test:[/googlebot/i],describe:function(){return{type:"bot",vendor:"Google"}}},{test:[/huawei/i],describe:function(e){var t=s.default.getFirstMatch(/(can-l01)/i,e)&&"Nova",n={type:o.PLATFORMS_MAP.mobile,vendor:"Huawei"};return t&&(n.model=t),n}},{test:[/nexus\s*(?:7|8|9|10).*/i],describe:function(){return{type:o.PLATFORMS_MAP.tablet,vendor:"Nexus"}}},{test:[/ipad/i],describe:function(){return{type:o.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(){return{type:o.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/kftt build/i],describe:function(){return{type:o.PLATFORMS_MAP.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"}}},{test:[/silk/i],describe:function(){return{type:o.PLATFORMS_MAP.tablet,vendor:"Amazon"}}},{test:[/tablet(?! pc)/i],describe:function(){return{type:o.PLATFORMS_MAP.tablet}}},{test:function(e){var t=e.test(/ipod|iphone/i),n=e.test(/like (ipod|iphone)/i);return t&&!n},describe:function(e){var t=s.default.getFirstMatch(/(ipod|iphone)/i,e);return{type:o.PLATFORMS_MAP.mobile,vendor:"Apple",model:t}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe:function(){return{type:o.PLATFORMS_MAP.mobile,vendor:"Nexus"}}},{test:[/[^-]mobi/i],describe:function(){return{type:o.PLATFORMS_MAP.mobile}}},{test:function(e){return"blackberry"===e.getBrowserName(!0)},describe:function(){return{type:o.PLATFORMS_MAP.mobile,vendor:"BlackBerry"}}},{test:function(e){return"bada"===e.getBrowserName(!0)},describe:function(){return{type:o.PLATFORMS_MAP.mobile}}},{test:function(e){return"windows phone"===e.getBrowserName()},describe:function(){return{type:o.PLATFORMS_MAP.mobile,vendor:"Microsoft"}}},{test:function(e){var t=Number(String(e.getOSVersion()).split(".")[0]);return"android"===e.getOSName(!0)&&t>=3},describe:function(){return{type:o.PLATFORMS_MAP.tablet}}},{test:function(e){return"android"===e.getOSName(!0)},describe:function(){return{type:o.PLATFORMS_MAP.mobile}}},{test:function(e){return"macos"===e.getOSName(!0)},describe:function(){return{type:o.PLATFORMS_MAP.desktop,vendor:"Apple"}}},{test:function(e){return"windows"===e.getOSName(!0)},describe:function(){return{type:o.PLATFORMS_MAP.desktop}}},{test:function(e){return"linux"===e.getOSName(!0)},describe:function(){return{type:o.PLATFORMS_MAP.desktop}}},{test:function(e){return"playstation 4"===e.getOSName(!0)},describe:function(){return{type:o.PLATFORMS_MAP.tv}}},{test:function(e){return"roku"===e.getOSName(!0)},describe:function(){return{type:o.PLATFORMS_MAP.tv}}}];t.default=a,e.exports=t.default},95:function(e,t,n){"use strict";t.__esModule=!0,t.default=void 0;var i,s=(i=n(17))&&i.__esModule?i:{default:i},o=n(18),a=[{test:function(e){return"microsoft edge"===e.getBrowserName(!0)},describe:function(e){if(/\sedg\//i.test(e))return{name:o.ENGINE_MAP.Blink};var t=s.default.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i,e);return{name:o.ENGINE_MAP.EdgeHTML,version:t}}},{test:[/trident/i],describe:function(e){var t={name:o.ENGINE_MAP.Trident},n=s.default.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:function(e){return e.test(/presto/i)},describe:function(e){var t={name:o.ENGINE_MAP.Presto},n=s.default.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:function(e){var t=e.test(/gecko/i),n=e.test(/like gecko/i);return t&&!n},describe:function(e){var t={name:o.ENGINE_MAP.Gecko},n=s.default.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/(apple)?webkit\/537\.36/i],describe:function(){return{name:o.ENGINE_MAP.Blink}}},{test:[/(apple)?webkit/i],describe:function(e){var t={name:o.ENGINE_MAP.WebKit},n=s.default.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}}];t.default=a,e.exports=t.default}})},242:function(e,t,n){e.exports=function(){"use strict";var e=Function.prototype.toString,t=Object.create,i=Object.defineProperty,s=Object.getOwnPropertyDescriptor,o=Object.getOwnPropertyNames,a=Object.getOwnPropertySymbols,r=Object.getPrototypeOf,l=Object.prototype,h=l.hasOwnProperty,p=l.propertyIsEnumerable,c="function"==typeof a,d="function"==typeof WeakMap,u=function(){if(d)return function(){return new WeakMap};var e=function(){function e(){this._keys=[],this._values=[]}return e.prototype.has=function(e){return!!~this._keys.indexOf(e)},e.prototype.get=function(e){return this._values[this._keys.indexOf(e)]},e.prototype.set=function(e,t){this._keys.push(e),this._values.push(t)},e}();return function(){return new e}}(),m=function(n,i){var s=n.__proto__||r(n);if(!s)return t(null);var o=s.constructor;if(o===i.Object)return s===i.Object.prototype?{}:t(s);if(~e.call(o).indexOf("[native code]"))try{return new o}catch(e){}return t(s)},g=function(e,t,n,i){var s=m(e,t);for(var o in i.set(e,s),e)h.call(e,o)&&(s[o]=n(e[o],i));if(c)for(var r=a(e),l=0,d=r.length,u=void 0;l<d;++l)u=r[l],p.call(e,u)&&(s[u]=n(e[u],i));return s},f=function(e,t,n,r){var l=m(e,t);r.set(e,l);for(var h=c?o(e).concat(a(e)):o(e),p=0,d=h.length,u=void 0,g=void 0;p<d;++p)if("callee"!==(u=h[p])&&"caller"!==u)if(g=s(e,u)){g.get||g.set||(g.value=n(e[u],r));try{i(l,u,g)}catch(e){l[u]=g.value}}else l[u]=n(e[u],r);return l},y=function(e){var t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.unicode&&(t+="u"),e.sticky&&(t+="y"),t},w=Array.isArray,x=Object.getPrototypeOf,M=function(){return"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==n.g?n.g:(console&&console.error&&console.error('Unable to locate global object, returning "this".'),this)}();function E(e,t){var n=!(!t||!t.isStrict),i=t&&t.realm||M,s=n?f:g,o=function(e,t){if(!e||"object"!=typeof e)return e;if(t.has(e))return t.get(e);var a,r=e.__proto__||x(e),l=r&&r.constructor;if(!l||l===i.Object)return s(e,i,o,t);if(w(e)){if(n)return f(e,i,o,t);a=new l,t.set(e,a);for(var h=0,p=e.length;h<p;++h)a[h]=o(e[h],t);return a}if(e instanceof i.Date)return new l(e.getTime());if(e instanceof i.RegExp)return(a=new l(e.source,e.flags||y(e))).lastIndex=e.lastIndex,a;if(i.Map&&e instanceof i.Map)return a=new l,t.set(e,a),e.forEach((function(e,n){a.set(n,o(e,t))})),a;if(i.Set&&e instanceof i.Set)return a=new l,t.set(e,a),e.forEach((function(e){a.add(o(e,t))})),a;if(i.Blob&&e instanceof i.Blob)return e.slice(0,e.size,e.type);if(i.Buffer&&i.Buffer.isBuffer(e))return a=i.Buffer.allocUnsafe?i.Buffer.allocUnsafe(e.length):new l(e.length),t.set(e,a),e.copy(a),a;if(i.ArrayBuffer){if(i.ArrayBuffer.isView(e))return a=new l(e.buffer.slice(0)),t.set(e,a),a;if(e instanceof i.ArrayBuffer)return a=e.slice(0),t.set(e,a),a}return"function"==typeof e.then||e instanceof Error||i.WeakMap&&e instanceof i.WeakMap||i.WeakSet&&e instanceof i.WeakSet?e:s(e,i,o,t)};return o(e,u())}return E.default=E,E.strict=function(e,t){return E(e,{isStrict:!0,realm:t?t.realm:void 0})},E}()},121:e=>{e.exports=function(){return"undefined"!=typeof window&&"object"==typeof window.process&&"renderer"===window.process.type||(!("undefined"==typeof process||"object"!=typeof process.versions||!process.versions.electron)||"object"==typeof navigator&&"string"==typeof navigator.userAgent&&navigator.userAgent.indexOf("Electron")>=0)}},317:e=>{"use strict";e.exports=s,e.exports.isMobile=s,e.exports.default=s;const t=/(android|bb\d+|meego).+mobile|armv7l|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series[46]0|samsungbrowser|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i,n=/CrOS/,i=/android|ipad|playbook|silk/i;function s(e){e||(e={});let s=e.ua;if(s||"undefined"==typeof navigator||(s=navigator.userAgent),s&&s.headers&&"string"==typeof s.headers["user-agent"]&&(s=s.headers["user-agent"]),"string"!=typeof s)return!1;let o=t.test(s)&&!n.test(s)||!!e.tablet&&i.test(s);return!o&&e.tablet&&e.featureDetect&&navigator&&navigator.maxTouchPoints>1&&-1!==s.indexOf("Macintosh")&&-1!==s.indexOf("Safari")&&(o=!0),o}}},t={};function n(i){var s=t[i];if(void 0!==s)return s.exports;var o=t[i]={exports:{}};return e[i].call(o.exports,o,o.exports,n),o.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";class e{constructor(e){this.materials=new Array,this.isUpdate=!0,this.addMaterials(...e)}addMaterials(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=t.filter((e=>!this.materials.includes(e)));i.length>0&&(this.materials.push(...i),this.isUpdate=!0)}getMaterial(e){return this.materials[e]||null}getMaterials(){return this.materials}hasMaterals(e){return this.materials.hasOwnProperty(e)}checkUpdate(){const{isUpdate:e}=this;return this.isUpdate=!1,e}}const t=new WeakMap;class i{constructor(e,t){this.type=t,this.timestamp=performance.now(),this.target=e}on(e){let n=t.get(this.target);void 0===n&&t.set(this.target,n=new Map),n.has(this.type)||n.set(this.type,new Array);const i=n.get(this.type);void 0!==i&&i.push(e)}off(e){const n=t.get(this.target);if(void 0===n||!n.has(this.type))return;const i=n.get(this.type);void 0!==i&&i.includes(e)&&i.splice(i.indexOf(e))}trigger(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const n=t.get(this.target)||null,i=this.target["on".concat(this.type)];if(null===n&&!(i instanceof Function))return;for(const t in e)Object.defineProperty(this,t,{writable:!1,enumerable:!0,configurable:!0,value:e[t]});i instanceof Function&&i.call(this.target,this);const s=null!==n&&n.get(this.type)||null;if(null!==s)for(let e=0,t=0|s.length;e<t;e=e+1|0)s[e].call(this.target,this)}async triggerAsync(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const n=t.get(this.target),i=this.target["on".concat(this.type)];if(void 0===n&&!(i instanceof Function))return;for(const t in e)Object.defineProperty(this,t,{writable:!1,enumerable:!0,configurable:!0,value:e[t]});i instanceof Function&&await i.call(this.target,this);const s=void 0!==n?n.get(this.type):void 0;if(void 0!==s)for(let e=0,t=0|s.length;e<t;e=e+1|0){const t=(0,s[e])(this);t instanceof Promise&&await t}}}function s(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Math.floor;return isNaN(e)||e===1/0?t:-1===n?e:i(Math.abs(e)*n)/n*Math.sign(e)}function o(e,t,n){return isNaN(e)||isNaN(t)||isNaN(n)?0:e===1/0||t===1/0||n===1/0?1/0:e*(1-n)+t*n}function a(e){e^=e<<13,e^=0;let t=123456789^(e^=e<<5);e^=e<<13,e^=0;let n=362436069^(e^=e<<5);e^=e<<13,e^=0;let i=521288629^(e^=e<<5);e^=e<<13,e^=0;let s=88675123^(e^=e<<5),o=t^t<<11;return t=n,n=i,i=s,s=(s^s>>>19^o^o>>>8)>>>0,s/4294967296}var r=n(121),l=n.n(r),h=n(317),p=n.n(h);let c=l()(),d=p()(),u="api"in self&&self.api.hasSteam(),m="api"in self&&self.api.hasOpenSteamOverlay();function g(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!e)return"postMessage"in self&&"importScripts"in self;try{return!!importScripts}catch(e){return!1}}function f(){return c}setInterval((()=>{c=l()(),d=p()(),u="api"in self&&self.api.hasSteam(),m="api"in self&&self.api.hasOpenSteamOverlay()}));class y{constructor(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.speed=1,this.maxFrameSkipCount=5,this.framerate=60,this.update=0,this.reqAnim=null,this.timeout=null,this.updateTime=-1,this.nextGameTick=-1,this.paintTime=-1,this.skipFrameCount=-1,this.isSkip=!1,this.stackTick=0,this.isSleep=!1,this.isError=!1,this.isUpdateDefault=!1,this.isPaintDefault=!1,self.addEventListener("error",(()=>{this.error()})),this.useAnimationFrame=e}error(){this.isError=!0,this.stop(),new i(this,"error").trigger()}sleep(){this.isSleep=!0,new i(this,"sleep").trigger({})}unsleep(){this.isSleep=!1,new i(this,"unsleep").trigger()}updateDefault(){this.isUpdateDefault=!0}paintDefault(){this.isPaintDefault=!0}getFramerate(){return f()?60:1/0}reset(){let e=!1;return null!==this.reqAnim&&(cancelAnimationFrame(this.reqAnim),e=!0),this.updateTime=-1,this.nextGameTick=-1,this.paintTime=-1,this.skipFrameCount=-1,this.stackTick=0,this.reqAnim=null,e}tickFunc(e){if(this.requestTick(),-1===this.updateTime&&(this.updateTime=e),-1===this.nextGameTick&&(this.nextGameTick=e),-1===this.paintTime&&(this.paintTime=e),-1===this.skipFrameCount&&(this.skipFrameCount=this.maxFrameSkipCount),this.isSleep)return this.updateTime=e,this.paintTime=e,this.nextGameTick=e,void(this.skipFrameCount=this.maxFrameSkipCount);const t=e-this.updateTime;this.updateTime=e;const n=Math.max(60,this.getFramerate()),o=s(1e3/t,n);this.framerate=Math.min(n,o);let a=0,r=e;for(;;){if((this.update>0||a>0)&&(performance.now()-this.paintTime>=1e3/this.getFramerate()||this.isPaintDefault)&&(this.useAnimationFrame&&"requestAnimationFrame"in self?null===this.reqAnim&&(this.reqAnim=requestAnimationFrame((()=>{new i(this,"paint").trigger({now:e,framerate:o,fps:this.getFramerate()}),this.reqAnim=null})),this.isPaintDefault=!1,this.paintTime=e):(new i(this,"paint").trigger({now:e,framerate:o,fps:this.getFramerate()}),this.isPaintDefault=!1,this.paintTime=e)),this.nextGameTick>=e){this.isSkip||(this.skipFrameCount=Math.min(this.maxFrameSkipCount,this.skipFrameCount+.5)),this.isSkip=!1;break}if(a>=this.skipFrameCount){this.skipFrameCount=Math.max(1,this.skipFrameCount-1|0),this.stackTick=e-this.nextGameTick,this.isSkip=!0;break}0===a&&new i(this,"updatebegin").trigger({now:e,framerate:o,fps:this.getFramerate()}),a++;const t=performance.now(),n=t-r+this.stackTick;r=t;const s=n/(1e3/60)*this.speed;new i(this,"update").trigger({time:s,now:e,framerate:o,fps:this.getFramerate()}),this.stackTick=0,this.nextGameTick+=n}const l=Math.max(0,t-(performance.now()-e));(a>0||this.isUpdateDefault)&&(this.isUpdateDefault=!1,new i(this,"updateend").trigger({time:l/(1e3/60),now:e,framerate:o,fps:this.getFramerate()})),this.paintTime===e?this.update=0:this.update+=a}requestTick(){null===this.timeout&&(this.timeout=setTimeout((()=>{const e=performance.now();this.timeout=null,this.tickFunc(e)})))}cancelTick(){return null!==this.timeout&&(clearTimeout(this.timeout),this.timeout=null,!0)}run(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return!(this.isError||this.hasRun()||this.isSleep&&!e)&&(this.reset(),this.isSleep=!1,this.requestTick(),!0)}stop(){return!this.hasRun()||(this.reset(),this.cancelTick())}getNowFramerate(){return this.framerate}hasRun(){return null!==this.timeout}hasSleep(){return this.isSleep}getSpeed(){return this.speed}getMaxSkipFrameCount(){return this.maxFrameSkipCount}setSpeed(e){this.speed=e}setMaxSkipFrameCount(){return this.maxFrameSkipCount}clear(){this.setSpeed(1)}}const w=2*Math.PI,x=Math.PI,M=Math.PI/2;Math.PI;class E{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=e,this.y=t}}class C{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.x=e,this.y=t,this.z=n}}function v(e,t,n,i){return[e-n,t-i]}function b(e,t,n,i,s,o){return[e-i,t-s,n-o]}function _(e,t,n,i){return e*n+t*i}function S(e,t,n,i,s,o){return e*i+t*s+n*o}function k(e,t,n,i,s,o){return[t*o-s*n,n*i-o*e,e*s-i*t]}function T(e,t,n,i){const[s,o]=v(e,t,n,i);return Math.sqrt(_(s,o,s,o))}function P(e,t,n,i,s,o){const[a,r,l]=b(e,t,n,i,s,o);return Math.sqrt(S(a,r,l,a,r,l))}function I(e){return[Math.cos(z(e)),Math.sin(z(e))]}function L(e,t){const n=Math.sin(z(t)),i=Math.cos(z(t)),s=Math.sin(z(e)),o=Math.cos(z(e)),a=Math.abs(i);return[o*a,-n,s*a]}function O(e,t,n){let i=0,s=0;const[o,a]=I(e-Math.PI/2);i+=t*o,s+=t*a;const[r,l]=I(e);return i+=n*r,s+=n*l,[i,s]}function A(e,t,n,i,s){let o=0,a=0,r=0;const[l,h]=I(e-Math.PI/2);if(o+=n*l,r+=n*h,t>0){const[n,s,l]=L(e,t-Math.PI/2);o+=i*n,a+=i*s,r+=i*l}else{const[n,s,l]=L(e,t+Math.PI/2);o-=i*n,a-=i*s,r-=i*l}const[p,c,d]=L(e,t);return o+=s*p,a+=s*c,r+=s*d,[o,a,r]}function W(e,t,n,i){const[s,o]=v(e,t,n,i);return Math.atan2(o,s)}function N(e,t,n,i,s,o){const[a,r,l]=b(e,t,n,i,s,o);return[Math.atan2(l,a),-Math.atan2(r,Math.sqrt(a*a+l*l))]}function z(e){return(e%=w)<0&&(e+=w),6123233995736766e-32===e?0:e}function D(e,t,n){let i=e*e+t*t+n*n;return i>0&&(i=1/Math.sqrt(i)),[e*i,t*i,n*i]}function R(e,t){let n=(e=z(e))-(t=z(t));return n-=Math.floor(n/w)*w,n-=n>Math.PI?w:0,n}function H(e,t){return Math.abs(R(e,t))}function F(e,t,n,i){const s=R(e,n);return[s,R(Math.abs(s)<Math.PI/4*3?t:Math.PI/2*(t/Math.abs(t))-t+Math.PI/2*(t/Math.abs(t)),i)]}function U(e,t,n,i){const[s,o]=F(e,t,n,i);return[Math.abs(s),Math.abs(o)]}function B(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.5;const o=Math.cos(e),a=Math.sin(e),r=Math.cos(t-Math.PI/2),l=Math.sin(t-Math.PI/2),h=i-.5,p=s-.5,c=n,d=c*r+p*l;return D(d*o-h*a,p*r-c*l,h*o+d*a)}function Y(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.5;const o=Math.cos(e),a=Math.sin(e),r=Math.cos(t),l=Math.sin(t),h=i-.5,p=s-.5,c=n,d=c*r+p*l;return D(d*o-h*a,p*r-c*l,h*o+d*a)}function G(e){const t=z(e+Math.PI/4);return t<=Math.PI/2?0:t<=Math.PI/2*2?Math.PI/2*1:t<=Math.PI/2*3?Math.PI/2*2:Math.PI/2*3}function V(e){const t=z(e+Math.PI/8);return t<=Math.PI/4?0:t<Math.PI/4*2?Math.PI/4*1:t<=Math.PI/4*3?Math.PI/4*2:t<Math.PI/4*4?Math.PI/4*3:t<=Math.PI/4*5?Math.PI/4*4:t<Math.PI/4*6?Math.PI/4*5:t<=Math.PI/4*7?Math.PI/4*6:Math.PI/4*7}function X(e,t,n,i,s,o,a,r,l,h,p,c,d,u,m,g){let f=arguments.length>16&&void 0!==arguments[16]?arguments[16]:0,y=arguments.length>17&&void 0!==arguments[17]?arguments[17]:1;const w=i-e,x=s-t,M=o-n,E=S(w,x,M,r,l,h),C=S(w,x,M,p,c,d),v=S(w,x,M,u,m,g),b=2*y,_=E/v*b,k=C/v*b,P=a*T(0,0,1,1)/v*b,I=Math.sin(-f),L=Math.cos(-f);return[L*_-I*k,I*_+L*k,P]}function j(e,t,n){return e+(t-e)*Math.max(0,Math.min(1,n))}function K(e){return 90/e/(e/90*2)}function J(e,t,n){const[i,s]=O(-n,-t,0),[o,a]=O(-n,0,e);return[i+o,s+a]}const q=new Map;function Z(e,t){let n;const i=e.toLowerCase();switch(!0){case/^int[0-9]+$/.test(i):switch(i){case"int8":n=new Int8Array(t);break;case"int16":n=new Int16Array(t);break;case"int32":n=new Int32Array(t)}break;case/^uint[0-9]+$/.test(i):switch(i){case"uint8":n=new Uint8Array(t);break;case"uint16":n=new Uint16Array(t);break;case"uint32":n=new Uint32Array(t)}break;case"uint8clamped"===i:n=new Uint8ClampedArray(t);break;case/^float[0-9]+$/.test(i):switch(i){case"float32":n=new Float32Array(t);break;case"float64":n=new Float64Array(t)}}if(!n)throw new Error("Not found array type was ".concat(e));return n}function Q(){return"SharedArrayBuffer"in self}function $(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i=Z(e,t).byteLength;return!n&&Q()?new SharedArrayBuffer(i):new ArrayBuffer(i)}function ee(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Z(e,$(e,t,n))}var te=n(762);const ne=self.navigator.userAgent.length>0?(0,te.getParser)(self.navigator.userAgent):null,ie=(ne&&ne.isBrowser("chrome"),ne&&ne.getOS().name,ne&&ne.isBrowser("firefox"));ne&&ne.isBrowser("safari");var se=function(e){return function(t,n,i){return e(t,n,i)*i}},oe=function(e,t){if(e)throw Error("Invalid sort config: "+t)},ae=function(e){var t=e||{},n=t.asc,i=t.desc,s=n?1:-1,o=n||i;return oe(!o,"Expected `asc` or `desc` property"),oe(n&&i,"Ambiguous object with `asc` and `desc` config properties"),{order:s,sortBy:o,comparer:e.comparer&&se(e.comparer)}};function re(e,t,n){if(void 0===e||!0===e)return function(e,i){return t(e,i,n)};if("string"==typeof e)return oe(e.includes("."),"String syntax not allowed for nested properties."),function(i,s){return t(i[e],s[e],n)};if("function"==typeof e)return function(i,s){return t(e(i),e(s),n)};if(Array.isArray(e)){var i=function(e){return function t(n,i,s,o,a,r,l){var h,p;if("string"==typeof n)h=r[n],p=l[n];else{if("function"!=typeof n){var c=ae(n);return t(c.sortBy,i,s,c.order,c.comparer||e,r,l)}h=n(r),p=n(l)}var d=a(h,p,o);return(0===d||null==h&&null==p)&&i.length>s?t(i[s],i,s+1,o,a,r,l):d}}(t);return function(s,o){return i(e[0],e,1,n,t,s,o)}}var s=ae(e);return re(s.sortBy,s.comparer||t,s.order)}var le=function(e,t,n,i){return Array.isArray(t)?(Array.isArray(n)&&n.length<2&&(n=n[0]),t.sort(re(n,i,e))):t};function he(e){var t=se(e.comparer);return function(n){var i=Array.isArray(n)&&!e.inPlaceSorting?n.slice():n;return{asc:function(e){return le(1,i,e,t)},desc:function(e){return le(-1,i,e,t)},by:function(e){return le(1,i,e,t)}}}}var pe=function(e,t,n){return null==e?n:null==t?-n:e<t?-1:e>t?1:0},ce=(he({comparer:pe}),he({comparer:pe,inPlaceSorting:!0}));class de{constructor(e){this.sorter=null,this.sorter=ce(e)}asc(e){this.sorter.asc(e)}desc(e){this.sorter.desc(e)}}function ue(e){return new de(e)}function me(e){if(ie)for(;e.length>0;)e.pop();else e.length=0}function ge(e){for(let t=e.length-1|0,n=0;t>n;t--){const n=Math.floor(Math.random()*(t+1)),i=e[t];e[t]=e[n],e[n]=i}}function fe(e,t,n,i,s,o,a){const r=W(e,t,n,i),l=W(e,t,s,o),h=W(n,i,s,o);if(H(r,l)>Math.PI/2&&H(r,h)>Math.PI/2)return 0;const p=T(e,t,s,o),c=T(e,t,n,i),d=T(s,o,n,i),u=Math.sqrt((c+d+p)*(c-d+p)*(-c+d+p)*(c+d-p)/(4*c*c)),m=Math.sqrt(a/2);return Math.max(0,m-u)}function ye(e,t,n,i,s,o){let[a,r]=v(e,t,i,s),l=Math.sqrt(a*a+r*r);const h=n/2+o/2-l;return h<=0?[0,0]:(l>0&&(l=1/l),a*=l,r*=l,[-a*h,-r*h])}function we(e,t,n,i,s,o,a,r,l){const h=0|e,p=0|t,c=0|n;let d=0,u=0,m=!0;if(s+r>p&&s<p+1){const t=h,s=c,r=h+1,g=c,f=h,y=c+1,w=h+1,x=c+1;if(c<=o&&c+1>o){const n=fe(r,g,w,x,i,o,a)-fe(t,s,f,y,i,o,a);n>0?d=Math.round(i+n-a/2)+a/2-i:n<0&&(d=Math.round(i+n+a/2)-a/2-i),d=e+.5>i?-Math.abs(d):Math.abs(d),m=!1}if(h<=i&&h+1>i){const e=fe(f,y,w,x,i,o,a)-fe(t,s,r,g,i,o,a);e>0?u=Math.round(o+e-a/2)+a/2-o:e<0&&(u=Math.round(o+e+a/2)-a/2-o),u=n+.5>o?-Math.abs(u):Math.abs(u),m=!1}m&&(!l(t-1,p,s)&&!l(t,p,s-1)&&!l(t-1,p,s-1)&&h>i&&c>o?[d,u]=ye(t,s,0,i,o,a):!l(t+1,p,s)&&!l(t,p,s-1)&&!l(t+1,p,s-1)&&h+1<i&&c>o?[d,u]=ye(r,g,0,i,o,a):!l(t-1,p,s)&&!l(t,p,s+1)&&!l(t-1,p,s+1)&&h>i&&c+1<o?[d,u]=ye(f,y,0,i,o,a):!l(t+1,p,s)&&!l(t,p,s+1)&&!l(t+1,p,s+1)&&h+1<i&&c+1<o&&([d,u]=ye(w,x,0,i,o,a)))}return[d,0,u,m]}function xe(e,t,n,i,s,o,a,r){if(e|=0,n|=0,s+r>(t|=0)&&s<t+1){const t=a/2;if((i+t>e||i-t<e+1)&&(o+t>n||o-t<n+1)){const s=e,a=n,r=e+1,l=n,h=e,p=n+1,c=e+1,d=n+1;return i<s&&o<a?T(i,o,s,a)<t:i>r&&o<l?T(i,o,r,l)<t:i<h&&o>p?T(i,o,h,p)<t:!(i>c&&o>d)||T(i,o,c,d)<t}}return!1}function Me(e,t,n,i,s,o,a){const r=Math.max(0,Math.abs(e-i)-o/2),l=Math.max(0,Math.abs(t-s)-a/2);return _(r,l,r,l)<=n*n}function Ee(e,t,n,i,s,o,a,r,l,h){const[p,c,d,u,m,g]=Ce(e,t,n,i,s,o,a,r,l,h);return 0!==p||0!==c||0!==d||0!==u||0!==m||0!==g}function Ce(e,t,n,i,s,o,a,r,l,h){if(t<a+h&&t+s>a||a<t+s&&a+h>t){const[p,c,d,u]=function(e,t,n,i,s,o){let[a,r]=v(e,t,i,s),l=Math.sqrt(a*a+r*r),h=n/2+o/2-l;return h<=0?[0,0,0,0]:(l>0&&(l=1/l),a*=l,r*=l,h/=2,[a*h,r*h,-a*h,-r*h])}(e,n,i,o,r,l),m=0!==p||0!==c||0!==d||0!==u?a-t>h/.5?t-(a+h):a-(t+s):0;return[p,m/2,c,d,-m/2,u]}return[0,0,0,0,0,0]}const ve=new Array;function be(e,t,n,i,s,o,a,r,l){return(e-i)*(a-i)+(t-s)*(r-s)+(n-o)*(l-o)}function _e(e,t,n,i,s,o,a,r,l,h){let p=arguments.length>10&&void 0!==arguments[10]?arguments[10]:new C(0,0,0),c=arguments.length>11&&void 0!==arguments[11]?arguments[11]:new C(0,0,0);const d=i*i+s*s+o*o,u=i*(a-=e)+s*(r-=t)+o*(l-=n),m=a*a+r*r+l*l-h*h;if(0===d)return!1;let g=u*u-d*m;if(g<0)return!1;g=Math.sqrt(g);const f=(u-g)/d,y=(u+g)/d;return!(f<0||y<0)&&(p.x=e+f*i,p.y=t+f*s,p.z=n+f*o,c.x=e+y*i,c.y=t+y*s,c.z=n+y*o,!0)}function Se(e,t,n,i,s,o,a,r,l,h,p,c,d){let u=arguments.length>13&&void 0!==arguments[13]?arguments[13]:new C(0,0,0),m=arguments.length>14&&void 0!==arguments[14]?arguments[14]:new C(0,0,0);const g=a-e,f=r-t,y=l-n,w=(h-=e)-g,x=(p-=t)-f,M=(c-=n)-y,E=i*i+s*s+o*o,v=w*i+x*s+M*o,b=g*i+f*s+y*o,_=w*w+x*x+M*M,S=g*w+f*x+y*M,k=g*g+f*f+y*y,T=d*d;if(0===_)return!1;const P=E-v*v/_,I=b-S*v/_,L=k-S*S/_-T;if(0===P)return!1;let O=I*I-P*L;if(O<0)return!1;O=Math.sqrt(O);const A=(I-O)/P,W=(I+O)/P;return u.x=e+A*i,u.y=t+A*s,u.z=n+A*o,m.x=e+W*i,m.y=t+W*s,m.z=n+W*o,!0}function ke(e,t,n,i,s,o,a,r,l,h,p,c){const[d,u,m]=L(i,s),g=new C(-1,-1,-1),f=new C(-1,-1,-1);h-=c/=2;let y=!1,w=!1,x=!1;if(1==_e(e,t,n,d,u,m,o,a+=c,r,c,g,f)&&be(l,h,p,o,a,r,g.x,g.y,g.z)<=0)y=!0;else if(1==_e(e,t,n,d,u,m,l,h,p,c,g,f)&&be(o,a,r,l,h,p,g.x,g.y,g.z)<=0)w=!0;else{if(!(1==Se(e,t,n,d,u,m,o,a,r,l,h,p,c,g,f)&&be(o,a,r,l,h,p,g.x,g.y,g.z)>0&&be(l,h,p,o,a,r,g.x,g.y,g.z)>0))return[-1,-1,-1,-1,-1,-1];x=!0}const M=new C(0,0,0);return y&&be(l,h,p,o,a,r,f.x,f.y,f.z)<=0||w&&be(o,a,r,l,h,p,f.x,f.y,f.z)<=0||x&&be(o,a,r,l,h,p,f.x,f.y,f.z)>0&&be(l,h,p,o,a,r,f.x,f.y,f.z)>0||1==_e(e,t,n,d,u,m,o,a,r,c,M,f)&&be(l,h,p,o,a,r,f.x,f.y,f.z)<=0||1==_e(e,t,n,d,u,m,l,h,p,c,M,f)&&be(o,a,r,l,h,p,f.x,f.y,f.z)<=0||Se(e,t,n,d,u,m,o,a,r,l,h,p,c,M,f),[g.x,g.y,g.z,f.x,f.y,f.z]}const Te=[[1,0,0],[0,0,1],[-1,0,0],[0,0,-1]],Pe=[[1,0,0],[0,0,1],[-1,0,0],[0,0,-1],[1,0,1],[-1,0,-1],[1,0,-1],[-1,0,1]],Ie=[[1,0,0],[-1,0,0],[0,1,0],[0,-1,0],[0,0,1],[0,0,-1],[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[0,1,1],[0,-1,1],[0,1,-1],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[1,-1,-1],[-1,1,1],[1,-1,1],[1,1,-1],[-1,-1,1],[1,-1,-1],[-1,1,-1],[-1,-1,-1],[1,1,1]];function Le(e,t,n,i,s,o,a,r){return((0|s)*a*o+(0|i)*o+(0|n))*e+t}function Oe(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Array;const i=t/2,s=Math.floor(e-i),o=Math.ceil(e+i);if(!(s^o))return[s];for(let t=0|s,a=0|o;t<a;t=t+1|0){const s=t+.5,o=Math.abs(s-e);Math.sqrt(o*o)>i||n.push(t)}return n}function Ae(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Array;const s=n/2,o=Math.floor(e-s),a=Math.floor(t-s),r=Math.ceil(e+s),l=Math.ceil(t+s);if(o==r&&a===l)return[o,a];for(let s=0|o,h=0|r;s<h;s=s+1|0)for(let o=0|a,r=0|l;o<r;o=o+1|0)xe(s,0,o,e,.5,t,n,0)&&i.push(s,o);return i}function We(e,t,n,i,s){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:new Array;const a=i/2,r=s,l=Math.floor(e-a),h=Math.floor(t),p=Math.floor(n-a),c=Math.ceil(e+a),d=Math.ceil(t+r),u=Math.ceil(n+a);if(l===c&&h===d&&p===u)return[l,h,p];for(let a=0|l,r=0|c;a<r;a=a+1|0)for(let r=0|p,l=0|u;r<l;r=r+1|0)for(let l=0|h,p=0|d;l<p;l=l+1|0)xe(a,l,r,e,t,n,i,s)&&o.push(a,l,r);return o}function Ne(e,t,n,i,s,o,a,r){return function(e,t,n,i,s){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1/0,a=arguments.length>6?arguments[6]:void 0,r=arguments.length>7?arguments[7]:void 0;const[l,h,p]=Y(e,t);let c=1/l,d=1/h,u=1/p,m=Math.floor(n),g=Math.floor(i),f=Math.floor(s),y=0,w=0,x=0,M=0,E=0,C=0;c>0?(y=1,M=(m+1-n)*c):(c*=-1,y=-1,M=(n-m)*c),d>0?(w=1,E=(g+1-i)*d):(d*=-1,w=-1,E=(i-g)*d),u>0?(x=1,C=(f+1-s)*u):(u*=-1,x=-1,C=(s-f)*u);let v=M<E?M<C?M:C:E<C?E:C,b=M<E?M<C?0:2:E<C?1:2;do{const e=a(m,g,f,v,b,M,E,C,c,d,u,y,w,x);if(e){let t=n+v/c*y,o=i+v/d*w,a=s+v/u*x;switch(b){case 0:t=Math.round(t);break;case 1:o=Math.round(o);break;case 2:a=Math.round(a)}if(r&&r(m,g,f,t,o,a,e,v,b,M,E,C,c,d,u,y,w,x))break;return[t,o,a,v]}{const e=M<E?M<C?M:C:E<C?E:C;let t=n+e/c*y,o=i+e/d*w,a=s+e/u*x;switch(M<E?M<C?0:2:E<C?1:2){case 0:t=Math.round(t);break;case 1:o=Math.round(o);break;case 2:a=Math.round(a)}if(r&&r(m,g,f,t,o,a,!1,v,b,M,E,C,c,d,u,y,w,x))break}M<E?M<C?(m+=y,v=M,M+=c,b=0):(f+=x,v=C,C+=u,b=2):E<C?(g+=w,v=E,E+=d,b=1):(f+=x,v=C,C+=u,b=2)}while(v<o);return[-1,-1,-1,-1]}(z(e),z(t),n,i,s,o,a,r)}function ze(e,t,n,i,o,a,r){const l=z(e),h=z(t);return function(e,t,n,i,o){let a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1/0,r=arguments.length>6?arguments[6]:void 0;const[l,h,p]=Y(e,t),c=1/l,d=1/h,u=1/p,m=Math.sign(l),g=Math.sign(h),f=Math.sign(p),y=m*c,w=g*d,x=f*u,M=Math.abs(c),E=Math.abs(d),C=Math.abs(u);let v=Math.floor(n),b=Math.floor(i),_=Math.floor(o),S=1/l,k=1/h,T=1/p,P=0,I=0,L=0,O=0,A=0,W=0;S>0?(P=1,O=(v+1-n)*S):(S*=-1,P=-1,O=(n-v)*S),k>0?(I=1,A=(b+1-i)*k):(k*=-1,I=-1,A=(i-b)*k),T>0?(L=1,W=(_+1-o)*T):(T*=-1,L=-1,W=(o-_)*T);let N=O<A?O<W?O:W:A<W?A:W,z=O<A?O<W?0:2:A<W?1:2;do{const e=r(v,b,_);if(e<=0){let e=n+N/S*P,t=i+N/k*I,s=o+N/T*L;switch(z){case 0:e=Math.round(e);break;case 1:t=Math.round(t);break;case 2:s=Math.round(s)}return[e,t,s,N]}const t=Math.floor(s(Math.max(0,e-1)/M,0)),a=Math.floor(s(Math.max(0,e-1)/E,0)),l=Math.floor(s(Math.max(0,e-1)/C,0));O+=t*y,A+=a*w,W+=l*x,v+=t*m,b+=a*g,_+=l*f,O<A?O<W?(v+=P,N=O,O+=S,z=0):(_+=L,N=W,W+=T,z=2):A<W?(b+=I,N=A,A+=k,z=1):(_+=L,N=W,W+=T,z=2)}while(N<a);return[-1,-1,-1,-1]}(l<Number.EPSILON&&l>-Number.EPSILON?Number.EPSILON:l,h<Number.EPSILON&&h>-Number.EPSILON?-Number.EPSILON:h,n,i,o,a,r)}function De(e,t,n,i,s,o,a){let[r,l,h]=a;const p=0|t,c=0|n,d=0|i;if(null===e||p<0||p>=r||c<0||c>=l||d<0||d>=h)return-1;return e[Le(o,s,p,c,d,r,l)]}function Re(e,t,n,i,s,o,a,r,l){let[h,p,c]=a;const d=0|t,u=0|n,m=0|i;if(null===e||d<0||d>=h||u<0||u>=p||m<0||m>=c)return!1;const g=Le(o,s,d,u,m,h,p),f=e[g],y=function(e,t){const n=q.has(e)?q.get(e):ee(e,1,!0);return n?(n[0]=t,n[0]):t}(r,l);return f!==y&&(e[g]=l,!0)}function He(e,t,n,i,s,o,a,r,l,h){let p=arguments.length>10&&void 0!==arguments[10]&&arguments[10],c=arguments.length>11&&void 0!==arguments[11]&&arguments[11],d=arguments.length>12&&void 0!==arguments[12]&&arguments[12];if(s<0||o<0||a<0||s>r-1||o>l-1||a>h-1)return!1;const u=Le(n,0,s,o,a,r,l);if(null===e||null===t)return!1;const m=e[u],g=0===t[u];return e[u]=d?i:p?0===t[u]?i:c?Math.max(0,Math.max(e[u],i)):Math.max(0,Math.min(e[u],i)):0===t[u]?i:e[u],t[u]=1,m!==e[u]||g}class Fe{constructor(e){this.filter=e}find(e,t,n,i,s){const[o,a,r]=e;let l=1/0,h=!1;const p=new Array,c={},d=(n,i,s,d)=>{if(i<0||s<0||d<0||i>o-1||s>a-1||d>r-1)return l=Math.min(l,n-1),void(h=!0);const u="".concat(i,",").concat(s,",").concat(d);if(c.hasOwnProperty(u))return l=Math.min(l,n-1),void(h=!0);c[u]=!0,1===De(this.filter,i,s,d,0,t,e)?h||p.push({count:n,x:i,y:s,z:d}):(l=Math.min(l,n-1),h=!0)};for(d(1,n,i,s);p.length>0;){const e=p.shift()||null;if(null===e)break;const{count:t,x:n,y:i,z:s}=e;for(let e=0,o=0|Ie.length;e<o;e=e+1|0){const[o,a,r]=Ie[e];d(t+1,n+o,i+a,s+r)}}return l===1/0?1:l}update(e,t,n,i,s,o,a,r){const[l,h,p]=n,c=De(this.filter,o,a,r,0,s,n)===i,d=c?this.find(n,s,o,a,r):0,u=new Array({count:d,x:o,y:a,z:r}),m={},g="".concat(o,",").concat(a,",").concat(r);if(m.hasOwnProperty(g))return;m[g]=!0,He(e,t,s,d,o,a,r,l,h,p,!0,c,!1);const f=(o,a,r,d)=>{if(o<0||a<0||r<0||d<0||a>l-1||r>h-1||d>p-1)return;const g="".concat(a,",").concat(r,",").concat(d);m.hasOwnProperty(g)||(m[g]=!0,He(e,t,s,o,a,r,d,l,h,p,!0,c,!1)&&De(this.filter,a,r,d,0,s,n)===i&&u.push({count:o,x:a,y:r,z:d}))};for(c&&f(this.find(n,s,o,a,r),o,a,r);u.length>0;){const e=u.shift()||null;if(null===e)break;const{count:t,x:i,y:o,z:a}=e;for(let e=0,r=0|Ie.length;e<r;e=e+1|0){const[r,l,h]=Ie[e];f(c?this.find(n,s,i+r,o+l,a+h):t+1,i+r,o+l,a+h)}}}}class Ue{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"uint8",s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:-1;this.buffer=null,this.is_update=!0,this.is_reflesh_distance_field=!1,this.filter=null,this.distance_field=null,this.fill_distance_field=null,this.inserts=new Array,this.distance_field_builder=null,this.width=e,this.height=t,this.depth=n,this.distance=P(0,0,0,e,t,n),this.data_type=i,this.length=s,this.fill=o,this.setSize(e,t,n)}clear(){this.setSize(1,1,1)}setSize(e,t,n){if(e===this.width&&t===this.height&&n===this.depth&&null!==this.buffer)return;const i=ee(this.data_type,e*t*n*this.length),s=ee("int32",e*t*n),o=ee("int8",e*t*n);this.distance_field_builder=new Fe(i),this.buffer=i.buffer,this.width=e,this.height=t,this.depth=n,this.distance=P(0,0,0,e,t,n),this.filter=i,this.distance_field=s,this.fill_distance_field=o,this.is_update=!0,i.fill(this.fill),s.fill(1),o.fill(0)}getWorldDistance(){return this.distance}getSize(){const{width:e,height:t,depth:n}=this;return[e,t,n]}getFill(){return this.fill}getLength(){return this.length}getBuffer(){return this.buffer}getFilter(){return this.filter}getDistanceField(){return this.distance_field}getFillDistanceField(){return this.fill_distance_field}set(e,t,n,i,s){let o=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:this.getFilter(),r=arguments.length>7&&void 0!==arguments[7]?arguments[7]:this.getSize();var l;if(null===a)return;const h=0|t,p=0|n,c=0|i,d=a===this.getFilter()?this.length:1,[u,m,g]=r,f=a[Le(d,e,h,p,c,u,m)];if(Re(a,t,n,i,e,d,r,this.data_type,s)&&a===this.getFilter()&&(this.is_update=!0,f!==this.fill&&void 0!==this.inserts[f]&&(this.inserts[f].count--,this.inserts[f].count<=0&&delete this.inserts[f]),s!==this.fill&&(void 0===this.inserts[s]?this.inserts[s]={count:1}:this.inserts[s].count++),o)){const e=this.getDistanceField(),t=this.getFillDistanceField();null!==e&&null!==t&&(null===(l=this.distance_field_builder)||void 0===l||l.update(e,t,this.getSize(),this.getFill(),this.getLength(),h,p,c))}}get(e,t,n,i){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.getFilter(),o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:this.getSize();return null===s?-1:De(s,t,n,i,e,s===this.getFilter()?this.length:1,o)}getCount(e){return void 0===this.inserts[e]?0:this.inserts[e].count}expand(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(0===e&&0===t&&0===n)return;const[i,s,o]=this.getSize(),a=this.getFilter(),r=this.getDistanceField(),l=this.getFillDistanceField();this.setSize(i+Math.abs(e),s+Math.abs(t),o+Math.abs(n));for(let h=i-1|0;h>=0;h=h-1|0)for(let p=s-1|0;p>=0;p=p-1|0)for(let c=o-1|0;c>=0;c=c-1|0){const d=h+Math.abs(e<0?-e:0),u=p+Math.abs(t<0?-t:0),m=c+Math.abs(n<0?-n:0),g=this.get(0,h,p,c,r,[i,s,o]),f=this.get(0,h,p,c,l,[i,s,o]);this.set(0,d,u,m,-1===g?0:g,!1,this.getDistanceField()),this.set(0,d,u,m,-1===f?0:f,!1,this.getFillDistanceField());for(let e=0,t=0|this.length;e<t;e=e+1|0){const t=this.get(e,h,p,c,a,[i,s,o]);this.set(e,d,u,m,-1===t?1:t,!1,this.getFilter())}}}reduction(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(0===e&&0===t&&0===n)return;const[i,s,o]=this.getSize(),a=this.getFilter(),r=this.getDistanceField(),l=this.getFillDistanceField();this.setSize(i-Math.abs(e),s-Math.abs(t),o-Math.abs(n));for(let h=i-1|0;h>=0;h=h-1|0)for(let p=s-1|0;p>=0;p=p-1|0)for(let c=o-1|0;c>=0;c=c-1|0){const d=h-Math.abs(e<0?-e:0),u=p-Math.abs(t<0?-t:0),m=c-Math.abs(n<0?-n:0),g=this.get(0,h,p,c,r,[i,s,o]),f=this.get(0,h,p,c,l,[i,s,o]);this.set(0,d,u,m,-1===g?0:g,!1,this.getDistanceField()),this.set(0,d,u,m,-1===f?0:f,!1,this.getFillDistanceField());for(let e=0,t=0|this.length;e<t;e=e+1|0){const t=this.get(e,h,p,c,a,[i,s,o]);this.set(e,d,u,m,-1===t?1:t,!1,this.getFilter())}}}requestRefleshDistanceField(){this.is_reflesh_distance_field=!0}cancelRefleshDistanceField(){this.is_reflesh_distance_field=!1}async refleshDistanceField(){var e,t;const n=this.getFilter(),i=this.getDistanceField(),s=this.getFillDistanceField(),[o,a,r]=this.getSize(),l=this.getFill();if(null!==n&&null!==i&&null!==s){i.fill(1),null===(e=this.fill_distance_field)||void 0===e||e.fill(0);for(let e=0;e<o;e=e+1|0)for(let n=0;n<a;n=n+1|0)for(let h=0;h<r;h=h+1|0)this.get(0,e,n,h)!==this.fill&&(null===(t=this.distance_field_builder)||void 0===t||t.update(i,s,[o,a,r],l,this.getLength(),e,n,h));this.finalize()}}hasUpdate(){return this.is_update}finalize(){var e;null===(e=this.fill_distance_field)||void 0===e||e.fill(1)}checkUpdate(){let e=this.is_update;return this.is_reflesh_distance_field&&(this.refleshDistanceField(),this.is_reflesh_distance_field=!1,e=!0),this.is_update=!1,e}}function Be(e){let t=e;return t=16711935&(t|t<<8),t=252645135&(t|t<<4),t=858993459&(t|t<<2),t=1431655765&(t|t<<1),t}function Ye(e){let t=e;return t&=1023,t=4278190335&(t^t<<16),t=50393103&(t^t<<8),t=51130563&(t^t<<4),t=153391689&(t^t<<2),t}class Ge{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e=>[-1,-1,-1,-1,-1];this.size=new C(1,1,1),this.entitys=new Array,this.oldPropertys=new WeakMap,this.oldPoints=new WeakMap,this.data=new Array,this.points=new Array,this.heap=new Array,this.hasAdd=e,this.paramGetter=t}hasOverPosition(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;const[o,a,r]=this.getSize();return e+i/2<0||t+s<0||n+i/2<0||e-i/2>=o||t>=a||n-i/2>=r}getDimension(){const[,e,t]=this.getSize();switch(!0){case!(1^e):return 1;case!(1^t):return 2}return 3}calcMortonNumber(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(this.hasOverPosition(e,t,n))return-1;switch(this.getDimension()){case 1:return e;case 2:return function(e,t){return Be(0|e)|Be(0|t)<<1}(e,n);case 3:return function(e,t,n){return Ye(0|e)|Ye(0|t)<<1|Ye(0|n)<<2}(e,t,n)}}setSize(e,t,n){this.size.x=e,this.size.y=t,this.size.z=n}getSize(){return[this.size.x,this.size.y,this.size.z]}getEntityProperty(e){return this.paramGetter(e)}getOldEntityProperty(e){const t=this.oldPropertys.get(e);return t?[t.x,t.y,t.z,t.rx,t.ry]:[-1,-1,-1,-1,-1]}add(e){this.hasAdd(e)&&!this.entitys.includes(e)&&this.entitys.push(e)}remove(e){this.hasAdd(e)&&this.entitys.includes(e)&&this.entitys.splice(this.entitys.indexOf(e),1)}hasEntity(e){return this.hasAdd(e)}clear(){this.entitys.forEach((e=>this.oldPropertys.delete(e))),this.size.x=0,this.size.y=0,this.size.z=0,me(this.data),me(this.points),me(this.entitys)}getCell(e){return this.data[e]||new Array}getPointCell(e,t,n){const i=this.calcMortonNumber(e,t,n);return this.getCell(i)}getAppendPoints(){return this.points}getDataLength(){return this.data.length}setOldPosition(e){const t=this.oldPropertys.get(e);if(void 0!==t){const[n,i,s,o,a]=this.getEntityProperty(e),r=Math.floor(n-o/2),l=Math.floor(i),h=Math.floor(s-o/2),p=Math.ceil(n+o/2),c=Math.ceil(i+a),d=Math.ceil(s+o/2);t.sx=r,t.sy=l,t.sz=h,t.ex=p,t.ey=c,t.ez=d,t.x=n,t.y=i,t.z=s,t.rx=o,t.ry=a}}initOldPosition(e){const t={x:-1,y:-1,z:-1,rx:-1,ry:-1,sx:-1,sy:-1,sz:-1,ex:-1,ey:-1,ez:-1};return this.oldPropertys.set(e,t),t}appendCells(e,t){const n=e.getID();for(let e=0,i=0|t.length;e<i;e=e+1|0){const i=t[e],s=this.data[i];void 0===s?this.data[i]=[n]:s.includes(n)||(s.push(n),s.length>1&&!this.points.includes(i)&&this.points.push(i))}}update(e,t,n){this.setSize(e,t,n),ie?this.data.fill(void 0):this.data.length=0,me(this.points);for(let e=0,t=0|this.entitys.length;e<t;e=e+1|0){const t=this.entitys[e],[n,i,o,a,r]=this.getEntityProperty(t);let l=this.oldPropertys.get(t);if(void 0===l&&(l=this.initOldPosition(t)),-1!==n&&-1!==i&&-1!==o&&!this.hasOverPosition(n,i,o,a,r)){let e=this.oldPoints.get(t);void 0===e&&this.oldPoints.set(t,e=new Array);const h=Math.floor(n-a/2),p=Math.floor(i),c=Math.floor(o-a/2),d=Math.ceil(n+a/2),u=Math.ceil(i+r),m=Math.ceil(o+a/2);if(l.sx!==h||l.sy!==p||l.sz!==c||l.ex!==d||l.ey!==u||l.ez!==m){const t=-1===l.x?n:l.x,g=-1===l.y?i:l.y,f=-1===l.z?o:l.z,y=n-t,w=i-g,x=o-f,M=P(y,w,x,0,0,0),[E,C]=N(y,w,x,0,0,0),v=Math.min(M,a/4,r/4,.5),[b,_,S]=A(E,C,0,0,1),k=this.getDimension();let T=0;for(me(e);;){const n=t+T*b,i=g+T*_,o=f+T*S;me(this.heap);let l=this.heap;switch(k){case 1:l=Oe(n,a,this.heap);break;case 2:l=Ae(n,o,a,this.heap);break;case 3:l=We(n,i,o,a,r,this.heap)}for(let t=0,n=0|l.length;t<n;t=t+k|0){const n=l[t],i=l[t+1],s=l[t+2];let o=-1;switch(k){case 1:o=this.calcMortonNumber(n,0,0);break;case 2:o=this.calcMortonNumber(n,0,i);break;case 3:o=this.calcMortonNumber(n,i,s)}-1===o||e.includes(o)||e.push(o)}if(T>=M)break;T=Math.min(M,s(T+v,M,1e5,Math.ceil))}0===v&&(l.sx=h,l.sy=p,l.sz=c,l.ex=d,l.ey=u,l.ez=m)}this.appendCells(t,e)}l.x=n,l.y=i,l.z=o,l.rx=a,l.ry=r}}}function Ve(){const e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".split("");for(let t=0,n=0|e.length;t<n;t=t+1|0)switch(e[t]){case"x":e[t]=Math.floor(16*Math.random()).toString(16);break;case"y":e[t]=(Math.floor(4*Math.random())+8).toString(16)}return e.join("")}new WeakMap,new WeakMap;function Xe(){return"localhost"===location.hostname}Promise.resolve(!1),Promise.resolve(!0);var je=Promise.resolve();function Ke(e,t){return e||(e=0),new Promise((function(n){return setTimeout((function(){return n(t)}),e)}))}function Je(){return Math.random().toString(36).substring(2)}var qe=0,Ze=0;function Qe(){var e=(new Date).getTime();return e===qe?1e3*e+ ++Ze:(qe=e,Ze=0,1e3*e)}var $e="[object process]"===Object.prototype.toString.call("undefined"!=typeof process?process:0);const et={create:function(e){var t={messagesCallback:null,bc:new BroadcastChannel(e),subFns:[]};return t.bc.onmessage=function(e){t.messagesCallback&&t.messagesCallback(e.data)},t},close:function(e){e.bc.close(),e.subFns=[]},onMessage:function(e,t){e.messagesCallback=t},postMessage:function(e,t){try{return e.bc.postMessage(t,!1),je}catch(e){return Promise.reject(e)}},canBeUsed:function(){if($e&&"undefined"==typeof window)return!1;if("function"==typeof BroadcastChannel){if(BroadcastChannel._pubkey)throw new Error("BroadcastChannel: Do not overwrite window.BroadcastChannel with this module, this is not a polyfill");return!0}return!1},type:"native",averageResponseTime:function(){return 150},microSeconds:Qe};var tt=function(){function e(e){this.ttl=e,this.set=new Set,this.timeMap=new Map}return e.prototype.has=function(e){return this.set.has(e)},e.prototype.add=function(e){var t=this;this.timeMap.set(e,nt()),this.set.add(e),setTimeout((function(){!function(e){var t=nt()-e.ttl,n=e.set[Symbol.iterator]();for(;;){var i=n.next().value;if(!i)return;if(!(e.timeMap.get(i)<t))return;e.timeMap.delete(i),e.set.delete(i)}}(t)}),0)},e.prototype.clear=function(){this.set.clear(),this.timeMap.clear()},e}();function nt(){return(new Date).getTime()}function it(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=JSON.parse(JSON.stringify(e));return void 0===t.webWorkerSupport&&(t.webWorkerSupport=!0),t.idb||(t.idb={}),t.idb.ttl||(t.idb.ttl=45e3),t.idb.fallbackInterval||(t.idb.fallbackInterval=150),e.idb&&"function"==typeof e.idb.onclose&&(t.idb.onclose=e.idb.onclose),t.localstorage||(t.localstorage={}),t.localstorage.removeTimeout||(t.localstorage.removeTimeout=6e4),e.methods&&(t.methods=e.methods),t.node||(t.node={}),t.node.ttl||(t.node.ttl=12e4),t.node.maxParallelWrites||(t.node.maxParallelWrites=2048),void 0===t.node.useFastPath&&(t.node.useFastPath=!0),t}var st="messages",ot={durability:"relaxed"};function at(){if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof window){if(void 0!==window.mozIndexedDB)return window.mozIndexedDB;if(void 0!==window.webkitIndexedDB)return window.webkitIndexedDB;if(void 0!==window.msIndexedDB)return window.msIndexedDB}return!1}function rt(e){e.commit&&e.commit()}function lt(e,t){var n=e.transaction(st,"readonly",ot),i=n.objectStore(st),s=[],o=IDBKeyRange.bound(t+1,1/0);if(i.getAll){var a=i.getAll(o);return new Promise((function(e,t){a.onerror=function(e){return t(e)},a.onsuccess=function(t){e(t.target.result)}}))}return new Promise((function(e,a){var r=function(){try{return o=IDBKeyRange.bound(t+1,1/0),i.openCursor(o)}catch(e){return i.openCursor()}}();r.onerror=function(e){return a(e)},r.onsuccess=function(i){var o=i.target.result;o?o.value.id<t+1?o.continue(t+1):(s.push(o.value),o.continue()):(rt(n),e(s))}}))}function ht(e,t){return function(e,t){var n=(new Date).getTime()-t,i=e.transaction(st,"readonly",ot),s=i.objectStore(st),o=[];return new Promise((function(e){s.openCursor().onsuccess=function(t){var s=t.target.result;if(s){var a=s.value;if(!(a.time<n))return rt(i),void e(o);o.push(a),s.continue()}else e(o)}}))}(e,t).then((function(t){return function(e,t){var n=e.transaction([st],"readwrite",ot).objectStore(st);return Promise.all(t.map((function(e){var t=n.delete(e);return new Promise((function(e){t.onsuccess=function(){return e()}}))})))}(e,t.map((function(e){return e.id})))}))}function pt(e){e.closed||ct(e).then((function(){return Ke(e.options.idb.fallbackInterval)})).then((function(){return pt(e)}))}function ct(e){return e.closed?je:e.messagesCallback?lt(e.db,e.lastCursorId).then((function(t){var n=t.filter((function(e){return!!e})).map((function(t){return t.id>e.lastCursorId&&(e.lastCursorId=t.id),t})).filter((function(t){return function(e,t){return!(e.uuid===t.uuid||t.eMIs.has(e.id)||e.data.time<t.messagesCallbackTime)}(t,e)})).sort((function(e,t){return e.time-t.time}));return n.forEach((function(t){e.messagesCallback&&(e.eMIs.add(t.id),e.messagesCallback(t.data))})),je})):je}const dt={create:function(e,t){return t=it(t),function(e){var t="pubkey.broadcast-channel-0-"+e,n=at().open(t);return n.onupgradeneeded=function(e){e.target.result.createObjectStore(st,{keyPath:"id",autoIncrement:!0})},new Promise((function(e,t){n.onerror=function(e){return t(e)},n.onsuccess=function(){e(n.result)}}))}(e).then((function(n){var i={closed:!1,lastCursorId:0,channelName:e,options:t,uuid:Je(),eMIs:new tt(2*t.idb.ttl),writeBlockPromise:je,messagesCallback:null,readQueuePromises:[],db:n};return n.onclose=function(){i.closed=!0,t.idb.onclose&&t.idb.onclose()},pt(i),i}))},close:function(e){e.closed=!0,e.db.close()},onMessage:function(e,t,n){e.messagesCallbackTime=n,e.messagesCallback=t,ct(e)},postMessage:function(e,t){return e.writeBlockPromise=e.writeBlockPromise.then((function(){return function(e,t,n){var i={uuid:t,time:(new Date).getTime(),data:n},s=e.transaction([st],"readwrite",ot);return new Promise((function(e,t){s.oncomplete=function(){return e()},s.onerror=function(e){return t(e)},s.objectStore(st).add(i),rt(s)}))}(e.db,e.uuid,t)})).then((function(){var t,n;0===(t=0,n=10,Math.floor(Math.random()*(n-t+1)+t))&&ht(e.db,e.options.idb.ttl)})),e.writeBlockPromise},canBeUsed:function(){return!$e&&!!at()},type:"idb",averageResponseTime:function(e){return 2*e.idb.fallbackInterval},microSeconds:Qe};function ut(){var e;if("undefined"==typeof window)return null;try{e=window.localStorage,e=window["ie8-eventlistener/storage"]||window.localStorage}catch(e){}return e}function mt(e){return"pubkey.broadcastChannel-"+e}function gt(){if($e)return!1;var e=ut();if(!e)return!1;try{var t="__broadcastchannel_check";e.setItem(t,"works"),e.removeItem(t)}catch(e){return!1}return!0}const ft={create:function(e,t){if(t=it(t),!gt())throw new Error("BroadcastChannel: localstorage cannot be used");var n=Je(),i=new tt(t.localstorage.removeTimeout),s={channelName:e,uuid:n,eMIs:i};return s.listener=function(e,t){var n=mt(e),i=function(e){e.key===n&&t(JSON.parse(e.newValue))};return window.addEventListener("storage",i),i}(e,(function(e){s.messagesCallback&&e.uuid!==n&&e.token&&!i.has(e.token)&&(e.data.time&&e.data.time<s.messagesCallbackTime||(i.add(e.token),s.messagesCallback(e.data)))})),s},close:function(e){var t;t=e.listener,window.removeEventListener("storage",t)},onMessage:function(e,t,n){e.messagesCallbackTime=n,e.messagesCallback=t},postMessage:function(e,t){return new Promise((function(n){Ke().then((function(){var i=mt(e.channelName),s={token:Je(),time:(new Date).getTime(),data:t,uuid:e.uuid},o=JSON.stringify(s);ut().setItem(i,o);var a=document.createEvent("Event");a.initEvent("storage",!0,!0),a.key=i,a.newValue=o,window.dispatchEvent(a),n()}))}))},canBeUsed:gt,type:"localstorage",averageResponseTime:function(){var e=navigator.userAgent.toLowerCase();return e.includes("safari")&&!e.includes("chrome")?240:120},microSeconds:Qe};var yt=Qe,wt=new Set;const xt={create:function(e){var t={name:e,messagesCallback:null};return wt.add(t),t},close:function(e){wt.delete(e)},onMessage:function(e,t){e.messagesCallback=t},postMessage:function(e,t){return new Promise((function(n){return setTimeout((function(){Array.from(wt).filter((function(t){return t.name===e.name})).filter((function(t){return t!==e})).filter((function(e){return!!e.messagesCallback})).forEach((function(e){return e.messagesCallback(t)})),n()}),5)}))},canBeUsed:function(){return!0},type:"simulate",averageResponseTime:function(){return 5},microSeconds:yt};var Mt=[et,dt,ft];var Et,Ct=new Set,vt=0,bt=function(e,t){var n,i,s;this.id=vt++,Ct.add(this),this.name=e,Et&&(t=Et),this.options=it(t),this.method=function(e){var t=[].concat(e.methods,Mt).filter(Boolean);if(e.type){if("simulate"===e.type)return xt;var n=t.find((function(t){return t.type===e.type}));if(n)return n;throw new Error("method-type "+e.type+" not found")}e.webWorkerSupport||$e||(t=t.filter((function(e){return"idb"!==e.type})));var i=t.find((function(e){return e.canBeUsed()}));if(i)return i;throw new Error("No useable method found in "+JSON.stringify(Mt.map((function(e){return e.type}))))}(this.options),this._iL=!1,this._onML=null,this._addEL={message:[],internal:[]},this._uMP=new Set,this._befC=[],this._prepP=null,i=(n=this).method.create(n.name,n.options),(s=i)&&"function"==typeof s.then?(n._prepP=i,i.then((function(e){n._state=e}))):n._state=i};function _t(e,t,n){var i={time:e.method.microSeconds(),type:t,data:n};return(e._prepP?e._prepP:je).then((function(){var t=e.method.postMessage(e._state,i);return e._uMP.add(t),t.catch().then((function(){return e._uMP.delete(t)})),t}))}function St(e){return e._addEL.message.length>0||e._addEL.internal.length>0}function kt(e,t,n){e._addEL[t].push(n),function(e){if(!e._iL&&St(e)){var t=function(t){e._addEL[t.type].forEach((function(e){var n=1e5,i=e.time-n;t.time>=i&&e.fn(t.data)}))},n=e.method.microSeconds();e._prepP?e._prepP.then((function(){e._iL=!0,e.method.onMessage(e._state,t,n)})):(e._iL=!0,e.method.onMessage(e._state,t,n))}}(e)}function Tt(e,t,n){e._addEL[t]=e._addEL[t].filter((function(e){return e!==n})),function(e){if(e._iL&&!St(e)){e._iL=!1;var t=e.method.microSeconds();e.method.onMessage(e._state,null,t)}}(e)}let Pt;bt._pubkey=!0,bt.prototype={postMessage:function(e){if(this.closed)throw new Error("BroadcastChannel.postMessage(): Cannot post message after channel has closed "+JSON.stringify(e));return _t(this,"message",e)},postInternal:function(e){return _t(this,"internal",e)},set onmessage(e){var t={time:this.method.microSeconds(),fn:e};Tt(this,"message",this._onML),e&&"function"==typeof e?(this._onML=t,kt(this,"message",t)):this._onML=null},addEventListener:function(e,t){kt(this,e,{time:this.method.microSeconds(),fn:t})},removeEventListener:function(e,t){Tt(this,e,this._addEL[e].find((function(e){return e.fn===t})))},close:function(){var e=this;if(!this.closed){Ct.delete(this),this.closed=!0;var t=this._prepP?this._prepP:je;return this._onML=null,this._addEL.message=[],t.then((function(){return Promise.all(Array.from(e._uMP))})).then((function(){return Promise.all(e._befC.map((function(e){return e()})))})).then((function(){return e.method.close(e._state)}))}},get type(){return this.method.type},get isClosed(){return this.closed}},Pt=g(!1)?async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise(((n,i)=>{const s=Ve();addEventListener("message",(function e(t){const{data:o}=t;o instanceof Object&&s===o.key&&"fetch"===o.method&&(removeEventListener("message",e),o.error?i():n(new Response(o.data,{status:200})))})),sn({method:"fetch",type:"arraybuffer",options:t,url:e,key:s},[])}))}:f()&&!Xe()?async function(e){const t=await("api"in self?self.api.request(e):null);return new Response(t,{status:t?200:404})}:self.fetch;const It=Pt,Lt=self,Ot=self.requestAnimationFrame&&self.requestAnimationFrame||setTimeout,At=self.cancelAnimationFrame||clearTimeout,Wt=[];let Nt,zt,Dt,Rt,Ht=0,Ft=!1,Ut=7,Bt=35,Yt=125,Gt=0,Vt=0,Xt=0;const jt={get didTimeout(){return!1},timeRemaining(){var e=Ut-(Date.now()-Vt);return Math.max(0,e)}},Kt=function(e){let t,n;const i=()=>{var s=Date.now()-n;s<99?t=setTimeout(i,99-s):(t=null,e())};return()=>{n=Date.now(),t||(t=setTimeout(i,99))}}((()=>{Ut=22,Yt=66,Bt=0}));function Jt(){125!=Yt&&(Ut=7,Yt=125,Bt=35,Ft&&(Ft&&(Rt&&At(Rt),Dt&&clearTimeout(Dt),Ft=!1),Qt())),Kt()}function qt(){Rt=null,Dt=setTimeout($t,0)}function Zt(){Dt=null,Ot(qt)}function Qt(){Ft||(zt=Yt-(Date.now()-Vt),Nt=Date.now(),Ft=!0,Bt&&zt<Bt&&(zt=Bt),zt>9?Dt=setTimeout(Zt,zt):(zt=0,Zt()))}function $t(){let e;const t=Ut>9?9:1;if(Vt=Date.now(),Ft=!1,Dt=null,Ht>2||Vt-zt-50<Nt)for(let n=0,i=0|Wt.length;n<i&&jt.timeRemaining()>t;n=n+1|0)e=Wt.shift()||null,Xt++,e&&e(jt);Wt.length?Qt():Ht=0}function en(e){return Gt++,Wt.push(e),Qt(),Gt}function tn(e){var t=e-1-Xt;Wt[t]&&(Wt[t]=null)}if("requestIdleCallback"in Lt&&"cancelIdleCallback"in Lt)try{self.requestIdleCallback((()=>{}),{timeout:0})}catch(e){(e=>{let t,n;if(self.requestIdleCallback=function(t,n){return n&&"number"==typeof n.timeout?e(t,{timeout:n.timeout}):e(t)},self.IdleDeadline&&(t=self.IdleDeadline.prototype)){if(n=Object.getOwnPropertyDescriptor(t,"timeRemaining"),!n||!n.configurable||!n.get)return;Object.defineProperty(t,"timeRemaining",{value:function(){return n.get.call(this)},enumerable:!0,configurable:!0})}})(self.requestIdleCallback)}else self.requestIdleCallback=en,self.cancelIdleCallback=tn,self.document&&document.addEventListener&&(self.addEventListener("scroll",Jt,!0),self.addEventListener("resize",Jt),document.addEventListener("focus",Jt,!0),document.addEventListener("mouseover",Jt,!0),["click","keypress","touchstart","mousedown"].forEach((function(e){document.addEventListener(e,Jt,{capture:!0,passive:!0})})),self.MutationObserver&&new MutationObserver(Jt).observe(document.documentElement,{childList:!0,subtree:!0,attributes:!0}));const nn="BroadcastChannel"in self?self.BroadcastChannel:class extends bt{addEventListener(e,t){super.addEventListener(e,(n=>{t(new MessageEvent(e,{data:n}))}))}};const sn=g(!1)?Lt.postMessage:postMessage,on=(self.requestIdleCallback,self.cancelIdleCallback,new nn("window")),an=new nn("display-log"),rn=new nn("worker-tick");new nn("worker-paint");"window"in self&&on.addEventListener("message",(e=>{const{data:t}=e;if(t instanceof Object)switch(t.method){case"shatdown":self.close();break;case"reload":self.location.reload()}}));const ln={},hn=new Array;let pn=!1,cn=!1;function dn(){pn=!0}function un(){pn=!1}function mn(){cn=!0}function gn(){cn=!1}function fn(e,t){hn.push({id:e,message:t})}"window"in self&&an.addEventListener("message",(e=>{const{data:t}=e;if(t instanceof Object)switch(t.method){case"enable":pn=!0;break;case"disable":pn=!1;break;case"log":cn=!1;for(const e in t.messages){const{id:n,message:i}=t.messages[e];ln[n]=i}const e=Object.values(t.messages);for(const t in ln)e.some((e=>e.id===t))||delete ln[t];break;case"stop":cn=!0}}));class yn{constructor(e){this.id=Ve(),this.components=new WeakMap,this.live=!0,this.isUpdate=!0;for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];this.setComponents(...n),this.names="".concat(e.length>0?"".concat(e," "):"").concat(this.id).split(" ")}getID(){return this.id}getNames(){return[...this.names]}addNames(){for(let e=0,t=0|arguments.length;e<t;e=e+1|0){const t=e<0||arguments.length<=e?void 0:arguments[e];this.names.includes(t)||(this.names.push(t),this.isUpdate=!0)}}removeNames(){for(let e=0,t=0|arguments.length;e<t;e=e+1|0){const t=e<0||arguments.length<=e?void 0:arguments[e];this.names.includes(t)&&(this.names.splice(this.names.indexOf(t),1),this.isUpdate=!0)}}hasComponent(e){return this.components.has(e)}setComponents(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];t.forEach((e=>{if(!e)return;let t=e;do{this.components.set(t.constructor,e)}while(null!==(t=t.constructor.prototype.__proto__));this.isUpdate=!0}))}getComponent(e){return this.components.get(e)}removeComponent(e){this.components.has(e)&&(this.components.delete(e),this.isUpdate=!0)}checkUpdate(){const{isUpdate:e}=this;return this.isUpdate=!1,e}hasUpdate(){return this.isUpdate}hasLive(){return this.live}remove(){this.live=!1}destroy(){}}class wn{constructor(e){this.id=Ve(),this.components=new Array,this.entity=e;for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];this.components.push(...n)}hasEntity(e){return e instanceof this.entity&&!this.components.some((t=>!e.hasComponent(t)))}additional(e,t,n){}movable(e,t,n){}physical(e,t,n){}offset(e,t,n){}preadditional(e,t){}premovable(e,t){}prephysical(e,t){}preoffset(e,t){}ending(e,t){}rendering(e,t){}destructor(e,t){}}class xn extends y{constructor(){super(...arguments),this.id=Ve(),this.additionals=new Array,this.movables=new Array,this.physicals=new Array,this.offsets=new Array,this.preadditionals=new Array,this.premovables=new Array,this.prephysicals=new Array,this.preoffsets=new Array,this.endings=new Array,this.renderings=new Array,this.destructors=new Array,this.heapSystem=new WeakMap,this.entitys=new Array,this.stands=new Array,this.entitysID={},this.entitysName={}}getID(){return this.id}addSystems(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];t.forEach((e=>{e.additional!==wn.prototype.additional&&this.additionals.push(e),e.movable!==wn.prototype.movable&&this.movables.push(e),e.physical!==wn.prototype.physical&&this.physicals.push(e),e.offset!==wn.prototype.offset&&this.offsets.push(e),e.preadditional!==wn.prototype.preadditional&&this.preadditionals.push(e),e.premovable!==wn.prototype.premovable&&this.premovables.push(e),e.prephysical!==wn.prototype.prephysical&&this.prephysicals.push(e),e.preoffset!==wn.prototype.preoffset&&this.preoffsets.push(e),e.rendering!==wn.prototype.ending&&this.endings.push(e),e.rendering!==wn.prototype.rendering&&this.renderings.push(e),e.destructor!==wn.prototype.destructor&&this.destructors.push(e)}))}check(){for(;this.stands.length>0;){const e=this.stands.shift()||null;if(null===e||!e.hasLive()||this.entitys.includes(e))continue;this.entitys.push(e),this.entitysID[e.getID()]=e;const t=e.getNames();for(let n=0,i=0|t.length;n<i;n=n+1|0){const i=t[n];this.entitysName.hasOwnProperty(i)||(this.entitysName[i]=new Array),this.entitysName[i].push(e)}}}syncEntitys(){const e=[...this.additionals,...this.movables,...this.physicals,...this.offsets,...this.renderings,...this.destructors];for(let t=0,n=0|arguments.length;t<n;t=t+1|0){const n=t<0||arguments.length<=t?void 0:arguments[t],i=n.getNames();for(let e=0,t=0|i.length;e<t;e=e+1|0){const t=i[e];this.entitysName.hasOwnProperty(t)||(this.entitysName[t]=new Array),this.entitysName[t].push(n)}for(const e in this.entitysName){const t=this.entitysName[e];t.includes(n)&&(t.splice(t.indexOf(n),1),0===t.length&&delete this.entitysName[e])}for(let t=0,i=0|e.length;t<i;t=t+1|0){const i=e[t];this.heapSystem.has(i)||this.heapSystem.set(i,new Array);const s=this.heapSystem.get(i)||[];i.hasEntity(n)?s.includes(n)||s.push(n):s.includes(n)&&s.splice(s.indexOf(n),1)}}}addEntitys(){for(let e=0,t=0|arguments.length;e<t;e=e+1|0){const t=e<0||arguments.length<=e?void 0:arguments[e];this.entitys.includes(t)||this.stands.includes(t)||this.stands.push(t)}}removeEntitys(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var i;const s=[...this.additionals,...this.movables,...this.physicals,...this.offsets];for(let e=0,n=0|this.destructors.length;e<n;e=e+1|0){const n=this.destructors[e],s=((null===(i=this.heapSystem.get(n))||void 0===i?void 0:i.slice())||[]).filter((e=>t.includes(e)));for(let e=0,t=0|s.length;e<t;e=e+1|0){const t=s[e];(!t.hasUpdate()||n.hasEntity(t))&&n.destructor(t,this)}}for(let e=0,n=0|t.length;e<n;e=e+1|0){const n=t[e];this.entitys.splice(this.entitys.indexOf(n),1),delete this.entitysID[n.getID()];for(const e in this.entitysName){const t=this.entitysName[e];t.includes(n)&&(t.splice(t.indexOf(n),1),0===t.length&&delete this.entitysName[e])}n.destroy();for(let e=0,t=0|s.length;e<t;e=e+1|0){const t=s[e],i=this.heapSystem.get(t)||[];i.includes(n)&&i.splice(i.indexOf(n),1)}}}hasEntity(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.some((e=>e.hasLive()&&-1!==Object.keys(this.entitys).indexOf(e.getID())))}getEntitys(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e=>!0;return this.entitys.filter((t=>t.hasLive()&&e(t)))}getEntityOfID(e){if(!this.entitysID.hasOwnProperty(e))return null;const t=this.entitysID[e];return t.hasLive()?t:null}getEntitysOfName(){const e=new Array;for(let t=0,n=0|arguments.length;t<n;t=t+1|0){const n=t<0||arguments.length<=t?void 0:arguments[t];this.entitysName.hasOwnProperty(n)&&e.push(...this.entitysName[n].filter((t=>t.hasLive()&&!e.includes(t))))}return e}clear(){for(let e=0,t=0|this.stands.length;e<t;e=e+1|0)this.stands[e].remove();for(let e=0,t=0|this.entitys.length;e<t;e=e+1|0)this.entitys[e].remove();super.clear()}onupdate(e){var t,n,s,o;const{time:a,now:r,framerate:l,fps:h}=e;new i(this,"ecsbegin").trigger({time:a,now:r,framerate:l,fps:h});const p=new Array,c=new Array;let d=0;for(let e=0,t=0|this.entitys.length;e<t;e=e+1|0){const t=this.entitys[e];if(t.hasLive()){if(d++,!t.checkUpdate())continue;p.push(t)}else c.push(t)}p.length>0&&this.syncEntitys(...p),c.length>0&&this.removeEntitys(...c),fn("entity","entitys:".concat(d)),new i(this,"beforeadditional").trigger({time:a,now:r,framerate:l,fps:h});for(let e=0,t=0|this.preadditionals.length;e<t;e=e+1|0){this.preadditionals[e].preadditional(a,this)}for(let e=0,n=0|this.additionals.length;e<n;e=e+1|0){const n=this.additionals[e],i=(null===(t=this.heapSystem.get(n))||void 0===t?void 0:t.slice())||[];for(let e=0,t=0|i.length;e<t;e=e+1|0){const t=i[e];t.hasLive()&&(!t.hasUpdate()||n.hasEntity(t))&&n.additional(a,t,this)}}new i(this,"beforemoveble").trigger({time:a,now:r,framerate:l,fps:h});for(let e=0,t=0|this.premovables.length;e<t;e=e+1|0){this.premovables[e].premovable(a,this)}for(let e=0,t=0|this.movables.length;e<t;e=e+1|0){const t=this.movables[e],i=(null===(n=this.heapSystem.get(t))||void 0===n?void 0:n.slice())||[];for(let e=0,n=0|i.length;e<n;e=e+1|0){const n=i[e];n.hasLive()&&(!n.hasUpdate()||t.hasEntity(n))&&t.movable(a,n,this)}}new i(this,"beforephysical").trigger({time:a,now:r,framerate:l,fps:h});for(let e=0,t=0|this.prephysicals.length;e<t;e=e+1|0){this.prephysicals[e].prephysical(a,this)}for(let e=0,t=0|this.physicals.length;e<t;e=e+1|0){const t=this.physicals[e],n=(null===(s=this.heapSystem.get(t))||void 0===s?void 0:s.slice())||[];for(let e=0,i=0|n.length;e<i;e=e+1|0){const i=n[e];i.hasLive()&&(!i.hasUpdate()||t.hasEntity(i))&&t.physical(a,i,this)}}new i(this,"beforeoffset").trigger({time:a,now:r,framerate:l,fps:h});for(let e=0,t=0|this.preoffsets.length;e<t;e=e+1|0){this.preoffsets[e].preoffset(a,this)}for(let e=0,t=0|this.offsets.length;e<t;e=e+1|0){const t=this.offsets[e],n=(null===(o=this.heapSystem.get(t))||void 0===o?void 0:o.slice())||[];for(let e=0,i=0|n.length;e<i;e=e+1|0){const i=n[e];i.hasLive()&&(!i.hasUpdate()||t.hasEntity(i))&&t.offset(a,i,this)}}this.check(),new i(this,"ecsend").trigger({time:a,now:r,framerate:l,fps:h})}onupdateend(e){var t;for(let e=0,n=0|this.endings.length;e<n;e=e+1|0){const n=this.endings[e],i=(null===(t=this.heapSystem.get(n))||void 0===t?void 0:t.slice())||[];for(let e=0,t=0|i.length;e<t;e=e+1|0){const t=i[e];t.hasLive()&&(!t.hasUpdate()||n.hasEntity(t))&&n.ending(t,this)}}}onpaint(e){var t;for(let e=0,n=0|this.renderings.length;e<n;e=e+1|0){const n=this.renderings[e],i=(null===(t=this.heapSystem.get(n))||void 0===t?void 0:t.slice())||[];for(let e=0,t=0|i.length;e<t;e=e+1|0){const t=i[e];t.hasLive()&&(!t.hasUpdate()||n.hasEntity(t))&&n.rendering(t,this)}}}}class Mn extends yn{constructor(){super(...arguments),this.position=new C(0,0,0),this.direction=new C(0,0,0)}}class En{constructor(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.size=new E(e,t),this.treeFix=n}}class Cn{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,s=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5&&void 0!==arguments[5]&&arguments[5];this.material=e,this.scale=t,this.rotate=n,this.bounding=i,this.flip={x:s,y:o}}}class vn{constructor(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.axes={x:e,y:t,z:n},this.bottom=i}}class bn{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;this.fix=new C(0,0,0),this.fixRotate=0,this.position=new C(e,t,n),this.scale=i,this.rotate=s}}class _n{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Array,i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this.init=!1,this.enable=!0,this.old=new C(-1,-1,-1),this.targets=new Array,this.size=new E(e,t),this.filter=n,this.treeFix=i}}class Sn{constructor(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.size=new E(e,t),this.treeFix=n}}class kn{constructor(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;this.cost=0,this.x=e,this.y=t,this.z=n,this.stepX=i,this.stepY=s,this.stepZ=o,this.step=null===a?0:a.step+1,this.prev=a}getCost(e,t,n){return P(e,t,n,this.x,this.y,this.z)+this.step}}class Tn{constructor(e){this.finish=!0,this.find=!1,this.start=new kn(0,0,0),this.hasSearch={},this.searchPoint=new Array,this.stack=new Array,this.dimension=e?3:2}hasFinish(){return this.finish}begin(e,t,n){this.finish=!1,this.find=!1,this.start=new kn(.5+(0|e),.5+(0|t),.5+(0|n)),this.hasSearch={},me(this.searchPoint),this.searchPoint.push(this.start)}close(e){if(null!==e){me(this.stack);let t=e,n=null;do{t!==e&&(t===this.start||null!==n&&t.stepX===n.stepX&&t.stepY===n.stepY&&t.stepZ===n.stepZ)||(n=t,this.stack.unshift(t.x,t.y,t.z))}while(null!==(t=t.prev));this.find=!0}else this.find=!1;this.finish=!0}}class Pn{constructor(){this.stacks=new Array,this.queue=new Array,this.sorts=new WeakMap,this.block={block:!1}}find(e,t,n,i){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:e=>({block:!1}),o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:e=>!0,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:e=>e.step,r=arguments.length>7&&void 0!==arguments[7]?arguments[7]:()=>!0,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:()=>0;const h=[];return new Promise(((p,c)=>{if(!e.hasFinish())return;const d=(3===e.dimension?Ie:Pe).slice(),{block:u}=this;let m=0;e.begin(.5+(0|t),.5+(0|n),.5+(0|i));const g=this;this.queue.push(function*(){yield()=>0;let t=!1;do{t&&ue(e.searchPoint).asc((e=>e.cost)),t=!1;const n=e.searchPoint.shift();if(void 0===n||!r())break;if(o(n)){e.close(n),p(null);break}ge(d);for(let i=0|d.length;m<i;m=m+1|0){const[i,o,r]=d[m],h=i+(0|n.x)|0,p=o+(0|n.y)|0,c=r+(0|n.z)|0;let f=g.stacks.shift()||null;null===f?f=new kn(h+.5,p+.5,c+.5,i,o,r,n):(f.x=h+.5,f.y=p+.5,f.z=c+.5,f.stepX=i,f.stepY=o,f.stepZ=r,f.prev=n,f.cost=0),u.block=!1,delete u.label,s(f,u);let y="".concat(h,",").concat(p,",").concat(c);void 0!==u.label&&(y="".concat(y,"-").concat(u.label)),e.hasSearch[y]||(e.hasSearch[y]=!0,u.block||(f.cost=a(f),t=!0,e.searchPoint.push(f))),yield l}m=0,h.push(n)}while(e.searchPoint.length>0);return e.close(null),c(),!0}())})).finally((()=>{this.stacks.push(...h)}))}update(e){ue(this.queue).asc((e=>(this.sorts.get(e)||(()=>0))()));const t=performance.now();do{const e=this.queue.shift()||null;if(null===e)break;{const t=e.next();t.done||(this.sorts.set(e,t.value),this.queue.push(e))}}while(performance.now()-t<e&&this.queue.length>0)}}class In{constructor(e,t){this.src=e,this.index=t}}function Ln(e){return btoa(unescape(encodeURIComponent(e)))}let On=!1;const An=new nn("file");function Wn(e,t){switch(e.toLowerCase()){case"text":return t.text();case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"json":return t.json();case"xml":return t.text().then((e=>(new DOMParser).parseFromString(e,"text/xml")));case"html":return t.text().then((e=>(new DOMParser).parseFromString(e,"text/html")))}return null}async function Nn(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"text",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{method:"GET",mode:"cors",cache:"no-store",credentials:"same-origin"};try{return await It(e,n).then((async e=>e.ok?await Wn(t,e):null))}catch(e){return console.error(e),null}}async function zn(e){let t=null;On=!0;try{const n=prompt(e);null!==n&&(t=await Nn(n,"text"))}catch(e){console.error(e)}finally{On=!1}return t}async function Dn(e,t,n,i,s){let o=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const a=o?e:"".concat(prompt("enter file name")||e).concat(n?"."+n[0]:"");switch(On=!0,i){case"text":s="data:".concat(t?t[0]:"",";charset=utf-8;base64,").concat(Ln(s));break;case"blob":s=URL.createObjectURL(new Blob([s],{type:t[0]}))}const r=document.createElement("a");r.href=s,r.download=a,document.body.appendChild(r),r.click(),r.remove(),"blob"===i&&URL.revokeObjectURL(s),await new Promise((e=>{const t=()=>{self.removeEventListener("focus",t,!1),e(null)};self.addEventListener("focus",t,!1)})),On=!1}function Rn(){return On}async function Hn(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"text",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=e;if(/^(data|blob):/.test(e)||new RegExp("^".concat(location.origin)).test(e))i=e;else if("file:"!==location.protocol){const t=/^http:\/\/[^\/]+\/$|^file:\/\/[^\/]+\/$|^http:\/\/$|^file:\/\/$/.test(location.origin)?location.origin.substring(0,location.origin.length-1):location.origin,n=(/^http:\/\/|^file:\/\//.test(location.pathname)||0===location.pathname.length?"/":location.pathname).replace(/\/[^\/]+$/,"/");i="".concat(t).concat(n).concat(e.replace(/^\.\/|^\//,""))}const s=await Nn(i,t,n);if(null===s)throw new Error("Not found file is ".concat(e));return{source:s,src:i}}function Fn(e){return It(e).then((()=>!0)).catch((()=>!1))}async function Un(e,t,n){return g()?await new Promise((i=>{const s=e=>{const{data:t}=e;if(t instanceof Object&&(An.removeEventListener("message",s),"return"===t.method))t.data&&i(t.data)};An.addEventListener("message",s),An.postMessage({method:"open",description:e,mimeTypes:t,extensions:n})})):"showOpenFilePicker"in window&&self.isSecureContext?await async function(e,t,n){let i=null;On=!0;try{const s=(await showOpenFilePicker({types:[{description:e,accept:(()=>{const e={};return e[t[0]]=n.map((e=>".".concat(e))),e})()}]}))[0];if("granted"===await s.requestPermission({mode:"read"})){const e=await s.getFile();i=await e.text()}else zn(e)}catch(e){console.error(e.message)}finally{On=!1}return i}(e,t,n):zn(e)}async function Bn(e,t,n,i,s){g()?await new Promise((o=>{const a=e=>{An.removeEventListener("message",a),o(null)};An.addEventListener("message",a),An.postMessage({method:"save",description:e,mimeTypes:t,extensions:n,type:i,text:s})})):"showSaveFilePicker"in self&&self.isSecureContext?await async function(e,t,n,i,s){let o="boxengine-file".concat(n?"."+n[0]:""),a=null;On=!0;try{const r=await window.showSaveFilePicker({types:[{description:e,accept:(()=>{const e={};return e[t[0]]=n.map((e=>".".concat(e))),e})()}]});o=r.name,"granted"===await r.requestPermission({mode:"readwrite"})?(a=await r.createWritable(),await a.truncate(0),await a.write(s)):await Dn(o,t,n,i,s instanceof Function?s():s,!0)}catch(e){console.error("Cannot save complete.")}finally{null!==a&&await a.close(),On=!1}}(e,t,n,i,s):Dn("boxengine-file",t,n,i,s instanceof Function?s():s)}g()||An.addEventListener("message",(async e=>{const{data:t}=e;if(!(t instanceof Object))return;let n=null;switch(t.method){case"open":n=await Un(t.description,t.mimeTypes,t.extensions);break;case"save":await Bn(t.description,t.mimeTypes,t.extensions,t.type,t.text)}An.postMessage({method:"return",data:n})}));class Yn{constructor(){this.data=Array(),this.locations=new Array,this.isTransfer=!1;for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.src=t}async load(){0===this.data.length&&(this.data=await Promise.all(this.src.map((async e=>(await Hn(e)).source))))}hasTransfer(){return this.isTransfer}createTransferData(){return this.isTransfer=!0,{src:this.src,locations:this.locations}}}class Gn extends Yn{async load(){0===this.data.length&&(this.data=await Promise.all(this.src.map((async e=>await async function(e){let t;if("createImageBitmap"in self){const n=(await Hn(e,"blob")).source;t=await createImageBitmap(n)}else Image.prototype.decode?(t=new Image,await t.decode()):t=await new Promise((t=>{const n=new Image;n.onload=()=>{t(n)},n.onerror=()=>{throw new Error("Not found image to ".concat(e))},n.src=e}));return t}(e)))))}}class Vn extends Gn{}class Xn{constructor(e,t,n,i,s,o,a,r,l){let h=arguments.length>9&&void 0!==arguments[9]&&arguments[9],p=arguments.length>10&&void 0!==arguments[10]&&arguments[10],c=arguments.length>11&&void 0!==arguments[11]&&arguments[11],d=arguments.length>12&&void 0!==arguments[12]&&arguments[12],u=arguments.length>13&&void 0!==arguments[13]&&arguments[13],m=arguments.length>14&&void 0!==arguments[14]&&arguments[14],g=arguments.length>15&&void 0!==arguments[15]&&arguments[15],f=arguments.length>16&&void 0!==arguments[16]&&arguments[16],y=arguments.length>17&&void 0!==arguments[17]&&arguments[17],w=arguments.length>18&&void 0!==arguments[18]&&arguments[18],x=arguments.length>19&&void 0!==arguments[19]&&arguments[19],M=arguments.length>20&&void 0!==arguments[20]&&arguments[20];this.flipXFront=!1,this.flipYFront=!1,this.flipXBack=!1,this.flipYBack=!1,this.flipXRight=!1,this.flipYRight=!1,this.flipXLeft=!1,this.flipYLeft=!1,this.flipXTop=!1,this.flipYTop=!1,this.flipXBottom=!1,this.flipYBottom=!1,this.position=new C(e,t,n),this.front=i,this.back=s,this.right=o,this.left=a,this.top=r,this.bottom=l,this.flipXFront=h,this.flipYFront=p,this.flipXBack=c,this.flipYBack=d,this.flipXRight=u,this.flipYRight=m,this.flipXLeft=g,this.flipYLeft=f,this.flipXTop=y,this.flipYTop=w,this.flipXBottom=x,this.flipYBottom=M}}const jn=["touchstart","touchend","mousedown","keydown"],Kn=new WeakMap;function Jn(e){if(Kn.get(e)||"suspended"!==e.state)return e;const t=self.document.body;function n(){e.resume().then(i)}function i(){jn.forEach((e=>t.removeEventListener(e,n))),Kn.delete(e)}return jn.forEach((e=>t.addEventListener(e,n,!1))),Kn.set(e,!0),e}let qn=null;if("AudioContext"in self){qn=new AudioContext;try{Jn(qn)}catch(e){self.addEventListener("load",(()=>qn&&Jn(qn)))}}class Zn extends Yn{async load(){0===this.data.length&&(this.data=await Promise.all(this.src.map((async e=>qn?qn.decodeAudioData((await Hn(e,"arraybuffer")).source):null))))}}new Gn("./asset/font.png"),new Gn("./asset/icon.png"),new Gn("./asset/key.png"),new Gn("./asset/horde_badge.png"),new Gn("./asset/title-prod.png"),new Gn("./asset/title-demo.png"),new Gn("./asset/how_to_play_keyboard.png"),new Gn("./asset/how_to_play_gamepad.png"),new Gn("./asset/memberscard/members.png"),new Gn("./asset/memberscard/silver.png"),new Gn("./asset/memberscard/gold.png"),new Gn("./asset/memberscard/platinum.png"),new Gn("./asset/memberscard/diamond.png"),new Vn("./asset/wall/default.albedo.png","./asset/wall/default.pbr.png","./asset/wall/default.normal.png"),new Vn("./asset/wall/desert.albedo.png","./asset/wall/desert.pbr.png","./asset/wall/desert.normal.png"),new Vn("./asset/hud/hand.albedo.png","./asset/hud/hand.pbr.png","./asset/hud/hand.normal.png"),new Vn("./asset/hud/foot.albedo.png","./asset/hud/foot.pbr.png","./asset/hud/foot.normal.png"),new Vn("./asset/hud/slowball.albedo.png","./asset/hud/slowball.pbr.png","./asset/hud/slowball.normal.png"),new Vn("./asset/hud/binoculars.albedo.png","./asset/hud/binoculars.pbr.png","./asset/hud/binoculars.normal.png"),new Vn("./asset/hud/energyshield.albedo.png","./asset/hud/energyshield.pbr.png","./asset/hud/energyshield.normal.png"),new Vn("./asset/hud/combobooster.albedo.png","./asset/hud/combobooster.pbr.png","./asset/hud/combobooster.normal.png"),new Vn("./asset/hud/hookshot.albedo.png","./asset/hud/hookshot.pbr.png","./asset/hud/hookshot.normal.png"),new Vn("./asset/hud/pistol.albedo.png","./asset/hud/pistol.pbr.png","./asset/hud/pistol.normal.png"),new Vn("./asset/hud/handcannon.albedo.png","./asset/hud/handcannon.pbr.png","./asset/hud/handcannon.normal.png"),new Vn("./asset/hud/machingun.albedo.png","./asset/hud/machingun.pbr.png","./asset/hud/machingun.normal.png"),new Vn("./asset/hud/chainshotgun.albedo.png","./asset/hud/chainshotgun.pbr.png","./asset/hud/chainshotgun.normal.png"),new Vn("./asset/hud/shotgun.albedo.png","./asset/hud/shotgun.pbr.png","./asset/hud/shotgun.normal.png"),new Vn("./asset/hud/heavycannon.albedo.png","./asset/hud/heavycannon.pbr.png","./asset/hud/heavycannon.normal.png"),new Vn("./asset/hud/launcher.albedo.png","./asset/hud/launcher.pbr.png","./asset/hud/launcher.normal.png"),new Vn("./asset/hud/clusterbow.albedo.png","./asset/hud/clusterbow.pbr.png","./asset/hud/clusterbow.normal.png"),new Vn("./asset/hud/plasmagun.albedo.png","./asset/hud/plasmagun.pbr.png","./asset/hud/plasmagun.normal.png"),new Vn("./asset/hud/plasmasmg.albedo.png","./asset/hud/plasmasmg.pbr.png","./asset/hud/plasmasmg.normal.png"),new Vn("./asset/entity/debug.albedo.png","./asset/entity/debug.pbr.png","./asset/entity/debug.normal.png"),new Vn("./asset/entity/ui.albedo.png","./asset/entity/ui.pbr.png","./asset/entity/ui.normal.png"),new Vn("./asset/entity/bullet.albedo.png","./asset/entity/bullet.pbr.png","./asset/entity/bullet.normal.png"),new Vn("./asset/entity/blood.albedo.png","./asset/entity/blood.pbr.png","./asset/entity/blood.normal.png"),new Vn("./asset/entity/acid.albedo.png","./asset/entity/acid.pbr.png","./asset/entity/acid.normal.png"),new Vn("./asset/entity/gib.albedo.png","./asset/entity/gib.pbr.png","./asset/entity/gib.normal.png"),new Vn("./asset/entity/hit.albedo.png","./asset/entity/hit.pbr.png","./asset/entity/hit.normal.png"),new Vn("./asset/entity/ring.albedo.png","./asset/entity/ring.pbr.png","./asset/entity/ring.normal.png"),new Vn("./asset/entity/stuff.albedo.png","./asset/entity/stuff.pbr.png","./asset/entity/stuff.normal.png"),new Vn("./asset/entity/spark.albedo.png","./asset/entity/spark.pbr.png","./asset/entity/spark.normal.png"),new Vn("./asset/entity/explode.albedo.png","./asset/entity/explode.pbr.png","./asset/entity/explode.normal.png"),new Vn("./asset/entity/flame.albedo.png","./asset/entity/flame.pbr.png","./asset/entity/flame.normal.png"),new Vn("./asset/entity/enemy-guy.albedo.png","./asset/entity/enemy-guy.pbr.png","./asset/entity/enemy-guy.normal.png"),new Vn("./asset/entity/helmet.albedo.png","./asset/entity/helmet.pbr.png","./asset/entity/helmet.normal.png"),new Vn("./asset/entity/enemy-armor.albedo.png","./asset/entity/enemy-armor.pbr.png","./asset/entity/enemy-armor.normal.png"),new Vn("./asset/entity/object.albedo.png","./asset/entity/object.pbr.png","./asset/entity/object.normal.png"),new Vn("./asset/entity/checkpoint.albedo.png","./asset/entity/checkpoint.pbr.png","./asset/entity/checkpoint.normal.png"),new Vn("./asset/entity/spawner.albedo.png","./asset/entity/spawner.pbr.png","./asset/entity/spawner.normal.png"),new Vn("./asset/entity/health.albedo.png","./asset/entity/health.pbr.png","./asset/entity/health.normal.png"),new Vn("./asset/entity/armor.albedo.png","./asset/entity/armor.pbr.png","./asset/entity/armor.normal.png"),new Vn("./asset/entity/stamina.albedo.png","./asset/entity/stamina.pbr.png","./asset/entity/stamina.normal.png"),new Vn("./asset/entity/ammo.albedo.png","./asset/entity/ammo.pbr.png","./asset/entity/ammo.normal.png"),new Vn("./asset/entity/weapon.albedo.png","./asset/entity/weapon.pbr.png","./asset/entity/weapon.normal.png"),new Vn("./asset/entity/key.albedo.png","./asset/entity/key.pbr.png","./asset/entity/key.normal.png"),new Zn("./asset/sound/menu/press.mp3"),new Zn("./asset/sound/menu/cancel.mp3"),new Zn("./asset/sound/menu/scroll.mp3"),new Zn("./asset/sound/menu/move.mp3"),new Zn("./asset/sound/menu/buy.mp3"),new Zn("./asset/sound/effect/explode.mp3"),new Zn("./asset/sound/effect/corrosive.mp3"),new Zn("./asset/sound/effect/splash.mp3"),new Zn("./asset/sound/effect/head-shot.mp3"),new Zn("./asset/sound/effect/bullet-wall-spark.mp3"),new Zn("./asset/sound/effect/mine-drop.wav"),new Zn("./asset/sound/effect/damage-ammo.mp3"),new Zn("./asset/sound/effect/damage-melee.mp3"),new Zn("./asset/sound/effect/damage-magic.mp3"),new Zn("./asset/sound/effect/damage-slash.mp3"),new Zn("./asset/sound/effect/damage-flame.mp3"),new Zn("./asset/sound/effect/damage-corrosive1.mp3"),new Zn("./asset/sound/effect/damage-corrosive2.mp3"),new Zn("./asset/sound/weapon/punch-fire.mp3"),new Zn("./asset/sound/weapon/punch-fire-charge.mp3"),new Zn("./asset/sound/weapon/combobooster-fire.mp3"),new Zn("./asset/sound/weapon/combobooster-loop.mp3"),new Zn("./asset/sound/weapon/pistol-fire.mp3"),new Zn("./asset/sound/weapon/hook-fire.mp3"),new Zn("./asset/sound/weapon/hook-bullet.mp3"),new Zn("./asset/sound/weapon/machingun-fire.mp3"),new Zn("./asset/sound/weapon/chainshotgun-fire.wav"),new Zn("./asset/sound/weapon/chainshotgun-start.wav"),new Zn("./asset/sound/weapon/chainshotgun-loop.wav"),new Zn("./asset/sound/weapon/chainshotgun-end.wav"),new Zn("./asset/sound/weapon/heavycannon-fire.mp3"),new Zn("./asset/sound/weapon/heavycannon-fire-charge.wav"),new Zn("./asset/sound/weapon/heavycannon-pump.mp3"),new Zn("./asset/sound/weapon/shotgun-fire.mp3"),new Zn("./asset/sound/weapon/shotgun-pump.mp3"),new Zn("./asset/sound/weapon/launcher-fire.mp3"),new Zn("./asset/sound/weapon/launcher-pump.mp3"),new Zn("./asset/sound/weapon/clusterbow-fire.wav"),new Zn("./asset/sound/weapon/plasmagun-fire.mp3"),new Zn("./asset/sound/weapon/plasmasmg-fire.mp3"),new Zn("./asset/sound/weapon/out-of-ammo.mp3"),new Zn("./asset/sound/weapon/charge-loop.mp3"),new Zn("./asset/sound/weapon/charge-complete.mp3"),new Zn("./asset/sound/combo/up.mp3"),new Zn("./asset/sound/combo/down.mp3"),new Zn("./asset/sound/item/ammo.mp3"),new Zn("./asset/sound/item/weapon.mp3"),new Zn("./asset/sound/item/key.mp3"),new Zn("./asset/sound/item/meat-1.mp3"),new Zn("./asset/sound/item/meat-2.mp3"),new Zn("./asset/sound/item/meat-3.mp3"),new Zn("./asset/sound/item/meat-mute.mp3"),new Zn("./asset/sound/item/armor.mp3"),new Zn("./asset/sound/item/stamina.mp3"),new Zn("./asset/sound/item/checkpoint.mp3"),new Zn("./asset/sound/item/spawn.mp3"),new Zn("./asset/sound/player/step-1.mp3"),new Zn("./asset/sound/player/step-2.mp3"),new Zn("./asset/sound/player/step-3.mp3"),new Zn("./asset/sound/player/step-4.mp3"),new Zn("./asset/sound/player/landing.mp3"),new Zn("./asset/sound/player/grab.mp3"),new Zn("./asset/sound/player/climb.mp3"),new Zn("./asset/sound/player/sliding.mp3"),new Zn("./asset/sound/player/wallrun.mp3"),new Zn("./asset/sound/player/open.mp3"),new Zn("./asset/sound/player/lock.mp3"),new Zn("./asset/sound/enemy/no-damage.mp3"),new Zn("./asset/sound/enemy/find-pistol-1.mp3"),new Zn("./asset/sound/enemy/find-pistol-2.mp3"),new Zn("./asset/sound/enemy/find-pistol-3.mp3"),new Zn("./asset/sound/enemy/find-pistol-4.mp3"),new Zn("./asset/sound/enemy/find-shotgun-1.mp3"),new Zn("./asset/sound/enemy/find-shotgun-2.mp3"),new Zn("./asset/sound/enemy/find-shotgun-3.mp3"),new Zn("./asset/sound/enemy/find-shotgun-4.mp3"),new Zn("./asset/sound/enemy/find-shotgun-5.mp3"),new Zn("./asset/sound/enemy/find-machingun-1.mp3"),new Zn("./asset/sound/enemy/find-machingun-2.mp3"),new Zn("./asset/sound/enemy/find-machingun-3.mp3"),new Zn("./asset/sound/enemy/find-melee-1.mp3"),new Zn("./asset/sound/enemy/find-melee-2.mp3"),new Zn("./asset/sound/enemy/find-melee-3.mp3"),new Zn("./asset/sound/enemy/pain-pistol-1.mp3"),new Zn("./asset/sound/enemy/pain-pistol-2.mp3"),new Zn("./asset/sound/enemy/pain-shotgun-1.mp3"),new Zn("./asset/sound/enemy/pain-shotgun-2.mp3"),new Zn("./asset/sound/enemy/pain-machingun-1.mp3"),new Zn("./asset/sound/enemy/pain-machingun-2.mp3"),new Zn("./asset/sound/enemy/pain-melee-1.mp3"),new Zn("./asset/sound/enemy/pain-melee-2.mp3"),new Zn("./asset/sound/enemy/death-pistol-1.mp3"),new Zn("./asset/sound/enemy/death-shotgun-1.mp3"),new Zn("./asset/sound/enemy/death-machingun-1.mp3"),new Zn("./asset/sound/enemy/death-melee-1.mp3"),new Zn("./asset/sound/enemy/death-armor.mp3"),new Zn("./asset/sound/enemy/fire-melee.mp3"),new Zn("./asset/sound/enemy/fire-magic.mp3"),new Zn("./asset/sound/system/help.mp3");const Qn=["./asset/sound/item/ammo.mp3"],$n=["./asset/sound/item/weapon.mp3"],ei=["./asset/sound/item/key.mp3"],ti=["./asset/sound/item/meat-1.mp3","./asset/sound/item/meat-2.mp3","./asset/sound/item/meat-3.mp3"],ni=["./asset/sound/item/meat-mute.mp3"],ii=["./asset/sound/item/armor.mp3"],si=["./asset/sound/item/stamina.mp3"],oi={NONE:new In("./asset/wall/default.albedo.png",0),EPISODE1_DOOR_DEFAULT:new In("./asset/wall/default.albedo.png",1),EPISODE1_DOOR_RED:new In("./asset/wall/default.albedo.png",2),EPISODE1_DOOR_BLUE:new In("./asset/wall/default.albedo.png",3),EPISODE1_DOOR_YELLOW:new In("./asset/wall/default.albedo.png",4),EPISODE1_GOLE_WALL:new In("./asset/wall/default.albedo.png",5),EPISODE1_SECRET_WALL:new In("./asset/wall/default.albedo.png",6),EPISODE1_FLOOR:new In("./asset/wall/default.albedo.png",7),EPISODE1_WALL:new In("./asset/wall/default.albedo.png",8),EPISODE1_CEIL:new In("./asset/wall/default.albedo.png",9),EPISODE1_WALL1:new In("./asset/wall/default.albedo.png",10),EPISODE1_WALL2:new In("./asset/wall/default.albedo.png",11),EPISODE1_GRAB_WALL:new In("./asset/wall/default.albedo.png",14),EPISODE1_ASSIST_GRAB_WALL:new In("./asset/wall/default.albedo.png",15),EPISODE1_WALLRUN_WALL:new In("./asset/wall/default.albedo.png",16),EPISODE1_EDIT_ZONE:new In("./asset/wall/default.albedo.png",17),EPISODE1_EDIT_BLOCK:new In("./asset/wall/default.albedo.png",18),EPISODE2_DOOR_DEFAULT:new In("./asset/wall/desert.albedo.png",1),EPISODE2_DOOR_RED:new In("./asset/wall/desert.albedo.png",2),EPISODE2_DOOR_BLUE:new In("./asset/wall/desert.albedo.png",3),EPISODE2_DOOR_YELLOW:new In("./asset/wall/desert.albedo.png",4),EPISODE2_GOLE_WALL:new In("./asset/wall/desert.albedo.png",5),EPISODE2_SECRET_WALL:new In("./asset/wall/desert.albedo.png",6),EPISODE2_FLOOR:new In("./asset/wall/desert.albedo.png",7),EPISODE2_WALL:new In("./asset/wall/desert.albedo.png",8),EPISODE2_CEIL:new In("./asset/wall/desert.albedo.png",9),EPISODE2_GRAB_WALL:new In("./asset/wall/desert.albedo.png",14),EPISODE2_ASSIST_GRAB_WALL:new In("./asset/wall/desert.albedo.png",15),EPISODE2_WALLRUN_WALL:new In("./asset/wall/desert.albedo.png",16),EPISODE2_EDIT_ZONE:new In("./asset/wall/desert.albedo.png",17),EPISODE2_EDIT_BLOCK:new In("./asset/wall/desert.albedo.png",18),HUD_HAND_GRIP:new In("./asset/hud/hand.albedo.png",0),HUD_HAND_STILL:new In("./asset/hud/hand.albedo.png",1),HUD_HAND_FIRE:new In("./asset/hud/hand.albedo.png",2),HUD_HAND_JUMP:new In("./asset/hud/hand.albedo.png",3),HUD_HAND_SPRINT:new In("./asset/hud/hand.albedo.png",4),HUD_HAND_AIR:new In("./asset/hud/hand.albedo.png",5),HUD_HAND_CHARGE:new In("./asset/hud/hand.albedo.png",6),HUD_HAND_ATTACK:new In("./asset/hud/hand.albedo.png",7),HUD_FOOT_SLIDING:new In("./asset/hud/foot.albedo.png",0),HUD_FOOT_COIL:new In("./asset/hud/foot.albedo.png",1),HUD_SLOWBALL_STILL:new In("./asset/hud/slowball.albedo.png",0),HUD_SLOWBALL_FIRE:new In("./asset/hud/slowball.albedo.png",1),HUD_BINOCULARS_STILL:new In("./asset/hud/binoculars.albedo.png",0),HUD_ENERGYSHIELD_STILL:new In("./asset/hud/energyshield.albedo.png",0),HUD_ENERGYSHIELD_EMPTY:new In("./asset/hud/energyshield.albedo.png",1),HUD_ENERGYSHIELD_FIRE:new In("./asset/hud/energyshield.albedo.png",2),HUD_COMBO_BOOSTER_STILL:new In("./asset/hud/combobooster.albedo.png",0),HUD_COMBO_BOOSTER_FIRE:new In("./asset/hud/combobooster.albedo.png",1),HUD_HOOKSHOT_STILL:new In("./asset/hud/hookshot.albedo.png",0),HUD_PISTOL_STILL:new In("./asset/hud/pistol.albedo.png",0),HUD_PISTOL_COCKING:new In("./asset/hud/pistol.albedo.png",1),HUD_PISTOL_FIRE:new In("./asset/hud/pistol.albedo.png",2),HUD_HANDCANNON_STILL:new In("./asset/hud/handcannon.albedo.png",0),HUD_HANDCANNON_COCKING:new In("./asset/hud/handcannon.albedo.png",1),HUD_HANDCANNON_FIRE:new In("./asset/hud/handcannon.albedo.png",2),HUD_MACHINGUN_STILL:new In("./asset/hud/machingun.albedo.png",0),HUD_MACHINGUN_COCKING:new In("./asset/hud/machingun.albedo.png",1),HUD_MACHINGUN_FIRE:new In("./asset/hud/machingun.albedo.png",2),HUD_CHAINSHOTGUN_STILL:new In("./asset/hud/chainshotgun.albedo.png",0),HUD_CHAINSHOTGUN_COCKING:new In("./asset/hud/chainshotgun.albedo.png",1),HUD_CHAINSHOTGUN_FIRE:new In("./asset/hud/chainshotgun.albedo.png",2),HUD_SHOTGUN_STILL:new In("./asset/hud/shotgun.albedo.png",0),HUD_SHOTGUN_COCKING:new In("./asset/hud/shotgun.albedo.png",1),HUD_SHOTGUN_FIRE:new In("./asset/hud/shotgun.albedo.png",2),HUD_HEAVYCANNON_STILL:new In("./asset/hud/heavycannon.albedo.png",0),HUD_HEAVYCANNON_COCKING:new In("./asset/hud/heavycannon.albedo.png",1),HUD_HEAVYCANNON_FIRE:new In("./asset/hud/heavycannon.albedo.png",2),HUD_LAUNCHER_STILL:new In("./asset/hud/launcher.albedo.png",0),HUD_LAUNCHER_COCKING:new In("./asset/hud/launcher.albedo.png",1),HUD_LAUNCHER_FIRE:new In("./asset/hud/launcher.albedo.png",2),HUD_CLUSTERBOW_STILL:new In("./asset/hud/clusterbow.albedo.png",0),HUD_CLUSTERBOW_FIRE:new In("./asset/hud/clusterbow.albedo.png",1),HUD_PLASMAGUN_STILL:new In("./asset/hud/plasmagun.albedo.png",0),HUD_PLASMAGUN_COCKING:new In("./asset/hud/plasmagun.albedo.png",1),HUD_PLASMAGUN_FIRE:new In("./asset/hud/plasmagun.albedo.png",2),HUD_PLASMASMG_STILL:new In("./asset/hud/plasmasmg.albedo.png",0),HUD_PLASMASMG_COCKING:new In("./asset/hud/plasmasmg.albedo.png",1),HUD_PLASMASMG_FIRE:new In("./asset/hud/plasmasmg.albedo.png",2),DEGUB_TARGET:new In("./asset/entity/debug.albedo.png",0),UI_START_POINT:new In("./asset/entity/ui.albedo.png",0),UI_GOLE_POINT:new In("./asset/entity/ui.albedo.png",1),UI_SECRET_POINT:new In("./asset/entity/ui.albedo.png",2),UI_HELP_POINT:new In("./asset/entity/ui.albedo.png",3),UI_HORDE_SPAWN_POINT:new In("./asset/entity/ui.albedo.png",4),UI_ANGLE:new In("./asset/entity/ui.albedo.png",5),EFFECT_BULLET_AMMO_TRAIL:new In("./asset/entity/bullet.albedo.png",0),EFFECT_BULLET_PLASMA_BALL:new In("./asset/entity/bullet.albedo.png",1),EFFECT_BULLET_HOOK_HEAD:new In("./asset/entity/bullet.albedo.png",2),EFFECT_BULLET_HOOK_CHAIN:new In("./asset/entity/bullet.albedo.png",3),EFFECT_BULLET_GRENADE:new In("./asset/entity/bullet.albedo.png",3),EFFECT_BULLET_LASER_TRAIL:new In("./asset/entity/bullet.albedo.png",4),EFFECT_BULLET_BALL_TRAIL:new In("./asset/entity/bullet.albedo.png",5),EFFECT_BULLET_PLASMA_TRAIL:new In("./asset/entity/bullet.albedo.png",6),EFFECT_BULLET_MAGINC_MISSILE_TRAIL:new In("./asset/entity/bullet.albedo.png",7),EFFECT_BULLET_DEATH_BOMB:new In("./asset/entity/bullet.albedo.png",8),EFFECT_BULLET_ARM_GRANADE:new In("./asset/entity/bullet.albedo.png",9),EFFECT_BLOOD_RED1:new In("./asset/entity/blood.albedo.png",0),EFFECT_BLOOD_RED2:new In("./asset/entity/blood.albedo.png",1),EFFECT_BLOOD_RED3:new In("./asset/entity/blood.albedo.png",2),EFFECT_BLOOD_GREEN1:new In("./asset/entity/blood.albedo.png",3),EFFECT_BLOOD_GREEN4:new In("./asset/entity/blood.albedo.png",4),EFFECT_BLOOD_GREEN3:new In("./asset/entity/blood.albedo.png",5),EFFECT_ACID:new In("./asset/entity/acid.albedo.png",0),EFFECT_GIB1:new In("./asset/entity/gib.albedo.png",0),EFFECT_GIB2:new In("./asset/entity/gib.albedo.png",1),EFFECT_GIB3:new In("./asset/entity/gib.albedo.png",2),EFFECT_GIB4:new In("./asset/entity/gib.albedo.png",3),EFFECT_HIT_WALL1:new In("./asset/entity/hit.albedo.png",0),EFFECT_HIT_WALL2:new In("./asset/entity/hit.albedo.png",1),EFFECT_HIT_WALL3:new In("./asset/entity/hit.albedo.png",2),EFFECT_HIT_BLOOD1:new In("./asset/entity/hit.albedo.png",3),EFFECT_HIT_BLOOD2:new In("./asset/entity/hit.albedo.png",4),EFFECT_HIT_BLOOD3:new In("./asset/entity/hit.albedo.png",5),EFFECT_HEADSHOT1:new In("./asset/entity/ring.albedo.png",0),EFFECT_HEADSHOT2:new In("./asset/entity/ring.albedo.png",1),EFFECT_HEADSHOT3:new In("./asset/entity/ring.albedo.png",2),EFFECT_HEADSHOT4:new In("./asset/entity/ring.albedo.png",3),EFFECT_HEADSHOT5:new In("./asset/entity/ring.albedo.png",4),EFFECT_HEADSHOT6:new In("./asset/entity/ring.albedo.png",5),EFFECT_ARMORBREAK1:new In("./asset/entity/ring.albedo.png",6),EFFECT_ARMORBREAK2:new In("./asset/entity/ring.albedo.png",7),EFFECT_ARMORBREAK3:new In("./asset/entity/ring.albedo.png",8),EFFECT_ARMORBREAK4:new In("./asset/entity/ring.albedo.png",9),EFFECT_ARMORBREAK5:new In("./asset/entity/ring.albedo.png",10),EFFECT_ARMORBREAK6:new In("./asset/entity/ring.albedo.png",11),EFFECT_STUFF:new In("./asset/entity/stuff.albedo.png",0),EFFECT_SPARK_MISSILE1:new In("./asset/entity/spark.albedo.png",0),EFFECT_SPARK_MISSILE2:new In("./asset/entity/spark.albedo.png",1),EFFECT_SPARK_MISSILE3:new In("./asset/entity/spark.albedo.png",2),EFFECT_SPARK_MISSILE4:new In("./asset/entity/spark.albedo.png",3),EFFECT_DEFAULT_EXPLODE1:new In("./asset/entity/explode.albedo.png",0),EFFECT_DEFAULT_EXPLODE2:new In("./asset/entity/explode.albedo.png",1),EFFECT_DEFAULT_EXPLODE3:new In("./asset/entity/explode.albedo.png",2),EFFECT_DEFAULT_EXPLODE4:new In("./asset/entity/explode.albedo.png",3),EFFECT_DEFAULT_EXPLODE5:new In("./asset/entity/explode.albedo.png",4),EFFECT_DEFAULT_EXPLODE6:new In("./asset/entity/explode.albedo.png",5),EFFECT_DEFAULT_EXPLODE7:new In("./asset/entity/explode.albedo.png",6),EFFECT_DEFAULT_EXPLODE8:new In("./asset/entity/explode.albedo.png",7),EFFECT_DEFAULT_EXPLODE9:new In("./asset/entity/explode.albedo.png",8),EFFECT_DEFAULT_EXPLODE10:new In("./asset/entity/explode.albedo.png",9),EFFECT_DEFAULT_EXPLODE11:new In("./asset/entity/explode.albedo.png",10),EFFECT_DEFAULT_EXPLODE12:new In("./asset/entity/explode.albedo.png",11),EFFECT_DEFAULT_EXPLODE13:new In("./asset/entity/explode.albedo.png",12),EFFECT_DEFAULT_EXPLODE14:new In("./asset/entity/explode.albedo.png",13),EFFECT_CORROSIVE_EXPLODE1:new In("./asset/entity/explode.albedo.png",14),EFFECT_CORROSIVE_EXPLODE2:new In("./asset/entity/explode.albedo.png",15),EFFECT_CORROSIVE_EXPLODE3:new In("./asset/entity/explode.albedo.png",16),EFFECT_CORROSIVE_EXPLODE4:new In("./asset/entity/explode.albedo.png",17),EFFECT_CORROSIVE_EXPLODE5:new In("./asset/entity/explode.albedo.png",18),EFFECT_CORROSIVE_EXPLODE6:new In("./asset/entity/explode.albedo.png",19),EFFECT_CORROSIVE_EXPLODE7:new In("./asset/entity/explode.albedo.png",20),EFFECT_CORROSIVE_EXPLODE8:new In("./asset/entity/explode.albedo.png",21),EFFECT_CORROSIVE_EXPLODE9:new In("./asset/entity/explode.albedo.png",22),EFFECT_CORROSIVE_EXPLODE10:new In("./asset/entity/explode.albedo.png",23),EFFECT_CORROSIVE_EXPLODE11:new In("./asset/entity/explode.albedo.png",24),EFFECT_CORROSIVE_EXPLODE12:new In("./asset/entity/explode.albedo.png",25),EFFECT_CORROSIVE_EXPLODE13:new In("./asset/entity/explode.albedo.png",26),EFFECT_CORROSIVE_EXPLODE14:new In("./asset/entity/explode.albedo.png",27),EFFECT_FLAME1:new In("./asset/entity/flame.albedo.png",0),EFFECT_FLAME2:new In("./asset/entity/flame.albedo.png",1),EFFECT_FLAME3:new In("./asset/entity/flame.albedo.png",2),EFFECT_FLAME4:new In("./asset/entity/flame.albedo.png",3),EFFECT_FLAME5:new In("./asset/entity/flame.albedo.png",4),ENEMY_TARGET_STILL:new In("./asset/entity/enemy-guy.albedo.png",0),ENEMY_TARGET_PAIN:new In("./asset/entity/enemy-guy.albedo.png",2),ENEMY_TARGET_BLOW:new In("./asset/entity/enemy-guy.albedo.png",3),ENEMY_TARGET_DOWN:new In("./asset/entity/enemy-guy.albedo.png",4),ENEMY_GUY_PISTOL_STILL:new In("./asset/entity/enemy-guy.albedo.png",5),ENEMY_GUY_PISTOL_AIM:new In("./asset/entity/enemy-guy.albedo.png",6),ENEMY_GUY_PISTOL_PAIN:new In("./asset/entity/enemy-guy.albedo.png",7),ENEMY_GUY_PISTOL_BLOW:new In("./asset/entity/enemy-guy.albedo.png",8),ENEMY_GUY_PISTOL_DOWN:new In("./asset/entity/enemy-guy.albedo.png",9),ENEMY_GUY_SHOTGUN_STILL:new In("./asset/entity/enemy-guy.albedo.png",10),ENEMY_GUY_SHOTGUN_AIM:new In("./asset/entity/enemy-guy.albedo.png",11),ENEMY_GUY_SHOTGUN_PAIN:new In("./asset/entity/enemy-guy.albedo.png",12),ENEMY_GUY_SHOTGUN_BLOW:new In("./asset/entity/enemy-guy.albedo.png",13),ENEMY_GUY_SHOTGUN_DOWN:new In("./asset/entity/enemy-guy.albedo.png",14),ENEMY_GUY_MACHINGUN_STILL:new In("./asset/entity/enemy-guy.albedo.png",15),ENEMY_GUY_MACHINGUN_AIM:new In("./asset/entity/enemy-guy.albedo.png",16),ENEMY_GUY_MACHINGUN_PAIN:new In("./asset/entity/enemy-guy.albedo.png",17),ENEMY_GUY_MACHINGUN_BLOW:new In("./asset/entity/enemy-guy.albedo.png",18),ENEMY_GUY_MACHINGUN_DOWN:new In("./asset/entity/enemy-guy.albedo.png",19),ENEMY_GUY_MELEE_STILL:new In("./asset/entity/enemy-guy.albedo.png",20),ENEMY_GUY_MELEE_AIM:new In("./asset/entity/enemy-guy.albedo.png",21),ENEMY_GUY_MELEE_PAIN:new In("./asset/entity/enemy-guy.albedo.png",22),ENEMY_GUY_MELEE_BLOW:new In("./asset/entity/enemy-guy.albedo.png",23),ENEMY_GUY_MELEE_DOWN:new In("./asset/entity/enemy-guy.albedo.png",24),ENEMY_GUY_PISTOL_ARMOR_STILL:new In("./asset/entity/enemy-guy.albedo.png",25),ENEMY_GUY_PISTOL_ARMOR_AIM:new In("./asset/entity/enemy-guy.albedo.png",26),ENEMY_GUY_PISTOL_ARMOR_PAIN:new In("./asset/entity/enemy-guy.albedo.png",27),ENEMY_GUY_SHOTGUN_ARMOR_STILL:new In("./asset/entity/enemy-guy.albedo.png",30),ENEMY_GUY_SHOTGUN_ARMOR_AIM:new In("./asset/entity/enemy-guy.albedo.png",31),ENEMY_GUY_SHOTGUN_ARMOR_PAIN:new In("./asset/entity/enemy-guy.albedo.png",32),ENEMY_GUY_MACHINGUN_ARMOR_STILL:new In("./asset/entity/enemy-guy.albedo.png",35),ENEMY_GUY_MACHINGUN_ARMOR_AIM:new In("./asset/entity/enemy-guy.albedo.png",36),ENEMY_GUY_MACHINGUN_ARMOR_PAIN:new In("./asset/entity/enemy-guy.albedo.png",37),ENEMY_GUY_MELEE_ARMOR_STILL:new In("./asset/entity/enemy-guy.albedo.png",40),ENEMY_GUY_MELEE_ARMOR_AIM:new In("./asset/entity/enemy-guy.albedo.png",41),ENEMY_GUY_MELEE_ARMOR_PAIN:new In("./asset/entity/enemy-guy.albedo.png",42),ENEMY_GUY_MISSILE_STILL:new In("./asset/entity/enemy-guy.albedo.png",45),ENEMY_GUY_MISSILE_AIM:new In("./asset/entity/enemy-guy.albedo.png",46),ENEMY_GUY_MISSILE_PAIN:new In("./asset/entity/enemy-guy.albedo.png",47),ENEMY_TANK_BALL_STILL:new In("./asset/entity/enemy-guy.albedo.png",50),ENEMY_TANK_BALL_AIM:new In("./asset/entity/enemy-guy.albedo.png",51),ENEMY_TANK_BALL_PAIN:new In("./asset/entity/enemy-guy.albedo.png",52),ENEMY_GUY_HELMET_STILL:new In("./asset/entity/helmet.albedo.png",0),ENEMY_GUY_HELMET_PAIN:new In("./asset/entity/helmet.albedo.png",1),ENEMY_GUY_ARMOR_HELMET:new In("./asset/entity/enemy-armor.albedo.png",0),ENEMY_GUY_ARMOR_SHOULDER:new In("./asset/entity/enemy-armor.albedo.png",1),ENEMY_GUY_ARMOR_ARM:new In("./asset/entity/enemy-armor.albedo.png",2),ENEMY_GUY_ARMOR_BODY:new In("./asset/entity/enemy-armor.albedo.png",3),ENEMY_GUY_ARMOR_WAIST:new In("./asset/entity/enemy-armor.albedo.png",4),OBJECT_SHOP:new In("./asset/entity/object.albedo.png",0),OBJECT_SHOP_SALE:new In("./asset/entity/object.albedo.png",1),OBJECT_EDITOR:new In("./asset/entity/object.albedo.png",2),OBJECT_DRUM:new In("./asset/entity/object.albedo.png",3),OBJECT_CHECKPOINT_DISABLE:new In("./asset/entity/checkpoint.albedo.png",0),OBJECT_CHECKPOINT_ACTIVE:new In("./asset/entity/checkpoint.albedo.png",1),OBJECT_SPAWNER:new In("./asset/entity/spawner.albedo.png",0),ITEM_HEALTH_STIM:new In("./asset/entity/health.albedo.png",0),ITEM_HEALTH_MEDIKIT:new In("./asset/entity/health.albedo.png",1),ITEM_HEALTH_ELIXIR:new In("./asset/entity/health.albedo.png",2),ITEM_ARMOR_ELIXIR:new In("./asset/entity/armor.albedo.png",0),ITEM_STAMINA_ELIXIR:new In("./asset/entity/stamina.albedo.png",0),ITEM_AMMO_CLIP:new In("./asset/entity/ammo.albedo.png",0),ITEM_AMMO_MAGAZINE:new In("./asset/entity/ammo.albedo.png",1),ITEM_AMMO_SHELL:new In("./asset/entity/ammo.albedo.png",2),ITEM_AMMO_ROCKET:new In("./asset/entity/ammo.albedo.png",3),ITEM_AMMO_CELL:new In("./asset/entity/ammo.albedo.png",4),ITEM_WEAPON_PUNCH:new In("./asset/entity/weapon.albedo.png",0),ITEM_WEAPON_SLOWBALL:new In("./asset/entity/weapon.albedo.png",6),ITEM_WEAPON_BINOCULARS:new In("./asset/entity/weapon.albedo.png",12),ITEM_WEAPON_ENERGYSHIELD:new In("./asset/entity/weapon.albedo.png",18),ITEM_WEAPON_COMBOBOOSTER:new In("./asset/entity/weapon.albedo.png",24),ITEM_WEAPON_GRENADE:new In("./asset/entity/weapon.albedo.png",30),ITEM_WEAPON_HOOKSHOT:new In("./asset/entity/weapon.albedo.png",36),ITEM_WEAPON_PISTOL:new In("./asset/entity/weapon.albedo.png",1),ITEM_WEAPON_HANDCANNON:new In("./asset/entity/weapon.albedo.png",7),ITEM_WEAPON_MACHINGUN:new In("./asset/entity/weapon.albedo.png",2),ITEM_WEAPON_CHAINSHOTGUN:new In("./asset/entity/weapon.albedo.png",8),ITEM_WEAPON_SHOTGUN:new In("./asset/entity/weapon.albedo.png",3),ITEM_WEAPON_HEAVYCANNON:new In("./asset/entity/weapon.albedo.png",9),ITEM_WEAPON_LAUNCHER:new In("./asset/entity/weapon.albedo.png",4),ITEM_WEAPON_CLUSTERBOW:new In("./asset/entity/weapon.albedo.png",10),ITEM_WEAPON_PLASMAGUN:new In("./asset/entity/weapon.albedo.png",5),ITEM_WEAPON_PLASMASMG:new In("./asset/entity/weapon.albedo.png",11),ITEM_KEY_RED:new In("./asset/entity/key.albedo.png",0),ITEM_KEY_BLUE:new In("./asset/entity/key.albedo.png",1),ITEM_KEY_YELLOW:new In("./asset/entity/key.albedo.png",2),ITEM_KEY_RANDOM:new In("./asset/entity/key.albedo.png",3)},ai={EPISODE1:{NONE:oi.NONE,DOOR_DEFAULT:oi.EPISODE1_DOOR_DEFAULT,DOOR_RED:oi.EPISODE1_DOOR_RED,DOOR_BLUE:oi.EPISODE1_DOOR_BLUE,DOOR_YELLOW:oi.EPISODE1_DOOR_YELLOW,GOLE_WALL:oi.EPISODE1_GOLE_WALL,SECRET_WALL:oi.EPISODE1_SECRET_WALL,FLOOR:oi.EPISODE1_FLOOR,WALL:oi.EPISODE1_WALL,CEIL:oi.EPISODE1_CEIL,WALL1:oi.EPISODE1_WALL1,WALL2:oi.EPISODE1_WALL2,WALL3:oi.NONE,WALL4:oi.NONE,GRAB_WALL:oi.EPISODE1_GRAB_WALL,ASSIST_GRAB_WALL:oi.EPISODE1_ASSIST_GRAB_WALL,WALLRUN_WALL:oi.EPISODE1_WALLRUN_WALL,EDIT_ZONE:oi.EPISODE1_EDIT_ZONE,EDIT_BLOCK:oi.EPISODE1_EDIT_BLOCK},EPISODE2:{NONE:oi.NONE,DOOR_DEFAULT:oi.EPISODE2_DOOR_DEFAULT,DOOR_RED:oi.EPISODE2_DOOR_RED,DOOR_BLUE:oi.EPISODE2_DOOR_BLUE,DOOR_YELLOW:oi.EPISODE2_DOOR_YELLOW,GOLE_WALL:oi.EPISODE2_GOLE_WALL,SECRET_WALL:oi.EPISODE2_SECRET_WALL,FLOOR:oi.EPISODE2_FLOOR,WALL:oi.EPISODE2_WALL,CEIL:oi.EPISODE2_CEIL,WALL1:oi.NONE,WALL2:oi.NONE,WALL3:oi.NONE,WALL4:oi.NONE,GRAB_WALL:oi.EPISODE2_GRAB_WALL,ASSIST_GRAB_WALL:oi.EPISODE2_ASSIST_GRAB_WALL,WALLRUN_WALL:oi.EPISODE2_WALLRUN_WALL,EDIT_ZONE:oi.EPISODE2_EDIT_ZONE,EDIT_BLOCK:oi.EPISODE2_EDIT_BLOCK}},ri={DEFAULT:{theme:0,rise_up_color:[50/255,125/255,50/255],night_up_color:[50/255,125/255,50/255],rise_down_color:[100/255,125/255,50/255],night_down_color:[100/255,125/255,50/255],material_up:[1,.625,.075],material_down:[1,.625,0],noise_size:5,noise_length:2},GRASS:{theme:0,rise_up_color:[50/255,125/255,50/255],night_up_color:[50/255,125/255,50/255],rise_down_color:[100/255,125/255,50/255],night_down_color:[100/255,125/255,50/255],material_up:[1,.625,.075],material_down:[1,.625,0],noise_size:5,noise_length:2},DESERT:{theme:0,rise_up_color:[152/255,107/255,64/255],night_up_color:[152/255,107/255,64/255],rise_down_color:[202/255,127/255,84/255],night_down_color:[202/255,127/255,84/255],material_up:[1,.5,.25],material_down:[1,1,0],noise_size:5,noise_length:2},SEA:{theme:1,rise_up_color:[50/255,50/255,84/255],night_up_color:[7.5/255,37.5/255,.25],rise_down_color:[50/255,50/255,84/255],night_down_color:[7.5/255,37.5/255,.25],material_up:[.1,.1,.5],material_down:[.1,.1,.5],noise_size:1,noise_length:2},LAVA:{theme:1,rise_up_color:[1,0,0],night_up_color:[1,0,0],rise_down_color:[1,.5,0],night_down_color:[1,.5,0],material_up:[0,0,0],material_down:[0,0,0],noise_size:1,noise_length:2},BLOOD:{theme:1,rise_up_color:[200/255,50/255,50/255],night_up_color:[125/255,37.5/255,.15],rise_down_color:[200/255,50/255,50/255],night_down_color:[125/255,37.5/255,.15],material_up:[.1,.1,.1],material_down:[.1,.1,.1],noise_size:1,noise_length:2}},li=new Xn(.5,.5,.5,"NONE","NONE","NONE","NONE","NONE","NONE"),hi=new Xn(.5,.5,.5,"NONE","NONE","NONE","NONE","NONE","NONE"),pi={NONE:li,DEFAULT:new Xn(.5,.5,.5,"WALL","WALL","WALL","WALL","CEIL","FLOOR"),DOOR_DEFAULT:new Xn(.5,.5,.5,"DOOR_DEFAULT","DOOR_DEFAULT","DOOR_DEFAULT","DOOR_DEFAULT","DOOR_DEFAULT","DOOR_DEFAULT"),DOOR_RED:new Xn(.5,.5,.5,"DOOR_RED","DOOR_RED","DOOR_RED","DOOR_RED","DOOR_RED","DOOR_RED"),DOOR_BLUE:new Xn(.5,.5,.5,"DOOR_BLUE","DOOR_BLUE","DOOR_BLUE","DOOR_BLUE","DOOR_BLUE","DOOR_BLUE"),DOOR_YELLOW:new Xn(.5,.5,.5,"DOOR_YELLOW","DOOR_YELLOW","DOOR_YELLOW","DOOR_YELLOW","DOOR_YELLOW","DOOR_YELLOW"),EDIT_BLOCK:new Xn(.5,.5,.5,"EDIT_BLOCK","EDIT_BLOCK","EDIT_BLOCK","EDIT_BLOCK","EDIT_BLOCK","EDIT_BLOCK")},ci=["DOOR_DEFAULT","DOOR_RED","DOOR_BLUE","DOOR_YELLOW"],di="abcdefghijklmnopqrstuvwxyz1234567890 .!?/()%',@+-:",ui="0123456789+";function mi(e){return"DOOR_DEFAULT"===e.front||"DOOR_DEFAULT"===e.back||"DOOR_DEFAULT"===e.left||"DOOR_DEFAULT"===e.right||"DOOR_DEFAULT"===e.top||"DOOR_DEFAULT"===e.bottom}function gi(e){return"DOOR_RED"===e.front||"DOOR_RED"===e.back||"DOOR_RED"===e.left||"DOOR_RED"===e.right||"DOOR_RED"===e.top||"DOOR_RED"===e.bottom}function fi(e){return"DOOR_BLUE"===e.front||"DOOR_BLUE"===e.back||"DOOR_BLUE"===e.left||"DOOR_BLUE"===e.right||"DOOR_BLUE"===e.top||"DOOR_BLUE"===e.bottom}function yi(e){return"DOOR_YELLOW"===e.front||"DOOR_YELLOW"===e.back||"DOOR_YELLOW"===e.left||"DOOR_YELLOW"===e.right||"DOOR_YELLOW"===e.top||"DOOR_YELLOW"===e.bottom}class wi{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.position=new C(e,t,n)}}class xi extends xn{constructor(e,t,n,i,s,o){super(!1),this.name=e,this.scenes=t,this.renderers=n,this.assets=i,this.controls=s,this.sounds=o}getName(){return this.name}getRendererManager(){return this.renderers}getAssetManager(){return this.assets}getControlManager(){return this.controls}getSoundManager(){return this.sounds}createSound(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return this.sounds.create(e,t,null===n?Ve():n)}getSound(e){return this.sounds.getSound(e)}hasSound(e){return this.sounds.hasSound(e)}getSceneManager(){return this.scenes}clear(){const e=this.getSceneManager(),t=this.getControlManager();e.clear(),t.clear(),super.clear()}oninactive(){this.getControlManager().clear()}onupdatebegin(e){let{time:t,now:n,framerate:s,fps:o}=e;new i(this.getControlManager(),"update").trigger({time:t,now:n,framerate:s,fps:o})}onupdateend(e){const{time:t,now:n,framerate:s,fps:o}=e;new i(this.getSceneManager(),"update").trigger({time:t,now:n,framerate:s,fps:o}),new i(this.getRendererManager(),"update").trigger({time:t,now:n,framerate:s,fps:o}),new i(this.getSoundManager(),"update").trigger({time:t,now:n,framerate:s,fps:o})}}class Mi extends xi{constructor(e,t,n,i,s,o){super(e,t,n,i,s,o)}createTransferUIData(){return[]}}class Ei{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.value=e}}const Ci=.23964497041420119,vi=[[0,0],[1,0],[0,1],[-1,0],[0,-1],[1,1],[1,-1],[-1,1],[-1,-1]];function bi(e,t){return e.top===t.top&&e.bottom===t.bottom&&e.right===t.right&&e.left===t.left&&e.front===t.front&&e.back===t.back&&e.flipXRight===t.flipXRight&&e.flipYRight===t.flipYRight&&e.flipXLeft===t.flipXLeft&&e.flipYLeft===t.flipYLeft&&e.flipXFront===t.flipXFront&&e.flipYFront===t.flipYFront&&e.flipXBack===t.flipXBack&&e.flipYBack===t.flipYBack&&e.flipXTop===t.flipXTop&&e.flipYTop===t.flipYTop&&e.flipXBottom===t.flipXBottom&&e.flipYBottom===t.flipYBottom&&e.position.x===t.position.x&&e.position.y===t.position.y&&e.position.z===t.position.z}function _i(e,t,n,i,s){e[t*n+i]=s}class Si{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.data=e,this.width=t,this.height=n,this.depth=i}}class ki{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1/0;this.buffers={},this.clusterAABBs=new Array,this.clusterBoxX=0,this.clusterBoxY=0,this.clusterWidth=0,this.clusterHeight=0,this.dists=new WeakMap,this.billboardPropLength=14,this.voxelPropLength=21,this.oldScene=null,this.setting=e,this.maxTextureSize=t,this.maxDrawDistance=n}getClusterResolution(){return this.setting.clusterResolution||16}getBuffer(e){return Q()?this.buffers[e]:new Si(this.buffers[e].data.slice(),this.buffers[e].width,this.buffers[e].height,this.buffers[e].depth)}requireBuffer(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const[o,a,r]=function(e,t){return[Math.min(t,e),Math.min(t,1+Math.floor(e/t)),Math.min(t,1+Math.floor(Math.floor(e/t)/t))]}(n,this.maxTextureSize),l=o*a*r*i;return(s||!this.buffers.hasOwnProperty(e)||this.buffers[e].data.length<l)&&(this.buffers[e]=new Si(ee(t,l,s),o,a,r)),this.buffers[e]}lightCullingData(e){const t=new Array,n=e.getCamera(),i=e.getSun(),s=e.getEntitys();if(n.hasComponent(Ei)){const{position:e,direction:t}=n,i=n.getComponent(Ei).value;if(null!==i){let s=new C(0,0,0);n.hasComponent(wi)&&(s=n.getComponent(wi).position);const[o,a]=O(i.direction.x,s.x,s.z);e.x=i.position.x+o,e.y=i.position.y+s.y,e.z=i.position.z+a,t.x=i.direction.x,t.y=i.direction.y,t.z=i.direction.z}}for(let e=0,i=0|s.length;e<i;e=e+1|0){const i=s[e];if(i&&!i.hasLive()||!(i instanceof Mn)||!i.hasComponent(Cn)||!i.hasComponent(vn))continue;const{direction:a,position:r}=i;if(i.hasComponent(bn)&&i.hasComponent(Ei)){const e=i.getComponent(bn),t=i.getComponent(Cn),s=i.getComponent(Ei);if(null!==s.value){const{position:i,direction:l}=s.value,[h,p,c]=A(l.x,l.y,e.position.x*(e.position.z/Ci),e.position.y*(e.position.z/Ci),e.position.z);r.x=i.x+h,r.y=i.y+p,r.z=i.z+c;const[d,u,m]=A(l.x,l.y,e.position.x*(e.position.z/n.fov),e.position.y*(e.position.z/n.fov),e.position.z);e.fix.x=i.x+d,e.fix.y=i.y+u,e.fix.z=i.z+m,t.scale=e.scale*(e.position.z/Ci);let g=0;if(l.y>=0){g+=z(l.x),g+=Math.PI/16*(Math.abs(e.position.x)/.25)*(e.position.x>0?1:-1)*(Math.abs(Math.max(0,Ci-.5))/.5)*((M-l.y)/M);let t=g+Math.sin(2*W(r.x,r.z,s.value.position.x,s.value.position.z))*(Math.PI/16*(Math.abs(Math.max(0,Ci-.5))/.5)*(1-Math.abs(Math.sin(l.y))));t+=Math.sin(2*W(r.x,r.z,s.value.position.x,s.value.position.z))*(Math.PI/16*(Math.abs(Math.max(0,.5-Ci))/.25)*Math.abs(Math.sin(l.y))),t+=Math.sin(2*W(r.x,r.z,s.value.position.x,s.value.position.z))*(Math.PI/32*Math.abs(Math.cos(2*l.y)))*(Math.abs(e.position.x)/.25),g=o(t,g,Math.max(0,Math.min(1,((a.y-Math.PI/3.5)/.5+1)/2))),g+=((.5-Math.abs(l.y)/(Math.PI/2))/.5*(Math.PI/16)+Math.PI/16)*(e.position.x>0?-1:1)*Math.min(1,Math.abs(e.position.x)/.25)}else g+=Math.PI/(16-Math.abs(Math.max(0,.5-Ci))/.5*6)*(Math.abs(e.position.x)/.25)*(e.position.x>0?-1:1)*(Math.abs(l.y)/M),g+=(Math.sin(a.x)+M*Math.sign(e.position.x)*(Math.abs(Math.max(0,.5-Ci))/.25))*(Math.PI/16+Math.abs(Math.max(0,Ci-.5))/.25*16*Math.cos(-l.y))*(Math.abs(e.position.x)/.25),g+=(Math.abs(l.y)/M*(Math.PI/5)-Math.PI/32)*(e.position.x>0?-1:1)*Math.min(1,Math.abs(e.position.x)/.25);e.fixRotate=g,t.rotate=e.rotate}}const l=r.x,h=r.y+i.getComponent(vn).bottom*i.getComponent(Cn).scale,p=r.z,c=P(l,h,p,n.position.x,n.position.y,n.position.z);if(c>this.maxDrawDistance)continue;const[d,u]=N(l,h,p,n.position.x,n.position.y,n.position.z),[m,g]=U(d,u,n.direction.x,n.direction.y);m>Math.PI/2&&g>Math.PI/2||(this.dists.set(i,c),t.push(i))}return t.length>1&&ue(t).asc((e=>this.dists.get(e))),{billboards:t,camera:{position:{x:n.position.x,y:n.position.y,z:n.position.z},direction:{x:n.direction.x,y:n.direction.y,z:n.direction.z},fov:n.fov,zoom:n.zoom,light:n.light},sun:{direction:{x:i.direction.x,y:i.direction.y}}}}frustumCullingData(e,t,n){const{clusterWidth:i,clusterHeight:s,clusterAABBs:o,clusterBoxX:a,clusterBoxY:r}=this,[l,h]=e.getSize(),p=l/Math.min(l,h),c=h/Math.min(l,h),d=t.getCamera(),u=d.fov*d.zoom,m=[...new Array(i*s)].map((()=>[])),g=new Array,f=a*p,y=r*c,[w,x,M,E,C,v,b,_,S]=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.5;const[o,a,r]=B(e,t,n,i,s),[l,h,p]=Y(e,t,n,i,s),[c,d,u]=k(l,h,p,o,a,r);return[c,d,u,o,a,r,l,h,p]}(d.direction.x,d.direction.y,u);let T=0;for(let e=0,t=0|n.length;e<t;e=e+1|0){const t=n[e],{position:a}=t,r=t.getComponent(vn),l=t.getComponent(Cn),h=a.x,k=a.y+r.bottom*l.scale,P=a.z;let[I,L,O]=X(d.position.x,d.position.y,d.position.z,h,k,P,l.scale,w,x,M,E,C,v,b,_,S,d.direction.z,t.hasComponent(bn)?Ci:u);O*=l.bounding;const A=Math.floor(Math.min(i*f,Math.max(0,I+i*f/2-O))/f),W=Math.floor(Math.min(s*y,Math.max(0,L+s*y/2-O))/y),N=Math.floor(Math.min(i*f,Math.max(0,I+i*f/2+O))/f),z=Math.floor(Math.min(s*y,Math.max(0,L+s*y/2+O))/y),D=Math.min(A,N),R=Math.min(W,z),H=Math.max(A,N),F=Math.max(W,z);if(H<0||F<0||D>=i||R>=s)continue;let U=!1;for(let e=0|R,t=F+1|0;e<t;e=e+1|0)for(let t=0|D,n=H+1|0;t<n;t=t+1|0){if(t<0||e<0||t>=i||e>=s)continue;const n=e*i+t|0;if(!Me(I,L,O,o[2*n]*p,o[2*n+1]*c,f,y))continue;const a=m[n]||null;null!==a&&a.push(T),U=!0}U&&(g.push({id:T,entity:t}),T++)}return{bind_entitys:g,cullings:m}}buildEntitys(e,t){const{billboardPropLength:n}=this,i=this.requireBuffer("billboard_parameters","float32",Math.max(n,t.length*n),1,!0),s=e.getMaterialManager().getMaterials();for(let e=0,o=0|t.length;e<o;e=e+1|0){const{id:o,entity:a}=t[e],{position:r}=a,l=a.getComponent(Cn),h=a.getComponent(vn),p=a.hasComponent(bn);_i(i.data,n,o,0,r.x),_i(i.data,n,o,1,r.y+h.bottom*l.scale),_i(i.data,n,o,2,r.z),_i(i.data,n,o,3,l.scale),_i(i.data,n,o,4,l.bounding),_i(i.data,n,o,5,p?a.getComponent(bn).fix.x:h.axes.x?1:0),_i(i.data,n,o,6,p?a.getComponent(bn).fix.y:h.axes.y?1:0),_i(i.data,n,o,7,p?a.getComponent(bn).fix.z:h.axes.z?1:0),_i(i.data,n,o,8,z(l.rotate)),_i(i.data,n,o,9,l.flip.x?-1:1),_i(i.data,n,o,10,l.flip.y?-1:1),_i(i.data,n,o,11,p?1:0),_i(i.data,n,o,12,p?z(a.getComponent(bn).fixRotate):0),_i(i.data,n,o,13,s.indexOf(l.material)||0)}return{billboard_parameters:i}}buildCullingData(e){const t=this.requireBuffer("cluster_list","int32",Math.max(1,e.length),1,!0),n=this.requireBuffer("item_list","int32",Math.max(1,e.reduce(((e,t)=>e+t.length),0)),1,!0);for(let i=0,s=0|e.length;i<s;i=i+1|0){const s=e[i],o=i>0?t.data[i-1]:0;t.data[i]=o+s.length;for(let e=0,t=0|s.length;e<t;e=e+1|0)n.data[o+e]=s[e]}return{cluster_list:t,item_list:n}}buildMaterials(e,t,n){if(!e.checkUpdate()&&!t.checkUpdate()&&!n)return{materials:null,sync_materials:!1};const i=[],s=t.getMaterials();for(const t in s){const n=Number(t);if(isNaN(n))continue;const o=s[n];i[n]=e.getBufferLocation(o.src,o.index)}const o=this.requireBuffer("materials","int32",Math.max(1,i.length),1);for(let e=0,t=0|i.length;e<t;e=e+1|0)o.data[e]=i[e]||0;return{materials:this.getBuffer("materials"),sync_materials:!0}}buildVoxels(e,t,n){if(!t.checkUpdate()&&!n)return{voxels:null,sync_voxels:!1};const i=[],s=t.getVoxels(),{voxelPropLength:o}=this;for(const t in s){const n=Number(t);if(isNaN(n))continue;const a=s[n];if(null===a)for(let e=0,t=0|o;e<t;e=e+1|0)i[n*o+e]=0;else{const t=e.getTileSet(),s=e.getMaterials();i[n*o+0]=a.position.x,i[n*o+1]=a.position.y,i[n*o+2]=a.position.z,null!==t?(i[n*o+3]=Object.values(s).indexOf(t[a.front]),i[n*o+4]=Object.values(s).indexOf(t[a.back]),i[n*o+5]=Object.values(s).indexOf(t[a.right]),i[n*o+6]=Object.values(s).indexOf(t[a.left]),i[n*o+7]=Object.values(s).indexOf(t[a.top]),i[n*o+8]=Object.values(s).indexOf(t[a.bottom])):(i[n*o+3]=Object.values(s).indexOf(s.NONE),i[n*o+4]=Object.values(s).indexOf(s.NONE),i[n*o+5]=Object.values(s).indexOf(s.NONE),i[n*o+6]=Object.values(s).indexOf(s.NONE),i[n*o+7]=Object.values(s).indexOf(s.NONE),i[n*o+8]=Object.values(s).indexOf(s.NONE)),i[n*o+9]=a.flipXFront?-1:1,i[n*o+10]=a.flipYFront?-1:1,i[n*o+11]=a.flipXBack?-1:1,i[n*o+12]=a.flipYBack?-1:1,i[n*o+13]=a.flipXRight?-1:1,i[n*o+14]=a.flipYRight?-1:1,i[n*o+15]=a.flipXLeft?-1:1,i[n*o+16]=a.flipYLeft?-1:1,i[n*o+17]=a.flipXTop?-1:1,i[n*o+18]=a.flipYTop?-1:1,i[n*o+19]=a.flipXBottom?-1:1,i[n*o+20]=a.flipYBottom?-1:1}}const a=this.requireBuffer("voxels","float32",Math.max(o,i.length),1);for(let e=0,t=0|i.length;e<t;e=e+1|0)a.data[e]=i[e]||0;return{voxels:this.getBuffer("voxels"),sync_voxels:!0}}getMaxDrawDistance(){return this.maxDrawDistance}setMaxDrawDistance(e){this.maxDrawDistance=e}createData(e,t,n,i){const s=e.getRendererManager(),o=e.getMaterialManager(),a=e.getVoxelManager(),r=this.oldScene!==e.getName()||i;this.oldScene=e.getName();const l=e.getMap(),h=e.getLateTime();let p=null,c=null,d=null,u=null,m=null,g=null;const f=[],y=[];if(n){d=[this.getClusterResolution(),this.getClusterResolution()];const t=d[0],n=d[1];if(this.clusterWidth!==t||this.clusterWidth!==n){const[e,i,s]=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];const i=1/e*2,s=1/t*2;let o=0;for(let a=0,r=0|t;a<r;a=a+1|0)for(let t=0,r=0|e;t<r;t=t+1|0){let e=t*i+i/2,r=a*s+s/2;n[2*o]=e-1,n[2*o+1]=r-1,o++}return[n,i,s]}(t,n,this.requireBuffer("frustum","float32",t,2*n).data);this.clusterAABBs=e,this.clusterBoxX=i,this.clusterBoxY=s,this.clusterWidth=t,this.clusterHeight=n}const{billboards:i,camera:o,sun:a}=this.lightCullingData(e),{bind_entitys:r,cullings:l}=this.frustumCullingData(s,e,i),{billboard_parameters:h}=this.buildEntitys(e,r),{cluster_list:y,item_list:w}=this.buildCullingData(l);p=o,c=a,u=h,m=y,g=w,f.push(u.data.buffer,m.data.buffer,g.data.buffer)}const{materials:w,sync_materials:x}=this.buildMaterials(t,o,r),{voxels:M,sync_voxels:E}=this.buildVoxels(e,a,r),C=e.getBackground(),v=l.checkUpdate(),b=l.getFilter(),_=l.getDistanceField();return Q()||(b&&(v||r)&&y.push(b.buffer),null!==_&&(v||r)&&y.push(_.buffer),null!==w&&(x||r)&&y.push(w.data.buffer),null!==M&&(E||r)&&y.push(M.data.buffer),null!==w&&(x||r)&&f.push(w.data.buffer),null!==M&&(E||r)&&f.push(M.data.buffer)),y.push(...f),[{camera:p,sun:c,map:{width:l.getSize()[0],height:l.getSize()[1],depth:l.getSize()[2],distance:l.getWorldDistance(),data:v||r?b:null},distance_field:(v||r)&&null!==_?{width:l.getSize()[0],height:l.getSize()[1],depth:l.getSize()[2],data:_}:null,materials:x||r?w:null,voxels:E||r?M:null,cluster_resolution:d,billboard_parameters:u,item_list:g,cluster_list:m,background:C,lateTime:h},f,y]}}class Ti extends Mi{constructor(e,t,n,i,s,o,a,r,l,h,p,c,d,u,m,g){super(e,a,r,l,h,p),this.isForceUpdate=!1,this.tile_set=null,this.background=null,this.mats={},this.lateTime=0,this.trees={range:new Ge((e=>e instanceof Mn&&e.hasComponent(En)),(e=>{if(!(e instanceof Mn))return[-1,-1,-1,-1,-1];const t=e.getComponent(En),n=t.treeFix&&e.hasComponent(wi)?e.getComponent(wi).position:new C(0,0,0);return[e.position.x+n.x,e.position.y+n.y,e.position.z+n.z,t.size.x,t.size.y]})),hitbox:new Ge((e=>e instanceof Mn&&e.hasComponent(Sn)),(e=>{if(!(e instanceof Mn))return[-1,-1,-1,-1,-1];const t=e.getComponent(Sn),n=t.treeFix&&e.hasComponent(wi)?e.getComponent(wi).position:new C(0,0,0);return[e.position.x+n.x,e.position.y+n.y,e.position.z+n.z,t.size.x,t.size.y]})),collision:new Ge((e=>e instanceof Mn&&e.hasComponent(_n)),(e=>{if(!(e instanceof Mn))return[-1,-1,-1,-1,-1];const t=e.getComponent(_n),n=t.treeFix&&e.hasComponent(wi)?e.getComponent(wi).position:new C(0,0,0);return[e.position.x+n.x,e.position.y+n.y,e.position.z+n.z,t.size.x,t.size.y]}))},this.finder=new Pn,this.margin=s,this.materials=c,this.voxels=d,this.camera=m,this.sun=g,this.addEntitys(m,g),this.transferDataBuilder=new ki(u,o,1/0),this.offset={top:s,bottom:s,front:s,back:s,right:s,left:s},this.map=new Ue(t,n,i,"int32",1,1)}initTrees(e){for(const t in this.trees){const n=this.trees[t];n.hasEntity(e)&&n.initOldPosition(e)}}addEntitys(){for(let e=0,t=0|arguments.length;e<t;e=e+1|0){const t=e<0||arguments.length<=e?void 0:arguments[e];for(const e in this.trees){this.trees[e].add(t)}}super.addEntitys(...arguments)}removeEntitys(){for(let e=0,t=0|arguments.length;e<t;e=e+1|0){const t=e<0||arguments.length<=e?void 0:arguments[e];for(const e in this.trees){this.trees[e].remove(t)}}super.removeEntitys(...arguments)}getMaterialManager(){return this.materials}getVoxelManager(){return this.voxels}getMap(){return this.map}getWorldDistance(){return this.map.getWorldDistance()}getWorldSize(){return this.map.getSize()}getCamera(){return this.camera}getSun(){return this.sun}getMargin(){return this.margin}getOffset(){return this.offset}getVoxel(e,t,n){return this.getVoxelManager().getVoxel(this.map.get(0,e,t,n)-1)}getDistanceField(e,t,n){let i=this.map.get(0,e,t,n,this.map.getDistanceField(),this.map.getSize());return-1===i?0:i}getMaterials(){return this.mats}getTileSet(){return this.tile_set}getBackground(){return this.background||{theme:0,rise_up_color:[50/255,125/255,50/255],night_up_color:[50/255,125/255,50/255],rise_down_color:[100/255,125/255,50/255],night_down_color:[100/255,125/255,50/255],material_up:[1,.625,.075],material_down:[1,.625,0],noise_size:5,noise_length:2}}getLateTime(){return this.lateTime}getTree(e){return this.trees[e]||null}setWorldSize(e,t,n,i,s,o,a,r,l){this.map.setSize(e,t,n),this.offset.top=i,this.offset.bottom=s,this.offset.front=o,this.offset.back=a,this.offset.right=r,this.offset.left=l}setActorPosition(e,t,n,i){e.position.x=t,e.position.y=n,e.position.z=i;for(const t in this.trees)this.trees[t].setOldPosition(e)}setCamera(e){this.camera=e}setSun(e){this.sun=e}setTileSet(e){this.tile_set!==e&&(this.isForceUpdate=!0),this.tile_set=e}setBackground(e){this.background=e}setMaterials(e){for(const t in e)this.mats[t]=e[t]}setVoxel(e,t,n,i){let s=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],o=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const a=this.getVoxelManager(),r=a.getVoxels(),l=this.map.get(0,e,t,n)-1,h=a.getVoxel(l);l>0&&this.map.getCount(l+1)<=0&&(h!==hi||h!==li)&&a.removeVoxels(h);let p=!1;for(let e=0,t=0|r.length;e<t;e=e+1|0){const t=r[e];if(null!==t&&bi(t,i)){p=!0;break}}p||a.addVoxels(i);const c=r.find((e=>null!==e&&bi(e,i)));if(void 0!==c){const i=r.indexOf(c)+1;this.map.set(0,e,t,n,i,s)}o&&(i===li?this.reductionPosition():this.expandPosition())}setDistanceField(e,t,n,i){this.map.set(0,e,t,n,i,!1,this.map.getDistanceField())}hasOutOfWorld(e,t,n){return function(e,t,n,i){const[s,o,a]=e.getSize();return t<=0||t>=s-1||n<=0||n>=o-1||i<=0||i>=a-1}(this.map,e,t,n)}clear(){const e=this.getMap(),t=this.getVoxelManager(),n=this.getControlManager();e.clear(),t.clear(),n.clear();for(const e in this.trees){this.trees[e].clear()}this.lateTime=0,super.clear()}hitScanVoxel(e,t,n,i,s,o){return ze(e,t,n,i,s,o,((e,t,n)=>this.getDistanceField(e,t,n)))}hasHitScanVoxel(e,t,n,i,s,o){const[a,r,l]=this.hitScanVoxel(e,t,n,i,s,o);return!(-1===a&&-1===r&&-1===l)}hasHitScanBoldFind(e,t,n,i,s,o,a){let r=arguments.length>7&&void 0!==arguments[7]?arguments[7]:1/0,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:new Array;const[h,p,c,,]=this.hitScanBoldFind(e,t,n,i,s,o,a,r,l);return-1!==h&&-1!==p&&-1!==c}hasHitScanBold(e,t,n,i,s,o,a){let r=arguments.length>7&&void 0!==arguments[7]?arguments[7]:1/0,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:new Array;const[h,p,c,,]=this.hitScanBold(e,t,n,i,s,o,a,r,l);return-1!==h&&-1!==p&&-1!==c}hasHitScanVoxelBoldFind(e,t,n,i,s,o){let a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1/0;const[r,l,h]=this.hitScanVoxelBold(e,t,n,i,s,o,a);return-1!==r&&-1!==l&&-1!==h}hasHitScanVoxelBold(e,t,n,i,s,o){let a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1/0;const[r,l,h]=this.hitScanVoxelBold(e,t,n,i,s,o,a);return-1!==r&&-1!==l&&-1!==h}hasBlockScaleVoxel(e,t,n,i,s){return function(e,t,n,i,s){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:()=>!1;me(ve);const a=We(e,t,n,i,s,ve);for(let r=0,l=0|a.length;r<l;r=r+3|0){const l=a[r],h=a[r+1],p=a[r+2];if(o("type",l,h,p)&&xe(l,h,p,e,t,n,i,s))return!0}return!1}(e,t,n,i,s,((e,t,n,i)=>this.getVoxel(t,n,i)!==li))}hasBlockScale(e,t,n,i,o,a){let r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:new Array;if(this.hasBlockScaleVoxel(t,n,i,o,a))return!0;const l=new Array,h=this.trees[e],p=e=>r.includes(e),c=We(t,n,i,o,a,[]);for(let e=0,r=0|c.length;e<r;e=e+3|0){const r=c[e],d=c[e+1],u=c[e+2],m=h.getPointCell(r,d,u);for(let e=0,r=0|m.length;e<r;e=e+1|0){const r=this.getEntityOfID(m[e]);if(null===r||!r.hasLive()||l.includes(r)||r.getNames().some(p)||p(r.getID()))continue;const[c,d,u,g,f]=h.getEntityProperty(r);if(-1===c&&-1===d&&-1===u)continue;let[y,w,x,,,]=h.getOldEntityProperty(r);y=-1===y?c:y,w=-1===w?d:w,x=-1===x?u:x;const M=c-y,E=d-w,C=u-x,v=P(M,E,C,0,0,0),[b,_]=N(M,E,C,0,0,0),S=Math.min(v,g/4,f/4,.5),[k,T,I]=A(b,_,0,0,1);let L=0;for(;;){if(Ee(t,n,i,o,a,y+L*k,w+L*T,x+L*I,g,f))return!0;if(L>=v)break;L=Math.min(v,s(L+S,v,1e5,Math.ceil))}}}return!1}getEntitysOfRange(e,t,n,i,o,a){let r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:new Array;const l=new Array,h=new Array,p=this.trees[e],c=e=>r.includes(e),d=We(t,n-a/2,i,o,a,[]);for(let e=0,r=0|d.length;e<r;e=e+3|0){const r=d[e],u=d[e+1],m=d[e+2],g=p.getPointCell(r,u,m);for(let e=0,r=0|g.length;e<r;e=e+1|0){const r=g[e],d=this.getEntityOfID(r);if(null===d||!d.hasLive()||h.includes(d)||d.getNames().some(c)||c(r))continue;const[u,m,f,y,w]=p.getEntityProperty(d);if(-1===u&&-1===m&&-1===f)continue;let[x,M,E,,,]=p.getOldEntityProperty(d);x=-1===x?u:x,M=-1===M?m:M,E=-1===E?f:E;const C=u-x,v=m-M,b=f-E,_=P(C,v,b,0,0,0),[S,k]=N(C,v,b,0,0,0),T=Math.min(_,y/4,w/4,.5),[I,L,O]=A(S,k,0,0,1);let W=0;for(;;){if(Ee(t,n-a/2,i,o,a,x+W*I,M+W*L,E+W*O,y,w)){l.push(d);break}if(W>=_)break;W=Math.min(_,s(W+T,_,1e5,Math.ceil))}}}return l}getEntitysOfLine(e,t,n,i,o,a,r){let l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:[],h=arguments.length>8&&void 0!==arguments[8]?arguments[8]:(e,t,n)=>!1;const p=new Array,c=new Array,d=e=>l.includes(e),u=this.trees[e];return Ne(t,n,i,o,a,r,h,((e,l,h,m,g,f,y,w,x,M,E,C,v,b,_,S,k,T)=>{const I=u.getPointCell(e,l,h);for(let e=0,l=0|I.length;e<l;e=e+1|0){const l=I[e],h=this.getEntityOfID(l);if(null===h||!h.hasLive()||c.includes(h)||h.getNames().some(d)||d(l))continue;const[y,w,x,M,E]=u.getEntityProperty(h);if(-1===y&&-1===w&&-1===x)continue;let[C,v,b,,,]=u.getOldEntityProperty(h);C=-1===C?y:C,v=-1===v?w:v,b=-1===b?x:b;const _=y-C,S=w-v,k=x-b,T=P(_,S,k,0,0,0),[L,O]=N(_,S,k,0,0,0),[W,z,D]=A(L,O,0,0,1),R=Math.min(T,M/4,E/4,.5);let H=0;for(;;){const e=C+H*W,l=v+H*z,d=b+H*D;if((i<m?i<e+M/2:m<e+M/2)&&(o<g?o<l+E:g<l+E)&&(a<f?a<d+M/2:f<d+M/2)&&(i>m?i>e-M/2:m>e-M/2)&&(o>g?o>l:g>l)&&(a>f?a>d-M/2:f>d-M/2)){const[s,u,m]=ke(i,o,a,t,n,e,l,d,e,l+E,d,M);if(-1!==s||-1!==u||-1!==m){const e=P(s,u,m,i,o,a);if(e<r){c.push(h),p.push([s,u,m,e,h]);break}}}if(H>=T)break;H=Math.min(T,s(H+R,T,1e5,Math.ceil))}}return p.length>0})),p.length>1&&ue(p).asc((e=>e[3])),p}hitScan(e,t,n,i,o,a,r){let l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:[];const h=new Array,p=new Array,c=this.trees[e],d=e=>l.includes(e),[u,m,g,f]=Ne(t,n,i,o,a,r,((e,t,n)=>this.getVoxel(e,t,n)!==li),((e,l,u,m,g,f,y,w,x,M,E,C,v,b,_,S,k,T)=>{const I=c.getPointCell(e,l,u);for(let e=0,l=0|I.length;e<l;e=e+1|0){const l=this.getEntityOfID(I[e]);if(null===l||!l.hasLive()||p.includes(l)||l.getNames().some(d)||d(l.getID()))continue;const[u,y,w,x,M]=c.getEntityProperty(l);if(-1===u&&-1===y&&-1===w)continue;let[E,C,v,,,]=c.getOldEntityProperty(l);E=-1===E?u:E,C=-1===C?y:C,v=-1===v?w:v;const b=u-E,_=y-C,S=w-v,k=P(b,_,S,0,0,0),T=s(Math.min(r,P(m,g,f,i,o,a)/r),0),[L,O]=N(b,_,S,0,0,0),[W,z,D]=A(L,O,0,0,1),R=u+k*T*W,H=y+k*T*z,F=w+k*T*D;if((i<m?i<R+x/2:m<R+x/2)&&(o<g?o<H+M:g<H+M)&&(a<f?a<F+x/2:f<F+x/2)&&(i>m?i>R-x/2:m>R-x/2)&&(o>g?o>H:g>H)&&(a>f?a>F-x/2:f>F-x/2)){const[e,s,c]=ke(i,o,a,t,n,R,H,F,R,H+M,F,x);if(-1===e&&-1===s&&-1===c)continue;const d=P(e,s,c,i,o,a);d<r&&(p.push(l),h.push([e,s,c,d,l]))}}return h.length>0}));return h.length>1&&ue(h).asc((e=>e[3])),h.push([u,m,g,f,null]),h[0]}hasHitScan(e,t,n,i,o,a,r){let l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:[];const h=new Array,p=new Array,c=new Array,d=this.trees[e];const[u,m,g]=Ne(t,n,i,o,a,r,((e,t,n)=>this.getVoxel(e,t,n)!==li),((e,u,m,g,f,y,w,x,M,E,C,v,b,_,S,k,T,I)=>{const L=d.getPointCell(e,u,m);for(let e=0,u=0|L.length;e<u;e=e+1|0){const u=this.getEntityOfID(L[e]);if(null===u||!u.hasLive()||c.includes(u))continue;if(u instanceof Mn&&u.getNames().some((e=>l.includes(e)))){c.push(u);continue}const[m,w,x,M,E]=d.getEntityProperty(u);if(-1===m&&-1===w&&-1===x)continue;let[C,v,b,,,]=d.getOldEntityProperty(u);C=-1===C?m:C,v=-1===v?w:v,b=-1===b?x:b;const _=P(m,w,x,C,v,b),S=s(Math.min(1,P(g,f,y,i,o,a)/r),0),[k,T]=N(m,w,x,C,v,b),[I,O,W]=A(k,T,0,0,1),z=m+_*S*I,D=w+_*S*O,R=x+_*S*W;if((i<g?i<z+M/2:g<z+M/2)&&(o<f?o<D+E:f<D+E)&&(a<y?a<R+M/2:y<R+M/2)&&(i>g?i>z-M/2:g>z-M/2)&&(o>f?o>D:f>D)&&(a>y?a>R-M/2:y>R-M/2)){const[e,s,l]=ke(i,o,a,t,n,z,D,R,z,D+E,R,M);if(-1===e&&-1===s&&-1===l)continue;const c=P(e,s,l,i,o,a);c<r&&(p.push(u),h.push([e,s,l,c,u]))}}return!1}));return-1!==u&&-1!==m&&-1!==g}hasHitScanActor(e,t,n,i,o,a,r){let l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:[];const h=new Array,p=this.trees[e];let c=!1;return Ne(t,n,i,o,a,r,((e,t,n)=>this.getVoxel(e,t,n)!==li),((e,d,u,m,g,f,y,w,x,M,E,C,v,b,_,S,k,T)=>{const I=p.getPointCell(e,d,u);for(let e=0,d=0|I.length;e<d;e=e+1|0){const d=this.getEntityOfID(I[e]);if(null===d||!d.hasLive()||h.includes(d))continue;if(d instanceof Mn&&d.getNames().some((e=>l.includes(e)))){h.push(d);continue}const[u,y,w,x,M]=p.getEntityProperty(d);if(-1===u&&-1===y&&-1===w)continue;let[E,C,v,,,]=p.getOldEntityProperty(d);E=-1===E?u:E,C=-1===C?y:C,v=-1===v?w:v;const b=u-E,_=y-C,S=w-v,k=P(b,_,S,0,0,0),T=s(Math.min(1,P(m,g,f,i,o,a)/r),0),[L,O]=N(b,_,S,0,0,0),[W,z,D]=A(L,O,0,0,1),R=u+k*T*W,H=y+k*T*z,F=w+k*T*D;if((i<m?i<R+x/2:m<R+x/2)&&(o<g?o<H+M:g<H+M)&&(a<f?a<F+x/2:f<F+x/2)&&(i>m?i>R-x/2:m>R-x/2)&&(o>g?o>H:g>H)&&(a>f?a>F-x/2:f>F-x/2)){const[e,s,l]=ke(i,o,a,t,n,R,H,F,R,H+M,F,x);if(-1===e&&-1===s&&-1===l)continue;if(P(e,s,l,i,o,a)<r)return c=!0,!0}}return!1})),c}hitScanBold(e,t,n,i,o,a,r,l){let h=arguments.length>8&&void 0!==arguments[8]?arguments[8]:[];const p=new Array,c=e=>h.includes(e),d=this.trees[e],[u,m,g]=this.getWorldSize(),f=Math.min(l,P(u,m,g,0,0,0)),[y,w,x]=A(t,n,0,0,f),M=P(y,w,x,0,0,0),[E,C]=N(y,w,x,0,0,0),[v,b,_]=A(E,C,0,0,1),S=Math.min(M,r,.5);let k,T=new Array,I=null,L=0;for(;;){const e=i+L*v,l=o+L*b,h=a+L*_,u=We(e,l-r/2,h,r,r);for(let m=0,g=0|u.length;m<g;m=m+3|0){const g=u[m+0],y=u[m+1],w=u[m+2];if(this.getVoxel(g,y,w)!==li){const[s,r]=N(g+.5,y+.5,w+.5,e,l,h),c=P(g+.5,y+.5,w+.5,e,l,h),d=Math.cos(s)+Math.sin(s),u=Math.sin(r)+Math.cos(r),[m,f,x]=A(t,n,0,0,c-Math.sqrt(Math.max(d*d,u*u))+P(e,l,h,i,o,a));p.push([m+i,f+o,x+a,P(m+i,f+o,x+a,i,o,a),null]),k=!0}const x="".concat(g,",").concat(y,",").concat(w);T=x!==I?d.getPointCell(g,y,w):T,I=x;for(let t=0,n=0|T.length;t<n;t=t+1|0){const n=T[t],u=this.getEntityOfID(n);if(null===u||!u.hasLive()||c(u.getID())||u.getNames().some(c))continue;const[m,g,y,w,x]=d.getEntityProperty(u);if(-1===m&&-1===g&&-1===y)continue;let[E,C,v,,,]=d.getOldEntityProperty(u);E=-1===E?m:E,C=-1===C?g:C,v=-1===v?y:v;const b=m-E,_=g-C,S=y-v,k=s(Math.min(1,L/M),0),[I,O]=N(b,_,S,0,0,0),[W,z,D]=A(I,O,0,0,1),R=P(b,_,S,0,0,0);if(Ee(e,l-r/2,h,r,r,E+R*k*W,C+R*k*z,v+R*k*D,w,x)){const t=e,n=l,s=h,r=P(t,n,s,i,o,a);r<f&&p.push([t,n,s,r,u])}}}if(k||L>=M){L=M;break}L=Math.min(M,s(L+S,M,1e5,Math.ceil))}return p.length>0?(ue(p).asc((e=>e[3])),p[0]):[-1,-1,-1,-1,null]}hitScanBoldFind(e,t,n,i,o,a,r,l){let h=arguments.length>8&&void 0!==arguments[8]?arguments[8]:[];const p=new Array,c=e=>h.includes(e),d=this.trees[e];let u=new Array,m=null,[g,f,y,w]=this.hitScanVoxelBoldFindMax(t,n,i,o,a,r,1/0);if(-1!==g&&-1!==f&&-1!==y){const e=Math.min(l,w),t=g-i,n=f-o,h=y-a,x=P(t,n,h,0,0,0),[M,E]=N(t,n,h,0,0,0),[C,v,b]=A(M,E,0,0,1),_=Math.min(x,r,.5);let S=0;for(;;){const t=i+S*C,n=o+S*v,l=a+S*b,h=We(t,n-r/2,l,r,r);for(let g=0,f=0|h.length;g<f;g=g+3|0){const f=h[g+0],y=h[g+1],w=h[g+2],M="".concat(f,",").concat(y,",").concat(w);u=M!==m?d.getPointCell(f,y,w):u,m=M;for(let h=0,m=0|u.length;h<m;h=h+1|0){const m=u[h],g=this.getEntityOfID(m);if(null===g||!g.hasLive()||c(g.getID())||g.getNames().some(c))continue;const[f,y,w,M,E]=d.getEntityProperty(g);if(-1===f&&-1===y&&-1===w)continue;let[C,v,b,,,]=d.getOldEntityProperty(g);C=-1===C?f:C,v=-1===v?y:v,b=-1===b?w:b;const _=f-C,k=y-v,T=w-b,I=s(Math.min(1,S/x),0),[L,O]=N(_,k,T,0,0,0),[W,z,D]=A(L,O,0,0,1),R=P(_,k,T,0,0,0);if(Ee(t,n-r/2,l,r,r,C+R*I*W,v+R*I*z,b+R*I*D,M,E)){const s=t,r=n,h=l,c=P(s,r,h,i,o,a);c<e&&p.push([s,r,h,c,g])}}}if(S>=x){S=x;break}S=Math.min(x,s(S+_,x,1e5,Math.ceil))}if(p.length>1)return ue(p).asc((e=>e[3])),p[0]}return 0===p.length&&([g,f,y,w]=this.hitScanVoxelBoldFindMin(t,n,i,o,a,r,l)),[g,f,y,w,null]}hitScanVoxelBoldFindMin(e,t,n,i,s,o){let a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1/0,r=-1,l=-1,h=-1,p=1/0;const c=o/2;let d=!1;for(let o=0,u=0|vi.length;o<u;o=o+1|0){const u=W(vi[o][0],vi[o][1],0,0),m=Math.cos(u)*c,g=Math.sin(u)*c,[f,y,w]=A(e,t,m,g,0),[x,M,E,C]=this.hitScanVoxel(e,t,n+f,i+y,s+w,a);-1!==x&&-1!==M&&-1!==E&&C<p&&(r=x-f,l=M-y,h=E-w,p=C,d=!0)}return[r,l,h,d?p:-1]}hitScanVoxelBoldFindMax(e,t,n,i,s,o){let a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1/0,r=-1,l=-1,h=-1,p=0;const c=o/2;let d=!1;for(let o=0,u=0|vi.length;o<u;o=o+1|0){const u=W(vi[o][0],vi[o][1],0,0),m=Math.cos(u)*c,g=Math.sin(u)*c,[f,y,w]=A(e,t,m,g,0),[x,M,E,C]=this.hitScanVoxel(e,t,n+f,i+y,s+w,a);-1!==x&&-1!==M&&-1!==E&&C>p&&(r=x-f,l=M-y,h=E-w,p=C,d=!0)}return[r,l,h,d?p:-1]}hitScanVoxelBold(e,t,n,i,o,a,r){const l=new Array,[h,p,c]=this.getWorldSize(),d=Math.min(r,P(h,p,c,0,0,0)),[u,m,g]=A(e,t,0,0,d),f=P(u,m,g,0,0,0),[y,w]=N(u,m,g,0,0,0),[x,M,E]=A(y,w,0,0,1),C=Math.min(f,a,.5);let v,b=0;for(;;){const r=n+b*x,h=i+b*M,p=o+b*E,c=We(r,h-a/2,p,a,a);for(let s=0,a=0|c.length;s<a;s=s+3|0){const a=c[s+0],d=c[s+1],u=c[s+2];if(this.getVoxel(a,d,u)!==li){const[s,c]=N(a+.5,d+.5,u+.5,r,h,p),m=P(a+.5,d+.5,u+.5,r,h,p),g=Math.cos(s)+Math.sin(s),f=Math.sin(c)+Math.cos(c),[y,w,x]=A(e,t,0,0,m-Math.sqrt(Math.max(g*g,f*f))+P(r,h,p,n,i,o));l.push([y+n,w+i,x+o,P(y+n,w+i,x+o,n,i,o),null]),v=!0}}if(v||b>=f){b=f;break}b=Math.min(f,s(b+C,f,1e5,Math.ceil))}return l.length>0?(ue(l).asc((e=>e[3])),l[0]):[-1,-1,-1,-1,null]}expandPosition(){const[e,t,n]=this.getWorldSize(),i=this.getMargin();let s=0,o=0,a=0,r=e-1,l=t-1,h=n-1;e:for(;s<e;){for(let e=0;e<n;e=e+1|0)for(let n=0;n<t;n=n+1|0)if(this.getVoxel(s,n,e)!==li&&this.getVoxel(s,n,e)!==hi)break e;s+=1}e:for(;r>=0;){for(let e=0;e<n;e=e+1|0)for(let n=0;n<t;n=n+1|0)if(this.getVoxel(r,n,e)!==li&&this.getVoxel(r,n,e)!==hi)break e;r+=-1}e:for(;o<t;){for(let t=0;t<e;t=t+1|0)for(let e=0;e<n;e=e+1|0)if(this.getVoxel(t,o,e)!==li&&this.getVoxel(t,o,e)!==hi)break e;o+=1}e:for(;l>=0;){for(let t=0;t<e;t=t+1|0)for(let e=0;e<n;e=e+1|0)if(this.getVoxel(t,l,e)!==li&&this.getVoxel(t,l,e)!==hi)break e;l+=-1}e:for(;a<n;){for(let n=0;n<e;n=n+1|0)for(let e=0;e<t;e=e+1|0)if(this.getVoxel(n,e,a)!==li&&this.getVoxel(n,e,a)!==hi)break e;a+=1}e:for(;h>=0;){for(let n=0;n<e;n=n+1|0)for(let e=0;e<t;e=e+1|0)if(this.getVoxel(n,e,h)!==li&&this.getVoxel(n,e,h)!==hi)break e;h+=-1}let p=0,c=0,d=0;this.offset.left=i,p+=Math.min(0,s-i),this.offset.right=r+i,p+=Math.max(0,r+i-(e-1)),this.offset.bottom=i,c+=Math.min(0,o-i),this.offset.top=l+i,c+=Math.max(0,l+i-(t-1)),this.offset.back=i,d+=Math.min(0,a-i),this.offset.front=h+i,d+=Math.max(0,h+i-(n-1)),this.map.expand(p,c,d);const u=this.getEntitys();for(let e=0,t=0|u.length;e<t;e=e+1|0){const t=u[e];if(!(t instanceof Mn))continue;const{position:n}=t;n.x+=Math.abs(p<0?p:0),n.y+=Math.abs(c<0?c:0),n.z+=Math.abs(d<0?d:0)}}reductionPosition(){const[e,t,n]=this.getWorldSize(),i=this.getMargin();let s=0,o=0,a=0,r=e-1,l=t-1,h=n-1;e:for(;s<e;){for(let e=0;e<n;e=e+1|0)for(let n=0;n<t;n=n+1|0)if(this.getVoxel(s,n,e)!==li&&this.getVoxel(s,n,e)!==hi)break e;s+=1}e:for(;r>=0;){for(let e=0;e<n;e=e+1|0)for(let n=0;n<t;n=n+1|0)if(this.getVoxel(r,n,e)!==li&&this.getVoxel(r,n,e)!==hi)break e;r+=-1}e:for(;o<t;){for(let t=0;t<e;t=t+1|0)for(let e=0;e<n;e=e+1|0)if(this.getVoxel(t,o,e)!==li&&this.getVoxel(t,o,e)!==hi)break e;o+=1}e:for(;l>=0;){for(let t=0;t<e;t=t+1|0)for(let e=0;e<n;e=e+1|0)if(this.getVoxel(t,l,e)!==li&&this.getVoxel(t,l,e)!==hi)break e;l+=-1}e:for(;a<n;){for(let n=0;n<e;n=n+1|0)for(let e=0;e<t;e=e+1|0)if(this.getVoxel(n,e,a)!==li&&this.getVoxel(n,e,a)!==hi)break e;a+=1}e:for(;h>=0;){for(let n=0;n<e;n=n+1|0)for(let e=0;e<t;e=e+1|0)if(this.getVoxel(n,e,h)!==li&&this.getVoxel(n,e,h)!==hi)break e;h+=-1}let p=0,c=0,d=0;this.offset.left=i,p+=Math.min(0,i-s),this.offset.right=r+i,p+=Math.max(0,e-1-(r+i)),this.offset.bottom=i,c+=Math.min(0,i-o),this.offset.top=l+i,c+=Math.max(0,t-1-(l+i)),this.offset.back=i,d+=Math.min(0,i-a),this.offset.front=h+i,d+=Math.max(0,n-1-(h+i)),this.map.reduction(p,c,d);const u=this.getEntitys();for(let e=0,t=0|u.length;e<t;e=e+1|0){const t=u[e];if(!(t instanceof Mn))continue;const{position:n}=t;n.x-=Math.abs(p<0?p:0),n.y-=Math.abs(c<0?c:0),n.z-=Math.abs(d<0?d:0)}}findPath(e,t,n,i){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:(e,t)=>{t.block=!0},o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:e=>!0,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:e=>e.step,r=arguments.length>7&&void 0!==arguments[7]?arguments[7]:()=>!0,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:()=>0;return this.finder.find(e,t,n,i,s,o,a,r,l)}createTransferVoxelData(e,t,n){return n=n||this.isForceUpdate,this.isForceUpdate=!1,this.transferDataBuilder.createData(e,this.getAssetManager(),t,n)}onbeforeoffset(e){const[t,n,i]=this.getWorldSize();for(const e in this.trees){this.trees[e].update(t,n,i)}}onupdateend(e){const{time:t}=e;this.lateTime+=1e-7*t,this.finder.update(t*(1e3/60)),super.onupdateend(e)}}class Pi extends y{constructor(){super(!1),this.activeSceneName=null,this.activeTimer=null,this.scenes={}}addScenes(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];t.forEach((e=>{this.scenes[e.getName()]=e,new i(this,"attach-scene").trigger({scene:e})}))}getScene(e){return this.scenes[e]||null}hasScene(e){return null!==this.getScene(e)}getScenes(){return Object.values(this.scenes)}getActiveScene(){return this.scenes[this.activeSceneName||""]||null}getActiveSceneName(){return this.activeSceneName}createTransferSoundData(){const e=this.getActiveScene();if(null===e)return null;const t=e instanceof Ti?e.getCamera():{direction:new C(0,0,0),position:new C(0,0,0)};return{sounds:e.getSoundManager().createTransferData(t.direction,t.position,e)}}createTransferRenderData(e,t){const n=this.getActiveScene();if(null===n)return[null,[]];const i=n instanceof Ti?n.createTransferVoxelData(n,e,t):[null,[],[]],s=n instanceof Mi&&e?n.createTransferUIData():null;return[{voxel:i[0],ui:s,transfers:i[2]},i[1]]}createTransferUpdateData(){arguments.length>0&&void 0!==arguments[0]||new C(0,0,0),arguments.length>1&&void 0!==arguments[1]||new C(0,0,0);const e=this.getActiveScene();if(null===e)return null;return{scenes:{activeSceneName:this.activeSceneName},controls:e.getControlManager().createTransferData()}}applySoundData(e){const t=this.getActiveScene();null!==t&&t.getSoundManager().applyData(e)}applyRenderData(e){const t=this.getActiveScene();null!==t&&t.getRendererManager().applyData(e)}applyUpdateData(e){const t=this.getActiveScene();null!==t&&t.getAssetManager().applyData(e.assets)}activeScene(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];null!==this.activeTimer&&clearTimeout(this.activeTimer);let n=!1;this.activeTimer=setTimeout((()=>{this.activeTimer=null;for(const s in this.scenes)if(s!==e){const e=this.scenes[s];new i(e,"inactive").trigger({}),t=t||e.hasRun(),n=n||e.hasSleep(),e.stop()}const s=this.scenes[e];void 0!==s&&(this.activeSceneName=e,t&&!n&&s.run(),new i(this,"active").triggerAsync({scene:s}),new i(s,"active").triggerAsync({}))}),0)}}class Ii{constructor(){this.voxels=new Array,this.isUpdate=!0;for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.addVoxels(li,...t)}clear(){me(this.voxels),this.addVoxels(li),this.isUpdate=!0}addVoxels(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];t.forEach((e=>{if(!this.voxels.find((t=>null!==t&&bi(e,t)))){for(let t=0,n=0|this.voxels.length;t<n;t=t+1|0)if(null===this.voxels[t])return this.voxels[t]=e,void(this.isUpdate=!0);this.voxels.push(e),this.isUpdate=!0}}))}removeVoxels(){for(let e=0,t=0|arguments.length;e<t;e=e+1|0){const t=e<0||arguments.length<=e?void 0:arguments[e],n=this.voxels.indexOf(t);-1!==n&&(this.voxels[n]=null)}}getVoxel(e){return e<0||e>=this.voxels.length?hi:this.voxels[e]||hi}getVoxels(){return this.voxels||null}hasVoxel(e){return this.voxels.hasOwnProperty(e)}checkUpdate(){const{isUpdate:e}=this;return this.isUpdate=!1,e}}class Li extends yn{constructor(){super(...arguments),this.direction=new E(0,0)}}class Oi extends Mn{constructor(){super(...arguments),this.zoom=1,this.fov=1,this.light=0}}class Ai{constructor(e,t){this.type=e,this.name=t.split(" ")}}class Wi extends Ai{constructor(e,t,n,i,s,o){super(e,t),this.x=n,this.y=i,this.offsetX=s,this.offsetY=o}}class Ni extends Wi{constructor(e,t,n,i,s,o,a,r){let l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:new Array;super(e,t,n,i,s,o),this.width=a,this.height=r,this.children=l}}class zi extends Ai{constructor(e,t,n,i,s,o,a){super("line",e),this.color=t,this.start=new E(n,i),this.end=new E(s,o),this.bold=a}}class Di extends Ni{constructor(e,t,n,i,s,o,a,r){super("rect",e,s,o,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,a,r,arguments.length>10&&void 0!==arguments[10]?arguments[10]:new Array),this.color=t,this.fill=n,this.bold=i}}class Ri extends Ni{constructor(e,t,n,i,s,o,a,r,l,h){let p=!(arguments.length>10&&void 0!==arguments[10])||arguments[10];super("arc",e,o,a,arguments.length>11&&void 0!==arguments[11]?arguments[11]:0,arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,r,r,arguments.length>13&&void 0!==arguments[13]?arguments[13]:new Array),t instanceof Array?(this.color="",this.gradiant=t):(this.color=t,this.gradiant=[]),this.gradiantPar=n,this.fill=i,this.bold=s,this.startAngle=l,this.endAngle=h,this.clockWise=p}}class Hi extends Ni{constructor(e,t,n,i,s,o){let a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,r=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,h=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,p=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1;super("image",e,n,i,arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,arguments.length>11&&void 0!==arguments[11]?arguments[11]:0,s,o,arguments.length>13&&void 0!==arguments[13]?arguments[13]:new Array),this.image=t,this.clipX=a,this.clipY=r,this.clipWidth=l,this.clipHeight=h,this.alpha=p}}class Fi extends Wi{constructor(e,t,n,i,s,o,a,r){let l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:1,h=arguments.length>11&&void 0!==arguments[11]?arguments[11]:1,p=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null;super("font",e,a,r,arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,arguments.length>10&&void 0!==arguments[10]?arguments[10]:0),this.image=t,this.clipWidth=n,this.clipHeight=i,this.order=s,this.text=o,this.size=l,this.alpha=h,this.color=p}}class Ui{constructor(){this.keys={},this.presss={},this.axes={x:new E(0,0),y:new E(0,0),z:new E(0,0)}}}class Bi extends wn{constructor(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];super(Mn,...t),this.waitAsync={}}beginAsync(e,t){return this.waitAsync[e.getID()]=(this.waitAsync[e.getID()]||0)+1,t.finally((()=>{this.waitAsync[e.getID()]=Math.max(0,(this.waitAsync[e.getID()]||0)-1)}))}hasWaitAsync(e){return(this.waitAsync[e.getID()]||0)>0}}class Yi{constructor(e,t,n,i){this.position=new C(e,t,n),this.time=i}}class Gi extends Ui{constructor(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-.25,n=arguments.length>2?arguments[2]:void 0;super(),this.state="still",this.damages=new Array,this.loading=!1,this.time=0,this.landingTime=-1,this.landingForce=0,this.isPause=!1,this.isPressChange=!1,this.isPressNext=!1,this.isStartCombo=!1,this.isStick=!1,this.isAir=!1,this.isWaitActive=!1,this.isSlowMo=!1,this.isHookShot=!1,this.isHookAccel=!1,this.isPick=!1,this.isSprint=!1,this.startTime=-1,this.pickupTime=-1,this.powerupTime=-1,this.comboTime=-1,this.respawnTime=-1,this.deathTime=-1,this.goleTime=-1,this.hordeStartTime=0,this.startAddTime=-1,this.addTimeValue=0,this.bonusType=0,this.intermissionTime=-1,this.groundTime=-1,this.grabTime=-1,this.killTime=-1,this.hitWaitStartTime=-1,this.hitWaitTime=.25,this.gole=-1,this.secret=!1,this.activeEntity=null,this.wall=!1,this.airForce=0,this.jumpBuffer=!1,this.jumpWaitTime=-1,this.speed=1,this.oldSpeed=-1,this.oldDirX=-1,this.reduceTime=-1,this.pickMessage=null,this.helpMessages=new Array,this.hookPar=1,this.readySlowMo=!1,this.isZoomAnimation=!1,this.zoomAnimationPar=0,this.isFullscreen=!1,this.isPointerLock=!1,this.healthReduceInterval=-1,this.staminaReduceInterval=-1,this.cmda=new E(0,0),this.itemLogs=new Array,this.axesY=e,this.airValue=t,this.borderHealth=n}}function Vi(e,t){const n=e.getComponent(Ui);return!e.hasComponent(Gi)||!e.getComponent(Gi).activeEntity||t instanceof Gh&&"gamepad"!==t.getControlManager().getInputType()?n.keys["menu-touchpad-l"]>0?n.axes.z:n.axes.y:new E(-n.axes.x.x,-n.axes.x.y)}class Xi{constructor(e,t,n,i,s,o){this.name=e,this.keys=t,this.hasRelease=n,this.hasEnable=i,this.getMessage=s,this.exec=o}}class ji{constructor(){this.enable=!1,this.pressReadys={},this.value=-1,this.oldValue=-1,this.hasTrigger=!1,this.begin=!1,this.menus=new Array,this.menus.push(...arguments)}}class Ki extends Bi{constructor(){super(ji,Ui)}additional(e,t,n){const i=t.getComponent(ji),s=t.getComponent(Ui);if(i.enable){i.value!==i.oldValue&&(i.hasTrigger=!1),i.begin||(i.value=-1,i.oldValue=-1,i.begin=!0),i.oldValue=i.value;const o=Vi(t,n);if((Math.abs(o.x)>25e-5||Math.abs(o.y)>25e-5)&&(i.value=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(!e.hasComponent(Ui)||!e.hasComponent(ji))return n;const i=e.getComponent(ji).menus.length,s=2*Math.PI/i;if(Math.abs(t.x)>25e-5||Math.abs(t.y)>25e-5){const e=z(W(0,0,-t.x,-t.y));for(let t=0,n=0|i;t<n;t=t+1|0){const n=z(s*t-Math.PI/2-s/2),i=z(s*(t+1)-Math.PI/2-s/2);if(R(e,n)>=0&&R(e,i)<0)return t}}return n}(t,o,i.value)),-1!==i.value&&i.menus[i.value]){const o=i.menus[i.value];o.keys.forEach((a=>{i.pressReadys[a]&&s.keys[a]>0&&s.keys[a]!==s.presss[a]?(!0===o.hasEnable()&&setTimeout((()=>o.exec(e,t,n,a))),i.hasTrigger=!0,i.pressReadys[a]=!1):(s.keys[a]||0)<=0&&(i.pressReadys[a]=!0)}))}}else if(i.begin){if(-1!==i.oldValue&&-1!==i.value&&!i.hasTrigger&&i.menus[i.value]&&i.menus[i.value].hasRelease){const s=i.menus[i.value];!0===s.hasEnable()&&s.exec(e,t,n,""),i.hasTrigger=!1}i.begin=!1}}}function Ji(e,t,n,i,s){if(!e.hasComponent(Ui)||!e.hasComponent(ji)||!e.getComponent(ji).enable)return new Array;const o=e.getComponent(ji),a=o.menus.length,r=2*Math.PI/a,l=new Array,h=o.value;for(let e=0,t=0|a;e<t;e=e+1|0){const t=o.menus[e],a=z(r*e-Math.PI/2-r/2);l.push(new Ri("weapon-wheel-parts-arc-".concat(e),!0==!t.hasEnable()?"rgba(0,0,0,0.5)":e===h?"rgba(255,255,255,0.75)":"rgba(125,125,125,0.75)",1,!1,72.5,n,i,.75*s,z(a+r)-.01,z(a)+.01));const[p,c]=O(z(a+r/2),0,1.5*s);l.push(new Fi("weapon-wheel-parts-text-".concat(t.name),"./asset/font.png",5,5,di,t.name instanceof Function?t.name(!1):t.name,p,c,1,0,0,"low"===t.hasEnable()||t.hasEnable()?.75:.25,"low"===t.hasEnable()?[1,0,0]:t.hasEnable()&&e===h?[.5,.5,.5]:[1,1,1]))}const p=Vi(e,t),c=Math.abs(p.x)>25e-5||Math.abs(p.y)>25e-5?W(0,0,-p.x,-p.y):r*h-Math.PI/2,d=o.menus[h];return[new Ri("weapon-wheel-background","rgba(0,0,0,0.75)",1,!0,1,n,i,s,0,2*Math.PI,!0,0,0),d?new Ri("weapon-wheel-background-line","rgba(255,255,255,1.0)",1,!1,3,n,i,.5*s-.025,z(c+r/2),z(c-r/2),!0,0,0):null,d&&!1!==d.hasEnable()?new Fi("weapon-wheel-parts-text-".concat(d.name),"./asset/font.png",5,5,di,d.name instanceof Function?d.name(!0):d.name,0,-s/2*.5,2,0,0,1,"low"===d.hasEnable()?[1,0,0]:[1,1,1]):null,d&&!1!==d.hasEnable()?new Fi("weapon-wheel-parts-text-".concat(d.name),"./asset/font.png",5,5,di,d.getMessage(),0,s/2*.5,2,0,0,1,"low"===d.hasEnable()?[1,0,0]:[1,1,1]):null,...l]}function qi(e,t,n){if(e.hasComponent(is)){const i=e.getComponent(is);if(!i.value.hasOwnProperty(t))return;const s=i.value[t];"number"==typeof s.value&&(s.value+=n)}}function Zi(e,t,n){if(e.hasComponent(is)){const i=e.getComponent(is);if(!i.value.hasOwnProperty(t))return;i.value[t].value=n}}function Qi(e,t,n){if(e.hasComponent(is)){const i=e.getComponent(is);if(!i.value.hasOwnProperty(t))return;const s=i.value[t];"number"==typeof s.value&&(((null==s?void 0:s.max)||1/0)<n&&(n=(null==s?void 0:s.max)||1/0),s.value=n)}}function $i(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(e.hasComponent(is)){const i=e.getComponent(is);return i.value.hasOwnProperty(t)?i.value[t].value:n}return n}function es(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(e.hasComponent(is)){const i=e.getComponent(is);if(!i.value.hasOwnProperty(t))return n;const s=i.value[t].value;return"number"==typeof s?s:n}return n}function ts(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";if(e.hasComponent(is)){const i=e.getComponent(is);if(!i.value.hasOwnProperty(t))return n;const s=i.value[t].value;return"string"==typeof s?s:n}return n}function ns(e,t){if(e.hasComponent(is)){const n=e.getComponent(is).value[t];return n instanceof Object&&void 0!==n.max?n.max:0}return 0}class is{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.value={};for(const t in e)this.value[t]=e[t]}}class ss{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;this.enable=!0,this.exec=!1,this.through=!1,this.value=0,this.press=!1,this.angle=0,this.move=!1,this.blockPositionTop=-1,this.time=0,this.flip=null,this.standJump=!1,this.canJump=!1,this.canClimb=!1,this.canThroug=!1,this.canMove=!1,this.hasJump=!1,this.climb=!1,this.oldHit=!1,this.start=new C(0,0,0),this.end=new C(0,0,0),this.last=new C(0,0,0),this.oldPosition=new C(-1,-1,-1),this.grabPosition=new C(-1,-1,-1),this.height=e,this.clumbSpeed=t,this.grabSpeed=n}}class os{constructor(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.time=0,this.fireTime=0,this.spinPar=0,this.spinTime=-1,this.enableSprint=!1,this.sprintStartTime=-1,this.isFireAnimation=!1,this.state="still",this.inverse=e}}function as(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=e.getComponent(Fo),i=t?t.getComponent(os):null,o=-1!==n.rightWeapon.time?Math.min(n.rightWeapon.time,n.rightWeapon.data.fireSpeed):n.rightWeapon.data.fireSpeed,a=-1!==n.leftWeapon.time?Math.min(n.leftWeapon.time,n.leftWeapon.data.fireSpeed):n.leftWeapon.data.fireSpeed,r=s(Math.min(1,o/n.rightWeapon.data.fireSpeed),1),l=s(Math.min(1,a/n.leftWeapon.data.fireSpeed),1),h=Math.min(1,o/Math.min(.05,n.rightWeapon.data.fireSpeed)),p=Math.min(1,a/Math.min(.05,n.leftWeapon.data.fireSpeed));let c=1,d=1,u=1,m=-1;const g=(!n.leftWeapon.data.grip&&n.rightWeapon.data.grip&&!n.rightWeapon.data.release||n.leftWeapon.data.grip&&!n.rightWeapon.data.grip&&!n.leftWeapon.data.release)&&!(e.hasComponent(ss)&&(((null==i?void 0:i.inverse)?n.leftWeapon.data.climb:n.rightWeapon.data.climb)&&e.getComponent(ss).exec))&&!n.leftWeapon.data.release&&!n.rightWeapon.data.release&&(!n.leftWeapon.data.fireRelease||(!n.leftWeapon.isChargeStart&&!n.leftWeapon.isFire||!n.leftWeapon.isAmmo&&!(l>0&&l<1)))&&(!n.rightWeapon.data.fireRelease||(!n.rightWeapon.isChargeStart&&!n.rightWeapon.isFire||!n.rightWeapon.isAmmo&&!(r>0&&r<1)))&&(!n.leftWeapon.data.grip||(!n.leftWeapon.isFire||!n.leftWeapon.isAmmo&&!(l>0&&l<1)))&&(!n.rightWeapon.data.grip||(!n.rightWeapon.isFire||!n.rightWeapon.isAmmo&&!(r>0&&r<1)))&&(n.leftWeapon.data.shootType!==wo.HOOK||0===n.leftWeapon.bullets.length)&&(n.rightWeapon.data.shootType!==wo.HOOK||0===n.rightWeapon.bullets.length);let f=null;return null!==i&&(!i.inverse&&g&&n.rightWeapon.data.grip&&!n.leftWeapon.data.grip&&r>=1||i.inverse&&g&&n.rightWeapon.data.grip&&!n.leftWeapon.data.grip?(c=l,d=p,u=n.leftWeapon.chargePar,m=n.leftWeapon.data.fireAnimation,f="left"):i.inverse&&g&&n.leftWeapon.data.grip&&!n.rightWeapon.data.grip&&l>=1||!i.inverse&&g&&n.leftWeapon.data.grip&&!n.rightWeapon.data.grip?(c=r,d=h,u=n.rightWeapon.chargePar,m=n.rightWeapon.data.fireAnimation,f="right"):i.inverse?(c=l,d=p,u=n.leftWeapon.chargePar,m=n.leftWeapon.data.fireAnimation,f="left"):i.inverse||(c=r,d=h,u=n.rightWeapon.chargePar,m=n.rightWeapon.data.fireAnimation,f="right")),[g,f,m,s(Math.abs(Math.cos(Math.PI/2+Math.PI/2*c)),1,1e4),d,u]}class rs{constructor(e,t,n,i,s,o,a,r,l,h,p,c,d,u,m,g,f,y,w,x,M,E,C,v,b,_,S,k,T,P,I,L,O,A,W,N,z,D,R,H,F,U,B,Y,G,V,X,j,K,J,q,Z,Q,$,ee,te,ne,ie,se,oe,ae,re,le,he,pe,ce,de,ue,me,ge,fe,ye,we,xe,Me,Ee,Ce,ve,be,_e,Se,ke){this.itemMaterial=e,this.stillMaterial=t,this.cluchMateial=n,this.jumpMaterial=i,this.airMaterial=s,this.sprintMaterial=o,this.slidingMaterial=a,this.coilMaterial=r,this.grabMaterial=l,this.wallrunMaterial=h,this.chargeMaterial=p,this.chargeWaitMaterial=c,this.fireMaterial=d,this.chargeFireMaterial=u,this.cockingMaterial=m,this.gripMaterial=g,this.emptyMaterial=f,this.flip=y,this.grip=w,this.climb=x,this.release=M,this.fireRelease=E,this.isEndFire=C,this.shootType=v,this.isShootHold=b,this.fireAnimation=_,this.sprintType=S,this.tacticalSprintType=k,this.changeAnimationType=T,this.lightForce=P,this.fireSpeed=I,this.waitTime=L,this.normalBulletType=O,this.chargeBulletType=A,this.damageMin=W,this.damageMax=N,this.random=z,this.chargeTime=D,this.damageType=R,this.bulletCountMin=H,this.bulletCountMax=F,this.bulletSpeedMin=U,this.bulletSpeedMax=B,this.bulletBurstMin=V,this.bulletBurstMax=X,this.bulletLengthMin=Y,this.bulletLengthMax=G,this.bulletScaleMin=j,this.bulletScaleMax=K,this.standBulletSpreadMin=J,this.actionBulletSpreadMin=q,this.standBulletSpreadMax=Z,this.actionBulletSpreadMax=Q,this.spreadBullet=$,this.standRecoilForce=ee,this.actionRecoilForce=te,this.swaiTime=ne,this.swaiPar=ie,this.swaiForce=se,this.swaiReduce=oe,this.bobTime=ae,this.bobPar=re,this.bobForce=le,this.bobReduce=he,this.bobFov=pe,this.ammoType=ce,this.ammoReduceMin=de,this.ammoReduceMax=ue,this.isRotateCenter=me,this.isNeverLower=ge,this.fireSound=fe,this.chargeFireSound=ye,this.isReticle=we,this.isNormalHitShoot=xe,this.isChargeHitShoot=Me,this.isHave=Ee,this.isEmptySound=Ce,this.isOutOfAmmoLower=ve,this.normalFindTarget=be,this.chargeFindTarget=_e,this.normalFindType=Se,this.chargeFindType=ke}create(){return new ls(this)}}class ls{constructor(e){this.time=-1,this.fireTime=-1,this.fireStartTime=-1,this.bullets=new Array,this.isFire=!1,this.isCanShoot=!1,this.isShootable=!1,this.isAmmo=!1,this.isEmpty=!1,this.isFireWait=!1,this.isNoChargeFire=!1,this.isChargeStart=!1,this.isChargeEnable=!1,this.isChargeMax=!1,this.isChargeAttack=!1,this.spread=0,this.chargeLateTime=0,this.chargePar=0,this.isFirePress=!1,this.shootableTarget=null,this.isHoldFire=!1,this.data=e}}class hs{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"none",s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5&&void 0!==arguments[5]&&arguments[5],a=arguments.length>6?arguments[6]:void 0,r=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"none",l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:[oi.NONE],h=arguments.length>9&&void 0!==arguments[9]?arguments[9]:1,p=arguments.length>10&&void 0!==arguments[10]?arguments[10]:1,c=arguments.length>11&&void 0!==arguments[11]?arguments[11]:0,d=arguments.length>12&&void 0!==arguments[12]?arguments[12]:.05,u=arguments.length>13&&void 0!==arguments[13]?arguments[13]:10,m=arguments.length>14&&void 0!==arguments[14]&&arguments[14];this.init=!1,this.isRemove=!0,this.fixPosition=new C(0,0,0),this.isReduceAmmo=!0,this.invert=e,this.damage=t,this.random=n,this.damageType=i,this.force=s,this.isDeath=o,this.getSpark=a,this.trailType=r,this.images=l,this.trailBounding=h,this.startScale=p,this.endScale=c,this.force=s,this.trailLength=d,this.effectCount=u,this.isTrailRotateRandom=m}}class ps{constructor(e,t,n,i,s,o,a,r,l,h,p){let c=arguments.length>11&&void 0!==arguments[11]?arguments[11]:1/0,d=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,u=arguments.length>13&&void 0!==arguments[13]?arguments[13]:"hitbox",m=arguments.length>14&&void 0!==arguments[14]?arguments[14]:[];this.init=!1,this.hit=!1,this.over=!1,this.time=0,this.hitTime=-1,this.hitPosition=new C(-1,-1,-1),this.target=null,this.filter=new Array,this.hitDiff=new C(0,0,0),this.start=new C(e,t,n),this.originStart=new C(i,s,o),this.originPosition=new C(i,s,o),this.originDirection=new E(a,r),this.behind=e!==i||t!==s||n!==o,this.size=l,this.speed=h,this.findTarget=p,this.distance=c,this.attacker=d,this.tree=u,this.filter.push(...m)}}class cs{constructor(e,t){this.init=!1,this.enable=!0,this.hit={x:0,y:0,z:0,angle:{x:0,y:0}},this.old=new C(-1,-1,-1),this.size=new E(e,t)}}class ds{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this.value=new C(0,0,0),this.forceAir=!1,this.drift=new C(e,t,n),this.airDrift=i}}class us{constructor(e,t,n,i,s,o,a,r,l,h){let p=arguments.length>10&&void 0!==arguments[10]?arguments[10]:1/0,c=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,d=arguments.length>12&&void 0!==arguments[12]?arguments[12]:"hitbox",u=arguments.length>13&&void 0!==arguments[13]?arguments[13]:[];this.hit=!1,this.over=!1,this.target=null,this.hitPosition=new C(-1,-1,-1),this.fixPosition=new C(0,0,0),this.filter=new Array,this.start=new C(e,t,n),this.originStart=new C(i,s,o),this.originPosition=new C(i,s,o),this.originDirection=new E(a,r),this.behind=e!==i||t!==s||n!==o,this.size=l,this.speed=h,this.distance=p,this.attacker=c,this.tree=d,this.filter.push(...u)}}class ms{constructor(){this.value=new Array,this.value.push(...arguments)}}class gs extends Mn{constructor(e,t,n,i,s,o,a,r,l,h,p,c,d,u,m,g,f,y,w,x,M,E,C,v,b,_,S,k,T,P,I,L,O,A){let W=arguments.length>34&&void 0!==arguments[34]?arguments[34]:null,N=arguments.length>35&&void 0!==arguments[35]?arguments[35]:null,z=arguments.length>36?arguments[36]:void 0,D=arguments.length>37&&void 0!==arguments[37]?arguments[37]:new Array;for(var R=arguments.length,H=new Array(R>38?R-38:0),F=38;F<R;F++)H[F-38]=arguments[F];super("bullet".concat(e.length>0?" ".concat(e):""),new ps(l,h,p,c,d,u,m,g,f,w,x,t,W,z,D),new hs(n,i,s,r,M,E,C,v,T,A,I,L,b,_,S),...null===k||k===oi.NONE||P<=0||O<=0?[]:[new Cn(k,P,y,O),new vn(!0,!0,!0,0)],new ms,...H),this.position.x=l,this.position.y=h,this.position.z=p,this.direction.x=m,this.direction.y=g,this.attacker=W,this.weapon=N}}class fs extends Mn{constructor(e,t,n,i,s,o,a,r,l,h,p,c,d,u,m,g,f,y,w,x,M,E,C,v,b,_,S,k,T,P,I,L,O){let W=arguments.length>33&&void 0!==arguments[33]?arguments[33]:null,N=arguments.length>34&&void 0!==arguments[34]?arguments[34]:null,z=arguments.length>35?arguments[35]:void 0,D=arguments.length>36&&void 0!==arguments[36]?arguments[36]:new Array,R=arguments.length>37&&void 0!==arguments[37]?arguments[37]:new Array;for(var H=arguments.length,F=new Array(H>38?H-38:0),U=38;U<H;U++)F[U-38]=arguments[U];super("bullet".concat(e.length>0?" ".concat(e):""),new us(l,h,p,c,d,u,m,g,f,w,t,W,z,R),new ds(0,0,0,0),new _n(f,f,D),new cs(f,f),new hs(n,i,s,r,x,M,E,C,k,O,P,I,v,b,_),new Cn(S,T,y,L),new vn(!0,!0,!0,0),new ms,...F),this.position.x=l,this.position.y=h,this.position.z=p,this.direction.x=m,this.direction.y=g,this.attacker=W,this.weapon=N;const B=this.getComponent(ds),[Y,G,V]=A(m,g,0,0,w);B.value.x=Y,B.value.y=G,B.value.z=V}}class ys{constructor(){this.init=!1}}class ws{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Array,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>[];this.enable=!1,this.range=new E(e,t),this.filter=n,this.execAddComponents=i}}class xs extends Mn{constructor(e,t,n,i,s,o,a,r,l,h){for(var p=arguments.length,c=new Array(p>10?p-10:0),d=10;d<p;d++)c[d-10]=arguments[d];super("spark",new ys,new Cn(e,s,a,o),new vn(!0,l,!0,r),...c),this.position.x=t,this.position.y=n,this.position.z=i,this.attacker=h}}class Ms{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.time=0,this.speed=e}}class Es{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Array,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.time=0,this.frame=0,this.name=null,this.oldName=null,this.frames=new Array,this.frames.push(...e),this.speed=t,this.loop=n}}class Cs{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Ve();this.init=!1,this.sounds=e,this.volume=t,this.unliveStop=n,this.loop=i,this.namespace=s}}class vs extends xs{constructor(e,t,n,i,s,o){super(oi.EFFECT_HIT_WALL0,e,t,n,2*i,.75,Math.PI*Math.random(),0,!0,s,new Es([oi.EFFECT_HIT_WALL0,oi.EFFECT_HIT_WALL1,oi.EFFECT_HIT_WALL2],.1),new Ms(.1),new Cs(["./asset/sound/effect/bullet-wall-spark.mp3"],1,!1))}}class bs extends xs{constructor(e,t,n,i,s,o){super(oi.EFFECT_BULLET_AMMO_TRAIL,e,t,n,3*i,.75,Math.PI*Math.random(),0,!0,s,new Es([oi.EFFECT_HIT_BLOOD1,oi.EFFECT_HIT_BLOOD2,oi.EFFECT_HIT_BLOOD3],.1),new Ms(.1))}}class _s extends gs{constructor(e,t,n,i,s,o,a,r,l,h,p,c,d,u,m,g,f,y){let w=arguments.length>18&&void 0!==arguments[18]?arguments[18]:"ammo",x=arguments.length>19&&void 0!==arguments[19]?arguments[19]:null,M=arguments.length>20&&void 0!==arguments[20]?arguments[20]:null,E=arguments.length>21&&void 0!==arguments[21]?arguments[21]:new Array;super("player-bullet",p,h,u,m,f,y,w,e,t,n,i,s,o,a,r,c,0,l,d,.01,!0,((e,t,n,i,s,o,a)=>null!==o&&o.getNames().some((e=>"enemy"===e))&&!o.getNames().some((e=>"guy-armor"===e))?new bs(e,t,n,1,x,a):new vs(e,t,n,1,x,a)),"flash",1.5,10,!1,null,[oi.EFFECT_BULLET_AMMO_TRAIL],0,1,0,0,.1,x,M,"hitbox",["player-hit-bullet",...E])}}class Ss{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"none",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"none",s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:new Array;this.enable=!1,this.time=0,this.fireTick=-1,this.fireStartTime=-1,this.exec=!1,this.filter=new Array,this.damage=e,this.random=t,this.damageType=n,this.attackType=i,this.fireSpeed=s,this.filter.push(...o)}}class ks extends Ss{constructor(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>8&&void 0!==arguments[8]&&arguments[8];super(arguments.length>4&&void 0!==arguments[4]?arguments[4]:128,arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,arguments.length>6&&void 0!==arguments[6]?arguments[6]:"none","melee",arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,arguments.length>9&&void 0!==arguments[9]?arguments[9]:[]),this.minDamage=i,this.force=n,this.range=new E(e,t),this.isAcid=s}}class Ts extends xs{constructor(e,t,n,i,s,o,a,r,l,h){super(oi.EFFECT_DEFAULT_EXPLODE1,e,t,n,5*i,1,0,.25,!1,l,new ks(5*i,5*i,s,o,a,1,r,1/0,!1,h),new Es([oi.EFFECT_DEFAULT_EXPLODE1,oi.EFFECT_DEFAULT_EXPLODE2,oi.EFFECT_DEFAULT_EXPLODE3,oi.EFFECT_DEFAULT_EXPLODE4,oi.EFFECT_DEFAULT_EXPLODE5,oi.EFFECT_DEFAULT_EXPLODE6,oi.EFFECT_DEFAULT_EXPLODE7,oi.EFFECT_DEFAULT_EXPLODE8,oi.EFFECT_DEFAULT_EXPLODE9,oi.EFFECT_DEFAULT_EXPLODE10,oi.EFFECT_DEFAULT_EXPLODE11,oi.EFFECT_DEFAULT_EXPLODE12,oi.EFFECT_DEFAULT_EXPLODE13,oi.EFFECT_DEFAULT_EXPLODE14],.75,!1),new Ms(.75),new Cs(["./asset/sound/effect/explode.mp3"],10*i,!1))}}class Ps extends xs{constructor(e,t,n,i,s,o,a,r,l,h){super(oi.EFFECT_CORROSIVE_EXPLODE1,e,t,n,5*i,1,0,.25,!1,l,new ks(5*i,5*i,s,o,a,1,r,1/0,!0,h),new Es([oi.EFFECT_CORROSIVE_EXPLODE1,oi.EFFECT_CORROSIVE_EXPLODE2,oi.EFFECT_CORROSIVE_EXPLODE3,oi.EFFECT_CORROSIVE_EXPLODE4,oi.EFFECT_CORROSIVE_EXPLODE5,oi.EFFECT_CORROSIVE_EXPLODE6,oi.EFFECT_CORROSIVE_EXPLODE7,oi.EFFECT_CORROSIVE_EXPLODE8,oi.EFFECT_CORROSIVE_EXPLODE9,oi.EFFECT_CORROSIVE_EXPLODE10,oi.EFFECT_CORROSIVE_EXPLODE11,oi.EFFECT_CORROSIVE_EXPLODE12,oi.EFFECT_CORROSIVE_EXPLODE13,oi.EFFECT_CORROSIVE_EXPLODE14],.75,!1),new Ms(.75),new Cs(["./asset/sound/effect/corrosive.mp3"],10,!1))}}class Is extends gs{constructor(e,t,n,i,s,o,a,r,l,h,p,c,d,u,m,g,f,y){let w=arguments.length>18&&void 0!==arguments[18]?arguments[18]:"ammo",x=arguments.length>19&&void 0!==arguments[19]?arguments[19]:null,M=arguments.length>20&&void 0!==arguments[20]?arguments[20]:null,E=arguments.length>21&&void 0!==arguments[21]?arguments[21]:new Array;super("player-bullet",p,h,u,m,f,y,w,e,t,n,i,s,o,a,r,c,0,l,d,0,!0,((e,t,n,i,s,o,a)=>new Ts(e,t,n,1,.5,0,128,"explode",x,[])),"flash",5,10,!1,null,[oi.EFFECT_BULLET_AMMO_TRAIL],0,3,0,0,.1,x,M,"hitbox",["player-hit-bullet","enemy-hit-bullet",...E])}}class Ls extends Mn{constructor(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;for(var s=arguments.length,o=new Array(s>7?s-7:0),a=7;a<s;a++)o[a-7]=arguments[a];super("effect effect-headshot",new Cn(oi.EFFECT_HEADSHOT1,5*i,2*Math.PI*Math.random()),new vn(!0,!0,!0),new Es([oi.EFFECT_HEADSHOT1,oi.EFFECT_HEADSHOT2,oi.EFFECT_HEADSHOT3,oi.EFFECT_HEADSHOT4,oi.EFFECT_HEADSHOT5,oi.EFFECT_HEADSHOT],.25,!1),new Ms(.25),...o);const{position:r}=this;r.x=e,r.y=t,r.z=n}}class Os extends Mn{constructor(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;for(var s=arguments.length,o=new Array(s>7?s-7:0),a=7;a<s;a++)o[a-7]=arguments[a];super("effect effect-headshot",new Cn(oi.EFFECT_ARMORBREAK1,5*i,2*Math.PI*Math.random()),new vn(!0,!0,!0),new Es([oi.EFFECT_ARMORBREAK1,oi.EFFECT_ARMORBREAK2,oi.EFFECT_ARMORBREAK3,oi.EFFECT_ARMORBREAK4,oi.EFFECT_ARMORBREAK5,oi.EFFECT_ARMORBREAK],.25,!1),new Ms(.25),...o);const{position:r}=this;r.x=e,r.y=t,r.z=n}}class As extends xs{constructor(e,t,n,i,s,o,a){super(oi.EFFECT_SPARK_MISSILE1,e,t,n,2.5*i,.25,0,0,!0,o,new Es([oi.EFFECT_SPARK_MISSILE1,oi.EFFECT_SPARK_MISSILE2,oi.EFFECT_SPARK_MISSILE3,oi.EFFECT_SPARK_MISSILE4],.25,!1),new Ms(.25),...s?[new Cs(["./asset/sound/effect/damage-magic.mp3"],1,!1)]:[])}}class Ws{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.isDeath=!1,this.deathAngle=0,this.attacker=null,this.value=new Array,this.removes=new Array,this.multiples=e}}class Ns extends gs{constructor(e,t,n,i,s,o,a,r,l,h,p,c,d,u,m,g,f,y){let w=arguments.length>18&&void 0!==arguments[18]?arguments[18]:"ammo",x=arguments.length>19&&void 0!==arguments[19]?arguments[19]:null,M=arguments.length>20&&void 0!==arguments[20]?arguments[20]:null,E=arguments.length>21&&void 0!==arguments[21]?arguments[21]:new Array;super("player-bullet shot-target player-hit-bullet",p,h,u,m,f,y,w,e,t,n,i,s,o,a,r,c,0,l,d,0,!0,((e,t,n,i,s,o,a)=>new As(e,t,n,1,null===o,x,a)),"none",0,0,!1,oi.EFFECT_BULLET_PLASMA_BALL,[],1.25,0,0,.1,0,x,M,"hitbox",["player-hit-bullet",...E],new is({health:{value:1,max:1}}),new Ws({magic:1,explode:1}),new Sn(.5,.5),new wi(0,-.25,0))}}class zs extends gs{constructor(e,t,n,i,s,o,a,r,l,h,p,c,d,u,m,g,f,y){let w=arguments.length>18&&void 0!==arguments[18]?arguments[18]:"ammo",x=arguments.length>19&&void 0!==arguments[19]?arguments[19]:null,M=arguments.length>20&&void 0!==arguments[20]?arguments[20]:null,E=arguments.length>21&&void 0!==arguments[21]?arguments[21]:new Array;super("player-bullet",p,h,u,m,f,y,w,e,t,n,i,s,o,a,r,c,0,l,d,.25,!0,((e,t,n,i,s,o,a)=>null!==o&&o.getNames().some((e=>"enemy"===e))&&!o.getNames().some((e=>"guy-armor"===e))?new bs(e,t,n,1,x,a):new vs(e,t,n,1,x,a)),"flash",1.5,10,!1,null,[oi.EFFECT_BULLET_AMMO_TRAIL],0,1,0,0,.1,x,M,"hitbox",["player-hit-bullet",...E])}}class Ds extends Ss{constructor(e,t,n,i,s){let o=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0;super(arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,arguments.length>6&&void 0!==arguments[6]?arguments[6]:1,arguments.length>7&&void 0!==arguments[7]?arguments[7]:"none","melee",arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,arguments.length>10&&void 0!==arguments[10]?arguments[10]:[]),this.force=n,this.clusterCount=o,this.range=new E(e,t),this.direction=new E(i,s)}}class Rs extends xs{constructor(e,t,n,i,s,o,a,r,l,h,p){super(oi.NONE,e,t,n,5*o,1,0,.25,!1,h,new Ds(5*o,5*o,.5,-i,-s,r,1,l,1/0,5,p),new Cs(["./asset/sound/effect/mine-drop.wav"],10,!1),new Ms(1))}}class Hs{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-.325;this.init=!1,this.fall=1,this.isFall=!1,this.value=e,this.gravity=t,this.flex=n,this.max=i}}class Fs extends fs{constructor(e,t,n,i,s,o,a,r,l,h,p,c,d,u,m,g,f,y){let w=arguments.length>18&&void 0!==arguments[18]?arguments[18]:"ammo",x=arguments.length>19&&void 0!==arguments[19]?arguments[19]:null,M=arguments.length>20&&void 0!==arguments[20]?arguments[20]:null,E=arguments.length>21&&void 0!==arguments[21]?arguments[21]:new Array;super("player-bullet cluster player-hit-bullet",p,h,u,m,f,y,w,e,t,n,i,s,o,a,r,c,0,l,.1,!0,((e,t,n,i,s,o,a)=>new Rs(e,t,n,z(Math.PI-i),-s,1,!1,0,w,x,a)),"flash",5,10,!1,oi.EFFECT_BULLET_GRENADE,[],3,3,3,.1,0,x,M,"hitbox",["player-hit-bullet","enemy-hit-bullet",...E],["player-hit-bullet","enemy-hit-bullet",...E],...y?[]:[new Hs(.5)])}}class Us extends gs{constructor(e,t,n,i,s,o,a,r,l,h,p,c,d,u,m,g,f,y){let w=arguments.length>18&&void 0!==arguments[18]?arguments[18]:"ammo",x=arguments.length>19&&void 0!==arguments[19]?arguments[19]:null,M=arguments.length>20&&void 0!==arguments[20]?arguments[20]:null,E=arguments.length>21&&void 0!==arguments[21]?arguments[21]:new Array;super("player-bullet",p,h,u,m,f,y,w,e,t,n,i,s,o,a,r,c,0,l,d,.01,!0,((e,t,n,i,s,o,a)=>null!==o&&o.getNames().some((e=>"enemy"===e))&&!o.getNames().some((e=>"guy-armor"===e))?new bs(e,t,n,1,x,a):new vs(e,t,n,1,x,a)),"flash",1,10,!1,null,[oi.EFFECT_BULLET_PLASMA_TRAIL],0,.75,0,0,.1,x,M,"hitbox",["player-hit-bullet",...E])}}class Bs{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.time=0,this.speed=e,this.reverse=t,this.loop=n}}class Ys extends fs{constructor(e,t,n,i,s,o,a,r,l,h,p,c,d,u,m,g,f,y){let w=arguments.length>18&&void 0!==arguments[18]?arguments[18]:"ammo",x=arguments.length>19&&void 0!==arguments[19]?arguments[19]:null,M=arguments.length>20&&void 0!==arguments[20]?arguments[20]:null,E=arguments.length>21&&void 0!==arguments[21]?arguments[21]:new Array;super("player-bullet",p,h,u,m,f,y,w,e,t,n,i,s,o,a,r,c,0,l,0,!0,((e,t,n,i,s,o,a)=>new Ps(e,t,n,1,.5,0,64,"explode",x,[])),"flash",1,10,!1,oi.EFFECT_BULLET_ARM_GRANADE,[oi.EFFECT_BULLET_PLASMA_TRAIL],1,.5,0,.375,.1,x,M,"",["player-hit-bullet","enemy-hit-bullet",...E],["player-hit-bullet","enemy-hit-bullet",...E],new Hs(.5),new Bs(1,!1,!0))}}class Gs{constructor(){this.init=!1,this.bullet=null,this.fixPosition=new C(0,0,0)}}class Vs extends gs{constructor(e,t,n,i,s,o,a,r,l,h,p,c,d,u,m,g,f,y){super("player-bullet hook target",p,h,0,0,f,y,arguments.length>18&&void 0!==arguments[18]?arguments[18]:"ammo",e,t,n,i,s,o,a,r,c,c,1/0,!1,0,!1,((e,t,n,i,s,o,a)=>null),"none",0,0,!1,null,[],0,0,0,0,0,arguments.length>19&&void 0!==arguments[19]?arguments[19]:null,arguments.length>20&&void 0!==arguments[20]?arguments[20]:null,"hitbox",["player-hit-bullet","enemy-hit-bullet",...arguments.length>21&&void 0!==arguments[21]?arguments[21]:new Array],new Gs)}}class Xs extends gs{constructor(e,t,n,i,s,o,a,r,l,h,p,c,d,u,m,g,f,y){let w=arguments.length>18&&void 0!==arguments[18]?arguments[18]:"ammo",x=arguments.length>19&&void 0!==arguments[19]?arguments[19]:null,M=arguments.length>20&&void 0!==arguments[20]?arguments[20]:null,E=arguments.length>21&&void 0!==arguments[21]?arguments[21]:new Array;super("player-bullet",p,h,u,m,f,y,w,e,t,n,i,s,o,a,r,c,0,l,d,.875/g,!0,((e,t,n,i,s,o,a)=>null!==o&&o.getNames().some((e=>"enemy"===e))&&!o.getNames().some((e=>"guy-armor"===e))?new bs(e,t,n,1,x,a):new vs(e,t,n,1,x,a)),"flash",1.5,10,!1,null,[oi.EFFECT_BULLET_AMMO_TRAIL],0,1,0,0,.1,x,M,"hitbox",["player-hit-bullet",...E])}}function js(e){let t=es(e,"useshoppoint",0),n=0,i=0;for(let e=0,s=0|eo.length;e<s;e=e+1|0){const s=eo[e];if(t-s.need<0){const o=eo[e-1];return n=t/s.need,i=s.need,[o.img,n,t,i,o.sale]}t-=s.need}const s=eo[eo.length-1];return[s.img,n,i,i,s.sale]}class Ks{constructor(e,t,n){this.img=e,this.need=t,this.sale=n}}class Js{constructor(e,t,n){this.damagePar=e,this.range=new E(t,n)}}function qs(e){for(let t=0,n=0|$s.length;t<n;t=t+1|0){const n=$s[t];if(e-n.score<0){const e=$s[Math.max(t-1,0)]||n;return[e.text,e.color]}}const t=$s[$s.length-1];return[t.text,t.color]}class Zs{constructor(e,t,n){this.score=e,this.text=t,this.color=n}}const Qs=["D","C","B","A","S","SS","SSS"],$s=[new Zs(0,"D",[1,1,1]),new Zs(1e5,"C",[0,1,0]),new Zs(375e3,"B",[0,0,1]),new Zs(75e4,"A",[1,0,1]),new Zs(1e6,"S",[1,1,0])],eo=[new Ks("./asset/memberscard/members.png",0,1),new Ks("./asset/memberscard/silver.png",1e5,.95),new Ks("./asset/memberscard/gold.png",15e4,.9),new Ks("./asset/memberscard/platinum.png",25e4,.75),new Ks("./asset/memberscard/diamond.png",5e5,.5)],to=["HEAD SHOT","SHOOT DOWN","ARMOR BREAK"],no=-1,io=0,so=1,oo=2,ao=3,ro=4,lo=5,ho=6,po=7,co=8,uo=9,mo=10,go=11,fo=12,yo=13,wo={NONE:-1,SEMIAUTO:0,AUTO:1,BURST:2,CHARGE:3,SPIN:4,SLOW:5,ZOOM:6,SHIELD:7,COMBO:8,HOOK:9},xo=-1,Mo=0,Eo=1,Co=2,vo=0,bo=1,_o=3,So=0,ko=1,To=2,Po=3,Io=4,Lo=5,Oo=6,Ao=7,Wo=8,No=9,zo=10,Do=["hand","sidearm","machingun","shotgun","launcher","plasmagun"],Ro=["stamina","clip","magazine","shell","rocket","cell"],Ho={none:new rs(oi.NONE,oi.HUD_HAND_STILL,oi.HUD_HAND_STILL,oi.HUD_HAND_JUMP,oi.HUD_HAND_AIR,oi.HUD_HAND_SPRINT,oi.HUD_HAND_STILL,oi.NONE,oi.HUD_HAND_JUMP,oi.HUD_HAND_SPRINT,oi.HUD_HAND_STILL,oi.HUD_HAND_STILL,oi.HUD_HAND_FIRE,oi.HUD_HAND_FIRE,oi.HUD_HAND_FIRE,oi.HUD_HAND_GRIP,oi.HUD_HAND_STILL,!0,!0,!0,!1,!0,!1,wo.NONE,!1,no,So,So,vo,0,0,0,null,null,0,0,0,0,"none",0,0,0,0,0,0,1,1,0,0,0,0,0,0,!1,0,0,0,0,0,0,.5,.25,.025,2.5,.05,null,0,0,!1,!0,null,null,!1,!1,!1,!0,!1,!1,!1,!1,xo,xo),punch:new rs(oi.ITEM_WEAPON_PUNCH,oi.HUD_HAND_STILL,oi.HUD_HAND_STILL,oi.HUD_HAND_JUMP,oi.HUD_HAND_AIR,oi.HUD_HAND_SPRINT,oi.HUD_HAND_STILL,oi.NONE,oi.HUD_HAND_JUMP,oi.HUD_HAND_SPRINT,oi.HUD_HAND_CHARGE,oi.HUD_HAND_STILL,oi.HUD_HAND_FIRE,oi.HUD_HAND_ATTACK,oi.HUD_HAND_FIRE,oi.HUD_HAND_GRIP,oi.HUD_HAND_STILL,!0,!0,!0,!1,!0,!1,wo.CHARGE,!1,io,So,So,vo,0,.25,.1,class extends gs{constructor(e,t,n,i,s,o,a,r,l,h,p,c,d,u,m,g,f,y){let w=arguments.length>18&&void 0!==arguments[18]?arguments[18]:"ammo",x=arguments.length>19&&void 0!==arguments[19]?arguments[19]:null,M=arguments.length>20&&void 0!==arguments[20]?arguments[20]:null,E=arguments.length>21&&void 0!==arguments[21]?arguments[21]:new Array;super("player-bullet",p,h,u*f,m,f,y,w,e,t,n,i,s,o,a,r,c,0,l,d,.25+.75*f,!0,((e,t,n,i,s,o,a)=>f>=1?new Ls(e,t,n,1):null!==o&&o.getNames().some((e=>"enemy"===e))?new bs(e,t,n,1,x,a):new vs(e,t,n,1,x,a)),"none",0,0,!1,null,[],0,0,0,0,0,x,M,"hitbox",[...f>=1?["player-hit-bullet","enemy-hit-bullet","player-bullet","enemy-bullet"]:[],...E])}},class extends gs{constructor(e,t,n,i,s,o,a,r,l,h,p,c,d,u,m,g,f,y){super("player-bullet",p,h,u*f,m,f,y,arguments.length>18&&void 0!==arguments[18]?arguments[18]:"ammo",e,t,n,i,s,o,a,r,c,0,l,d,.25+.75*f,!0,(()=>null),"none",0,0,!1,null,[],0,0,0,0,0,arguments.length>19&&void 0!==arguments[19]?arguments[19]:null,arguments.length>20&&void 0!==arguments[20]?arguments[20]:null,"hitbox",[...f>=1?["player-hit-bullet","player-bullet","enemy-bullet"]:[],...arguments.length>21&&void 0!==arguments[21]?arguments[21]:new Array],new Js(.375,2.5+5*f,2.5+5*f))}},0,100,1,.5,"melee",1,1,1/0,1/0,2.5,7.5,1,1,1,1,0,0,0,0,!1,0,0,0,0,0,0,.5,.25,.025,2.5,.05,"stamina",0,50,!1,!1,"./asset/sound/weapon/punch-fire.mp3","./asset/sound/weapon/punch-fire-charge.mp3",!1,!1,!0,!0,!1,!1,!0,!0,xo,Co),slowball:new rs(oi.ITEM_WEAPON_SLOWBALL,oi.HUD_SLOWBALL_STILL,oi.HUD_SLOWBALL_STILL,oi.HUD_SLOWBALL_STILL,oi.HUD_SLOWBALL_STILL,oi.HUD_SLOWBALL_STILL,oi.HUD_SLOWBALL_STILL,oi.NONE,oi.HUD_HAND_JUMP,oi.HUD_SLOWBALL_STILL,oi.HUD_SLOWBALL_STILL,oi.HUD_SLOWBALL_STILL,oi.HUD_SLOWBALL_FIRE,oi.HUD_SLOWBALL_FIRE,oi.HUD_SLOWBALL_FIRE,oi.HUD_HAND_GRIP,oi.HUD_SLOWBALL_STILL,!0,!0,!0,!1,!0,!1,wo.SLOW,!0,fo,So,So,vo,1.075,.03,.03,null,null,.25,.25,0,0,"none",0,0,0,0,0,0,1,1,0,0,0,0,0,0,!1,0,0,0,0,0,0,0,0,0,0,0,"stamina",1,1,!1,!1,null,null,!1,!1,!1,!0,!1,!1,!1,!1,xo,xo),binoculars:new rs(oi.ITEM_WEAPON_BINOCULARS,oi.HUD_BINOCULARS_STILL,oi.HUD_BINOCULARS_STILL,oi.HUD_BINOCULARS_STILL,oi.HUD_BINOCULARS_STILL,oi.HUD_BINOCULARS_STILL,oi.HUD_BINOCULARS_STILL,oi.NONE,oi.HUD_HAND_JUMP,oi.HUD_BINOCULARS_STILL,oi.HUD_BINOCULARS_STILL,oi.HUD_BINOCULARS_STILL,oi.HUD_BINOCULARS_STILL,oi.HUD_BINOCULARS_STILL,oi.HUD_BINOCULARS_STILL,oi.HUD_HAND_GRIP,oi.HUD_BINOCULARS_STILL,!0,!0,!0,!1,!0,!1,wo.ZOOM,!0,fo,So,So,vo,0,.03,.03,null,null,2.5,2.5,0,0,"none",0,.25,.25,0,0,0,1,1,0,0,0,0,0,0,!1,0,0,0,0,0,0,0,0,0,0,0,"stamina",1,1,!1,!1,null,null,!1,!1,!1,!0,!1,!1,!1,!1,xo,xo),energyshield:new rs(oi.ITEM_WEAPON_ENERGYSHIELD,oi.HUD_ENERGYSHIELD_STILL,oi.HUD_ENERGYSHIELD_STILL,oi.HUD_ENERGYSHIELD_STILL,oi.HUD_ENERGYSHIELD_STILL,oi.HUD_ENERGYSHIELD_STILL,oi.HUD_ENERGYSHIELD_STILL,oi.NONE,oi.HUD_HAND_JUMP,oi.HUD_ENERGYSHIELD_STILL,oi.HUD_ENERGYSHIELD_STILL,oi.HUD_ENERGYSHIELD_STILL,oi.HUD_ENERGYSHIELD_FIRE,oi.HUD_ENERGYSHIELD_FIRE,oi.HUD_ENERGYSHIELD_EMPTY,oi.HUD_HAND_GRIP,oi.HUD_ENERGYSHIELD_STILL,!0,!1,!0,!1,!1,!1,wo.SHIELD,!0,so,So,So,vo,0,.03,.03,null,null,.25,.25,0,0,"none",0,0,0,0,0,0,1,1,0,0,0,0,0,0,!1,0,0,0,0,0,0,0,0,0,0,0,"stamina",0,0,!1,!1,null,null,!1,!1,!1,!0,!1,!1,!1,!1,xo,xo),combobooster:new rs(oi.ITEM_WEAPON_COMBOBOOSTER,oi.HUD_COMBO_BOOSTER_STILL,oi.HUD_COMBO_BOOSTER_STILL,oi.HUD_COMBO_BOOSTER_STILL,oi.HUD_COMBO_BOOSTER_STILL,oi.HUD_COMBO_BOOSTER_STILL,oi.HUD_COMBO_BOOSTER_STILL,oi.NONE,oi.HUD_HAND_JUMP,oi.HUD_COMBO_BOOSTER_STILL,oi.HUD_COMBO_BOOSTER_STILL,oi.HUD_COMBO_BOOSTER_STILL,oi.HUD_COMBO_BOOSTER_FIRE,oi.HUD_COMBO_BOOSTER_FIRE,oi.HUD_COMBO_BOOSTER_STILL,oi.HUD_HAND_GRIP,oi.HUD_COMBO_BOOSTER_STILL,!0,!0,!0,!1,!0,!0,wo.COMBO,!1,yo,So,So,vo,1.25,1,1,null,null,7,7,0,0,"none",0,0,0,0,0,0,1,1,0,0,0,0,0,0,!1,0,0,0,0,0,0,.5,.25,.025,2.5,.05,"stamina",75,75,!1,!1,null,null,!1,!1,!1,!0,!0,!1,!1,!1,xo,xo),corrodegrenade:new rs(oi.ITEM_WEAPON_GRENADE,oi.HUD_HAND_STILL,oi.HUD_HAND_STILL,oi.HUD_HAND_JUMP,oi.HUD_HAND_AIR,oi.HUD_HAND_SPRINT,oi.HUD_HAND_STILL,oi.NONE,oi.HUD_HAND_JUMP,oi.HUD_HAND_SPRINT,oi.HUD_HAND_CHARGE,oi.HUD_HAND_FIRE,oi.HUD_HAND_ATTACK,oi.HUD_HAND_ATTACK,oi.HUD_HAND_STILL,oi.HUD_HAND_GRIP,oi.HUD_HAND_CHARGE,!0,!0,!0,!1,!0,!1,wo.SEMIAUTO,!1,oo,So,So,vo,1.125,.5,.5,Ys,Ys,5,10,3,1,"corrode",1,1,.1875,.1875,1/0,1/0,1,1,.25,.25,0,0,0,0,!1,0,0,0,0,0,.5,.5,.25,.025,2.5,.05,"stamina",75,75,!1,!1,null,null,!1,!1,!1,!0,!0,!1,!1,!1,xo,xo),hookshot:new rs(oi.ITEM_WEAPON_HOOKSHOT,oi.HUD_HAND_STILL,oi.HUD_HAND_STILL,oi.HUD_HAND_JUMP,oi.HUD_HAND_AIR,oi.HUD_HAND_SPRINT,oi.HUD_HAND_STILL,oi.NONE,oi.HUD_HAND_JUMP,oi.HUD_HAND_SPRINT,oi.HUD_HOOKSHOT_STILL,oi.HUD_HOOKSHOT_STILL,oi.HUD_HOOKSHOT_STILL,oi.HUD_HOOKSHOT_STILL,oi.HUD_HOOKSHOT_STILL,oi.HUD_HAND_GRIP,oi.HUD_HAND_STILL,!0,!0,!0,!1,!0,!1,wo.HOOK,!1,ao,So,So,vo,0,.0175,0,Vs,Vs,0,0,0,0,"hook",1,1,1/0,1/0,12.5,12.5,1,1,0,0,0,0,0,0,!1,.025,.025,.375,.5,1,.5,.5,.25,.0125,2.5,.1,"stamina",0,0,!1,!1,"./asset/sound/weapon/hook-fire.mp3",null,!1,!0,!0,!0,!1,!0,!1,!1,Mo,Mo),pistol:new rs(oi.ITEM_WEAPON_PISTOL,oi.HUD_PISTOL_STILL,oi.HUD_PISTOL_STILL,oi.HUD_PISTOL_STILL,oi.HUD_PISTOL_STILL,oi.HUD_PISTOL_STILL,oi.HUD_PISTOL_STILL,oi.NONE,oi.HUD_HAND_JUMP,oi.HUD_PISTOL_STILL,oi.HUD_PISTOL_STILL,oi.HUD_PISTOL_STILL,oi.HUD_PISTOL_FIRE,oi.HUD_PISTOL_FIRE,oi.HUD_PISTOL_COCKING,oi.HUD_HAND_GRIP,oi.HUD_PISTOL_COCKING,!0,!1,!0,!1,!1,!1,wo.SEMIAUTO,!1,ro,Wo,Io,bo,1.125,.125,.1,_s,_s,5,5,3,0,"ammo",1,1,1,1,1/0,1/0,1,1,.125,.125,Math.PI/2*.0275,0,Math.PI/2*.0275,0,!1,.1,.025,.375,.5,.5,.5,.5,.25,.0325,2.5,.065,"clip",1,1,!0,!1,"./asset/sound/weapon/pistol-fire.mp3",null,!0,!1,!1,!0,!0,!0,!1,!1,xo,xo),handcannon:new rs(oi.ITEM_WEAPON_HANDCANNON,oi.HUD_HANDCANNON_STILL,oi.HUD_HANDCANNON_STILL,oi.HUD_HANDCANNON_STILL,oi.HUD_HANDCANNON_STILL,oi.HUD_HANDCANNON_STILL,oi.HUD_HANDCANNON_STILL,oi.NONE,oi.HUD_HAND_JUMP,oi.HUD_HANDCANNON_STILL,oi.HUD_HANDCANNON_STILL,oi.HUD_HANDCANNON_STILL,oi.HUD_HANDCANNON_FIRE,oi.HUD_HANDCANNON_FIRE,oi.HUD_HANDCANNON_COCKING,oi.HUD_HAND_GRIP,oi.HUD_HANDCANNON_COCKING,!0,!1,!0,!1,!1,!1,wo.CHARGE,!1,lo,Wo,Io,bo,1.125,.5,.375,Xs,Xs,40,5,1,.5,"mugnum",1,8,1.5,1.5,1/0,1/0,1,1,.125,.125,Math.PI/2*.0275,0,Math.PI/2*.0575,Math.PI/2*.025,!0,.5,.175,.25,.5,.875,.5,.75,.25,.05,2.5,.25,"clip",1,1,!0,!1,"./asset/sound/weapon/heavycannon-fire.mp3","./asset/sound/weapon/shotgun-fire.mp3",!0,!1,!1,!0,!0,!0,!1,!1,xo,xo),machingun:new rs(oi.ITEM_WEAPON_MACHINGUN,oi.HUD_MACHINGUN_STILL,oi.HUD_MACHINGUN_STILL,oi.HUD_MACHINGUN_STILL,oi.HUD_MACHINGUN_STILL,oi.HUD_MACHINGUN_STILL,oi.HUD_MACHINGUN_STILL,oi.NONE,oi.HUD_HAND_JUMP,oi.HUD_MACHINGUN_STILL,oi.HUD_MACHINGUN_STILL,oi.HUD_MACHINGUN_STILL,oi.HUD_MACHINGUN_FIRE,oi.HUD_MACHINGUN_FIRE,oi.HUD_MACHINGUN_COCKING,oi.HUD_HAND_GRIP,oi.HUD_MACHINGUN_COCKING,!1,!1,!0,!1,!1,!1,wo.AUTO,!1,ro,No,Po,_o,1.125,.1,.1,_s,_s,5,5,3,0,"ammo",1,1,1.25,1.25,1/0,1/0,1,1,.125,.125,Math.PI/2*.045,Math.PI/2*.02,Math.PI/2*.045,Math.PI/2*.02,!1,.0625,.01,.375,.5,.375,.5,.5,.25,.0325,2.5,.065,"magazine",1,1,!0,!1,"./asset/sound/weapon/machingun-fire.mp3",null,!0,!1,!1,!0,!0,!0,!1,!1,xo,xo),chainshotgun:new rs(oi.ITEM_WEAPON_CHAINSHOTGUN,oi.HUD_CHAINSHOTGUN_STILL,oi.HUD_CHAINSHOTGUN_STILL,oi.HUD_CHAINSHOTGUN_STILL,oi.HUD_CHAINSHOTGUN_STILL,oi.HUD_CHAINSHOTGUN_STILL,oi.HUD_CHAINSHOTGUN_STILL,oi.NONE,oi.HUD_HAND_JUMP,oi.HUD_CHAINSHOTGUN_STILL,oi.HUD_CHAINSHOTGUN_STILL,oi.HUD_CHAINSHOTGUN_STILL,oi.HUD_CHAINSHOTGUN_FIRE,oi.HUD_CHAINSHOTGUN_FIRE,oi.HUD_CHAINSHOTGUN_COCKING,oi.HUD_HAND_GRIP,oi.HUD_CHAINSHOTGUN_STILL,!1,!1,!1,!1,!1,!1,wo.SPIN,!1,ho,zo,Ao,vo,1.125,.25,.25,zs,zs,5,5,3,1,"ammo",6,6,1.25,1.25,1/0,1/0,1,1,.125,.125,Math.PI/2*.0575,Math.PI/2*.025,Math.PI/2*.0575,Math.PI/2*.025,!0,0,0,.375,.5,.375,.5,.5,.25,.05,2.5,.05,"magazine",6,6,!0,!1,"./asset/sound/weapon/chainshotgun-fire.wav",null,!0,!1,!1,!1,!0,!0,!1,!1,xo,xo),shotgun:new rs(oi.ITEM_WEAPON_SHOTGUN,oi.HUD_SHOTGUN_STILL,oi.HUD_SHOTGUN_STILL,oi.HUD_SHOTGUN_STILL,oi.HUD_SHOTGUN_STILL,oi.HUD_SHOTGUN_STILL,oi.HUD_SHOTGUN_STILL,oi.NONE,oi.HUD_HAND_JUMP,oi.HUD_SHOTGUN_STILL,oi.HUD_SHOTGUN_STILL,oi.HUD_SHOTGUN_STILL,oi.HUD_SHOTGUN_FIRE,oi.HUD_SHOTGUN_FIRE,oi.HUD_SHOTGUN_COCKING,oi.HUD_HAND_GRIP,oi.HUD_SHOTGUN_COCKING,!1,!1,!0,!1,!1,!1,wo.SEMIAUTO,!1,mo,No,Oo,vo,1.125,.625,.75,zs,zs,5,5,3,0,"ball",7,7,1,1,1/0,1/0,1,1,.125,.125,Math.PI/2*.0575,Math.PI/2*.025,Math.PI/2*.0575,Math.PI/2*.025,!0,.25,.05,.25,.5,.875,.5,.75,.25,.05,2.5,.25,"shell",1,1,!0,!1,"./asset/sound/weapon/shotgun-fire.mp3",null,!0,!1,!1,!0,!0,!0,!1,!1,xo,xo),heavycannon:new rs(oi.ITEM_WEAPON_HEAVYCANNON,oi.HUD_HEAVYCANNON_STILL,oi.HUD_HEAVYCANNON_STILL,oi.HUD_HEAVYCANNON_STILL,oi.HUD_HEAVYCANNON_STILL,oi.HUD_HEAVYCANNON_STILL,oi.HUD_HEAVYCANNON_STILL,oi.NONE,oi.HUD_HAND_JUMP,oi.HUD_HEAVYCANNON_STILL,oi.HUD_HEAVYCANNON_STILL,oi.HUD_HEAVYCANNON_STILL,oi.HUD_HEAVYCANNON_FIRE,oi.HUD_HEAVYCANNON_FIRE,oi.HUD_HEAVYCANNON_COCKING,oi.HUD_HAND_GRIP,oi.HUD_HEAVYCANNON_COCKING,!1,!1,!0,!1,!1,!1,wo.CHARGE,!1,uo,zo,Oo,vo,1.125,.625,.75,_s,_s,10,30,1,.5,"ball",7,7,1.5,1.5,1/0,1/0,1,1,.125,.125,0,0,0,0,!1,.5,.175,.375,.5,.5,.5,.5,.25,.05,2.5,.25,"shell",1,3,!0,!1,"./asset/sound/weapon/heavycannon-fire.mp3","./asset/sound/weapon/heavycannon-fire-charge.wav",!0,!1,!1,!0,!0,!0,!1,!1,xo,xo),launcher:new rs(oi.ITEM_WEAPON_LAUNCHER,oi.HUD_LAUNCHER_STILL,oi.HUD_LAUNCHER_STILL,oi.HUD_LAUNCHER_STILL,oi.HUD_LAUNCHER_STILL,oi.HUD_LAUNCHER_STILL,oi.HUD_LAUNCHER_STILL,oi.NONE,oi.HUD_HAND_JUMP,oi.HUD_LAUNCHER_STILL,oi.HUD_LAUNCHER_STILL,oi.HUD_LAUNCHER_STILL,oi.HUD_LAUNCHER_FIRE,oi.HUD_LAUNCHER_FIRE,oi.HUD_LAUNCHER_COCKING,oi.HUD_HAND_GRIP,oi.HUD_LAUNCHER_COCKING,!1,!1,!1,!1,!1,!1,wo.SEMIAUTO,!1,po,zo,Ao,vo,1.125,.5,.625,Is,Is,5,5,8,0,"rocket",1,1,.75,.75,1/0,1/0,1,1,.25,.25,0,0,0,0,!1,.125,0,.375,.5,.1,.5,.5,.25,.025,2.5,.05,"rocket",1,1,!0,!1,"./asset/sound/weapon/launcher-fire.mp3",null,!0,!1,!1,!0,!0,!0,!1,!1,xo,xo),clusterbow:new rs(oi.ITEM_WEAPON_CLUSTERBOW,oi.HUD_CLUSTERBOW_STILL,oi.HUD_CLUSTERBOW_STILL,oi.HUD_CLUSTERBOW_STILL,oi.HUD_CLUSTERBOW_STILL,oi.HUD_CLUSTERBOW_STILL,oi.HUD_CLUSTERBOW_STILL,oi.NONE,oi.HUD_HAND_JUMP,oi.HUD_CLUSTERBOW_STILL,oi.HUD_CLUSTERBOW_STILL,oi.HUD_CLUSTERBOW_STILL,oi.HUD_CLUSTERBOW_FIRE,oi.HUD_CLUSTERBOW_FIRE,oi.HUD_CLUSTERBOW_FIRE,oi.HUD_HAND_GRIP,oi.HUD_CLUSTERBOW_FIRE,!0,!1,!0,!1,!1,!1,wo.CHARGE,!1,co,No,Po,bo,0,1,1,Fs,Fs,0,0,0,1,"rocket",1,3,.25,.25,1/0,1/0,1,1,.025,.025,0,0,Math.PI/2*.0575,Math.PI/2*.025,!0,.125,0,.375,.5,.1,.5,.5,.25,.05,2.5,.05,"rocket",1,3,!0,!1,"./asset/sound/weapon/clusterbow-fire.wav",null,!0,!1,!1,!0,!0,!0,!1,!1,xo,xo),plasmagun:new rs(oi.ITEM_WEAPON_PLASMAGUN,oi.HUD_PLASMAGUN_STILL,oi.HUD_PLASMAGUN_STILL,oi.HUD_PLASMAGUN_STILL,oi.HUD_PLASMAGUN_STILL,oi.HUD_PLASMAGUN_STILL,oi.HUD_PLASMAGUN_STILL,oi.NONE,oi.HUD_HAND_JUMP,oi.HUD_PLASMAGUN_STILL,oi.HUD_PLASMAGUN_STILL,oi.HUD_PLASMAGUN_STILL,oi.HUD_PLASMAGUN_FIRE,oi.HUD_PLASMAGUN_FIRE,oi.HUD_PLASMAGUN_COCKING,oi.HUD_HAND_GRIP,oi.HUD_PLASMAGUN_STILL,!1,!1,!0,!1,!1,!1,wo.AUTO,!1,ro,No,Po,vo,1.125,.1,.1,Ns,Ns,10,10,4,0,"plasma",1,1,.5,.5,1/0,1/0,1,1,.5,.5,0,0,0,0,!1,0,0,.375,.5,.375,.5,.5,.25,.0325,2.5,.065,"cell",1,1,!0,!1,"./asset/sound/weapon/plasmagun-fire.mp3",null,!0,!1,!1,!0,!0,!0,!1,!1,xo,xo),plasmasmg:new rs(oi.ITEM_WEAPON_PLASMASMG,oi.HUD_PLASMASMG_STILL,oi.HUD_PLASMASMG_STILL,oi.HUD_PLASMASMG_STILL,oi.HUD_PLASMASMG_STILL,oi.HUD_PLASMASMG_STILL,oi.HUD_PLASMASMG_STILL,oi.NONE,oi.HUD_HAND_JUMP,oi.HUD_PLASMASMG_STILL,oi.HUD_PLASMASMG_STILL,oi.HUD_PLASMASMG_STILL,oi.HUD_PLASMASMG_FIRE,oi.HUD_PLASMASMG_FIRE,oi.HUD_PLASMASMG_COCKING,oi.HUD_HAND_GRIP,oi.HUD_PLASMASMG_COCKING,!0,!1,!0,!1,!1,!1,wo.AUTO,!1,ro,Wo,Io,bo,1.125,.075,.075,Us,Us,5,5,1,0,"plasma",4,4,1.25,1.25,1/0,1/0,0,0,.0625,.0625,Math.PI/2*.045,Math.PI/2*.02,Math.PI/2*.045,Math.PI/2*.02,!0,.0625,.0375,.375,.5,.375,.5,.5,.25,.0325,2.5,.065,"cell",1,1,!0,!1,"./asset/sound/weapon/plasmasmg-fire.mp3",null,!0,!1,!1,!0,!0,!0,!1,!1,xo,xo)};class Fo{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"hand",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"hand";this.enable=!0,this.time=0,this.isCanShoot=!1,this.isBlock=!1,this.isAction=!1,this.isLeftChange=!0,this.isRightChange=!0,this.leftChangeTime=0,this.rightChangeTime=0,this.leftBob=!0,this.rightBob=!0,this.toggleFireRight=!1,this.toggleFireLeft=!1,this.isFireRight=!1,this.isFireLeft=!1,this.isFireRightWait=!1,this.isFireLeftWait=!1,this.swapWait=!1,this.changeWait=-1,this.isPrevSet=!1,this.oldWeapon={left:"hand",right:"hand"},this.prevWeapon={left:"hand",right:"hand"},this.standPrevWeapon={left:"hand",right:"hand"},this.left=e,this.right=t,this.leftOld="hand",this.rightOld="hand",this.leftWeapon=Ho.none.create(),this.rightWeapon=Ho.none.create()}}class Uo{constructor(e,t,n,i){this.oldCount=0,this.start=e,this.max=t,this.timeLow=n,this.timeHigh=i}}class Bo{}class Yo{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.25;this.init=!1,this.initTime=-1,this.position=new C(0,0,0),this.speed=e}}class Go extends Bi{constructor(){super(Bo,Ei,wi)}offset(e,t,n){const i=t.getComponent(Ei).value;if(null===i)return;const{position:s,direction:o}=t,a=t.getComponent(wi).position,r=t.getComponent(Yo);r.init||(r.position.x=a.x,r.position.y=a.y,r.position.z=a.z,r.init=!0,r.initTime=performance.now()),a.x=j(a.x,r.position.x,r.speed*e),a.y=j(a.y,r.position.y,r.speed*e),a.z=j(a.z,r.position.z,r.speed*e);const[l,h]=O(i.direction.x,a.x,a.z);s.x=i.position.x+l,s.y=i.position.y+a.y,s.z=i.position.z+h,o.x=i.direction.x,o.y=i.direction.y,o.z=i.direction.z}}class Vo extends Bi{constructor(){super(cs,ds)}findPoints(e,t,n,i,s,o,a){for(let r=0,l=0|a.length;r<l;r=r+1|0){const[l,h,p]=a[r];let c=!1;if(o.getVoxel(l,h,p)!==li&&(c=xe(l,h,p,e,t,n,i,s)),c)return[l,h,p]}return[-1,-1,-1]}fixYTop(e,t,n){const{position:i}=e,s=e.getComponent(cs);let o=i.y+s.size.y;const[,a]=this.findPoints(i.x,i.y,i.z,s.size.x,s.size.y,t,n);return-1!==a?(o=Math.min(o,a),[0,o-s.size.y-i.y,0]):[0,0,0]}fixYBottom(e,t,n){const{position:i}=e,s=e.getComponent(cs);let o=i.y;const[,a]=this.findPoints(i.x,i.y,i.z,s.size.x,s.size.y,t,n);return-1!==a?(o=Math.max(o,a+1),[0,o-i.y,0]):[0,0,0]}collisionMap(e,t,n,i,s){const{position:o}=e,a=e.getComponent(cs),r=We(o.x,o.y,o.z,a.size.x,a.size.y,new Array);let l=0,h=0,p=0;const c=new Array;for(let e=0,t=0|r.length;e<t;e=e+3|0)c.push([r[e+0],r[e+1],r[e+2]]);o.y>i?ue(c).desc((e=>e[1])):o.y<i&&ue(c).asc((e=>e[1]));let d=!1,u=!1,m=n,g=i,f=s;for(let n=0,i=0|c.length;n<i;n=n+1|0){const[i,s,r]=c[n];if(t.getVoxel(i,s,r)!==li){let n=0,c=0,y=0,w=!1;const x=We(m,o.y,f,a.size.x,a.size.y,new Array),M=new Array;for(let e=0,t=0|x.length;e<t;e=e+3|0)M.push([x[e+0],x[e+1],x[e+2]]);o.y>g?ue(M).desc((e=>e[1])):o.y<g&&ue(M).asc((e=>e[1]));const[E,C,v]=this.findPoints(o.x,o.y,o.z,a.size.x,a.size.y,t,M);if(-1!==C)switch(!0){case t.getVoxel(E,C+1,v)===li&&o.y<g&&(0|o.y)<(g+.001|0)&&C===Math.floor(o.y):[,c]=this.fixYBottom(e,t,M),u=!0;break;case t.getVoxel(E,C-1,v)===li&&o.y>g&&(o.y+a.size.y|0)>(g-.001+a.size.y|0)&&C===Math.floor(o.y+a.size.y):[,c]=this.fixYTop(e,t,M),d=!0}if(h+=c,o.y+=c,[n,,y,w]=we(i,s,r,o.x,o.y,o.z,1.01*a.size.x,a.size.y,((e,n,i)=>t.getVoxel(e,n,i)!==li)),l+=n,o.x+=n,p+=y,o.z+=y,0!==n&&(m=o.x),0!==c&&(g=o.y),0!==y&&(f=o.z),!w){if(0!==n){const e=a.size.x/2*(n>0?-1:1),t=o.x+e;o.x=(t%1>.5?Math.ceil(t):Math.floor(t))-e}if(0!==y){const e=a.size.x/2*(y>0?-1:1),t=o.z+e;o.z=(t%1>.5?Math.ceil(t):Math.floor(t))-e}}if(0!==c){const e=d?a.size.y:0,t=o.y+e;o.y=(u?Math.ceil(t):Math.floor(t))-e}}}return 0!==l&&(a.hit.x=l<0?1:-1),0!==h&&(a.hit.y=h<0?1:-1),0!==p&&(a.hit.z=p<0?1:-1),0!==l||0!==h||0!==p}additional(e,t,n){const{position:i}=t,s=t.getComponent(cs),o=t.hasComponent(ds)?t.getComponent(ds).value:new C(0,0,0);s.hit.x>0?o.x=Math.min(0,o.x):s.hit.x<0&&(o.x=Math.max(0,o.x)),s.hit.y>0?o.y=Math.min(0,o.y):s.hit.y<0&&(o.y=Math.max(0,o.y)),s.hit.z>0?o.z=Math.min(0,o.z):s.hit.z<0&&(o.z=Math.max(0,o.z)),s.old.x=-1===s.old.x?i.x:s.old.x,s.old.y=-1===s.old.y?i.y:s.old.y,s.old.z=-1===s.old.z?i.z:s.old.z}physical(e,t,n){const{position:i}=t,o=t.getComponent(cs),a=-1===o.old.x?i.x:o.old.x,r=-1===o.old.y?i.y:o.old.y,l=-1===o.old.z?i.z:o.old.z,h=i.x,p=i.y,c=i.z,[d,u,m]=b(i.x,i.y,i.z,a,r,l);if(o.enable&&(!o.init||0!==d||0!==u||0!==m)){const e=P(d,u,m,0,0,0),[g,f]=N(d,u,m,0,0,0),y=Math.min(e,o.size.x/4,o.size.y/4,.5),[w,x,M]=A(g,f,0,0,1);let E=y,C=a,v=r,b=l;for(;i.x=0!==o.hit.x?i.x:a+E*w,i.y=0!==o.hit.y?i.y:r+E*x,i.z=0!==o.hit.z?i.z:l+E*M,this.collisionMap(t,n,C,v,b),!(E>=e);)E=Math.min(e,s(E+y,e,1e5,Math.ceil)),C=i.x,v=i.y,b=i.z;0===o.hit.x&&(i.x=h),0===o.hit.y&&(i.y=p),0===o.hit.z&&(i.z=c)}0!==o.hit.x||0!==o.hit.z?o.hit.angle.x=W(o.hit.x,o.hit.z,0,0):o.hit.angle.x=-1,0!==o.hit.y?o.hit.angle.y=o.hit.y*Math.PI/2:o.hit.angle.y=-1}offset(e,t,n){const{position:i}=t,s=t.getComponent(cs),o=t.hasComponent(ds)?t.getComponent(ds).value:new C(0,0,0),a=-1===s.old.x?i.x:s.old.x,r=-1===s.old.y?i.y:s.old.y,l=-1===s.old.z?i.z:s.old.z,h=i.x-a,p=i.y-r,c=i.z-l;0!==s.hit.x&&(s.hit.x<0?h>0||!n.hasBlockScaleVoxel(i.x-.001,i.y+.001,i.z,s.size.x,s.size.y-.002):h<0||!n.hasBlockScaleVoxel(i.x+.001,i.y+.001,i.z,s.size.x,s.size.y-.002))&&(s.hit.x=0),0!==s.hit.y&&(s.hit.y<0?p>0||!n.hasBlockScaleVoxel(i.x,i.y-.001,i.z,s.size.x-.001,.001):p<0||!n.hasBlockScaleVoxel(i.x,i.y+s.size.y+.001,i.z,s.size.x-.001,.001))&&(s.hit.y=0),0!==s.hit.z&&(s.hit.z<0?c>0||!n.hasBlockScaleVoxel(i.x,i.y+.001,i.z-.001,s.size.x,s.size.y-.002):c<0||!n.hasBlockScaleVoxel(i.x,i.y+.001,i.z+.001,s.size.x,s.size.y-.002))&&(s.hit.z=0);const d=t.hasComponent(Hs)?t.getComponent(Hs).flex:0,u=o.x,m=o.y,g=o.z;0!==s.hit.x&&(o.x=Math.floor(-u*d*100)/100),0!==s.hit.y&&(o.y=Math.floor(-m*d*100)/100),0!==s.hit.z&&(o.z=Math.floor(-g*d*100)/100),s.enable?(s.old.x=i.x,s.old.y=i.y,s.old.z=i.z,s.init=!0):(s.hit.x=0,s.hit.y=0,s.hit.z=0,s.old.x=-1,s.old.y=-1,s.old.z=-1,s.init=!1),t.getNames().includes("player")&&fn("hit","".concat(s.hit.x,",").concat(s.hit.y,",").concat(s.hit.z))}}class Xo extends Bi{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(Hs,ds),this.value=e}additional(e,t,n){const i=t.getComponent(Hs);if(i.isFall||!i.init){const n=t.getComponent(ds);n.value.y=Math.max(i.max*i.value,n.value.y-i.gravity*i.value*this.value*e*i.fall)}t.hasComponent(cs)&&!t.getComponent(cs).enable&&(i.init=!1)}offset(e,t,n){const i=t.getComponent(Hs),s=!!t.hasComponent(ds)&&t.getComponent(ds).value.y<=0&&!!t.hasComponent(cs)&&t.getComponent(cs).hit.y<0;i.isFall&&s?i.isFall=!1:i.isFall||s||(i.isFall=!0),i.init=!0}}class jo{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.move=new C(0,0,0),this.look=new E(0,0),this.force=1,this.limit=!0,this.speed=e}}class Ko extends Bi{constructor(){super(jo,ds)}additional(e,t,n){const i=t.getComponent(jo),o=t.getComponent(ds);let[a,r,l]=A(i.look.x,i.look.y,i.move.x*i.speed*i.force,i.move.y*i.speed*i.force,i.move.z*i.speed*i.force);a=s(a,0,1e4),r=s(r,0,1e4),l=s(l,0,1e4),i.limit?(a>0?o.value.x=o.value.x<=a?Math.min(a,o.value.x+a):o.value.x:a<0&&(o.value.x=o.value.x>=a?Math.max(a,o.value.x+a):o.value.x),r>0?o.value.y=o.value.y<=r?Math.min(r,o.value.y+r):o.value.y:r<0&&(o.value.y=o.value.y>=r?Math.max(r,o.value.y+r):o.value.y),l>0?o.value.z=o.value.z<=l?Math.min(l,o.value.z+l):o.value.z:l<0&&(o.value.z=o.value.z>=l?Math.max(l,o.value.z+l):o.value.z)):(a>0?o.value.x=o.value.x<=a?a:o.value.x:a<0&&(o.value.x=o.value.x>=a?a:o.value.x),r>0?o.value.y=o.value.y<=r?r:o.value.y:r<0&&(o.value.y=o.value.y>=r?r:o.value.y),l>0?o.value.z=o.value.z<=l?l:o.value.z:l<0&&(o.value.z=o.value.z>=l?l:o.value.z))}}class Jo extends Bi{constructor(){super(ds)}movable(e,t,n){const{position:i}=t,o=t.getComponent(ds),a=t.hasComponent(Hs)?t.getComponent(Hs).value:1;i.x+=s(0===a?o.value.x*e:o.value.x*e/a,0),i.y+=s(0===a?o.value.y*e:o.value.y*e/a,0),i.z+=s(0===a?o.value.z*e:o.value.z*e/a,0)}physical(e,t,n){const i=t.getComponent(ds),[s,o]=N(i.value.x,i.value.y,i.value.z,0,0,0);let a=1;((()=>{if(!t.hasComponent(cs))return!0;const e=t.getComponent(cs);return 0===e.hit.x&&0===e.hit.y&&0===e.hit.z})()||i.forceAir)&&(a=i.airDrift);const[r,l,h]=A(s,o,0,0,a*e),p=r*i.drift.x,c=l*i.drift.y,d=h*i.drift.z;0!==i.value.x&&(i.value.x>0?(i.value.x-=p,i.value.x<0&&(i.value.x=0)):(i.value.x+=-p,i.value.x>0&&(i.value.x=0))),0!==i.value.y&&(i.value.y>0?(i.value.y-=c,i.value.y<0&&(i.value.y=0)):(i.value.y+=-c,i.value.y>0&&(i.value.y=0))),0!==i.value.z&&(i.value.z>0?(i.value.z-=d,i.value.z<0&&(i.value.z=0)):(i.value.z+=-d,i.value.z>0&&(i.value.z=0)))}}class qo{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.25;this.init=!1,this.initTime=-1,this.position=new C(0,0,0),this.scale=0,this.rotate=0,this.isRotateCenter=!1,this.speed=e}}class Zo extends Bi{constructor(){super(bn,qo)}offset(e,t,n){const i=t.getComponent(bn),s=t.getComponent(qo);if(s.init||(s.position.x=i.position.x,s.position.y=i.position.y,s.position.z=i.position.z,s.scale=i.scale,s.rotate=i.rotate,s.init=!0,s.initTime=performance.now()),i.position.x=j(i.position.x,s.position.x,s.speed*e),i.position.y=j(i.position.y,s.position.y,s.speed*e),i.position.z=j(i.position.z,s.position.z,s.speed*e),i.scale=j(i.scale,s.scale,s.speed*e),s.isRotateCenter){const t=W(-i.position.y,i.position.x,0,0);i.rotate=j(i.rotate,t+s.rotate,s.speed*e)}else i.rotate=j(i.rotate,s.rotate,s.speed*e)}}class Qo{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.enable=!1,this.exec=!1,this.oldExec=!1,this.can=!1,this.angle=-1,this.time=-1,this.isAxes=!1,this.wallrun=!1,this.force=new E(e,t)}}class $o{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.enable=!0,this.exec=!1,this.start={position:new C(0,0,0),wallAngle4:-1,wallAngle8:-1,direction:0,hit:!1},this.through=!1,this.value=0,this.lock=!1,this.side=0,this.direction=0,this.speed=0,this.proplusion=0,this.par=0,this.time=0,this.force=new C(0,0,0),this.oldPosition=new C(-1,-1,-1),this.walkSpeed=e,this.walkTime=t}}class ea{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],a=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];this.time=0,this.initTime=-1,this.old={position:new C(-1,-1,-1),fov:-1,rotate:-1},this.move={position:new C(0,0,0),fov:0,rotate:0},this.swais=new Array,this.oldTime=0,this.x=e,this.y=t,this.rotate=n,this.slide=i,this.speed=s,this.moveFix=o,this.hard=a}}class ta{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.enableCluch=!1,this.value=0,this.block=!1,this.oldFeet=0,this.standSizeY=e,this.cluchSizeY=t,this.stretchSpeed=n}}class na{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;this.enable=!1,this.exec=!1,this.value=0,this.dir=0,this.nowSpeed=0,this.par=0,this.slideTime=-1,this.oldPosition=new C(-1,-1,-1),this.time=e,this.push=t,this.speed=n;for(var i=arguments.length,s=new Array(i>3?i-3:0),o=3;o<i;o++)s[o-3]=arguments[o];this.targetNames=s}}class ia{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;this.enableSprint=!1,this.enableTacticalSprint=!1,this.pressSprint=-1,this.startTacticalSprintTime=-1,this.tacticalSprintPar=1,this.isSprint=!1,this.isTacticalSprint=!1,this.value=0,this.walkSpeed=e,this.cluchSpeed=t,this.sprintSpeed=n,this.tacticalSprintSpeed=i,this.tacticalSprintTime=s}}class sa{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.enable=!1,this.dir=0,this.sizeY=e,this.stretchSpeed=t}}class oa{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.value=0,this.standValue=0,this.cluchValue=0,this.cameraValue=0,this.leanValue=0,this.length=e}}class aa{constructor(){this.oldPosition=new C(-1,-1,-1),this.diffPosition=new C(-1,-1,-1),this.moveValue=new C(0,0,0),this.value=new E(0,0),this.movePar=0,this.isGround=!1,this.isHitStand=!1,this.isHitCluch=!1,this.startDir=-1,this.exec=!1}}class ra{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;this.time=0,this.tick=e,this.par=t,this.scale=n,this.reduce=i,this.fov=s}}class la{constructor(){this.exec=!1,this.hasDoorMessage=!1}}function ha(e){let t=0;if(e.hasComponent(Uo)){const n=e.getComponent(Uo);t=Math.max(0,Math.min(1,(es(e,"combo",0)-n.start)/(n.max-n.start)))}return t}class pa extends Bi{constructor(){super(Uo,Gi,is)}offset(e,t,n){const i=t.getComponent(Uo),o=t.getComponent(Gi),a=t.getComponent(is);if(!a.value.hasOwnProperty("combo")||!a.value.hasOwnProperty("gage"))return;const r=es(t,"combo");if(i.start<=r&&i.oldCount!==r&&i.oldCount<r&&n.createSound("./asset/sound/combo/up.mp3",null,"combo").play(),i.oldCount!==r&&i.oldCount<i.start&&r>=i.start&&Qi(t,"gage",ns(t,"gage")),"air"!==o.state&&null===o.activeEntity&&-1===o.respawnTime&&-1===o.deathTime&&-1===o.goleTime&&-1===o.intermissionTime&&r>=i.start&&es(t,"gage")>0){Qi(t,"gage",Math.max(0,es(t,"gage")-s(e/(60*(i.timeLow-(i.timeLow-i.timeHigh)*Math.min(1,(es(t,"combo")-i.start)/(i.max-i.start)))),0)));const o=es(t,"gage"),a=es(t,"combo");o<=0&&(a>0&&(a>1&&Qi(t,"gage",ns(t,"gage")),n.createSound("./asset/sound/combo/down.mp3",null,"combo").play()),Qi(t,"combo",Math.max(0,es(t,"combo")-1)))}i.oldCount=r}}const ca=new nn("local-storage"),da={};g()?ca.addEventListener("message",(e=>{const{data:t}=e;if(t instanceof Object&&"save"===t.method){const e=da[t.name]||{};for(const t in e)delete e[t];for(const n in t.data)e[n]=t.data[n];da[t.name]=e}})):ca.addEventListener("message",(e=>{const{data:t}=e;if(t instanceof Object)switch(t.method){case"load":ga(t.name).then((e=>{ca.postMessage({method:"load",name:t.name,data:e,key:t.key})}));break;case"save":ga(t.name).then((e=>{for(const n in t.data)e[n]=t.data[n];fa(t.name).then((e=>{ca.postMessage({method:"save",name:t.name,data:t.data,key:t.key})}))}));break;case"delete":ya(t.name).then((()=>{ca.postMessage({method:"delete",name:t.name,key:t.key})}))}}));const ua=function(e,t){switch(!0){case void 0===t:case null===t:return{__extendData__:!0,type:"null",value:""};case Number.isNaN(t):return{__extendData__:!0,type:"number",value:"NaN"};case Number.POSITIVE_INFINITY===t:return{__extendData__:!0,type:"number",value:"Infinity"};case Number.NEGATIVE_INFINITY===t:return{__extendData__:!0,type:"number",value:"-Infinity"};case t instanceof Date:return{__extendData__:!0,type:"date",value:t.toISOString()};case"symbol"==typeof t:return{__extendData__:!0,type:"symbol",value:Symbol.keyFor(t)}}return t},ma=function(e,t){if("object"!=typeof t||!t.__extendData__)return t;switch(t.type){case"undefined":return;case"null":return null;case"number":switch(t.value){case"NaN":return Number.NaN;case"Infinity":case"+Infinity":return Number.POSITIVE_INFINITY;case"-Infinity":return Number.NEGATIVE_INFINITY}case"date":return new Date(t.value);case"symbol":return Symbol.for(t.value)}};async function ga(e){let t={};if(g()){if(da.hasOwnProperty(e))return da[e];let n=Ve();t=await new Promise((t=>{const i=e=>{const{data:s}=e;if(s instanceof Object&&s.key===n&&"load"===s.method)ca.removeEventListener("message",i),da[s.name]=s.data,n=null,t(s.data)};ca.addEventListener("message",i),ca.postMessage({method:"load",name:e,key:n})}))}else if(da.hasOwnProperty(e))t=da[e];else{const n=localStorage.getItem(e);if(n&&n.length>0)try{t=JSON.parse(n,ma)}catch(n){localStorage.removeItem(e),t={}}da[e]=t}return t}async function fa(e){if(g()){if(!da.hasOwnProperty(e))return;let t=Ve();await new Promise((n=>{const i=e=>{const{data:s}=e;if(s instanceof Object&&s.key===t&&"save"===s.method)ca.removeEventListener("message",i),t=null,n(null)};ca.addEventListener("message",i),ca.postMessage({method:"save",name:e,data:da[e],key:t})}))}else if(da.hasOwnProperty(e))try{localStorage.setItem(e,JSON.stringify(da[e],ua))}catch(e){}}async function ya(e){if(g()){if(!da.hasOwnProperty(e))return;let t=Ve();return delete da[e],await new Promise((n=>{ca.addEventListener("message",(function e(i){const{data:s}=i;if(s instanceof Object&&s.key===t&&"delete"===s.method)ca.removeEventListener("message",e),da[s.name]=s.data,t=null,n(s.data)})),ca.postMessage({method:"delete",name:e,key:t})}))}{const t=await ga(e);for(const e in t)delete t[e];await fa(e)}}class wa{constructor(e,t,n,i,s,o,a,r,l,h,p){this.time=0,this.init=!1,this.sub=0,this.length=0,this.ropeLength=0,this.lookPar=0,this.oldDist=-1,this.rigid=!1,this.old=new C(-1,-1,-1),this.oldDee=new C(-1,-1,-1),this.theta=new E(0,0),this.omega=new E(0,0),this.alpha=new E(0,0),this.pullForce=new C(0,0,0),this.fixPosition=new C(0,0,0),this.isPull=!1,this.minDistance=e,this.spring=new C(t,n,i),this.ropeForce=new C(s,o,a),this.bending=r,this.pullTime=l,this.minShrinkForce=h,this.maxShrinkForce=p}}let xa=!1,Ma=!1,Ea=!1,Ca=!1;const va=new nn("fullscreen"),ba=new Array;function _a(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return g()?ba.length>0?Ca:f()?Ma:e?Ea||xa:Ea:f()?Ma:null!==document.fullscreenElement||!!e&&Sa()}function Sa(){return g()?xa:window.innerHeight>=window.outerHeight||window.innerHeight>=window.outerWidth}function ka(){const e=async t=>{if(g()){const e=Ve(),n=i=>{const{data:s}=i;if(s instanceof Object&&s.key===e&&"success"===s.method)ba.includes(s.key)&&ba.splice(ba.indexOf(s.key),1),va.removeEventListener("message",n),t(null)};Ca=!0,ba.push(e),va.addEventListener("message",n),va.postMessage({method:"exec",value:!0,key:e})}else if(f())Ma||("api"in self&&self.api.fullscreen(!0),Ma=!0,window.dispatchEvent(new UIEvent("resize")),va.postMessage({method:"electron",value:Ma})),t(null);else if(_a(!f()))t(null);else if(null!==document.body){function e(){va.postMessage({method:"browser",value:_a()}),t(null)}document.body.requestFullscreen().then(e).catch(e)}else window.addEventListener("load",(()=>e(t)))};return new Promise(e)}async function Ta(){g()?await new Promise((e=>{const t=Ve(),n=i=>{const{data:s}=i;if(s instanceof Object&&s.key===t&&"success"===s.method)ba.includes(s.key)&&ba.splice(ba.indexOf(s.key),1),va.removeEventListener("message",n),e(null)};Ca=!1,ba.push(t),va.addEventListener("message",n),va.postMessage({method:"exec",value:!1,key:t})})):_a(!f())&&(f()?Ma&&("api"in self&&self.api.fullscreen(!1),Ma=!1,window.dispatchEvent(new UIEvent("resize")),va.postMessage({method:"electron",value:Ma})):_a(!1)&&await document.exitFullscreen())}g()?va.addEventListener("message",(e=>{const{data:t}=e;if(t instanceof Object)switch(t.method){case"browser":Ea=t.value;break;case"hack":xa=t.value;break;case"electron":Ma=t.value;break;case"success":ba.includes(t.key)&&ba.splice(ba.indexOf(t.key),1)}})):(va.addEventListener("message",(async e=>{const{data:t}=e;if(t instanceof Object){if("exec"===t.method)await(t.value?ka():Ta());va.postMessage({method:"success",key:t.key})}})),document.addEventListener("fullscreenchange",(e=>{Ea=!!document.fullscreenElement,va.postMessage({method:"browser",value:Ea})})));const Pa=new nn("pointer-lock");let Ia=!1,La=!1,Oa=null,Aa=null;const Wa=new Array;function Na(){return g()?Wa.length>0?La:Ia:null!==document.pointerLockElement}async function za(){return await new Promise(((e,t)=>{if(g()){const t=Ve(),n=i=>{const{data:s}=i;if(s instanceof Object&&s.key===t&&"success"===s.method)Wa.includes(s.key)&&Wa.splice(Wa.indexOf(s.key),1),Pa.removeEventListener("message",n),e()};La=!0,Pa.addEventListener("message",n),Pa.postMessage({method:"exec",value:!0,key:t})}else if(Na())e();else{const n=()=>{document.removeEventListener("pointerlockchange",i),document.removeEventListener("pointerlockerror",s)},i=()=>{n(),e()},s=e=>{n(),t()};document.addEventListener("pointerlockchange",i,!1),document.addEventListener("pointerlockerror",s,!1),null!==document.body?null!==Oa&&Oa.requestPointerLock():window.addEventListener("load",(()=>za().then(e).catch(t)))}}))}async function Da(){Aa=performance.now(),g()?await new Promise(((e,t)=>{const n=Ve(),i=t=>{const{data:s}=t;if(s instanceof Object&&s.key===n&&"success"===s.method)Wa.includes(s.key)&&Wa.splice(Wa.indexOf(s.key),1),Pa.removeEventListener("message",i),e(null)};La=!1,Wa.push(n),Pa.addEventListener("message",i),Pa.postMessage({method:"exec",value:!1,key:n})})):Na()&&document.exitPointerLock()}g()?Pa.addEventListener("message",(e=>{const{data:t}=e;if(t instanceof Object&&"exec"===t.method)Ia=t.value})):(Pa.addEventListener("message",(async e=>{const{data:t}=e;if(t instanceof Object){if("exec"===t.method)await(t.value?za():Da());Pa.postMessage({method:"success",key:t.key})}})),document.addEventListener("pointerlockchange",(()=>{Pa.postMessage({method:"exec",value:null!==document.pointerLockElement})})),document.addEventListener("pointerlockerror",(()=>{Pa.postMessage({method:"exec",value:!1})})));class Ra{constructor(e,t,n,i,s,o,a,r,l,h,p,c,d,u,m,g,f){let y=arguments.length>17&&void 0!==arguments[17]&&arguments[17],w=arguments.length>18&&void 0!==arguments[18]&&arguments[18],x=arguments.length>19&&void 0!==arguments[19]?arguments[19]:new Array,M=arguments.length>20&&void 0!==arguments[20]?arguments[20]:new Array,v=arguments.length>21&&void 0!==arguments[21]?arguments[21]:new Array,b=arguments.length>22&&void 0!==arguments[22]?arguments[22]:new Array;this.time=0,this.see=!1,this.findTime=0,this.hide=!1,this.aimStartTime=-1,this.painStartTime=-1,this.blowStartTime=-1,this.isBlow=!1,this.isDown=!1,this.blowTime=-1,this.isAir=!1,this.isSee=!1,this.nextFindTime=0,this.angleRight=new E(0,0),this.angleLeft=new E(0,0),this.path=null,this.stillMaterial=e,this.otherMaterials=t,this.seePosition=new C(n,i,s),this.angleForce=o,this.attackRadius=a,this.attackRangeMin=r,this.attackRangeMax=l,this.aimTime=h,this.isAimWait=p,this.painTime=c,this.blowTime=d,this.findInterval=u,this.findIntervalRandom=m,this.stillHeight=g,this.blowHeight=f,this.air=y,this.blow=w,this.findVoices=x,this.painVoices=M,this.deathVoices=v,this.filters=b}}class Ha extends Bi{constructor(e,t,n){super(Gi,Fo,cs,ds,ta,oa,sa,ia),this.keys={},this.presss={},this.toggles={},this.releases={},this.updateButtons={},this.keyWalk=new E(0,0),this.walk=new E(0,0),this.look=new E(0,0),this.oldWalk=new E(0,0),this.oldLook=new E(0,0),this.lookInputType=null,this.isUpdateWalkToKeyboard=!0,this.isAxesUpdateWalkX=!1,this.isAxesUpdateWalkY=!1,this.isAxesUpdateLookX=!1,this.isAxesUpdateLookY=!1,this.isResetLookX=!1,this.isResetLookY=!1,this.isResetWalkX=!1,this.isResetWalkY=!1,this.lockLockTime=0,this.activeSceneName="none",this.setting=e,this.scenes=t,this.controls=n,n.initKeyConfig({escape:["keyboard_escape","touchpad_start","gamepad_start"],pause:["gamepad_select"],forward:["keyboard_w","touchpad_up"],back:["keyboard_s","touchpad_down"],left:["keyboard_a","touchpad_left"],right:["keyboard_d","touchpad_right"],jump:["keyboard_space","touchpad_b","gamepad_a"],cluch:["keyboard_control","touchpad_a","gamepad_b"],sprint:["keyboard_shift","gamepad_ls","touchpad_cross_double"],use:["keyboard_f","gamepad_x","touchpad_a"],"lean-left":["keyboard_q"],"lean-right":["keyboard_e"],lean:["keyboard_alt","gamepad_lb"],"weapon-wheel":["keyboard_tab","gamepad_rb"],"weapon-wheel-right":["touchpad_r"],"weapon-wheel-left":["touchpad_l"],"fire-left":["mouse_left","gamepad_lt","touchpad_y"],"fire-right":["mouse_right","gamepad_rt","touchpad_x"],"next-weapon":["mouse_wheel_up"],"prev-weapon":["mouse_wheel_down"],"weapon-1":["keyboard_1"],"weapon-2":["keyboard_2"],"weapon-3":["keyboard_3"],"weapon-4":["keyboard_4"],"weapon-5":["keyboard_5"],"weapon-6":["keyboard_6"],"weapon-7":["keyboard_7"],"weapon-8":["keyboard_8"]}),fa("keyconfig"),n.axes(((e,i,s)=>{var o;if(!Rn()&&t.getActiveSceneName()===this.activeSceneName&&(null===(o=t.getScene(this.activeSceneName))||void 0===o?void 0:o.hasRun())){const t=performance.now();switch(e){case"z":this.keys.lean=0===i&&0===s?0:t,s*=-1;case"x":this.isAxesUpdateWalkX?(this.walk.x=Math.abs(this.walk.x)>Math.abs(i)?this.walk.x:-i,this.oldWalk.x=Math.abs(this.oldWalk.x)<Math.abs(i)?this.oldWalk.x:-i,this.isResetWalkX=0===i):0===i?(this.walk.x=0,this.oldWalk.x=0):(this.walk.x=-i,this.oldWalk.x=-i,this.isAxesUpdateWalkX=!0),this.isAxesUpdateWalkY?(this.walk.y=Math.abs(this.walk.y)>Math.abs(s)?this.walk.y:s,this.oldWalk.y=Math.abs(this.oldWalk.y)<Math.abs(s)?this.oldWalk.y:s,this.isResetWalkY=0===s):0===s?(this.walk.y=0,this.oldWalk.y=0):(this.walk.y=s,this.oldWalk.y=s,this.isAxesUpdateWalkY=!0);break;case"y":this.lookInputType=n.getInputType(),this.isAxesUpdateLookX?"gamepad"===this.lookInputType?(this.look.x=Math.abs(this.look.x)>Math.abs(i)?this.look.x:i,this.oldLook.x=Math.abs(this.oldLook.x)<Math.abs(i)?this.oldLook.x:i,this.isResetLookX=0===i):(this.look.x+=i,this.oldLook.x+=i,this.isResetLookX=!0):0===i?(this.look.x=0,this.oldLook.x=0):(this.look.x=i,this.oldLook.x=i,this.isAxesUpdateLookX=!0),this.isAxesUpdateLookY?"gamepad"===this.lookInputType?(this.look.y=Math.abs(this.look.y)>Math.abs(s)?this.look.y:s,this.oldLook.y=Math.abs(this.oldLook.y)<Math.abs(s)?this.oldLook.y:s,this.isResetLookY=0===s):(this.look.y+=s,this.oldLook.y+=s,this.isResetLookY=!0):0===s?(this.look.y=0,this.oldLook.y=0):(this.look.y=s,this.oldLook.y=s,this.isAxesUpdateLookY=!0)}}else this.walk.x=0,this.walk.y=0,this.look.x=0,this.look.y=0,this.oldWalk.x=0,this.oldWalk.y=0,this.oldLook.x=0,this.oldLook.y=0})),n.press(((e,n)=>{var i;const s=performance.now();if(!Rn()&&t.getActiveSceneName()===this.activeSceneName&&(null===(i=t.getScene(this.activeSceneName))||void 0===i?void 0:i.hasRun())){if(-1!==e.indexOf("gamepad_")||-1!==e.indexOf("touchpad_")||Na()){let i=!1;this.updateButtons[e]?this.releases[e]||n||(this.releases[e]=!0):(this.toggles[e]!==n&&(i=!0),this.enablePresss(e,n,i,t,s),this.toggles[e]=n,this.updateButtons[e]=!0)}}else{for(const e in this.keys)this.keys[e]=0;for(const e in this.presss)this.presss[e]=0;for(const e in this.releases)this.enablePresss(e,!1,!1,t,s),delete this.releases[e];for(const e in this.updateButtons)delete this.updateButtons[e]}}))}enablePresss(e,t,n,i,s){"keyboard_enter"!==e&&"touchpad_a"!==e&&"gamepad_a"!==e&&"mouse_left"!==e||(this.keys.next=t?s:0),"keyboard_enter"!==e&&"touchpad_a"!==e&&"gamepad_a"!==e&&"mouse_left"!==e||(this.keys.decision=t?s:0),"touchpad_b"!==e&&"gamepad_b"!==e&&"mouse_right"!==e||(this.keys.cancel=t?s:0);const o=this.controls;switch(!0){case o.hasKey("escape",e):this.keys.escape=t?s:0;break;case o.hasKey("pause",e):Xe()&&n&&t&&(this.keys.pause=t?s:0);break;case o.hasKey("forward",e):this.keyWalk.y=t?1:1===this.keyWalk.y?0:this.keyWalk.y,this.isUpdateWalkToKeyboard=!0;break;case o.hasKey("back",e):this.keyWalk.y=t?-1:-1===this.keyWalk.y?0:this.keyWalk.y,this.isUpdateWalkToKeyboard=!0;break;case o.hasKey("left",e):this.keyWalk.x=t?1:1===this.keyWalk.x?0:this.keyWalk.x,this.isUpdateWalkToKeyboard=!0;break;case o.hasKey("right",e):this.keyWalk.x=t?-1:-1===this.keyWalk.x?0:this.keyWalk.x,this.isUpdateWalkToKeyboard=!0;break;case o.hasKey("jump",e):this.keys.jump=t?s:0;break;case o.hasKey("cluch",e):this.setting.hasToggleCluch()?t&&n&&(this.keys.cluch=this.keys.cluch?0:s):this.keys.cluch=t?s:0,n&&t&&(this.keys.coil=this.keys.coil?0:s),this.keys.sliding=t?s:0,this.keys.sliding_cancel=t?s:0,this.keys.release=t?s:0;break;case o.hasKey("sprint",e):this.setting.hasToggleSprint()?t&&n&&(this.keys.sprint=this.keys.sprint?0:s):this.keys.sprint=t?s:0,"touchpad_cross_double"===e&&(this.keys.sprint_touch=t?s:0),this.keys.sliding_cancel=t?s:0,this.keys.pressTacticalSprint=t?s:0,this.keys.tacticalSprint=t?s:this.keys.tacticalSprint;break;case o.hasKey("use",e):this.keys.use=t?s:0;break;case o.hasKey("lean-left",e):this.keys["lean-left"]=t?s:0;break;case o.hasKey("lean-right",e):this.keys["lean-right"]=t?s:0;break;case o.hasKey("lean",e):this.keys.lean=t?s:0;break;case o.hasKey("weapon-wheel",e):this.keys["menu-right"]="keyboard"!==this.controls.getInputType()?s:0,this.keys["menu-left"]="keyboard"===this.controls.getInputType()?s:0,this.keys.menu=t?s:0;break;case o.hasKey("weapon-wheel-right",e):this.keys["menu-right"]=s,this.keys["menu-left"]=0,this.keys.menu=t?s:0;break;case o.hasKey("weapon-wheel-left",e):this.keys["menu-right"]=0,this.keys["menu-left"]=s,this.keys.menu=t?s:0;break;case o.hasKey("fire-left",e):this.keys["fire-left"]=t?s:0,this.keys.secondary=t?s:0;break;case o.hasKey("fire-right",e):this.keys["fire-right"]=t?s:0,this.keys.primary=t?s:0;break;case o.hasKey("next-weapon",e):this.keys["next-weapon"]=t?s:0;break;case o.hasKey("prev-weapon",e):this.keys["prev-weapon"]=t?s:0;break;case o.hasKey("weapon-1",e):this.keys["weapon-1"]=t?s:0;break;case o.hasKey("weapon-2",e):this.keys["weapon-2"]=t?s:0;break;case o.hasKey("weapon-3",e):this.keys["weapon-3"]=t?s:0;break;case o.hasKey("weapon-4",e):this.keys["weapon-4"]=t?s:0;break;case o.hasKey("weapon-5",e):this.keys["weapon-5"]=t?s:0;break;case o.hasKey("weapon-6",e):this.keys["weapon-6"]=t?s:0}}clearControls(){this.controls.clear();for(const e in this.keys)this.keys[e]=0;this.keyWalk.x=0,this.keyWalk.y=0,this.updateWalk()}updateWalk(){const e=Math.min(T(this.keyWalk.x,this.keyWalk.y,0,0),1),t=W(this.keyWalk.x,this.keyWalk.y,0,0),n=Math.cos(t)*e,i=Math.sin(t)*e;this.isAxesUpdateWalkX?(this.walk.x=Math.abs(this.walk.x)>Math.abs(n)?this.walk.x:-n,this.oldWalk.x=Math.abs(this.oldWalk.x)<Math.abs(n)?this.oldWalk.x:-n):0===n?(this.walk.x=0,this.oldWalk.x=0):(this.walk.x=n,this.oldWalk.x=n,this.isAxesUpdateWalkX=!0),this.isAxesUpdateWalkY?(this.walk.y=Math.abs(this.walk.y)>Math.abs(i)?this.walk.y:i,this.oldWalk.y=Math.abs(this.oldWalk.y)<Math.abs(i)?this.oldWalk.y:i):0===i?(this.walk.y=0,this.oldWalk.y=0):(this.walk.y=i,this.oldWalk.y=i,this.isAxesUpdateWalkX=!0)}fadeSound(e,t){const n=performance.now();let i=0;i=n-t>1e3?Math.min(1,(n-t-1e3)/500):0;const s=this.setting.getVolume();e.getSoundManager().setVolume(s-s*i)}createWeaponMenuExec(e){return(t,n,i,s)=>{if(!n.hasComponent(Fo))return;const o=n.getComponent(Fo);if(null!==$i(n,e,null)){const t=o.oldWeapon.left,n=o.oldWeapon.right;if("fire-right"!==s&&"fire-left"!==s)switch(!0){case this.keys["menu-right"]>0:"hand"===e?o.left=e:o.right=e,o.isFireRight=!1,o.toggleFireRight=!1;break;case this.keys["menu-left"]>0:"hand"===e?o.right=e:o.left=e,o.isFireLeft=!1,o.toggleFireLeft=!1}else"fire-right"===s&&(o.right=e),"fire-left"===s&&(o.left=e);o.left!==t||o.right!==n?o.isPrevSet||(o.standPrevWeapon.left=t,o.standPrevWeapon.right=n,o.isPrevSet=!0):(o.standPrevWeapon.left=o.right,o.standPrevWeapon.right=o.left,o.isPrevSet=!1)}}}additional(e,t,n){const i=performance.now(),{position:o,direction:a}=t,r=t.getComponent(Gi),l=t.getComponent(Fo),h=t.getComponent(ds),p=t.getComponent(ta),c=t.getComponent(oa),u=t.getComponent(sa),m=t.getComponent(ia),g=n.getCamera(),f=n.getControlManager();for(const e in this.keys)r.keys[e]=this.keys[e];for(const e in this.presss)r.presss[e]=this.presss[e];-1===r.startTime&&(r.startTime=i),this.keys.pause!==this.presss.pause&&(r.isPause=!r.isPause),this.activeSceneName=n.getName(),r.pickMessage=null,r.isZoomAnimation=!1,me(r.helpMessages);let y=!1;es(t,"combo")>=t.getComponent(Uo).start&&(y=!0);const w=l.rightWeapon.data.grip||l.leftWeapon.data.grip?(!!l.rightWeapon.data.grip||l.rightWeapon.isAmmo)&&(!!l.leftWeapon.data.grip||l.leftWeapon.isAmmo):l.rightWeapon.isAmmo||l.leftWeapon.isAmmo,x="hookshot"===$i(t,l.left,null)&&l.leftWeapon.bullets.length>0,M="hookshot"===$i(t,l.right,null)&&l.rightWeapon.bullets.length>0,E=(x||M)&&![...l.leftWeapon.bullets,...l.rightWeapon.bullets].some((e=>{if(e.hasLive()&&e.hasComponent(Gs)){const t=e.getComponent(Gs).bullet;if(null!==t)if(t.hasComponent(ps)&&t.getComponent(ps).hit){if(t.hasComponent(wa)&&t.getComponent(wa).isPull)return!0}else if(e.hasComponent(ps)&&e.getComponent(ps).hit)return!0}return!1})),C=(x||M)&&[...l.leftWeapon.bullets,...l.rightWeapon.bullets].some((e=>{if(e.hasLive()&&e.hasComponent(Gs)){const t=e.getComponent(Gs).bullet;return null!==t&&t.hasComponent(ps)&&t.getComponent(ps).hit&&t.hasComponent(wa)&&!1===t.getComponent(wa).isPull}return!1}));r.isHookShot=E,r.isHookAccel=C,r.isPick=!1;const v=r.time-r.hitWaitStartTime<r.hitWaitTime;if(-1!==r.respawnTime||-1!==r.deathTime||-1!==r.goleTime||n instanceof Gh&&n.hasHorde()&&!(r.hordeStartTime>5)||v){if(r.hordeStartTime+=e/60,t.hasComponent(jo)){const e=t.getComponent(jo);e.move.x=0,e.move.y=0,e.move.z=0,e.look.x=0,e.look.y=0}if(r.axes.x.x=0,r.axes.x.y=0,r.axes.y.x=0,r.axes.y.y=0,r.cmda.x=0,r.cmda.y=0,t.hasComponent(ss)&&(t.getComponent(ss).enable=!1),t.hasComponent($o)&&(t.getComponent($o).enable=!1),t.hasComponent(Hs)){t.getComponent(Hs).fall=1}if(t.hasComponent(Hs)){t.getComponent(Hs).isFall?h.forceAir=!0:h.forceAir=!1}}else{if(t.hasComponent(jo)){const e=t.getComponent(jo);if(h.airDrift=0,t.hasComponent(na)&&t.getComponent(na).exec)e.move.x=0,e.move.y=0,e.move.z=1,e.look.x=z(W(h.value.x,h.value.z,0,0)),e.look.y=0;else if(t.hasComponent($o)&&t.getComponent($o).exec){const n=t.getComponent($o);e.move.x=0,e.move.y=0,e.move.z=n.proplusion;const[i,s]=N(n.force.x,n.force.y,n.force.z,0,0,0);e.look.x=z(i),e.look.y=z(s),h.value.x=h.value.x>0?Math.min(n.force.x*n.proplusion*e.speed,h.value.x):Math.max(n.force.x*n.proplusion*e.speed,h.value.x),h.value.y=h.value.y>0?Math.min(n.force.y*n.proplusion*e.speed,h.value.y):Math.max(n.force.y*n.proplusion*e.speed,h.value.y),h.value.z=h.value.z>0?Math.min(n.force.z*n.proplusion*e.speed,h.value.z):Math.max(n.force.z*n.proplusion*e.speed,h.value.z)}else t.hasComponent(ss)&&t.getComponent(ss).exec||!C&&t.hasComponent(aa)&&t.getComponent(aa).exec||r.activeEntity||E?(e.move.x=0,e.move.y=0,e.move.z=0,e.look.x=t.direction.x,e.look.y=0):(e.move.x=this.walk.x,e.move.y=0,e.move.z=this.walk.y,e.look.x=t.direction.x,e.look.y=0)}if(t.hasComponent(ji)&&t.getComponent(ji).enable||null!==r.activeEntity)this.lockLockTime=performance.now();else if(t.hasComponent(ji)&&-1!==t.getComponent(ji).value&&performance.now()-this.lockLockTime<175)r.cmda.x=0,r.cmda.y=0,this.look.x=0,this.look.y=0;else{const t=this.setting.getSensibility();r.cmda.x=this.look.x*t/g.zoom*s("gamepad"===this.lookInputType?e/n.getSpeed():1,0)*(n instanceof Gh&&this.setting.hasInvertX()?-1:1),r.cmda.y=this.look.y*t/g.zoom*s("gamepad"===this.lookInputType?e/n.getSpeed():1,0)*(n instanceof Gh&&this.setting.hasInvertY()?-1:1)}if(t.hasComponent(Hs)){const e=t.getComponent(Hs);E||t.hasComponent(cs)&&t.getComponent(cs).hit.y<0||t.hasComponent(ss)&&t.getComponent(ss).exec||t.hasComponent($o)&&t.getComponent($o).exec||t.hasComponent(aa)&&t.getComponent(aa).isGround&&0!==t.getComponent(aa).value.x?e.fall=0:e.fall=1,e.isFall||E?h.forceAir=!0:h.forceAir=!1}r.axes.x.x=Math.min(1,Math.max(-1,this.walk.x)),r.axes.x.y=Math.min(1,Math.max(-1,this.walk.y)),r.axes.y.x=Math.min(1,Math.max(-1,this.look.x)),r.axes.y.y=Math.min(1,Math.max(-1,this.look.y)),t.hasComponent(ss)&&(t.getComponent(ss).enable=!0),t.hasComponent($o)&&(t.getComponent($o).enable=!0)}const b=W(r.axes.x.x,r.axes.x.y,0,0);if(l.toggleFireRight=!1,l.toggleFireLeft=!1,-1!==r.deathTime||-1!==r.goleTime||-1!==r.intermissionTime||v||null!==r.activeEntity)v||(l.isFireRight=!1,l.isFireLeft=!1),r.isSlowMo=!1,r.speed=1;else{if(t.hasComponent($o)){const e=t.getComponent($o);e.enable=!E}if(this.keys.menu||this.keys["weapon-1"]||this.keys["weapon-2"]||this.keys["weapon-3"]||this.keys["weapon-4"]||this.keys["weapon-5"]||this.keys["weapon-6"]||this.keys["weapon-7"]||this.keys["weapon-8"]||(this.keys["fire-right"]>0&&this.keys["fire-right"]!==this.presss["fire-right"]?(l.isFireRight=!0,l.toggleFireRight=!0):this.keys["fire-right"]||(l.isFireRight=!1),this.keys["fire-left"]>0&&this.keys["fire-left"]!==this.presss["fire-left"]?(l.isFireLeft=!0,l.toggleFireLeft=!0):this.keys["fire-left"]||(l.isFireLeft=!1)),this.keys.menu>0){if(performance.now()-this.keys.menu<this.setting.getWeaponWheelStandTime())l.swapWait=!0,l.isFireRightWait=l.isFireRightWait||this.keys["fire-right"]>0&&this.keys["fire-right"]!==this.presss["fire-right"],l.isFireLeftWait=l.isFireLeftWait||this.keys["fire-left"]>0&&this.keys["fire-left"]!==this.presss["fire-left"];else if(t.hasComponent(ji)){l.swapWait=!1,l.isFireRightWait=!1,l.isFireLeftWait=!1;const e=t.getComponent(ji);e.enable||(l.oldWeapon.left=l.left,l.oldWeapon.right=l.right),e.enable=!0,me(e.menus);const n=["fire-right","fire-left"];e.menus.push(new Xi((e=>e?ts(t,"hand",""):""===ts(t,"hand","")?"":"".concat(ts(t,"hand",""),"\n\n").concat(es(t,"stamina",0))),n,!0,(()=>!0),(()=>"".concat(es(t,"stamina",0))),this.createWeaponMenuExec("hand")),new Xi((e=>e?ts(t,"sidearm",""):""===ts(t,"sidearm","")?"":"".concat(ts(t,"sidearm",""),"\n\n").concat(es(t,"clip",0)===1/0?"":es(t,"clip",0))),n,!0,(()=>null!==$i(t,"sidearm",null)&&es(t,"clip",0)>0),(()=>"".concat(es(t,"clip",0)===1/0?"":es(t,"clip",0))),this.createWeaponMenuExec("sidearm")),new Xi((e=>e?ts(t,"machingun",""):""===ts(t,"machingun","")?"":"".concat(ts(t,"machingun",""),"\n\n").concat(es(t,"magazine",0))),n,!0,(()=>null!==$i(t,"machingun",null)&&es(t,"magazine",0)>0),(()=>"".concat(es(t,"magazine",0))),this.createWeaponMenuExec("machingun")),new Xi((e=>e?ts(t,"shotgun",""):""===ts(t,"shotgun","")?"":"".concat(ts(t,"shotgun",""),"\n\n").concat(es(t,"shell",0))),n,!0,(()=>null!==$i(t,"shotgun",null)&&es(t,"shell",0)>0),(()=>"".concat(es(t,"shell",0))),this.createWeaponMenuExec("shotgun")),new Xi((e=>e?ts(t,"launcher",""):""===ts(t,"launcher","")?"":"".concat(ts(t,"launcher",""),"\n\n").concat(es(t,"rocket",0))),n,!0,(()=>null!==$i(t,"launcher",null)&&es(t,"rocket",0)>0),(()=>"".concat(es(t,"rocket",0))),this.createWeaponMenuExec("launcher")),new Xi((e=>e?ts(t,"plasmagun",""):""===ts(t,"plasmagun","")?"":"".concat(ts(t,"plasmagun",""),"\n\n").concat(es(t,"cell",0))),n,!0,(()=>null!==$i(t,"plasmagun",null)&&es(t,"cell",0)>0),(()=>"".concat(es(t,"cell",0))),this.createWeaponMenuExec("plasmagun")))}}else{for(let e=0,i=0|Do.length;e<i;e=e+1|0){if(0!==e&&null===$i(t,Do[e],null))continue;const i=Do[e];if("string"==typeof $i(t,i,null))if(this.keys["weapon-".concat(e+1)])-1===l.changeWait&&(l.standPrevWeapon.left=l.left,l.standPrevWeapon.right=l.right),this.keys["fire-right"]>0&&this.keys["fire-right"]!==this.presss["fire-right"]&&(l.right=i,l.isFireRight=!1,r.isPressChange=!0),this.keys["fire-left"]>0&&this.keys["fire-left"]!==this.presss["fire-right"]&&(l.left=i,l.isFireLeft=!1,r.isPressChange=!0),l.changeWait=performance.now();else if(!this.keys["weapon-".concat(e+1)]&&this.keys["weapon-".concat(e+1)]!==this.presss["weapon-".concat(e+1)]){if(!r.isPressChange)if("keyboard"===n.getControlManager().getInputType())0===e?l.right=i:l.left=i,l.isFireLeft=!1;else 0===e?l.left=i:l.right=i,l.isFireRight=!1;r.isPressChange=!1}}if(t.hasComponent(ji)){t.getComponent(ji).enable=!1}if(l.isPrevSet&&(l.prevWeapon.right=l.standPrevWeapon.right,l.prevWeapon.left=l.standPrevWeapon.left,l.standPrevWeapon.right=l.right,l.standPrevWeapon.left=l.left,l.isPrevSet=!1),l.swapWait){let e=!1,t=!1;if(l.prevWeapon.left!==l.left||l.prevWeapon.right!==l.right){const n=l.left,i=l.right;e=n!==l.prevWeapon.left,t=i!==l.prevWeapon.right,l.left=l.prevWeapon.left,l.right=l.prevWeapon.right,l.prevWeapon.left=n,l.prevWeapon.right=i,l.swapWait=!1}l.isFireLeftWait?(l.isFireLeft=!0,l.toggleFireLeft=!0):e&&(l.isFireLeft=!1),l.isFireRightWait?(l.isFireRight=!0,l.toggleFireRight=!0):t&&(l.isFireRight=!1)}if(l.isFireRightWait=!1,l.isFireLeftWait=!1,"none"!==("keyboard"===this.controls.getInputType()?ts(t,l.left,"none"):ts(t,l.right,"none"))){const e="keyboard"===this.controls.getInputType()?l.left:l.right;let n=Do.indexOf(e);const i=l.right,s=l.left;if(-1!==n&&0!==n){if(this.keys["next-weapon"]&&this.keys["next-weapon"]!==this.presss["next-weapon"])for(;;){n++,n>=Do.length&&(n=1);const o=Do[n],a=Ro[n];if(e===o)break;if("none"!==ts(t,o,"none")&&("stamina"===a||es(t,a,0)>0)){l.prevWeapon.left=s,l.prevWeapon.right=i,"keyboard"===this.controls.getInputType()?l.left=o:l.right=o;break}}if(this.keys["prev-weapon"]&&this.keys["prev-weapon"]!==this.presss["prev-weapon"])for(;;){n--,n<1&&(n=Do.length-1);const o=Do[n],a=Ro[n];if(e===o)break;if("none"!==ts(t,o,"none")&&("stamina"===a||es(t,a,0)>0)){l.prevWeapon.left=s,l.prevWeapon.right=i,"keyboard"===this.controls.getInputType()?l.left=o:l.right=o;break}}}}-1===l.changeWait||this.keys["weapon-1"]||this.keys["weapon-2"]||this.keys["weapon-3"]||this.keys["weapon-4"]||this.keys["weapon-5"]||this.keys["weapon-6"]||l.standPrevWeapon.left===l.left&&l.standPrevWeapon.right===l.right||(l.prevWeapon.left=l.standPrevWeapon.left,l.prevWeapon.right=l.standPrevWeapon.right,l.changeWait=-1)}if((l.isFireRight||l.isFireLeft)&&(this.keys.coil=0),t.hasComponent(Qo)){const e=t.getComponent(Qo);if(e.can=!1,(!r.isAir||t.hasComponent($o)&&t.getComponent($o).exec)&&(r.groundTime=r.time),!(p.block||t.hasComponent(aa)&&t.getComponent(aa).exec)){const[n,s]=O(a.x,r.axes.x.x,r.axes.x.y),o=0===r.axes.x.x&&0===r.axes.x.y?-1:W(n,s,0,0);if(t.hasComponent(ss)&&t.getComponent(ss).exec)!t.getComponent(ss).climb&&this.keys.release>0&&this.keys.release!==this.presss.release?(t.hasComponent(ss)&&(t.getComponent(ss).through=!0),r.wall=!1,e.wallrun=!1):t.hasComponent(ss)&&!t.getComponent(ss).canJump&&t.getComponent(ss).canClimb?(((!t.getComponent(ss).canThroug||this.keys.jump!==this.presss.jump)&&this.keys.jump>0||this.keys.sprint!==this.presss.sprint)&&(t.hasComponent(ss)&&(t.getComponent(ss).climb=!0),this.presss.sprint&&(this.keys.sprint=i,this.keys.tacticalSprint=i)),e.wallrun=!1):t.getComponent(ss).canJump&&(this.keys.jump>0&&this.keys.jump!==this.presss.jump?(t.hasComponent(ss)&&(t.getComponent(ss).through=!0),t.hasComponent(ta)&&(t.getComponent(ta).enableCluch=!1),this.keys.cluch=0,e.enable=!0,e.exec=!1,e.angle=-1===o?a.x:o,e.wallrun=!1,e.isAxes=!1,r.jumpBuffer=!0,t.hasComponent(ss)&&(t.getComponent(ss).hasJump=!0)):e.can=!0);else if(t.hasComponent($o)&&t.getComponent($o).exec)if(this.keys.jump>0&&this.keys.jump!==this.presss.jump){const n=t.getComponent($o);t.hasComponent(ta)&&(t.getComponent(ta).enableCluch=!1),n.through=!0;const i=Math.abs(n.direction),s=-1===o?-1:H(n.start.wallAngle4,o);e.enable=!0,e.exec=!1,e.wallrun=i>Math.PI/4&&i<Math.PI/2+Math.PI/4&&(-1===o||s>Math.PI/4&&s<Math.PI/2+Math.PI/4),e.angle=e.wallrun?G(a.x)+(n.direction>Math.PI/4&&n.direction<Math.PI/2+Math.PI/4?-Math.PI/4:n.direction<-Math.PI/4&&n.direction>-Math.PI/2+-Math.PI/4?Math.PI/4:0):-1!==o?o:a.x,e.isAxes=!1,r.jumpBuffer=!0,this.keys.cluch=0}else e.can=!0;else E?this.keys.jump>0&&this.keys.jump!==this.presss.jump?(t.hasComponent(ta)&&(t.getComponent(ta).enableCluch=!1),e.enable=!0,e.exec=!1,e.angle=-1,e.wallrun=!1,e.isAxes=!1,r.jumpBuffer=!0,this.keys.cluch=0):e.can=!0:!e.exec&&-1!==r.groundTime&&r.time-r.groundTime<.25&&this.keys.jump>0&&this.keys.jump!==this.presss.jump||!r.isAir&&r.jumpBuffer&&-1!==r.jumpWaitTime&&r.time-r.jumpWaitTime<.25?(e.enable=!0,e.exec=!1,e.wallrun=!1,e.isAxes=r.axes.x.y>0,r.jumpBuffer=!0,t.hasComponent(ta)&&(t.getComponent(ta).enableCluch=!1),this.keys.cluch=0):(e.can=!0,r.jumpBuffer=r.isAir,this.keys.jump>0&&this.keys.jump!==this.presss.jump?r.jumpWaitTime=r.time:t.hasComponent(cs)&&t.getComponent(cs).hit.y>0&&(r.jumpWaitTime=-1))}}if(t.hasComponent(na)){const e=t.getComponent(na);if(e.exec)(c.cluchValue>0||this.keys.sliding_cancel>0&&this.keys.sliding_cancel!==this.presss.sliding_cancel||this.keys.sliding>0&&this.keys.sliding!==this.presss.sliding||r.isAir&&!n.hasBlockScaleVoxel(o.x,o.y-.001,o.z,t.hasComponent(cs)?t.getComponent(cs).size.x:.001,.001))&&(t.hasComponent(na)&&(t.getComponent(na).exec=!1),t.hasComponent(aa)&&t.getComponent(aa).exec||t.hasComponent(ss)&&t.getComponent(ss).exec||t.hasComponent($o)&&t.getComponent($o).exec||(m.enableSprint=!0,this.keys.sprint=i,this.presss.sprint=i));else{const n=t.getComponent(oa);(m.enableSprint||C)&&!p.block&&0===n.value&&this.keys.sliding>0&&this.keys.sliding!==this.presss.sliding&&!r.isAir&&(e.exec=!0,p.enableCluch=!0,this.keys.cluch=i,this.presss.cluch=i,this.keys.coil=0,this.presss.coil=0)}}const[s,u]=O(a.x,r.axes.x.x,r.axes.x.y),f=(t.hasComponent(cs)?t.getComponent(cs).size.x:0)/2+.1;if(t.hasComponent(ta)&&(!t.hasComponent(la)||!t.getComponent(la).exec)){const e=this.keys.cluch!==this.presss.cluch,a=!!this.keys.cluch!==p.enableCluch;p.block||t.hasComponent(ss)&&t.getComponent(ss).exec&&!t.getComponent(ss).climb||t.hasComponent(aa)&&t.getComponent(aa).exec||!r.isAir||n.hasBlockScaleVoxel(o.x,o.y-.001,o.z,t.hasComponent(cs)?t.getComponent(cs).size.x:.001,.001)?r.isAir||t.hasComponent(aa)&&t.getComponent(aa).exec||t.hasComponent($o)&&t.getComponent($o).exec||t.hasComponent(ss)&&t.getComponent(ss).exec&&!t.getComponent(ss).climb||t.hasComponent(ss)&&t.getComponent(ss).climb&&!n.hasBlockScaleVoxel(t.getComponent(ss).last.x,t.getComponent(ss).last.y,t.getComponent(ss).last.z,.001,p.standSizeY)||n.hasBlockScaleVoxel(o.x+s*f,0|o.y,o.z+u*f,t.hasComponent(cs)?t.getComponent(cs).size.x:.001,p.cluchSizeY)||!n.hasBlockScaleVoxel(o.x+s*f,0|o.y,o.z+u*f,t.hasComponent(cs)?t.getComponent(cs).size.x:.001,p.standSizeY)||!n.hasBlockScaleVoxel(o.x+s*f,Math.ceil((0|o.y)+p.standSizeY),o.z+u*f,t.hasComponent(cs)?t.getComponent(cs).size.x:.001,.001)?!p.block&&this.keys.sprint>0&&this.keys.sprint!==this.presss.sprint&&(this.keys.cluch>0||p.enableCluch)&&c.cluchValue<=0&&!r.isAir?(p.enableCluch=!1,this.keys.cluch=0):!p.enableCluch||p.block||t.hasComponent(na)&&t.getComponent(na).exec||!(this.keys.sprint!==this.presss.sprint||m.enableSprint&&c.cluchValue<=0)?!e&&!a||"touchpad"===n.getControlManager().getInputType()&&r.isWaitActive||p.block||t.hasComponent($o)&&t.getComponent($o).exec||!(!t.hasComponent(ss)||t.getComponent(ss).climb||!r.isAir||t.hasComponent(aa)&&t.getComponent(aa).exec)||(!e&&a&&(this.keys.cluch=p.enableCluch?i:0),p.enableCluch=this.keys.cluch>0):(p.enableCluch=!1,this.keys.cluch=0,this.keys.sprint=i,this.presss.sprint=i):(p.enableCluch=!0,this.keys.cluch=i):(p.enableCluch=!1,this.keys.cluch=0),t.hasComponent(ss)&&(t.getComponent(ss).exec&&!t.getComponent(ss).climb)?(p.enableCluch=!1,this.keys.cluch=0):!this.keys.cluch&&p.block&&(p.enableCluch=!0,this.keys.cluch=i)}if(t.hasComponent(sa)){const e=t.getComponent(sa);if(e.enable&&(!r.isAir||t.hasComponent(ss)&&t.getComponent(ss).exec||t.hasComponent($o)&&t.getComponent($o).exec))e.enable=!1,this.keys.coil=0,this.presss.coil=0,Math.abs(h.value.x)+Math.abs(h.value.z)>=m.walkSpeed?!t.hasComponent(na)||t.hasComponent($o)&&t.getComponent($o).exec||t.hasComponent(ss)&&t.getComponent(ss).exec&&!t.getComponent(ss).climb||(t.getComponent(na).exec=!0,p.enableCluch=!0,this.keys.cluch=i,this.presss.cluch=i):(p.enableCluch=!0,this.keys.cluch=i);else if((!t.hasComponent(aa)||!t.getComponent(aa).exec)&&(!t.hasComponent(ss)||!t.getComponent(ss).exec)&&(!t.hasComponent($o)||!t.getComponent($o).exec)&&r.isAir&&this.keys.coil!==this.presss.coil&&(E&&r.isAir&&[...l.leftWeapon.bullets,...l.rightWeapon.bullets].forEach((e=>e.hasComponent(ps)&&(e.getComponent(ps).over=!0))),e.enable=this.keys.coil>0,e.enable&&t.hasComponent(ds))){const n=t.getComponent(ds);e.dir=0===r.axes.x.x&&0===r.axes.x.y?a.x:z(W(n.value.x,n.value.z,0,0))}}const y=Math.max(Math.abs(r.axes.x.y),Math.abs(r.axes.x.x))>.625;if(t.hasComponent(ia)){const n=t.getComponent(ia);(t.hasComponent(aa)&&t.getComponent(aa).exec||this.keys.sprint>0&&i-this.keys.sprint>250&&0===r.axes.x.y&&0===r.axes.x.x)&&(this.keys.sprint=0),b<-Math.PI/4&&b>-Math.PI/4*3||!y||0!==c.cluchValue||0!==c.standValue||t.hasComponent(ss)&&t.getComponent(ss).exec&&!t.getComponent(ss).climb||t.hasComponent(Qo)&&t.getComponent(Qo).enable||r.isAir?this.keys.pressTacticalSprint||(n.enableSprint=!1,n.enableTacticalSprint=!1,y||(this.keys.sprint=0,this.keys.tacticalSprint=0)):this.keys.sprint>0&&this.keys.sprint!==this.presss.sprint&&(n.enableSprint=!0),this.keys.pressTacticalSprint||!this.keys.tacticalSprint||b<-Math.PI/4&&b>-Math.PI/4*3||0===r.axes.x.y&&0===r.axes.x.x||!(t.hasComponent(ss)&&(t.getComponent(ss).exec&&t.getComponent(ss).climb)||0===c.cluchValue&&0===c.standValue)||t.hasComponent(Qo)&&t.getComponent(Qo).enable||r.isAir||(n.pressSprint=this.keys.tacticalSprint),n.tacticalSprintPar=n.enableTacticalSprint?Math.max(0,n.tacticalSprintPar-e/60/n.tacticalSprintTime):Math.min(1,n.tacticalSprintPar+e/60/n.tacticalSprintTime),!n.enableTacticalSprint&&this.keys.pressTacticalSprint&&-1!==n.pressSprint&&i-n.pressSprint<250?(this.keys.sprint=i,this.keys.tacticalSprint=i,n.pressSprint=-1,n.enableTacticalSprint=!0,n.startTacticalSprintTime=r.time):n.enableTacticalSprint&&-1!==n.startTacticalSprintTime&&0===n.tacticalSprintPar&&(n.enableTacticalSprint=!1,n.startTacticalSprintTime=-1)}if(b<-Math.PI/4&&b>-Math.PI/4*3||!y||(!r.isAir||t.hasComponent(ss)&&t.getComponent(ss).exec?d&&0===this.walk.x&&0===this.walk.y&&!this.keys.sprint_touch?this.keys.sprint=0:this.keys.sprint>0&&y?m.enableSprint=!0:(m.enableSprint=!1,m.enableTacticalSprint=!1):this.keys.sprint>0&&y&&(m.enableSprint=!0)),r.isSprint=this.keys.sprint>0,(t.hasComponent(Fo)&&(l.isFireRight||l.isFireLeft)||t.hasComponent(na)&&t.getComponent(na).exec)&&(m.enableSprint=!1,m.enableTacticalSprint=!1),o.x,o.y,o.z,t.hasComponent(cs)&&t.getComponent(cs).size.x,t.hasComponent(ss)&&(t.getComponent(ss).hasJump=!1),-1!==r.respawnTime||t.hasComponent(ss)&&t.getComponent(ss).exec||t.hasComponent(aa)&&t.getComponent(aa).exec||t.hasComponent(Hs)&&!t.getComponent(Hs).isFall||n.hasBlockScaleVoxel(o.x,o.y-.001,o.z,t.hasComponent(cs)?t.getComponent(cs).size.x:.001,.001)){if(r.isAir&&g.hasComponent(ea)){const e=g.getComponent(ea),i=ha(t),s=Math.min(1,Math.max(0,-r.airForce)/r.airValue*(1-i));if(e.swais.push(new ra(.25,1,.025*s,.5,0)),o.y>.999){const e=new Mn("player-landing-sound");e.position.x=o.x,e.position.y=o.y,e.position.z=o.z,n.createSound("./asset/sound/player/landing.mp3",e,"player-landing").setVolume(1+1.5*s).play()}r.landingTime=r.time,r.landingForce=-s}r.isAir=!1}else(t.hasComponent($o)&&t.getComponent($o).exec||(!t.hasComponent(Hs)||t.getComponent(Hs).isFall)&&!n.hasBlockScaleVoxel(o.x,o.y-.001,o.z,t.hasComponent(cs)?t.getComponent(cs).size.x:.001,.001))&&(r.isAir=!0,r.landingTime=-1);r.isAir?0!==h.value.y&&(r.airForce=h.value.y):r.airForce=0;let x=0;if(t.hasComponent($o)&&t.getComponent($o).exec){const e=t.getComponent($o);x=Math.sin(e.direction)*(.1*Math.PI)*(1-e.value)}if(t.hasComponent(ss)&&t.getComponent(ss).climb)t.direction.z=j(t.direction.z,.125,.25*e);else if(t.hasComponent(na)&&t.getComponent(na).exec){const n=-.125-Math.min(Math.PI/2,Math.max(-Math.PI/2,Math.PI/2*Math.sin(R(a.x,t.getComponent(na).dir))))*(Math.PI/8)*(1-t.getComponent(na).value),i=Math.sin(Math.min(1,t.getComponent(na).value/.25)*Math.PI/4);t.direction.z=j(t.direction.z,n*i,.25*e)}else t.direction.z=j(t.direction.z,x+(t.hasComponent(aa)?-t.getComponent(aa).value.x:0)*Math.PI*.125,.25*e);r.isSlowMo=r.readySlowMo&&w&&!m.enableSprint&&this.setting.hasSSSSlowMo()&&es(t,"combo")>=ns(t,"combo"),r.speed=t.hasComponent(ji)&&t.getComponent(ji).enable?.1:r.isSlowMo?.375:1}if(g.getNames().some((e=>"camera"===e))){const e=t.hasComponent(ji)&&t.getComponent(ji).enable;f.hasStick()!==e&&(f.changeStick("y",e),this.look.x=0,this.look.y=0)}let _="still";if(-1!==r.deathTime)_="death";else if(r.goleTime>=0)_="gole";else{const e=-1!==l.rightWeapon.time?l.rightWeapon.time:l.rightWeapon.data.fireSpeed,n=-1!==l.leftWeapon.time?l.leftWeapon.time:l.leftWeapon.data.fireSpeed,i=s(Math.min(1,1-Math.min(1,e/l.rightWeapon.data.fireSpeed)),0),o=s(Math.min(1,1-Math.min(1,n/l.leftWeapon.data.fireSpeed)),0);0!==i&&1!==i&&0!==o&&1!==o||l.leftWeapon.data.shootType===wo.HOOK&&0!==l.leftWeapon.bullets.length||l.rightWeapon.data.shootType===wo.HOOK&&0!==l.rightWeapon.bullets.length||(t.hasComponent(ss)&&t.getComponent(ss).exec?_="grab":u.enable?_="coil":!y&&!l.rightWeapon.isFire&&!l.leftWeapon.isFire&&r.isAir&&h.value.y<r.airValue?_="air":t.hasComponent(na)&&t.getComponent(na).exec?_="sliding":t.hasComponent($o)&&t.getComponent($o).exec?_="wallrun":y||l.rightWeapon.isFire||l.leftWeapon.isFire||!(t.hasComponent(Qo)&&t.getComponent(Qo).enable||r.isAir)?p.enableCluch?_="cluch":m.enableSprint&&0===c.cameraValue&&w&&(!t.hasComponent(Qo)||!t.getComponent(Qo).exec||l.leftWeapon.data.grip&&!l.leftWeapon.data.release&&l.rightWeapon.data.grip&&!l.rightWeapon.data.release)&&r.time-l.leftWeapon.fireStartTime>Math.max(.5,l.leftWeapon.data.fireSpeed)&&r.time-l.rightWeapon.fireStartTime>Math.max(.5,l.rightWeapon.data.fireSpeed)&&(_="sprint"):_="jump")}if(r.state=_,-1!==r.respawnTime&&(this.keys.sprint=0),r.readySlowMo=!1,n instanceof Gh){const e=n.getSoundManager();-1!==r.goleTime&&this.fadeSound(n,r.goleTime),-1!==r.deathTime&&this.fadeSound(n,r.deathTime),-1!==r.intermissionTime&&e.setVolume(0),-1===r.goleTime&&-1===r.deathTime&&-1===r.intermissionTime&&e.setVolume(this.setting.getSoundVolume())}r.isStartCombo=y,r.time+=s(e/60,0)}physical(e,t,n){const i=t.getComponent(Gi);if(t.hasComponent(Qo)){const e=t.getComponent(Qo);t.hasComponent(jo)&&(t.getComponent(jo).force=1-(e.enable?e.wallrun?1-Math.min(1,Math.max(0,i.time-e.time-.25)/.25):.5:0))}}offset(e,t,n){const i=performance.now(),{position:s,direction:a}=t,r=t.getComponent(Gi),l=t.getComponent(ds),h=n.getControlManager(),p=_a(),c=Na(),d=h.getInputType();if(!Rn()&&("gamepad"===d||"touchpad"===d?this.keys.escape>0&&this.keys.escape!==this.presss.escape:!f()&&!p&&p!==r.isFullscreen||"keyboard"===d&&!c&&c!==r.isPointerLock)){const e=n.getSceneManager();n instanceof Gh&&n.hasPreview()?e.activeScene("editor"):e.activeScene("title")}r.isFullscreen=p,r.isPointerLock=c;const[u,m]=J(r.cmda.x,r.cmda.y,a.z);if(a.x=a.x+u,a.y+=m,a.y=Math.max(-Math.PI/2,Math.min(o(Math.PI/2,Math.PI/2/3,t.hasComponent(na)?t.getComponent(na).par:0),a.y)),null===r.activeEntity&&t.hasComponent($o)&&t.hasComponent(cs)){const n=t.getComponent($o),i=t.getComponent(cs),s=Math.abs(n.direction);if(n.exec&&s>Math.PI/4&&s<Math.PI/2+Math.PI/4&&(n.direction>Math.PI/4&&n.direction<Math.PI/2+Math.PI/4?r.cmda.x<=0:r.cmda.x>=0)&&(0===i.hit.x||0===i.hit.z)){const t=G(a.x);(0!==n.side&&n.side>0?R(t,a.x)<0:R(t,a.x)>0)&&(a.x=(g=a.x,y=t,x=.1*e,j(Math.abs(g-y)>Math.PI/2?g-w:g,y,x)))}}var g,y,x;if(a.x=z(a.x),a.y=Math.max(-Math.PI/2,Math.min(Math.PI/2,a.y)),n instanceof Gh&&!r.isPressNext&&(-1!==r.goleTime&&i-r.goleTime>=1e3||-1!==r.deathTime&&i-r.deathTime>=1e3||-1!==r.intermissionTime&&i-r.intermissionTime>=n.getEndIntermissionTime())&&this.keys.next&&this.keys.next!==this.presss.next&&(r.isPressNext=!0,-1!==r.intermissionTime?(n.clear(!0),n.deleteSave(),n.getSceneManager().activeScene("title")):-1!==r.goleTime?n.hasHorde()?(n.clear(!0),n.getSceneManager().activeScene("title")):n.hasTutorial()?n.newGame(1):n.hasPreview()?n.getSceneManager().activeScene("editor"):(r.loading=!0,r.goleTime=-1,n.nextLevel(r.secret).catch((()=>{r.intermissionTime=i,r.isPressNext=!1})).finally((()=>{r.loading=!1,this.clearControls()}))):-1!==r.deathTime&&(n.hasTutorial()?n.loadTutorial():n.hasPractice()?n.loadPracticeArea():this.setting.hasPermaDeath()?(n.clear(),n.deleteSave(),n.getSceneManager().activeScene("title")):!n.hasHorde()||!this.setting.hasCheckPoint()||this.setting.hasPermaDeath()||(performance.now()-r.deathTime)/1e3>5?n.hasHorde()&&!this.setting.hasCheckPoint()?n.newHorde(n.getEpisodeNumber()):n.continueLevel().then((e=>{if(null!==e){n.getEntitys().filter((e=>e.hasComponent(Ra))).forEach((e=>e.getComponent(Ra).see=!1)),r.isPressNext=!1,r.deathTime=-1,t.hasComponent(Ws)&&(t.getComponent(Ws).isDeath=!1),n.hasHorde()||Qi(t,"score",0),Qi(t,"combo",0),Qi(t,"gage",0),Qi(t,"health",100),Qi(t,"stamina",ns(t,"stamina")),$i(t,"machingun",null)&&Qi(t,"magazine",Math.max(es(t,"magagine",0),Math.floor(ns(t,"magazine")/2))),$i(t,"shotgun",null)&&Qi(t,"shell",Math.max(es(t,"shell",0),Math.floor(ns(t,"shell")/2))),$i(t,"launcher",null)&&Qi(t,"rocket",Math.max(es(t,"rocket",0),Math.floor(ns(t,"rocket")/2))),$i(t,"plasmagun",null)&&Qi(t,"cell",Math.max(es(t,"cell",0),Math.floor(ns(t,"cell")/2))),t.position.x=e.position.x,t.position.y=e.position.y+.01,t.position.z=e.position.z,t.direction.x=e.direction.x,t.direction.y=1e-4,t.direction.z=0;const i=n.getCamera();if(i.hasComponent(wi)){i.getComponent(wi).position.y=1.5}if(i.hasComponent(Yo)){const e=i.getComponent(Yo);e.position.x=0,e.position.y=1.5,e.position.z=0,e.init=!1}if(t.hasComponent(cs)){const e=t.getComponent(cs);e.enable=!0,e.old.x=t.position.x,e.old.y=t.position.y,e.old.z=t.position.z,e.size.y=1.75}if(t.hasComponent(_n)){const e=t.getComponent(_n);e.enable=!0,e.old.x=t.position.x,e.old.y=t.position.y,e.old.z=t.position.z}if(t.hasComponent(ds)){const e=t.getComponent(ds);e.value.x=0,e.value.y=0,e.value.z=0}n.initTrees(t)}})):r.isPressNext=!1)),r.isAir&&(!t.hasComponent($o)||!t.getComponent($o).exec)&&(!t.hasComponent(ss)||!t.getComponent(ss).exec)&&-1!==r.oldDirX){const[e,t]=O(a.x-r.oldDirX,-l.value.z,l.value.x),n=Math.max(0,r.axes.x.y);l.value.x+=(e-l.value.x)*n,l.value.z+=(t-l.value.z)*n}r.oldDirX=a.x;const[M,C,v]=n.getWorldSize(),b=t.hasComponent(cs)?t.getComponent(cs).size:new E(0,0);s.x=s.x<0?0+b.x/2:s.x,s.x=s.x>M-1-b.x/2?M-1-b.x/2:s.x,s.y=s.y<0?0:s.y,s.y=s.y>C-1-b.y?C-1-b.y:s.y,s.z=s.z<0?0+b.x/2:s.z,s.z=s.z>v-1-b.x/2?v-1-b.x/2:s.z,this.isUpdateWalkToKeyboard&&(this.updateWalk(),this.isUpdateWalkToKeyboard=!1),this.isAxesUpdateWalkX=!1,this.isAxesUpdateWalkY=!1,this.isAxesUpdateLookX=!1,this.isAxesUpdateLookY=!1;for(const e in this.updateButtons)this.updateButtons[e]=!1;for(const e in this.keys)this.presss[e]=this.keys[e];for(const e in this.releases)this.enablePresss(e,!1,!1,this.scenes,i),delete this.releases[e];for(const e in this.updateButtons)delete this.updateButtons[e];this.walk.x=this.oldWalk.x,this.walk.y=this.oldWalk.y,"gamepad"===this.controls.getInputType()&&(this.look.x=this.oldLook.x,this.look.y=this.oldLook.y),r.cmda.x=0,r.cmda.y=0;const _=r.time-r.time%.5;null===r.activeEntity&&-1===r.respawnTime&&-1===r.deathTime&&-1===r.goleTime&&-1===r.intermissionTime&&r.healthReduceInterval!==_&&es(t,"health",0)>r.borderHealth&&qi(t,"health",-1);const S=r.time-r.time%.25;if(null===r.activeEntity&&-1===r.respawnTime&&-1===r.deathTime&&-1===r.goleTime&&-1===r.intermissionTime&&r.staminaReduceInterval!==S&&t.hasComponent(Fo)){const e=t.getComponent(Fo);"stamina"===e.rightWeapon.data.ammoType&&e.isFireRight||"stamina"===e.leftWeapon.data.ammoType&&e.isFireLeft||!(es(t,"stamina",0)<ns(t,"stamina"))||qi(t,"stamina",1)}if(r.healthReduceInterval=_,r.staminaReduceInterval=S,t.hasComponent(Fo)){const e=t.getComponent(Fo),n="hookshot"===$i(t,e.left,null)&&e.leftWeapon.bullets.length>0,i="hookshot"===$i(t,e.right,null)&&e.rightWeapon.bullets.length>0,s=(n||i)&&![...e.leftWeapon.bullets,...e.rightWeapon.bullets].some((e=>{if(e.hasLive()&&e.hasComponent(Gs)){const t=e.getComponent(Gs).bullet;if(null!==t)if(t.hasComponent(ps)&&t.getComponent(ps).hit){if(t.hasComponent(wa)&&t.getComponent(wa).isPull)return!0}else if(e.hasComponent(ps)&&e.getComponent(ps).hit)return!0}return!1}));-1!==r.respawnTime&&t.hasComponent(sa)&&(this.keys.coil=0,t.getComponent(sa).enable=!1,s&&[...e.leftWeapon.bullets,...e.rightWeapon.bullets].forEach((e=>e.hasComponent(ps)&&(e.getComponent(ps).over=!0))))}this.isResetWalkX&&(this.walk.x=0,this.oldWalk.x=0,this.isResetWalkX=!1),this.isResetWalkY&&(this.walk.y=0,this.oldWalk.y=0,this.isResetWalkY=!1),this.isResetLookX&&(this.look.x=0,this.oldLook.x=0,this.isResetLookX=!1),this.isResetLookY&&(this.look.y=0,this.oldLook.y=0,this.isResetLookY=!1),fn("player-position","x:".concat(Math.floor(10*s.x)/10,",y:").concat(Math.floor(10*s.y)/10,",z:").concat(Math.floor(10*s.z)/10)),fn("player-direction","x:".concat(Math.floor(10*a.x)/10,",y:").concat(Math.floor(10*a.y)/10))}}class Fa{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,r=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,l=arguments.length>8&&void 0!==arguments[8]&&arguments[8],h=arguments.length>9&&void 0!==arguments[9]&&arguments[9],p=!(arguments.length>10&&void 0!==arguments[10])||arguments[10];this.enable=!0,this.time=0,this.initTime=-1,this.old={position:new E(-1,-1),scale:-1,rotate:-1},this.move={position:new E(0,0),scale:0,rotate:0},this.swais=new Array,this.x=e,this.y=t,this.rotate=n,this.speed=i,this.add=s,this.mrotate=o,this.blockX=a,this.slide=r,this.invert=l,this.moveFix=h,this.hard=p}}class Ua extends Bi{constructor(){super(Fa,qo,Ei)}additional(e,t,n){const i=t.getComponent(Ei).value;if(!(null!==i&&i instanceof Oi&&i.hasComponent(Ei)))return;const o=i.getComponent(Ei).value;if(null===o||!o.hasComponent(Gi))return;const a=o.getComponent(Gi),r=t.getComponent(Fa);let l=!0,h=0,p=0,c=0,d=0;if(o instanceof Mn&&o.hasComponent(cs)){const{position:e}=o,t=o.getComponent(cs);n.hasBlockScaleVoxel(e.x,e.y-.001,e.z,t.size.x,.001)||o.hasComponent($o)&&o.getComponent($o).exec||(l=!1),o.hasComponent(ss)&&o.getComponent(ss).exec&&(l=!1)}let u=0,m=0,g=0;if(!o.hasComponent(Gi)||null===o.getComponent(Gi).activeEntity){if(o.hasComponent(jo)){const e=o.getComponent(jo);u=e.move.x,m=e.move.z}else u=a.axes.x.x,m=a.axes.x.y;g=Math.min(1,Math.max(-1,1e3*(o.hasComponent(ji)&&o.getComponent(ji).enable?0:a.axes.y.x)))}const f=t.getComponent(qo);if(l){const t=o.hasComponent($o)&&o.getComponent($o).exec?1:Math.min(1,Math.abs(u)+Math.abs(m));0===t||0!==(o.hasComponent(oa)?o.getComponent(oa).value:0)?r.time=0:r.enable&&(r.time+=s(e/60*t*r.speed,0));const n=(r.time+r.add)%1*Math.abs(t);let i=0,a=0;const l=r.invert?Math.sin:Math.cos,y=r.invert?Math.cos:Math.sin;r.hard?(i=Math.min(1,2*Math.max(-1,l(n*(2*Math.PI))))*t*(r.moveFix?Math.max(.5,Math.abs(u)):.5),a=2*(1-Math.min(1,Math.max(-1,Math.abs(l(n*(2*Math.PI))))))*t*(r.moveFix?Math.max(.5,Math.abs(m)):1)):(i=Math.min(1,Math.max(-1,l(n*(2*Math.PI))))*t*(r.moveFix?Math.max(.5,Math.abs(u)):1),a=(1-Math.min(1,Math.max(-1,l(n*(4*Math.PI)))))*t*(r.moveFix?Math.max(.5,Math.abs(m)):1));const w=0!==t?y((1-n)*(2*Math.PI)):0,x=-u,M=-m,E=r.moveFix?g:0;isNaN(i)||(h+=i*r.x+x*r.slide+E*r.mrotate),isNaN(a)||(p+=a*r.y+.05*M,d+=.1*M),isNaN(w)||(c=f.isRotateCenter?0:w*r.rotate+-u*r.mrotate)}r.swais.slice().forEach((t=>{if(t.time<=t.tick){const n=s(Math.min(1,t.time/t.tick),0),i=(1-Math.sin(n*(Math.PI/2)))**t.reduce,o=Math.sin(n%t.par/t.par*Math.PI),a=s(((o<.5?o/.5:1-(o-.5)/.5)*i-i/2.5)/.5*t.scale,0);c+=Math.PI*a,t.time+=s(e/60,0)}else r.swais.splice(r.swais.indexOf(t),1)}));const y=!f.init||f.initTime!==r.initTime;r.initTime=f.initTime,(y||-1===r.old.position.x||Math.fround(f.position.x-r.move.position.x)!==Math.fround(r.old.position.x))&&(r.old.position.x=Math.fround(f.position.x)),(y||-1===r.old.position.y||Math.fround(f.position.y-r.move.position.y)!==Math.fround(r.old.position.y))&&(r.old.position.y=Math.fround(f.position.y)),(y||-1===r.old.rotate||Math.fround(f.rotate-r.move.rotate)!==Math.fround(r.old.rotate))&&(r.old.rotate=Math.fround(f.rotate)),(y||-1===r.old.scale||Math.fround(f.scale-r.move.scale)!==Math.fround(r.old.scale))&&(r.old.scale=Math.fround(f.scale));const w=.375;y||(f.position.x=Math.fround(j(f.position.x,r.old.position.x+h,w)),f.position.y=Math.fround(j(f.position.y,r.old.position.y+p,w)),f.rotate=Math.fround(j(f.rotate,r.old.rotate+c,w)),f.scale=Math.fround(j(f.scale,r.old.scale+d,w))),r.move.position.x=Math.fround(f.position.x-r.old.position.x),r.move.position.y=Math.fround(f.position.y-r.old.position.y),r.move.rotate=Math.fround(f.rotate-r.old.rotate),r.move.scale=Math.fround(f.scale-r.old.scale)}}class Ba extends Bi{constructor(){super(Qo,Gi,jo,ds,ia)}additional(e,t,n){const i=t.getComponent(Qo),s=t.getComponent(ds);if(t.hasComponent(Hs)){const n=t.getComponent(Hs);t.hasComponent(Qo)&&t.getComponent(Qo).exec&&t.hasComponent(ds)&&0!==t.getComponent(ds).value.y&&t.hasComponent(cs)&&0!==t.getComponent(cs).hit.y&&Math.abs(t.getComponent(ds).value.y)<=.05?n.gravity=.5:n.gravity=j(n.value,1,.25*e)}if(i.enable){const e=t.getComponent(Fo);if(i.exec)(t.hasComponent(Gi)&&-1!==t.getComponent(Gi).respawnTime||t.hasComponent(Gi)&&!t.getComponent(Gi).isAir||t.hasComponent($o)&&t.getComponent($o).exec||t.hasComponent(ss)&&t.getComponent(ss).exec||"hookshot"===$i(t,e.right,null)&&e.rightWeapon.bullets.length>0||"hookshot"===$i(t,e.left,null)&&e.leftWeapon.bullets.length>0)&&(i.enable=!1,i.exec=!1,i.time=-1);else if(i.exec=!0,i.time=t.hasComponent(Gi)?t.getComponent(Gi).time:0,s.value.y=i.force.y,-1!==i.angle){const e=t.getComponent(jo),[n,o]=O(i.angle,0,Math.max(e.speed,i.force.x)*e.force);s.value.x=n,s.value.z=o,i.angle=-1}}}}class Ya{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.standY=e,this.cluchY=t}}class Ga extends Bi{constructor(){super(ss,Gi,cs)}move(e,t,n){const{position:i}=t,o=t.getComponent(ss);o.time+=s(e/60,0);const a=s(Math.min(1,Math.max(0,o.time/n)),0);if(a>=1)i.x=o.end.x,i.y=o.end.y,i.z=o.end.z;else{const e=P(o.end.x,o.end.y,o.end.z,o.start.x,o.start.y,o.start.z),[t,n]=N(o.end.x,o.end.y,o.end.z,o.start.x,o.start.y,o.start.z),[s,r,l]=A(t,n,0,0,e*a);i.x=o.start.x+s,i.y=o.start.y+r,i.z=o.start.z+l}return a}cancel(e,t){const n=e.getComponent(ss),i=e.getComponent(cs),s=e.getComponent(Gi);n.climb||(s.grabTime=s.time),n.value=0,n.exec=!1,n.press=!1,n.flip=null,n.climb=!1,n.blockPositionTop=-1,n.through=!1,i.enable=!0}hasHitCamera(e){const{direction:t}=e.getCamera();return t.y<Math.PI/4}additional(e,t,n){const{position:i}=t,s=t.getComponent(ss);if(s.exec&&!s.through&&!s.press&&s.climb){const e=s.last.x,t=s.last.y,n=s.last.z;s.start.x=i.x,s.start.y=i.y,s.start.z=i.z,s.end.x=e,s.end.y=t,s.end.z=n,s.time=0,s.press=!0}if(s.exec&&!s.through&&t.hasComponent(ds)){const e=t.getComponent(ds);e.value.x=0,e.value.y=0,e.value.z=0}}movable(e,t,n){const i=t.getComponent(Gi),s=t.getComponent(ss);if(s.move=!1,!s.exec||s.press||s.through||s.standJump||-1===s.blockPositionTop)s.canMove=!1;else if(s.canMove=!0,Math.abs(i.axes.x.x)>.75){const o=-i.axes.x.x;if(0!==o){const i=t.getComponent(cs);let a=!1;const r=s.end.x,l=s.end.y,h=s.end.z;let p=s.angle,c=s.end.x,d=s.end.z,u=s.last.x,m=s.last.z;if(p===Math.PI/4)a=!0,o>0?(p=0,c=s.grabPosition.x-i.size.x/2,d=s.grabPosition.z+.001,u=c+i.size.x,m=d):o<0&&(p=Math.PI/2,c=s.grabPosition.x+.001,d=s.grabPosition.z-i.size.x/2,u=c,m=d+i.size.x);else if(p===Math.PI/4*3)a=!0,o>0?(p=Math.PI/2,c=s.grabPosition.x+1-.001,d=s.grabPosition.z-i.size.x/2,u=c,m=d+i.size.x):o<0&&(p=Math.PI,c=s.grabPosition.x+1+i.size.x/2,d=s.grabPosition.z+.001,u=c-i.size.x,m=d);else if(p===Math.PI/4*5)a=!0,o>0?(p=Math.PI,c=s.grabPosition.x+1-.001+i.size.x/2,d=s.grabPosition.z+1-.001,u=c-i.size.x,m=d):o<0&&(p=Math.PI/2*3,c=s.grabPosition.x+1-.001,d=s.grabPosition.z+1+i.size.x/2,u=c,m=d-i.size.x);else if(p===Math.PI/4*7)a=!0,o>0?(p=Math.PI/2*3,c=s.grabPosition.x+.001,d=s.grabPosition.z+1-.001+i.size.x/2,u=c,m=d-i.size.x):o<0&&(p=0,c=s.grabPosition.x-i.size.x/2,d=s.grabPosition.z+1-.001,u=c+i.size.x,m=d);else{const r=t.hasComponent(ia)?t.getComponent(ia).cluchSpeed:0;0===p?m=d+=r*o*e:p===Math.PI/2?u=c-=r*o*e:p===Math.PI/2*2?m=d-=r*o*e:p===Math.PI/2*3&&(u=c+=r*o*e);const l=Ae(u,m,i.size.x,new Array);for(let e=0,t=0|l.length;e<t;e=e+2|0){const t=l[e],o=l[e+1];if(n.getVoxel(t,s.blockPositionTop,o)===li)continue;const[a,,r]=we(t,s.blockPositionTop,o,u,s.blockPositionTop,m,i.size.x+.001,.001,((e,t,i)=>n.getVoxel(e,t,i)!==li));0===p||p===Math.PI?(m+=r,d=r>0?Math.max(d,m-i.size.x/2):Math.min(d,m+i.size.x/2)):(u+=a,c=a>0?Math.max(c,u-i.size.x/2):Math.min(c,u+i.size.x/2))}let h=!1,g=0,f=0;const y=Ae(c,d,i.size.x);for(let e=0,t=0|y.length;e<t;e=e+2|0){const t=y[e],o=y[e+1];for(let e=0|Math.max(0,Math.ceil(i.size.y)-1),a=Math.ceil(i.size.y);e<a;e=e+1|0){const a=s.end.y+e;if(n.getVoxel(t,a,o)===li)continue;const[r,,l]=we(t,a,o,c,s.end.y,d,i.size.x+.001,i.size.y,((e,t,i)=>n.getVoxel(e,t,i)!==li));0===p||p===Math.PI?(m+=l,d+=l,f+=l,0!==l&&(h=!0)):(u+=r,c+=r,g+=r,0!==r&&(h=!0))}}!h||0===g&&0===f?n.hasHitScanVoxel(p,0,c,s.blockPositionTop-.5,d,i.size.x/2+.5)||(0===p?(a=!0,o>0?(p=Math.PI/2*3,c=s.grabPosition.x+.001,d=s.grabPosition.z+1+i.size.x/2,u=c,m=d-i.size.x):o<0&&(p=Math.PI/2,c=s.grabPosition.x+.001,d=s.grabPosition.z-i.size.x/2,u=c,m=d+i.size.x)):p===Math.PI/2?(a=!0,o>0?(p=0,c=s.grabPosition.x-i.size.x/2,d=s.grabPosition.z+.001,u=c+i.size.x,m=d):o<0&&(p=Math.PI,c=s.grabPosition.x+1+i.size.x/2,d=s.grabPosition.z+.001,u=c-i.size.x,m=d)):p===Math.PI?(a=!0,o>0?(p=Math.PI/2,c=s.grabPosition.x+1-.001,d=s.grabPosition.z-i.size.x/2,u=c,m=d+i.size.x):o<0&&(p=Math.PI/2*3,c=s.grabPosition.x+1-.001,d=s.grabPosition.z+1+i.size.x/2,u=c,m=d-i.size.x)):p===Math.PI/2*3&&(a=!0,o>0?(p=Math.PI,c=s.grabPosition.x+1+i.size.x/2,d=s.grabPosition.z+1-.001,u=c-i.size.x,m=d):o<0&&(p=0,c=s.grabPosition.x-i.size.x/2,d=s.grabPosition.z+1-.001,u=c+i.size.x,m=d))):0===p?f>0?(p=Math.PI/2*3,u=c,m=d-i.size.x):f<0&&(p=Math.PI/2,u=c,m=d+i.size.x):p===Math.PI/2?g>0?(p=Math.PI,u=c-i.size.x,m=d):g<0&&(p=0,u=c+i.size.x,m=d):p===Math.PI/2*2?f>0?(p=Math.PI/2*3,u=c,m=d-i.size.x):f<0&&(p=Math.PI/2,u=c,m=d+i.size.x):p===Math.PI/2*3&&(g>0?(p=Math.PI,u=c-i.size.x,m=d):g<0&&(p=0,u=c+i.size.x,m=d))}const g=n.getCamera(),f=g.hasComponent(Ya)?g.getComponent(Ya).standY:.5;n.hasBlockScaleVoxel(c,s.blockPositionTop,d,.001,.001)||n.hasBlockScaleVoxel(c,s.blockPositionTop-f,d,.001,f)||n.hasBlockScaleVoxel(u,s.blockPositionTop+.5,m,.001,.001)||!n.hasBlockScaleVoxel(u,s.blockPositionTop-f,m,.001,f)||(s.end.x===c&&s.end.z===d||(s.move=!0),s.angle=p,s.end.x=c,s.end.z=d,s.last.x=u,s.last.z=m,a&&(s.time=0,s.start.x=r,s.start.y=l,s.start.z=h))}s.grabPosition.x=Math.floor(s.last.x),s.grabPosition.y=Math.floor(s.blockPositionTop-.999),s.grabPosition.z=Math.floor(s.last.z)}if(s.exec)if(s.press)s.value=.5+.5*this.move(e,t,s.grabSpeed);else{const{direction:o}=t;s.value=.5*this.move(e,t,s.clumbSpeed);const a=R(s.angle,o.x),r=a/Math.abs(a);if(Math.abs(a)>Math.PI/2&&null!==s.flip&&s.flip!==r){const e=n.getCamera();if(e.hasComponent(ea)){e.getComponent(ea).swais.push(new ra(.5,1,.05+.05*(t.hasComponent(ds)?Math.max(0,t.getComponent(ds).value.y/i.airValue):0),2,0))}const o=new Mn("player-grab-flip-sound"),[a,r]=O(s.angle,0,.375);o.position.x=e.position.x+a,o.position.y=e.position.y,o.position.z=e.position.z+r,n.createSound("./asset/sound/player/grab.mp3",o,"player-grab").play()}s.flip=r}(s.value>=1||-1!==i.deathTime||!n.hasBlockScaleVoxel(.5+(0|s.grabPosition.x),.5+(0|s.grabPosition.y),.5+(0|s.grabPosition.z),1,1))&&(this.cancel(t,n),s.grabPosition.x=-1,s.grabPosition.y=-1,s.grabPosition.z=-1)}offset(e,t,n){const{position:i,direction:o}=t,a=t.getComponent(ss),r=t.getComponent(Gi),l=t.getComponent(cs),h=i.x,p=i.y,c=i.z,d=-1===a.oldPosition.x?i.x:a.oldPosition.x,u=-1===a.oldPosition.y?i.y:a.oldPosition.y,m=-1===a.oldPosition.z?i.z:a.oldPosition.z,g=h-d,f=p-u,y=c-m,w=t.hasComponent(ta)?new E(t.getComponent(ta).standSizeY,t.getComponent(ta).cluchSizeY):new E(0,0);if(a.through)return this.cancel(t,n);const x=0!==l.hit.x||0!==l.hit.z||n.hasBlockScaleVoxel(i.x,i.y,i.z,l.size.x+.1,l.size.y);if(a.enable&&!a.exec&&!a.through&&(0!==g||0!==f||0!==y)&&(!t.hasComponent(ta)||!t.getComponent(ta).enableCluch)&&(!t.hasComponent(na)||!t.getComponent(na).exec)&&(!t.hasComponent(aa)||!t.getComponent(aa).exec)&&(r.isAir||!t.hasComponent(jo)||0!==t.getComponent(jo).move.x||0!==t.getComponent(jo).move.z)&&(r.isHookShot||r.isAir||x&&(x!==a.oldHit||0!==r.axes.x.x||0!==r.axes.x.y))&&this.hasHitCamera(n)){const[e,x]=O(o.x,r.axes.x.x,r.axes.x.y),M=0===r.axes.x.x&&0===r.axes.x.y?o.x:W(e,x,0,0),[E,v]=O(M,0,l.size.x),b=P(g,f,y,0,0,0),[_,S]=N(g,f,y,0,0,0),k=Math.min(b,l.size.x/4,l.size.y/4,.5),[T,I,L]=A(_,S,0,0,1),z=n.getCamera();let D=0;for(;;){i.x=d+D*T,i.y=u+D*I,i.z=m+D*L;let e=i.x+E,o=i.z+v;const h=!n.hasBlockScaleVoxel(e,Math.floor(i.y+w.x),o,.001,.001),p=!n.hasBlockScaleVoxel(e,Math.floor(i.y+w.y),o,.001,.001),c=i.y+l.size.y;if(h||p){let s=-1,h=-1,p=-1;for(let t=w.x;t>0&&([s,h,p,,]=n.hitScanVoxel(0,Math.PI/2,e,i.y+t,o,t),!(-1!==h&&h>=i.y&&h<=c&&n.getVoxel(s,h,p)===li));t-=w.x/5)s=-1,h=-1,p=-1;const d=h;if(-1!==s&&-1!==h&&-1!==p&&!n.hasBlockScaleVoxel(i.x,d,i.z,.001,w.y)){const c=d,u=Ae(e,o,l.size.x,new Array);for(let t=0,i=0|u.length;t<i;t=t+2|0){const i=u[t],s=u[t+1];if(n.getVoxel(i,c,s)===li)continue;const[a,,r]=we(i,c,s,e,c,o,l.size.x,.001,((e,t,i)=>n.getVoxel(e,t,i)!==li));e+=a,o+=r}if(s=Math.floor(s),h=Math.floor(h-.999),p=Math.floor(p),(!n.hasBlockScaleVoxel(e,c,o,l.size.x,w.x)||!n.hasBlockScaleVoxel(e,c,o,l.size.x,w.y))&&(-1===a.grabPosition.x||-1===a.grabPosition.y||-1===a.grabPosition.z||Math.abs(a.grabPosition.x-s)>1||Math.abs(a.grabPosition.y-h)>1||Math.abs(a.grabPosition.z-p)>1)){const c=!n.hasBlockScaleVoxel(i.x,d-w.x,i.z,.001,w.x),u=!n.hasBlockScaleVoxel(i.x,d-w.y,i.z,.001,w.y);if(c||u){const u=G(M);let m=u===Math.PI?s+1+l.size.x/2:0===u?s-l.size.x/2:i.x,g=u===Math.PI/2*3?p+1+l.size.x/2:u===Math.PI/2?p-l.size.x/2:i.z;const f=d-(z.hasComponent(wi)?z.getComponent(wi).position.y:.5),y=Ae(m,g,l.size.x,new Array);for(let e=0,t=0|y.length;e<t;e=e+2|0){const t=y[e],i=y[e+1];if(n.getVoxel(t,d-1,i)===li)continue;const[s,,o]=we(t,d-1,i,m,f,g,l.size.x,l.size.y,((e,t,i)=>n.getVoxel(e,t,i)!==li));m+=s,g+=o}const x=z.hasComponent(Ya)?z.getComponent(Ya).cluchY:.5,E=z.hasComponent(Ya)?z.getComponent(Ya).standY:.5,[v,b]=N(e,d+.001,o,m,d+.001,g),_=P(e,d+.001,o,m,d+.001,g);if(!n.hasBlockScaleVoxel(m,d-x,g,.001,x)&&!n.hasBlockScaleVoxel(e,d+.5,o,.001,.001)&&n.hasBlockScaleVoxel(e,d-E,o,.001,E)&&!n.hasHitScanVoxel(v,b,m,d+.001,g,_)){if(a.start.x=i.x,a.start.y=i.y,a.start.z=i.z,a.end.y=f,n.hasBlockScaleVoxel(e,f,g,l.size.x,l.size.y)?n.hasBlockScaleVoxel(m,f,o,l.size.x,l.size.y)?(a.end.x=m,a.end.z=g):(a.end.x=m,a.end.z=o):(a.end.x=e,a.end.z=g),a.last.x=e,a.last.y=d,a.last.z=o,a.angle=n.hasBlockScaleVoxel(s+.5-Math.sign(s+.5-i.x),d-.5,p+.5,.001,.001)||n.hasBlockScaleVoxel(s+.5,d-.5,p+.5-Math.sign(p+.5-i.z)+.5,.001,.001)?G(W(s+.5,p+.5,m,g)):V(W(s+.5,p+.5,m,g)),a.blockPositionTop=d,a.time=0,a.exec=!0,a.grabPosition.x=s,a.grabPosition.y=h,a.grabPosition.z=p,c&&n.hasBlockScaleVoxel(a.last.x,a.last.y,a.last.z,l.size.x,w.x)?a.climb=!1:a.climb=n.hasBlockScaleVoxel(i.x,i.y,i.z,l.size.x,l.size.y)||d-i.y<=Math.ceil(w.x/2),a.climb){const e=new Mn("player-climb-sound"),[t,i]=O(a.angle,0,.375);e.position.x=z.position.x+t,e.position.y=z.position.y,e.position.z=z.position.z+i,n.createSound("./asset/sound/player/climb.mp3",e,"player-climb").play()}else{const e=new Mn("player-grab-sound"),[i,s]=O(a.angle,0,.375);e.position.x=z.position.x+i,e.position.y=z.position.y,e.position.z=z.position.z+s;const o=t.hasComponent(ds)?t.getComponent(ds).value:new C;if(n.createSound("./asset/sound/player/grab.mp3",e,"player-grab").setVolume(.25+Math.max(Math.abs(o.x),Math.abs(o.y),Math.abs(o.z))/.1*.75).play(),z.hasComponent(ea)){z.getComponent(ea).swais.push(new ra(.5,1,.05+.05*(t.hasComponent(ds)?Math.max(0,t.getComponent(ds).value.y/r.airValue):0),2,0))}}const u=t.hasComponent(ds)?t.getComponent(ds).value:new C;u.x=0,u.y=0,u.z=0;break}}}}}if(D>=b)break;D=Math.min(b,s(D+k,b,1e5,Math.ceil))}i.x=h,i.y=p,i.z=c}if(a.exec&&!a.climb){const{direction:e}=n.getCamera(),{position:i}=t,[s,o]=O(a.angle,0,1),h=!n.hasHitScanVoxelBold(e.x,0,i.x,i.y+l.size.y/2,i.z,.75*l.size.x,1.01),p=R(e.y,0)<-Math.PI/4&&!n.hasBlockScaleVoxel(a.last.x,0|a.last.y,a.last.z,.001,w.y)&&n.hasBlockScaleVoxel(a.last.x,0|a.last.y,a.last.z,.001,w.x)&&!n.hasBlockScaleVoxel(a.last.x,Math.ceil((0|a.last.y)+w.y)+1,a.last.z,.001,w.y)&&!n.hasBlockScaleVoxel(i.x,.5+(0|a.last.y),i.z,.99*l.size.x,w.x),[c,d]=O(t.direction.x,r.axes.x.x,r.axes.x.y),u=(0!==r.axes.x.x||0!==r.axes.x.y)&&H(W(c,d,0,0),a.angle)<Math.PI/4,m=!n.hasBlockScaleVoxel(.5+(0|a.last.x),.5+(0|a.last.y),.5+(0|a.last.z),.001,.001)&&(!n.hasBlockScaleVoxel(.5+(0|a.last.x),0|a.last.y,.5+(0|a.last.z),l.size.x,w.x)||!n.hasBlockScaleVoxel(.5+(0|a.last.x),0|a.last.y,.5+(0|a.last.z),l.size.x,w.y)&&(()=>{const e={},t=[{x:0|a.last.x,y:0|a.last.y,z:0|a.last.z}];for(e["".concat(t[0].x,",").concat(t[0].y,",").concat(t[0].z)]=!0;t.length>0;){const i=t.shift()||null;if(null===i)break;for(let s=0,o=0|Te.length;s<o;s=s+1|0){const[o,a,r]=Te[s],l=o+i.x|0,h=a+i.y|0,p=r+i.z|0,c="".concat(l,",").concat(h,",").concat(p);if(!e.hasOwnProperty(c))if(e[c]=!0,n.hasBlockScaleVoxel(l+.5,h+.5,p+.5,.01,.01)){const e=n.getVoxel(l+.5,h+.5,p+.5);let t=!1;if(t=a<0?t||ci.some((t=>e.top===t)):t||ci.some((t=>e.bottom===t)),t=0!==o?o<0?t||ci.some((t=>e.back===t)):t||ci.some((t=>e.front===t)):r<0?t||ci.some((t=>e.right===t)):t||ci.some((t=>e.left===t)),t)return!0}else if(n.hasBlockScaleVoxel(l+.5,h+.5-1,p+.5,.01,.01)){if(!n.hasBlockScaleVoxel(l+.5,0|h,p+.5,.01,w.x))return!0;t.push({x:l,y:h,z:p})}}}return!1})());a.standJump=h||p,a.canJump=(!m||!u)&&h||p,a.canClimb=m&&(!a.canJump||u),a.canThroug=!n.hasBlockScaleVoxel(.5+(0|a.last.x),.5+(0|a.last.y),.5+(0|a.last.z),.001,.001)&&n.hasBlockScaleVoxel(.5+(0|a.last.x),0|a.last.y,.5+(0|a.last.z),l.size.x,w.x)&&!n.hasBlockScaleVoxel(.5+(0|a.last.x),0|a.last.y,.5+(0|a.last.z),l.size.x,w.y)&&!n.hasBlockScaleVoxel(.5+(0|a.last.x)+s,.5+(0|a.last.y),.5+(0|a.last.z)+o,.001,.001)&&!a.canJump}else a.canJump=!1,a.canClimb=!1;a.exec&&(l.enable=!1),a.exec||r.isAir||t.hasComponent(Qo)&&t.getComponent(Qo).exec||(a.grabPosition.x=-1,a.grabPosition.y=-1,a.grabPosition.z=-1),a.oldHit=x,a.oldPosition.x=i.x,a.oldPosition.y=i.y,a.oldPosition.z=i.z}}class Va extends Bi{constructor(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];super(Ei,...t),this.animations={}}addAnimations(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];t.forEach((e=>{this.animations[e.name]=e}))}additional(e,t,n){const i=t.getComponent(Ei).value;if(!(null!==i&&i instanceof Oi&&i.hasComponent(Ei)))return;const s=i.getComponent(Ei).value;if(null===s)return;let o=s.hasComponent(Gi)?s.getComponent(Gi).state:"still";this.animations.hasOwnProperty(o)||(o="still"),"still"!==o&&this.animations.hasOwnProperty("still")&&this.animations.still.update(e,t,s,n,o),this.animations.hasOwnProperty(o)&&this.animations[o].update(e,t,s,n,o)}}function Xa(e,t,n,i){if(n.isCanShoot){if(t>0&&t<1||n.isHoldFire)return n.isChargeAttack?n.data.chargeFireMaterial:n.data.fireMaterial;if(e>0&&e<1)return n.data.cockingMaterial;if(n.isChargeEnable)return n.data.chargeMaterial;if(n.isChargeStart)return n.data.chargeWaitMaterial;if(n.data.isOutOfAmmoLower&&!n.isAmmo&&0===n.bullets.length)return n.data.emptyMaterial}return i}class ja{constructor(){this.name="still"}stopSound(e,t,n,i){(i||n!==ho)&&(e.hasSound("player-chain-".concat(t.inverse?"left":"right","-start"))&&e.getSound("player-chain-".concat(t.inverse?"left":"right","-start")).stop(),e.hasSound("player-chain-".concat(t.inverse?"left":"right","-loop"))&&e.getSound("player-chain-".concat(t.inverse?"left":"right","-loop")).stop(),e.hasSound("player-chain-".concat(t.inverse?"left":"right","-end"))&&e.getSound("player-chain-".concat(t.inverse?"left":"right","-end")).stop()),(i||n!==yo)&&e.hasSound("player-combobooster-".concat(t.inverse?"left":"right","-loop"))&&e.getSound("player-combobooster-".concat(t.inverse?"left":"right","-loop")).stop()}update(e,t,n,i,o){const a=n.getComponent(Fo),r=t.getComponent(os),l=t.getComponent(bn),h=t.getComponent(qo),p=t.getComponent(Fa),c=t.getComponent(Cn),d=n.getComponent(Gi),u=n.getComponent(ta);if(n.hasComponent(ia)){const e=n.getComponent(ia),t=e.isSprint;r.sprintStartTime=e.isTacticalSprint?-1:r.enableSprint!==t?r.time:r.sprintStartTime,r.enableSprint=t}let m=0;if(n.hasComponent(is)&&n.hasComponent(Uo)){const e=n.getComponent(is),t=n.getComponent(Uo);e.value.hasOwnProperty("combo")&&(m=Math.max(0,Math.min(1,(es(n,"combo")-t.start)/(t.max-t.start))))}const g=i.getCamera();p.hard=!0,p.blockX=0,p.speed=g.hasComponent(ea)?g.getComponent(ea).speed:1.5,p.mrotate=Math.PI/2*(.1-.05*m),p.slide=.25-.175*m,p.x=.125-.075*m,p.y=.125-.075*m,p.rotate=0,p.invert=!0,p.moveFix=!0,h.rotate=0,h.scale=1+.375*u.value,h.position.y=-.5-1*((r.inverse?0===a.leftWeapon.chargePar:0===a.rightWeapon.chargePar)?1-Math.min(1,(d.time-d.grabTime)/.1):0)+-.125*u.value;const f="grab"===o&&!!n.hasComponent(ss)&&n.getComponent(ss).exec&&!n.getComponent(ss).climb,y="grab"===o&&!!n.hasComponent(ss)&&!n.getComponent(ss).exec&&n.getComponent(ss).climb,w="grab"===o&&!!n.hasComponent(ss)&&n.getComponent(ss).canJump,x=!(n.hasComponent(ss)&&n.getComponent(ss).exec)&&((a.rightWeapon.data.grip||a.leftWeapon.data.grip?(!!a.rightWeapon.data.grip||a.rightWeapon.isAmmo)&&(!!a.leftWeapon.data.grip||a.leftWeapon.isAmmo):a.rightWeapon.isAmmo||a.leftWeapon.isAmmo)||(r.inverse?a.leftWeapon.bullets.length>0:a.rightWeapon.bullets.length>0));f||x||!n.hasComponent(ia)||!n.getComponent(ia).enableSprint&&!n.getComponent(ia).enableTacticalSprint||!n.hasComponent(na)||n.getComponent(na).exec||(p.speed=g.hasComponent(ea)?g.getComponent(ea).speed:1.75,p.slide=.5-.25*m,p.x=.5-.25*m,p.y=.5-.25*m);const[M,E,C,v,b,_]=as(n,t),S=(a.leftWeapon.data.shootType!==wo.SHIELD||a.rightWeapon.data.shootType!==wo.SHIELD)&&(a.leftWeapon.data.shootType===wo.SHIELD&&a.leftWeapon.isFire)!==(a.rightWeapon.data.shootType===wo.SHIELD&&a.rightWeapon.isFire);let k,T=0;r.inverse&&a.leftWeapon.data.flip?c.flip.x=!0:c.flip.x=!1,T=r.inverse?a.leftWeapon.chargePar:a.rightWeapon.chargePar,k=r.inverse?Xa(v,b,a.leftWeapon,a.leftWeapon.data.stillMaterial):Xa(v,b,a.rightWeapon,a.rightWeapon.data.stillMaterial);const P=a.isLeftChange&&(r.inverse?0!==a.leftChangeTime&&d.time-a.leftChangeTime<.5:"hand"===a.right&&a.rightWeapon.data.grip&&a.left!==a.right),I=a.isRightChange&&(r.inverse?"hand"===a.left&&a.leftWeapon.data.grip&&a.left!==a.right:0!==a.rightChangeTime&&d.time-a.rightChangeTime<.5);if(f&&!w||!(M||S||f&&w)){if(r.inverse){if(p.add=.25,!P||t.hasComponent(ia)&&(n.getComponent(ia).enableSprint||n.getComponent(ia).enableTacticalSprint)||f&&!y)h.position.x=(a.leftWeapon.data.grip?.375:.25)+.125*u.value;else{if(l.position.x=h.position.x=.75+.125*u.value,l.position.y=h.position.y=-.125*u.value-1.5,a.leftWeapon.data.changeAnimationType===_o)l.position.y=h.position.y+=.25,l.rotate=h.rotate=2*Math.PI*.5,l.scale=h.scale=2;h.position.x=(a.leftWeapon.data.grip?.375:.25)+.125*u.value,h.position.y=-.125*u.value-.5,a.leftBob=!1}switch(o){case"still":case"sliding":case"jump":case"grab":case"wallrun":if(n.hasComponent(oa)){const e=n.getComponent(oa),t=!a.leftWeapon.data.isOutOfAmmoLower||a.leftWeapon.isAmmo||a.leftWeapon.bullets.length>0,i=Math.max(e.cameraValue,t?0:1);h.position.y-=.5*i,h.position.x+=.25*i,h.scale+=.5*i,t||(k=a.leftWeapon.data.cockingMaterial)}}h.isRotateCenter=!!a.leftWeapon.data.isRotateCenter}else{if(p.add=0,!I||t.hasComponent(ia)&&(n.getComponent(ia).enableSprint||n.getComponent(ia).enableTacticalSprint)||f&&!y)h.position.x=(a.rightWeapon.data.grip?-.375:-.25)+-.125*u.value;else{if(l.position.x=h.position.x=-.125*u.value-.75,l.position.y=h.position.y=-.125*u.value-1.5,a.rightWeapon.data.changeAnimationType===_o)l.position.y=h.position.y+=.25,l.rotate=h.rotate=2*-Math.PI*.5,l.scale=h.scale=2;h.position.x=(a.rightWeapon.data.grip?-.375:-.25)+-.125*u.value,h.position.y=-.125*u.value-.5,a.rightBob=!1}switch(o){case"still":case"sliding":case"jump":case"grab":case"wallrun":if(n.hasComponent(oa)){const e=n.getComponent(oa),t=!a.rightWeapon.data.isOutOfAmmoLower||a.rightWeapon.isAmmo||a.rightWeapon.bullets.length>0,i=Math.max(e.cameraValue,t?0:1);h.position.y-=.5*i,h.position.x-=.25*i,h.scale+=.5*i,t||(k=a.rightWeapon.data.cockingMaterial)}}h.isRotateCenter=!!a.rightWeapon.data.isRotateCenter}if(n.hasComponent(aa)){const e=n.getComponent(aa);h.position.x-=-.075*e.value.x}}else{if(p.add=0,P&&(!a.leftWeapon.data.grip&&a.rightWeapon.data.grip||r.inverse&&a.leftWeapon.data.shootType!==wo.SHIELD)&&(!f||y))switch(l.position.x=h.position.x=.75+.25*u.value,l.position.y=h.position.y=-.125*u.value-1.5,a.leftWeapon.data.changeAnimationType){case vo:l.rotate=h.rotate=2*Math.PI*.25;break;case bo:r.inverse?l.rotate=h.rotate=2*Math.PI*.25:(l.position.y=h.position.y+=.25,l.position.x=h.position.x=-.25);break;case _o:r.inverse?(l.position.y=h.position.y+=.25,l.rotate=h.rotate=2*Math.PI*.5,l.scale=h.scale=2):l.rotate=h.rotate=2*Math.PI*.25}if(I&&(a.leftWeapon.data.grip&&!a.rightWeapon.data.grip||!r.inverse&&a.rightWeapon.data.shootType!==wo.SHIELD)&&(!f||y))switch(l.position.x=h.position.x=-.25*u.value-.75,l.position.y=h.position.y=-.125*u.value-1.5,a.rightWeapon.data.changeAnimationType){case vo:l.rotate=h.rotate=2*-Math.PI*.25;break;case bo:r.inverse?(l.position.y=h.position.y+=.25,l.position.x=h.position.x=.25):l.rotate=h.rotate=2*-Math.PI*.25;break;case _o:r.inverse?l.rotate=h.rotate=2*-Math.PI*.25:(l.position.y=h.position.y+=.25,l.rotate=h.rotate=2*-Math.PI*.5,l.scale=h.scale=2)}else h.position.x=0;if(r.inverse?(l.position.z=h.position.z=a.leftWeapon.data.grip||a.leftWeapon.data.shootType===wo.SHIELD?.025:.005,h.isRotateCenter=!0):(l.position.z=h.position.z=a.rightWeapon.data.grip||a.rightWeapon.data.shootType===wo.SHIELD?.025:.005,h.isRotateCenter=!0),!a.leftWeapon.data.grip&&a.rightWeapon.data.grip)switch(o){case"still":case"sliding":case"jump":case"wallrun":if(n.hasComponent(oa)){const e=n.getComponent(oa),t=!a.leftWeapon.data.isOutOfAmmoLower||a.leftWeapon.isAmmo||a.leftWeapon.bullets.length>0,i=v>0&&v<1||a.rightWeapon.chargePar>0?0:Math.max(e.cameraValue,t?0:1);h.position.y-=.25*i,h.scale+=.5*i,h.rotate+=.25*Math.PI*i}}else if(a.leftWeapon.data.grip&&!a.rightWeapon.data.grip)switch(o){case"still":case"sliding":case"jump":case"wallrun":if(n.hasComponent(oa)){const e=n.getComponent(oa),t=!a.rightWeapon.data.isOutOfAmmoLower||a.rightWeapon.isAmmo||a.rightWeapon.bullets.length>0,i=v>0&&v<1||a.leftWeapon.chargePar>0?0:Math.max(e.cameraValue,t?0:1);h.position.y-=.25*i,h.scale+=.5*i,h.rotate-=.25*Math.PI*i}}if(n.hasComponent(aa)){const e=n.getComponent(aa);h.position.x-=-.175*e.value.x}}if("grab"!==o&&"sliding"!==o)if(-1!==d.landingTime){const e=d.landingTime;h.scale-=.25*(1-Math.min(1,(d.time-e)/.5))*(-R(0,n.direction.y)/(Math.PI/2)),h.position.y-=.1*(1-Math.min(1,(d.time-e)/.5))*(R(0,n.direction.y)/(Math.PI/2)),M||S||(h.position.x-=.1*(1-Math.min(1,(d.time-e)/.5))*(R(0,n.direction.y)/(Math.PI/2))*(r.inverse?-1:1));const t=H(0,n.direction.y)/(Math.PI/2);h.position.y-=d.landingForce/1.5*.5*(t<0?3:1)*(1-Math.min(1,(d.time-e)/.5))*(1-t)}else if(n.hasComponent(Qo)){const e=n.getComponent(Qo);if(-1!==e.time){const{time:t}=e;h.scale-=.125*(1-Math.min(1,(d.time-t)/.5))*(-R(0,n.direction.y)/(Math.PI/2)),h.position.y-=.05*(1-Math.min(1,(d.time-t)/.5))*(R(0,n.direction.y)/(Math.PI/2)),M||S||(h.position.x-=.05*(1-Math.min(1,(d.time-t)/.5))*(R(0,n.direction.y)/(Math.PI/2))*(r.inverse?-1:1));const i=H(0,n.direction.y)/(Math.PI/2);h.position.y-=.25*(i<0?3:1)*(1-Math.min(1,(d.time-t)/.5))*(1-i)}}if((r.inverse?0!==a.leftWeapon.bullets.length:0!==a.rightWeapon.bullets.length)||(r.inverse?0!==a.leftWeapon.chargePar||!a.leftWeapon.data.grip||a.rightWeapon.data.isHave||a.leftWeapon.isFire:0!==a.rightWeapon.chargePar||!a.rightWeapon.data.grip||a.leftWeapon.data.isHave||a.rightWeapon.isFire)||(h.position.y-=1),a.isCanShoot)if((r.inverse?a.leftWeapon.isHoldFire:a.rightWeapon.isHoldFire)||v>0&&v<1)switch(r.fireTime=r.time,C){case io:{let e=0;if(e=(r.inverse?a.leftWeapon.isChargeAttack:a.rightWeapon.isChargeAttack)?Math.min(1,4*v):Math.sin(v*Math.PI),h.position.y=-.625*(1-e)-.125,h.scale-=.25*(1-e),r.inverse?(h.position.x=.5-.375*e,h.rotate-=Math.PI/16+Math.PI/4*(1-e)):(h.position.x=.375*e-.5,h.rotate+=Math.PI/16+Math.PI/4*(1-e)),n.hasComponent(aa)){const t=n.getComponent(aa);h.position.x-=-.075*t.value.x*e}l.position.x=h.position.x,l.position.y=h.position.y,l.rotate=h.rotate,r.inverse?c.material=a.leftWeapon.isChargeAttack?a.leftWeapon.data.chargeFireMaterial:a.leftWeapon.data.fireMaterial:c.material=a.rightWeapon.isChargeAttack?a.rightWeapon.data.chargeFireMaterial:a.rightWeapon.data.fireMaterial;break}case oo:{const e=Math.min(1,4*v);if(h.position.y=-.1825*(1-e)-.125,h.scale=.75,r.inverse?(h.position.x=.25*e,h.rotate=-Math.PI/8):(h.position.x=-.25*e,h.rotate=Math.PI/8),n.hasComponent(aa)){const t=n.getComponent(aa);h.position.x-=-.075*t.value.x*e}l.position.x=h.position.x,l.position.y=h.position.y,l.rotate=h.rotate,r.inverse?c.material=e<.5?a.leftWeapon.data.cockingMaterial:a.leftWeapon.data.fireMaterial:c.material=e<.5?a.rightWeapon.data.cockingMaterial:a.rightWeapon.data.fireMaterial;break}case go:{const e=Math.sin(v*(Math.PI/2));h.position.y-=.5*e,h.scale+=.75*e,r.inverse?h.position.x+=.25*e:h.position.x-=.25*e;break}case fo:r.inverse?c.material=a.leftWeapon.data.fireMaterial:c.material=a.rightWeapon.data.fireMaterial;break;case so:r.inverse?c.material=es(n,a.leftWeapon.data.ammoType||"none")>0?a.leftWeapon.data.fireMaterial:a.leftWeapon.data.cockingMaterial:c.material=es(n,a.rightWeapon.data.ammoType||"none")>0?a.rightWeapon.data.fireMaterial:a.rightWeapon.data.cockingMaterial;break;case yo:if(h.isRotateCenter=!1,v<.425)r.isFireAnimation||(r.isFireAnimation=!0,l.position.y=-1.5,r.inverse?(l.position.x=.25,l.rotate=-.5*Math.PI):(l.position.x=-.25,l.rotate=.5*Math.PI)),h.position.y+=.25,r.inverse?h.position.x=.25:h.position.x=-.25,r.inverse?c.material=a.leftWeapon.data.stillMaterial:c.material=a.rightWeapon.data.stillMaterial;else if(v<.75){i.hasSound("player-combobooster-".concat(r.inverse?"left":"right","-fire"))||(i.createSound("./asset/sound/weapon/combobooster-fire.mp3",null,"player-combobooster-".concat(r.inverse?"left":"right","-fire")).setVolume(5).play(!0),p.swais.push(new ra(.25,1,.75,1,0)));const e=Math.min(1,(v-.425)/.25);i.hasSound("player-combobooster-".concat(r.inverse?"left":"right","-loop"))?i.getSound("player-combobooster-".concat(r.inverse?"left":"right","-loop")).setVolume(e):i.createSound("./asset/sound/weapon/combobooster-loop.mp3",null,"player-combobooster-".concat(r.inverse?"left":"right","-loop")).setVolume(e).play(!0),h.position.y+=.25,r.inverse?h.position.x=.25:h.position.x=-.25,r.inverse?c.material=a.leftWeapon.data.fireMaterial:c.material=a.rightWeapon.data.fireMaterial}else if(v<.9)h.position.y+=.25,r.inverse?h.position.x=.25:h.position.x=-.25,r.inverse?c.material=a.leftWeapon.data.fireMaterial:c.material=a.rightWeapon.data.fireMaterial;else{const e=Math.min(1,(v-.9)/.1);h.position.x+=.25*("right"===E?-1:1)+1.5*("right"===E?1:-1)*e,h.position.y+=.25+-1.75*e,h.rotate+=(.25*Math.PI+.125*Math.PI*e)*("right"===E?-1:1),h.scale+=.5+.5*e,r.inverse?c.material=a.leftWeapon.data.fireMaterial:c.material=a.rightWeapon.data.fireMaterial}break;case ao:r.inverse?c.material=a.leftWeapon.data.fireMaterial:c.material=a.rightWeapon.data.fireMaterial;break;case ro:{let e=Xa(v,b,a.leftWeapon,k),t=Xa(v,b,a.rightWeapon,k);r.inverse?c.material="right"===E&&a.leftWeapon.data.grip?a.leftWeapon.data.gripMaterial:e:c.material="left"===E&&a.rightWeapon.data.grip?a.rightWeapon.data.gripMaterial:t;let i=Math.sin(v*Math.PI),s=!1;(M&&("right"===E&&t===a.rightWeapon.data.cockingMaterial||"left"===E&&e===a.leftWeapon.data.cockingMaterial)||c.material===(r.inverse?a.leftWeapon.data.cockingMaterial:a.rightWeapon.data.cockingMaterial))&&!r.isFireAnimation&&(r.isFireAnimation=!0,i=1,s=!0),v<.5&&!r.isFireAnimation&&(i=0);const o=.125,p=l.position.x,d=l.position.y,u=h.position.x,m=h.position.y;if(h.position.y-=o*i,h.scale+=2.5*o*i,M||S?!a.leftWeapon.data.grip&&a.rightWeapon.data.grip?(h.position.x+=.125*o*i,h.rotate+=o*Math.PI*.25*i):a.leftWeapon.data.grip&&!a.rightWeapon.data.grip&&(h.position.x-=.125*o*i,h.rotate-=o*Math.PI*.25*i):r.inverse?(h.position.x+=o*i,h.rotate+=o*Math.PI*.25*i):(h.position.x-=o*i,h.rotate-=o*Math.PI*.25*i),n.hasComponent(aa)){const e=n.getComponent(aa);h.position.x-=e.value.x*o*-.25*i}s&&(l.position.x=p+(h.position.x-u),l.position.y=d+(h.position.y-m));break}case lo:{let e=Xa(v,b,a.leftWeapon,k),t=Xa(v,b,a.rightWeapon,k);r.inverse?c.material="right"===E&&a.leftWeapon.data.grip?a.leftWeapon.data.gripMaterial:e:c.material="left"===E&&a.rightWeapon.data.grip?a.rightWeapon.data.gripMaterial:t;let i=Math.min(1,Math.sin(v*Math.PI)),s=!1;(M&&("right"===E&&t===a.rightWeapon.data.cockingMaterial||"left"===E&&e===a.leftWeapon.data.cockingMaterial)||c.material===(r.inverse?a.leftWeapon.data.cockingMaterial:a.rightWeapon.data.cockingMaterial))&&!r.isFireAnimation&&(r.isFireAnimation=!0,i=1,s=!0),v<.5&&!r.isFireAnimation&&(i=0),r.isFireAnimation||(i=M&&("right"===E&&t===a.rightWeapon.data.cockingMaterial||"left"===E&&e===a.leftWeapon.data.cockingMaterial)||c.material===(r.inverse?a.leftWeapon.data.cockingMaterial:a.rightWeapon.data.cockingMaterial)?1:0);const o=.25,p=l.position.x,d=l.position.y,u=h.position.x,m=h.position.y;if(h.position.y-=2*o*i,h.scale+=4*o*i,h.isRotateCenter=!1,M||S?!a.leftWeapon.data.grip&&a.rightWeapon.data.grip||a.leftWeapon.data.shootType!==wo.SHIELD&&a.rightWeapon.data.shootType===wo.SHIELD?(h.position.x+=.5*o*i,h.rotate-=.175*Math.PI*i):(a.leftWeapon.data.grip&&!a.rightWeapon.data.grip||a.leftWeapon.data.shootType===wo.SHIELD&&a.rightWeapon.data.shootType!==wo.SHIELD)&&(h.position.x-=.5*o*i,h.rotate+=.175*Math.PI*i):r.inverse?(h.position.x+=o*i,h.rotate-=.175*Math.PI*i):(h.position.x-=o*i,h.rotate+=.175*Math.PI*i),n.hasComponent(aa)){const e=n.getComponent(aa);h.position.x-=e.value.x*o*-.25*i}s&&(l.position.x=p+(h.position.x-u),l.position.y=d+(h.position.y-m));break}case ho:{i.hasSound("player-chain-".concat(r.inverse?"left":"right","-start"))&&i.getSound("player-chain-".concat(r.inverse?"left":"right","-start")).stop(),i.hasSound("player-chain-".concat(r.inverse?"left":"right","-end"))&&i.getSound("player-chain-".concat(r.inverse?"left":"right","-end")).stop(),i.hasSound("player-chain-".concat(r.inverse?"left":"right","-loop"))||i.createSound("./asset/sound/weapon/chainshotgun-loop.wav",null,"player-chain-".concat(r.inverse?"left":"right","-loop")).setVolume(5).play(!0);let e,t=Xa(v,b,a.leftWeapon,k),s=Xa(v,b,a.rightWeapon,k);if(e=r.inverse?a.leftWeapon.data.grip?a.leftWeapon.data.gripMaterial:t:a.rightWeapon.data.grip?a.rightWeapon.data.gripMaterial:s,r.inverse?e===a.leftWeapon.data.cockingMaterial:e===a.rightWeapon.data.cockingMaterial){const t=.1,n=r.time%t>t/2;e=r.inverse?n?a.leftWeapon.data.stillMaterial:a.leftWeapon.data.cockingMaterial:n?a.rightWeapon.data.stillMaterial:a.rightWeapon.data.cockingMaterial}c.material=e;let o=Math.sin(v*Math.PI),p=!1;(M&&("right"===E&&s===a.rightWeapon.data.cockingMaterial||"left"===E&&t===a.leftWeapon.data.cockingMaterial)||c.material===(r.inverse?a.leftWeapon.data.cockingMaterial:a.rightWeapon.data.cockingMaterial))&&!r.isFireAnimation&&(r.isFireAnimation=!0,o=1,p=!0),v<.5&&!r.isFireAnimation&&(o=0),r.spinPar=1,r.spinTime=r.time;const d=.125,u=l.position.x,m=l.position.y,g=h.position.x,f=h.position.y;if(h.position.y-=d*o,h.scale+=2*d*o,M||S?!a.leftWeapon.data.grip&&a.rightWeapon.data.grip?(h.position.x+=.5*d*o,h.rotate+=d*Math.PI*.25*o):a.leftWeapon.data.grip&&!a.rightWeapon.data.grip&&(h.position.x-=.5*d*o,h.rotate-=d*Math.PI*.25*o):r.inverse?(h.position.x+=.5*d*o,h.rotate-=d*Math.PI*.125*o):(h.position.x-=.5*d*o,h.rotate+=d*Math.PI*.125*o),n.hasComponent(aa)){const e=n.getComponent(aa);h.position.x-=e.value.x*d*-.25*o}p&&(l.position.x=u+(h.position.x-g),l.position.y=m+(h.position.y-f));break}case po:if(v<.425){i.hasSound("player-cock")&&i.getSound("player-cock").stop();let e=Xa(v,b,a.leftWeapon,k),t=Xa(v,b,a.rightWeapon,k);r.inverse?c.material="right"===E&&a.leftWeapon.data.grip?a.leftWeapon.data.gripMaterial:e:c.material="left"===E&&a.rightWeapon.data.grip?a.rightWeapon.data.gripMaterial:t;const s=v/.425;let o=Math.sin(s*Math.PI),p=!1;(M&&("right"===E&&t===a.rightWeapon.data.cockingMaterial||"left"===E&&e===a.leftWeapon.data.cockingMaterial)||c.material===(r.inverse?a.leftWeapon.data.cockingMaterial:a.rightWeapon.data.cockingMaterial))&&!r.isFireAnimation&&(r.isFireAnimation=!0,o=1,p=!0),v<.5&&!r.isFireAnimation&&(o=0);const d=l.position.x,u=l.position.y,m=h.position.x,g=h.position.y,f=.25;if(h.position.y-=f*o,h.scale+=2*f*o,M||S){const e=.125;!a.leftWeapon.data.grip&&a.rightWeapon.data.grip?(h.position.x+=.5*e*o,h.rotate+=e*Math.PI*.25*o):a.leftWeapon.data.grip&&!a.rightWeapon.data.grip&&(h.position.x-=.5*e*o,h.rotate-=e*Math.PI*.25*o)}else{const e=.25;r.inverse?(h.position.x+=.5*e*o,h.rotate-=e*Math.PI*.125*o):(h.position.x-=.5*e*o,h.rotate+=e*Math.PI*.125*o)}if(n.hasComponent(aa)){const e=n.getComponent(aa);h.position.x-=e.value.x*f*-.25*o}p&&(l.position.x=d+(h.position.x-m),l.position.y=u+(h.position.y-g))}else v<.625?(i.hasSound("player-cock")&&i.getSound("player-cock").stop(),r.inverse?c.material=a.leftWeapon.data.grip?a.leftWeapon.data.gripMaterial:a.leftWeapon.data.cockingMaterial:c.material=a.rightWeapon.data.grip?a.rightWeapon.data.gripMaterial:a.rightWeapon.data.cockingMaterial):(i.hasSound("player-cock")||i.createSound("./asset/sound/weapon/launcher-pump.mp3",null,"player-cock").play(),r.inverse?c.material=a.leftWeapon.data.grip?a.leftWeapon.data.gripMaterial:a.leftWeapon.data.cockingMaterial:c.material=a.rightWeapon.data.grip?a.rightWeapon.data.gripMaterial:a.rightWeapon.data.cockingMaterial);break;case co:if(v<.425){i.hasSound("player-cock")&&i.getSound("player-cock").stop();let e=a.leftWeapon.data.fireMaterial,t=a.rightWeapon.data.fireMaterial;r.inverse?c.material="right"===E&&a.leftWeapon.data.grip?a.leftWeapon.data.gripMaterial:e:c.material="left"===E&&a.rightWeapon.data.grip?a.rightWeapon.data.gripMaterial:t;const s=v/.425;let o=Math.sin(s*Math.PI),p=!1;(M&&("right"===E&&t===a.rightWeapon.data.cockingMaterial||"left"===E&&e===a.leftWeapon.data.cockingMaterial)||c.material===(r.inverse?a.leftWeapon.data.cockingMaterial:a.rightWeapon.data.cockingMaterial))&&!r.isFireAnimation&&(r.isFireAnimation=!0,o=1,p=!0),v<.5&&!r.isFireAnimation&&(o=0);const d=.125,u=l.position.x,m=l.position.y,g=h.position.x,f=h.position.y;if(h.isRotateCenter=!1,h.position.y-=d*o,h.scale+=2*d*o,n.hasComponent(aa)){const e=n.getComponent(aa);h.position.x-=e.value.x*d*-.25*o}p&&(l.position.x=u+(h.position.x-g),l.position.y=m+(h.position.y-f))}else if(v<.625){const e=.125,t=-.0625,n=.1*Math.PI;i.hasSound("player-cock")&&i.getSound("player-cock").stop(),h.isRotateCenter=!1,h.position.y+=e,h.position.x+=t*("right"===E?1:-1),h.rotate+=n*("right"===E?1:-1),r.inverse?c.material=a.leftWeapon.data.grip?a.leftWeapon.data.gripMaterial:a.leftWeapon.data.fireMaterial:c.material=a.rightWeapon.data.grip?a.rightWeapon.data.gripMaterial:a.rightWeapon.data.fireMaterial}else{i.hasSound("player-cock")||i.createSound("./asset/sound/weapon/launcher-pump.mp3",null,"player-cock").play();const e=Math.min(1,1.5*Math.sin(Math.min(1,(v-.625)/.375)*(Math.PI/2))),t=.375;if(h.position.y-=t*e,h.scale+=2*t*e,M||S){const t=.25;!a.leftWeapon.data.grip&&a.rightWeapon.data.grip?(h.position.x+=.5*t*e,h.rotate+=t*Math.PI*.25*e):a.leftWeapon.data.grip&&!a.rightWeapon.data.grip&&(h.position.x-=.5*t*e,h.rotate-=t*Math.PI*.25*e)}else r.inverse?(h.position.x+=.5*t*e,h.rotate-=t*Math.PI*.125*e):(h.position.x-=.5*t*e,h.rotate+=t*Math.PI*.125*e);if(n.hasComponent(aa)){const t=n.getComponent(aa);h.position.x-=-.25*t.value.x*e}r.inverse?c.material=a.leftWeapon.data.grip?a.leftWeapon.data.gripMaterial:a.leftWeapon.data.stillMaterial:c.material=a.rightWeapon.data.grip?a.rightWeapon.data.gripMaterial:a.rightWeapon.data.stillMaterial}b<1&&(r.inverse?c.material=a.leftWeapon.data.grip?a.leftWeapon.data.gripMaterial:a.leftWeapon.data.fireMaterial:c.material=a.rightWeapon.data.grip?a.rightWeapon.data.gripMaterial:a.rightWeapon.data.cockingMaterial);break;case uo:if(v<.425){i.hasSound("player-cock")&&i.getSound("player-cock").stop();let e=Xa(v,b,a.leftWeapon,k),t=Xa(v,b,a.rightWeapon,k);r.inverse?c.material="right"===E&&a.leftWeapon.data.grip?a.leftWeapon.data.gripMaterial:e:c.material="left"===E&&a.rightWeapon.data.grip?a.rightWeapon.data.gripMaterial:t;const s=v/.425;let o=Math.sin(s*Math.PI),p=!1;(M&&("right"===E&&t===a.rightWeapon.data.cockingMaterial||"left"===E&&e===a.leftWeapon.data.cockingMaterial)||c.material===(r.inverse?a.leftWeapon.data.cockingMaterial:a.rightWeapon.data.cockingMaterial))&&!r.isFireAnimation&&(r.isFireAnimation=!0,o=1,p=!0),v<.5&&!r.isFireAnimation&&(o=0);const d=.25,u=l.position.x,m=l.position.y,g=h.position.x,f=h.position.y;if(h.position.y-=d*o,h.scale+=2*d*o,M||S?!a.leftWeapon.data.grip&&a.rightWeapon.data.grip?(h.position.x+=.5*d*o,h.rotate+=d*Math.PI*.25*o):a.leftWeapon.data.grip&&!a.rightWeapon.data.grip&&(h.position.x-=.5*d*o,h.rotate-=d*Math.PI*.25*o):r.inverse?(h.position.x+=.5*d*o,h.rotate-=d*Math.PI*.125*o):(h.position.x-=.5*d*o,h.rotate+=d*Math.PI*.125*o),n.hasComponent(aa)){const e=n.getComponent(aa);h.position.x-=e.value.x*d*-.25*o}p&&(l.position.x=u+(h.position.x-g),l.position.y=m+(h.position.y-f))}else v<.625?(i.hasSound("player-cock")&&i.getSound("player-cock").stop(),r.inverse?c.material=a.leftWeapon.data.grip?a.leftWeapon.data.gripMaterial:a.leftWeapon.data.cockingMaterial:c.material=a.rightWeapon.data.grip?a.rightWeapon.data.gripMaterial:a.rightWeapon.data.cockingMaterial):(i.hasSound("player-cock")||i.createSound("./asset/sound/weapon/heavycannon-pump.mp3",null,"player-cock").play(),r.inverse?c.material=a.leftWeapon.data.grip?a.leftWeapon.data.gripMaterial:a.leftWeapon.data.cockingMaterial:c.material=a.rightWeapon.data.grip?a.rightWeapon.data.gripMaterial:a.rightWeapon.data.cockingMaterial);b<1&&(r.inverse?c.material=a.leftWeapon.data.grip?a.leftWeapon.data.gripMaterial:a.leftWeapon.data.fireMaterial:c.material=a.rightWeapon.data.grip?a.rightWeapon.data.gripMaterial:a.rightWeapon.data.fireMaterial);break;case mo:if(v<.425){i.hasSound("player-cock")&&i.getSound("player-cock").stop();let e=Xa(v,b,a.leftWeapon,k),t=Xa(v,b,a.rightWeapon,k);r.inverse?c.material="right"===E&&a.leftWeapon.data.grip?a.leftWeapon.data.gripMaterial:e:c.material="left"===E&&a.rightWeapon.data.grip?a.rightWeapon.data.gripMaterial:t;const s=v/.425;let o=Math.sin(s*Math.PI),p=!1;(M&&("right"===E&&t===a.rightWeapon.data.cockingMaterial||"left"===E&&e===a.leftWeapon.data.cockingMaterial)||c.material===(r.inverse?a.leftWeapon.data.cockingMaterial:a.rightWeapon.data.cockingMaterial))&&!r.isFireAnimation&&(r.isFireAnimation=!0,o=1,p=!0),v<.5&&!r.isFireAnimation&&(o=0);const d=.125,u=-.0625,m=.1*Math.PI,g=l.position.x,f=l.position.y,y=h.position.x,w=h.position.y;if(h.isRotateCenter=!1,h.position.y+=d*o,h.position.x+=u*("right"===E?1:-1)*o,h.rotate+=m*("right"===E?1:-1)*o,h.scale+=2*d*o,n.hasComponent(aa)){const e=n.getComponent(aa);h.position.x-=e.value.x*d*-.25*o}r.inverse?c.material=a.leftWeapon.data.grip?a.leftWeapon.data.gripMaterial:a.leftWeapon.data.stillMaterial:c.material=a.rightWeapon.data.grip?a.rightWeapon.data.gripMaterial:a.rightWeapon.data.stillMaterial,p&&(l.position.x=g+(h.position.x-y),l.position.y=f+(h.position.y-w))}else if(v<.625){const e=.125,t=-.0625,n=.1*Math.PI;i.hasSound("player-cock")&&i.getSound("player-cock").stop(),h.isRotateCenter=!1,h.position.y+=e,h.position.x+=t*("right"===E?1:-1),h.rotate+=n*("right"===E?1:-1),r.inverse?c.material=a.leftWeapon.data.grip?a.leftWeapon.data.gripMaterial:a.leftWeapon.data.stillMaterial:c.material=a.rightWeapon.data.grip?a.rightWeapon.data.gripMaterial:a.rightWeapon.data.stillMaterial}else{i.hasSound("player-cock")||i.createSound("./asset/sound/weapon/shotgun-pump.mp3",null,"player-cock").play();const e=Math.min(1,1.5*Math.sin(Math.min(1,(v-.625)/.375)*(Math.PI/2))),t=.375;if(h.position.y-=t*e,h.scale+=2*t*e,M||S){const t=.25;!a.leftWeapon.data.grip&&a.rightWeapon.data.grip?(h.position.x+=.5*t*e,h.rotate+=t*Math.PI*.25*e):a.leftWeapon.data.grip&&!a.rightWeapon.data.grip&&(h.position.x-=.5*t*e,h.rotate-=t*Math.PI*.25*e)}else r.inverse?(h.position.x+=.5*t*e,h.rotate-=t*Math.PI*.125*e):(h.position.x-=.5*t*e,h.rotate+=t*Math.PI*.125*e);if(n.hasComponent(aa)){const t=n.getComponent(aa);h.position.x-=-.25*t.value.x*e}r.inverse?c.material=a.leftWeapon.data.grip?a.leftWeapon.data.gripMaterial:a.leftWeapon.data.cockingMaterial:c.material=a.rightWeapon.data.grip?a.rightWeapon.data.gripMaterial:a.rightWeapon.data.cockingMaterial}b<1&&(r.inverse?c.material=a.leftWeapon.data.grip?a.leftWeapon.data.gripMaterial:a.leftWeapon.data.fireMaterial:c.material=a.rightWeapon.data.grip?a.rightWeapon.data.gripMaterial:a.rightWeapon.data.fireMaterial)}else{let e=k;switch(C){case io:if(h.position.y-=.5*T,M||S||(r.inverse?h.position.x+=.25*T:h.position.x-=.25*T),(a.leftWeapon.isChargeEnable||a.rightWeapon.isChargeEnable)&&(r.inverse?c.material=a.leftWeapon.data.chargeMaterial:c.material=a.rightWeapon.data.chargeMaterial,a.leftWeapon.isChargeEnable&&r.inverse||a.rightWeapon.isChargeEnable&&!r.inverse)){const e=.05+.075*(r.inverse?a.leftWeapon.chargePar:a.rightWeapon.chargePar);h.position.x+=Math.sin(d.time%.075/.075*(Math.PI/2))*e,h.position.y+=Math.cos(d.time%.1/.1*(Math.PI/2))*e}break;case ho:if(_>0)if(r.inverse?a.leftWeapon.isChargeEnable:a.rightWeapon.isChargeEnable){i.hasSound("player-chain-".concat(r.inverse?"left":"right","-loop"))&&i.getSound("player-chain-".concat(r.inverse?"left":"right","-loop")).stop(),i.hasSound("player-chain-".concat(r.inverse?"left":"right","-end"))&&i.getSound("player-chain-".concat(r.inverse?"left":"right","-end")).stop(),i.hasSound("player-chain-".concat(r.inverse?"left":"right","-start"))||i.createSound("./asset/sound/weapon/chainshotgun-start.wav",null,"player-chain-".concat(r.inverse?"left":"right","-start")).setVolume(5).play();const t=.25-.15*_,n=r.time%1%t>t/2;e=r.inverse?n?a.leftWeapon.data.cockingMaterial:a.leftWeapon.data.stillMaterial:n?a.rightWeapon.data.cockingMaterial:a.rightWeapon.data.stillMaterial,r.spinPar=_,r.spinTime=r.time}else{i.hasSound("player-chain-".concat(r.inverse?"left":"right","-start"))&&i.getSound("player-chain-".concat(r.inverse?"left":"right","-start")).stop(),i.hasSound("player-chain-".concat(r.inverse?"left":"right","-end"))||i.createSound("./asset/sound/weapon/chainshotgun-end.wav",null,"player-chain-".concat(r.inverse?"left":"right","-end")).setVolume(5).play(!0);const t=r.inverse?a.leftWeapon.data.chargeTime:a.rightWeapon.data.chargeTime,n=Math.min(1,(r.time-r.spinTime)/(2*t));let s=0;r.time-r.spinTime<r.spinPar*t*2&&(s=.1+.15*n);const o=r.time%1%s>s/2;e=r.inverse?o?a.leftWeapon.data.cockingMaterial:a.leftWeapon.data.stillMaterial:o?a.rightWeapon.data.cockingMaterial:a.rightWeapon.data.stillMaterial}break;case yo:i.hasSound("player-combobooster-".concat(r.inverse?"left":"right","-loop"))&&i.getSound("player-combobooster-".concat(r.inverse?"left":"right","-loop")).stop()}M||S?r.inverse?c.material=a.leftWeapon.data.grip?a.leftWeapon.data.gripMaterial:e:c.material=a.rightWeapon.data.grip?a.rightWeapon.data.gripMaterial:e:(r.inverse,c.material=e)}(r.inverse?-1===a.leftWeapon.time:-1===a.rightWeapon.time)?this.stopSound(i,r,C,!0):this.stopSound(i,r,C,!1),"still"===o&&a.left===a.right&&(r.inverse?a.leftWeapon.data.isNeverLower:a.rightWeapon.data.isNeverLower)&&(h.position.y-=1.5),r.inverse&&a.leftWeapon&&a.leftWeapon.data.shootType===wo.HOOK&&a.leftWeapon.bullets.length>0?c.material=a.leftWeapon.data.cockingMaterial:!r.inverse&&a.rightWeapon&&a.rightWeapon.data.shootType===wo.HOOK&&a.rightWeapon.bullets.length>0&&(c.material=a.rightWeapon.data.cockingMaterial),r.time+=s(e/60,0)}}class Ka{constructor(){this.name="gole"}update(e,t,n,i,s){const o=t.getComponent(Cn),a=t.getComponent(qo),r=n.getComponent(Gi),l=performance.now();n.hasComponent(Ws)&&n.getComponent(Ws).isDeath?o.material=oi.NONE:a.position.y-=(l-r.goleTime)/500*.5}}class Ja{constructor(){this.name="jump"}update(e,t,n,i,o){const a=n.getComponent(Fo),r=t.getComponent(os),l=t.getComponent(qo),h=t.getComponent(Fa),p=t.getComponent(Cn),[,,,c,d]=as(n,t);if(a.leftWeapon.data.grip&&a.rightWeapon.data.grip){let e=!1;if(h.hard=!1,h.blockX=.5,h.speed=0,n.hasComponent(Qo)&&n.getComponent(Qo).exec){const t=1-Math.max(0,Math.min(1,s((n.hasComponent(ds)?n.getComponent(ds).value.y:0)/(n.hasComponent(Qo)?n.getComponent(Qo).force.y:0),0)));a.leftWeapon.isFire||a.rightWeapon.isFire||(a.rightWeapon.data.grip?(l.isRotateCenter=!1,r.inverse?(l.rotate=0,l.scale=1,l.position.x=.25,l.position.y=-1.5,(r.inverse?a.leftWeapon.isHoldFire:a.rightWeapon.isHoldFire)||c>0&&c<1?p.material=Xa(c,d,a.leftWeapon,a.leftWeapon.data.jumpMaterial):p.material=a.leftWeapon.data.jumpMaterial):(l.position.x=-.875,l.position.y=-1.25,l.rotate=Math.PI/2-Math.PI/2*t,l.scale=1.5-.625*t,l.position.x+=.75*t,l.position.y+=1*t,(r.inverse?a.leftWeapon.isHoldFire:a.rightWeapon.isHoldFire)||c>0&&c<1?p.material=Xa(c,d,a.rightWeapon,a.rightWeapon.data.jumpMaterial):p.material=a.rightWeapon.data.jumpMaterial)):a.leftWeapon.data.grip?(l.isRotateCenter=!1,r.inverse?(l.position.x=.875,l.position.y=-1.25,l.rotate=-Math.PI/2+Math.PI/2*t,l.scale=1.5-.625*t,l.position.x-=.75*t,l.position.y+=1*t,(r.inverse?a.leftWeapon.isHoldFire:a.rightWeapon.isHoldFire)||c>0&&c<1?p.material=Xa(c,d,a.leftWeapon,a.leftWeapon.data.jumpMaterial):p.material=a.leftWeapon.data.jumpMaterial):(l.rotate=0,l.scale=1,l.position.x=-.25,l.position.y=-1.5,(r.inverse?a.leftWeapon.isHoldFire:a.rightWeapon.isHoldFire)||c>0&&c<1?p.material=Xa(c,d,a.rightWeapon,a.rightWeapon.data.jumpMaterial):p.material=a.rightWeapon.data.jumpMaterial)):a.rightWeapon.data.grip?(l.isRotateCenter=!1,r.inverse?(l.rotate=0,l.scale=1,l.position.x=.25,l.position.y=-1.5,(r.inverse?a.leftWeapon.isHoldFire:a.rightWeapon.isHoldFire)||c>0&&c<1?p.material=Xa(c,d,a.leftWeapon,a.leftWeapon.data.jumpMaterial):p.material=a.leftWeapon.data.jumpMaterial):(l.position.x=-.875,l.position.y=-1.25,l.rotate=-Math.PI/2+Math.PI/4*t,l.scale=1.5-.625*t,l.position.x+=.75*t,l.position.y+=1*t,(r.inverse?a.leftWeapon.isHoldFire:a.rightWeapon.isHoldFire)||c>0&&c<1?p.material=Xa(c,d,a.rightWeapon,a.rightWeapon.data.jumpMaterial):p.material=a.rightWeapon.data.jumpMaterial)):(l.rotate=0,l.scale=1,l.position.x=.25,l.position.y=-1.5)),e=!0}e||(l.position.y=-1.5)}}}class qa{constructor(){this.name="air"}update(e,t,n,i,o){const a=n.getComponent(Fo),r=t.getComponent(os),l=t.getComponent(qo),h=t.getComponent(Fa),p=t.getComponent(Cn),[,,,c,d]=as(n,t);if(!(ha(n)>0)){h.hard=!1,h.blockX=.5,h.speed=0,l.isRotateCenter=!1;const e=n.hasComponent(ds)?n.getComponent(ds).value.y:0;if(s(Math.min(1,(Math.abs(e)-.25)/.125),0)<=0)l.position.y=-1.5;else{const e=Math.sin(r.time%.5/.5*(2*Math.PI)),t=Math.cos(r.time%.5/.5*(2*Math.PI)),n=Math.sin(r.time%.5/.5*(2*Math.PI)+Math.PI/2),i=-Math.cos(r.time%.5/.5*(2*Math.PI)+Math.PI/2),s=Math.sin((1-r.time%.5)/.5*(2*Math.PI)),o=Math.cos((1-r.time%.5)/.5*(2*Math.PI)),h=Math.sin((1-r.time%.5)/.5*(2*Math.PI)+Math.PI/2),u=-Math.cos((1-r.time%.5)/.5*(2*Math.PI)+Math.PI/2);a.leftWeapon.isFire||a.rightWeapon.isFire?r.inverse?l.position.x=.5:l.position.x=-.5:r.inverse?(l.position.x=.5,l.position.y=-.75):(l.position.x=-.5,l.position.y=-.75),r.inverse?(l.rotate=.1-.5*Math.sin(r.time%.5/.25*(2*Math.PI))+(a.rightWeapon.data.grip?0:.375),l.scale=1+(h+1)/2*.25):(l.rotate=.1-.5*Math.sin(r.time%.5/.25*(2*Math.PI))+(a.rightWeapon.data.grip?0:-.35),l.scale=1+(e+1)/2*.25),r.inverse?(l.position.x-=1*e+.1*t,l.position.y+=.75*n+.05*i,p.material=Xa(c,d,a.leftWeapon,a.leftWeapon.data.airMaterial)):(l.position.x-=1*-s+.1*-o,l.position.y+=.75*-h+.05*-u,p.material=Xa(c,d,a.rightWeapon,a.rightWeapon.data.airMaterial))}}}}class Za{constructor(){this.name="sprint"}update(e,t,n,i,s){const o=n.getComponent(Fo),{direction:a}=i.getCamera(),r=t.getComponent(os),l=t.getComponent(qo),h=t.getComponent(Fa),p=t.getComponent(Cn),[,,,c,d]=as(n,t),u=Math.sin(h.time%3/3*(2*Math.PI)),m=n.hasComponent(ia)&&n.getComponent(ia).enableTacticalSprint,g=Math.sin(h.time%1/1*(2*Math.PI)),f=Math.cos(h.time%1/1*(2*Math.PI)),y=Math.sin((1-h.time%1/1)*(2*Math.PI)),w=Math.cos((1-h.time%1/1)*(2*Math.PI)),x=n.hasComponent(ds)?n.getComponent(ds).value:new C(0,0,0),M=-Math.min(1,Math.max(-1,R(W(x.x,x.z,0,0),a.x)/(Math.PI/2))),E=a.y/(Math.PI/2);switch(h.hard=!0,h.blockX=.5,h.slide=.375,h.speed=n.hasComponent(ia)&&n.getComponent(ia).enableTacticalSprint?2:1.75,h.invert=!1,!!o.leftWeapon.data.grip!=!!o.rightWeapon.data.grip?m?o.leftWeapon.data.tacticalSprintType||o.rightWeapon.data.tacticalSprintType||So:o.leftWeapon.data.sprintType||o.rightWeapon.data.sprintType||So:m?ko:So){case So:r.inverse?(l.position.x=.5+.5*M-.5*g,l.position.y=-1.325-.25*Math.abs(M)+.375*E+1*g,l.scale=1.5+.5*y,l.rotate=.375*-M-.75*f+(o.leftWeapon.data.isRotateCenter?.75:0),p.material=Xa(c,d,o.leftWeapon,n.hasComponent(ds)&&0!==n.getComponent(ds).value.y?o.leftWeapon.data.jumpMaterial:o.leftWeapon.data.sprintMaterial)):(l.position.x=.5*M-.5+.5*y,l.position.y=-1.325-.25*Math.abs(M)+.375*E+1*y,l.scale=1.5+.5*g,l.rotate=.375*-M-.75*w+(o.rightWeapon.data.isRotateCenter?-.75:0),p.material=Xa(c,d,o.rightWeapon,n.hasComponent(ds)&&0!==n.getComponent(ds).value.y?o.rightWeapon.data.jumpMaterial:o.rightWeapon.data.sprintMaterial));break;case ko:r.inverse?(l.position.x=.5+.5*M-.5*g,l.position.y=-1.875-.25*Math.abs(M)+.375*E+1.5*g,l.scale=1.5+.5*y,l.rotate=o.leftWeapon.data.isRotateCenter?.75:0,p.material=Xa(c,d,o.leftWeapon,n.hasComponent(ds)&&0!==n.getComponent(ds).value.y?o.leftWeapon.data.jumpMaterial:o.leftWeapon.data.sprintMaterial)):(l.position.x=.5*M-.5+.5*y,l.position.y=-1.875-.25*Math.abs(M)+.375*E+1.5*y,l.scale=1.5+.5*g,l.rotate=o.rightWeapon.data.isRotateCenter?-.75:0,p.material=Xa(c,d,o.rightWeapon,n.hasComponent(ds)&&0!==n.getComponent(ds).value.y?o.rightWeapon.data.jumpMaterial:o.rightWeapon.data.sprintMaterial));break;case To:r.inverse?(o.leftWeapon.data.grip?(l.position.x=.5+.5*M-.5*g,l.position.y=-1.325-.25*Math.abs(M)+.375*E+1*g,l.scale=1.5+.5*y,l.rotate=.375*-M-.75*f+(o.leftWeapon.data.isRotateCenter?.75:0)):(h.y=-.375,h.x=.125,h.rotate=-.25*Math.PI,h.moveFix=!1,l.position.x=.25+.5*M,l.position.y=-.375,l.rotate=.25+.5*-M,l.position.x+=.0375*u),p.material=Xa(c,d,o.leftWeapon,n.hasComponent(ds)&&0!==n.getComponent(ds).value.y?o.leftWeapon.data.jumpMaterial:o.leftWeapon.data.sprintMaterial)):(o.rightWeapon.data.grip?(l.position.x=.5*M-.5+.5*y,l.position.y=-1.325-.25*Math.abs(M)+.375*E+1*y,l.scale=1.5+.5*g,l.rotate=.375*-M-.75*w+(o.rightWeapon.data.isRotateCenter?-.75:0)):(h.y=-.375,h.x=.125,h.rotate=-.25*Math.PI,h.moveFix=!1,l.position.x=.5*M-.25,l.position.y=-.375,l.rotate=.5*-M-.25,l.position.x+=.0375*u),p.material=Xa(c,d,o.rightWeapon,n.hasComponent(ds)&&0!==n.getComponent(ds).value.y?o.rightWeapon.data.jumpMaterial:o.rightWeapon.data.sprintMaterial));break;case Po:r.inverse?(o.leftWeapon.data.grip?(l.position.x=.5+.5*M-.5*g,l.position.y=-1.325-.25*Math.abs(M)+.375*E+1*g,l.scale=1.5+.5*y,l.rotate=.375*-M-.75*f+(o.leftWeapon.data.isRotateCenter?.75:0)):(h.y=-.5,h.x=.125,h.rotate=-.25*Math.PI,h.moveFix=!1,l.position.x=.5+.5*M,l.position.y=-.625,l.scale=1.75,l.rotate=0,l.position.x+=.0375*u),p.material=Xa(c,d,o.leftWeapon,n.hasComponent(ds)&&0!==n.getComponent(ds).value.y?o.leftWeapon.data.jumpMaterial:o.leftWeapon.data.sprintMaterial)):(o.rightWeapon.data.grip?(l.position.x=.5*M-.5+.5*y,l.position.y=-1.325-.25*Math.abs(M)+.375*E+1*y,l.scale=1.5+.5*g,l.rotate=.375*-M-.75*w+(o.rightWeapon.data.isRotateCenter?-.75:0)):(h.y=-.5,h.x=.125,h.rotate=-.25*Math.PI,h.moveFix=!1,l.position.x=.5*M-.5,l.position.y=-.625,l.scale=1.75,l.rotate=0,l.position.x+=.0375*u),p.material=Xa(c,d,o.rightWeapon,n.hasComponent(ds)&&0!==n.getComponent(ds).value.y?o.rightWeapon.data.jumpMaterial:o.rightWeapon.data.sprintMaterial));break;case Io:r.inverse?(o.leftWeapon.data.grip?(l.position.x=.5+.5*M-.5*g,l.position.y=-1.325-.25*Math.abs(M)+.375*E+1*g,l.scale=1.5+.5*y,l.rotate=.375*-M-.75*f+(o.leftWeapon.data.isRotateCenter?.75:0)):(h.y=-.5,h.x=.125,h.rotate=-.25*Math.PI,h.moveFix=!1,l.position.x=.5+.5*M,l.position.y=-.875,l.scale=1.75,l.rotate=0,l.position.x+=.0375*u),p.material=Xa(c,d,o.leftWeapon,n.hasComponent(ds)&&0!==n.getComponent(ds).value.y?o.leftWeapon.data.jumpMaterial:o.leftWeapon.data.sprintMaterial)):(o.rightWeapon.data.grip?(l.position.x=.5*M-.5+.5*y,l.position.y=-1.325-.25*Math.abs(M)+.375*E+1*y,l.scale=1.5+.5*g,l.rotate=.375*-M-.75*w+(o.rightWeapon.data.isRotateCenter?-.75:0)):(h.y=-.5,h.x=.125,h.rotate=-.25*Math.PI,h.moveFix=!1,l.position.x=.5*M-.5,l.position.y=-.875,l.scale=1.75,l.rotate=0,l.position.x+=.0375*u),p.material=Xa(c,d,o.rightWeapon,n.hasComponent(ds)&&0!==n.getComponent(ds).value.y?o.rightWeapon.data.jumpMaterial:o.rightWeapon.data.sprintMaterial));break;case Lo:h.mrotate=0,h.slide=0,h.y=-.375,h.x=.125,h.rotate=.25*Math.PI,h.moveFix=!1,l.position.x+=.125*u,r.inverse?o.leftWeapon.data.grip?(h.y=-.5,h.x=.125,h.rotate=-.25*Math.PI,l.position.x=.5*M-.5,l.position.y=-.75,l.scale=1.75,l.rotate=.375*-M-.25,p.material=Xa(c,d,o.leftWeapon,o.leftWeapon.data.grip?o.rightWeapon.data.isHave||c<1||o.leftWeapon.bullets.length>0?o.leftWeapon.data.gripMaterial:oi.NONE:o.leftWeapon.data.stillMaterial)):(h.y=-.5,h.x=.125,h.rotate=-.25*Math.PI,l.position.x=.5+.5*M,l.position.y=-.375,l.scale=1.75,l.rotate=.125+.25*-M,p.material=Xa(c,d,o.leftWeapon,n.hasComponent(ds)&&0!==n.getComponent(ds).value.y?o.leftWeapon.data.jumpMaterial:o.leftWeapon.data.sprintMaterial)):o.rightWeapon.data.grip?(h.y=-.5,h.x=.125,h.rotate=-.25*Math.PI,l.position.x=.5+.5*M,l.position.y=-.75,l.scale=1.75,l.rotate=.25+.375*-M,p.material=Xa(c,d,o.rightWeapon,o.rightWeapon.data.grip?o.leftWeapon.data.isHave||c<1||o.rightWeapon.bullets.length>0?o.rightWeapon.data.gripMaterial:oi.NONE:o.rightWeapon.data.stillMaterial)):(h.y=-.5,h.x=.125,h.rotate=-.25*Math.PI,l.position.x=.5*M-.5,l.position.y=-.375,l.scale=1.75,l.rotate=.25*-M-.125,p.material=Xa(c,d,o.rightWeapon,n.hasComponent(ds)&&0!==n.getComponent(ds).value.y?o.rightWeapon.data.jumpMaterial:o.rightWeapon.data.sprintMaterial)),l.position.x+=.075*u;break;case Oo:h.mrotate=0,h.slide=0,h.y=-.375,h.x=.125,h.rotate=.25*Math.PI,h.moveFix=!1,l.position.x+=.125*u,r.inverse?o.leftWeapon.data.grip?(h.y=-.5,h.x=.125,h.rotate=-.25*Math.PI,l.position.x=.5*M-.5,l.position.y=-.75,l.scale=1.75,l.rotate=.375*-M-.25,p.material=Xa(c,d,o.leftWeapon,o.leftWeapon.data.grip?o.rightWeapon.data.isHave||c<1||o.leftWeapon.bullets.length>0?o.leftWeapon.data.gripMaterial:oi.NONE:o.leftWeapon.data.stillMaterial)):(h.y=-.5,h.x=.125,h.rotate=-.25*Math.PI,l.position.x=.5+.5*M,l.position.y=-.75,l.scale=1.75,l.rotate=0,p.material=Xa(c,d,o.leftWeapon,n.hasComponent(ds)&&0!==n.getComponent(ds).value.y?o.leftWeapon.data.jumpMaterial:o.leftWeapon.data.sprintMaterial)):o.rightWeapon.data.grip?(h.y=-.5,h.x=.125,h.rotate=-.25*Math.PI,l.position.x=.5+.5*M,l.position.y=-.75,l.scale=1.75,l.rotate=.25+.375*-M,p.material=Xa(c,d,o.rightWeapon,o.rightWeapon.data.grip?o.leftWeapon.data.isHave||c<1||o.rightWeapon.bullets.length>0?o.rightWeapon.data.gripMaterial:oi.NONE:o.rightWeapon.data.stillMaterial)):(h.y=-.5,h.x=.125,h.rotate=-.25*Math.PI,l.position.x=.5*M-.5,l.position.y=-.75,l.scale=1.75,l.rotate=0,p.material=Xa(c,d,o.rightWeapon,n.hasComponent(ds)&&0!==n.getComponent(ds).value.y?o.rightWeapon.data.jumpMaterial:o.rightWeapon.data.sprintMaterial)),l.position.x+=.075*u;break;case Ao:h.mrotate=0,h.slide=0,h.y=-.375,h.x=.125,h.rotate=.125*Math.PI,h.add=0,h.moveFix=!1,l.position.y=.2*E-.75,l.scale+=.75,l.position.x+=.1*u,r.inverse?o.leftWeapon.data.grip?(l.rotate=-Math.PI/3,p.material=Xa(c,d,o.leftWeapon,o.leftWeapon.data.grip?o.rightWeapon.data.isHave||c<1||o.leftWeapon.bullets.length>0?o.leftWeapon.data.gripMaterial:oi.NONE:o.leftWeapon.data.stillMaterial)):(l.rotate=Math.PI/3,p.material=Xa(c,d,o.leftWeapon,p.material)):o.rightWeapon.data.grip?(l.rotate=Math.PI/3,p.material=Xa(c,d,o.rightWeapon,o.rightWeapon.data.grip?o.leftWeapon.data.isHave||c<1||o.rightWeapon.bullets.length>0?o.rightWeapon.data.gripMaterial:oi.NONE:o.rightWeapon.data.stillMaterial)):(l.rotate=-Math.PI/3,p.material=Xa(c,d,o.rightWeapon,p.material));break;case Wo:h.mrotate=0,h.y=-.5,h.add=0,h.moveFix=!1,l.position.y=.2*E-.6,r.inverse?o.leftWeapon.data.grip?(h.x=-.5,h.rotate=-Math.PI/6,l.rotate=-Math.PI/4,p.material=Xa(c,d,o.leftWeapon,o.leftWeapon.data.grip?o.leftWeapon.data.gripMaterial:p.material)):(h.x=.5,h.rotate=Math.PI/6,l.rotate=Math.PI/4,p.material=Xa(c,d,o.leftWeapon,n.hasComponent(ds)&&0!==n.getComponent(ds).value.y?o.leftWeapon.data.jumpMaterial:o.leftWeapon.data.sprintMaterial)):o.rightWeapon.data.grip?(h.x=.5,h.rotate=Math.PI/6,l.rotate=Math.PI/4,p.material=Xa(c,d,o.rightWeapon,o.rightWeapon.data.grip?o.leftWeapon.data.isHave||c<1||o.rightWeapon.bullets.length>0?o.rightWeapon.data.gripMaterial:oi.NONE:o.rightWeapon.data.stillMaterial)):(h.x=-.5,h.rotate=-Math.PI/6,l.rotate=-Math.PI/4,p.material=Xa(c,d,o.rightWeapon,n.hasComponent(ds)&&0!==n.getComponent(ds).value.y?o.rightWeapon.data.jumpMaterial:o.rightWeapon.data.sprintMaterial)),l.position.x+=.075*u;break;case No:h.mrotate=0,h.y=-.5,h.add=0,h.moveFix=!1,l.position.y=.2*E-.4,r.inverse?o.leftWeapon.data.grip?(h.x=-.5,h.rotate=-Math.PI/6,l.rotate=-Math.PI/4,p.material=Xa(c,d,o.leftWeapon,o.leftWeapon.data.grip?o.leftWeapon.data.gripMaterial:p.material)):(h.x=.5,h.rotate=Math.PI/6,l.rotate=Math.PI/4,p.material=Xa(c,d,o.leftWeapon,n.hasComponent(ds)&&0!==n.getComponent(ds).value.y?o.leftWeapon.data.jumpMaterial:o.leftWeapon.data.sprintMaterial)):o.rightWeapon.data.grip?(h.x=.5,h.rotate=Math.PI/6,l.rotate=Math.PI/4,p.material=Xa(c,d,o.rightWeapon,o.rightWeapon.data.grip?o.leftWeapon.data.isHave||c<1||o.rightWeapon.bullets.length>0?o.rightWeapon.data.gripMaterial:oi.NONE:o.rightWeapon.data.stillMaterial)):(h.x=-.5,h.rotate=-Math.PI/6,l.rotate=-Math.PI/4,p.material=Xa(c,d,o.rightWeapon,n.hasComponent(ds)&&0!==n.getComponent(ds).value.y?o.rightWeapon.data.jumpMaterial:o.rightWeapon.data.sprintMaterial)),l.position.x+=.075*u;break;case zo:h.mrotate=0,h.y=-.5,h.x=.25,h.rotate=0,h.slide=0,h.add=0,h.moveFix=!1,l.position.y=.2*E-.625,l.scale+=.125,l.position.x+=.1*u,r.inverse?o.leftWeapon.data.grip?(l.rotate=-Math.PI/4,p.material=Xa(c,d,o.leftWeapon,o.leftWeapon.data.grip?o.rightWeapon.data.isHave||c<1||o.leftWeapon.bullets.length>0?o.leftWeapon.data.gripMaterial:oi.NONE:o.leftWeapon.data.stillMaterial)):(l.rotate=Math.PI/4,p.material=Xa(c,d,o.leftWeapon,p.material)):o.rightWeapon.data.grip?(l.rotate=Math.PI/4,p.material=Xa(c,d,o.rightWeapon,o.rightWeapon.data.grip?o.leftWeapon.data.isHave||c<1||o.rightWeapon.bullets.length>0?o.rightWeapon.data.gripMaterial:oi.NONE:o.rightWeapon.data.stillMaterial)):(l.rotate=-Math.PI/4,p.material=Xa(c,d,o.rightWeapon,p.material))}if(-1!==r.sprintStartTime){const e=Math.max(0,1-(r.time-r.sprintStartTime-.25)/.5);l.position.y-=.375*e,l.scale+=.25*e}l.isRotateCenter=!1}}class Qa{constructor(){this.name="sliding"}update(e,t,n,i,s){const o=n.getComponent(Fo),a=t.getComponent(os),r=t.getComponent(qo),l=t.getComponent(Fa),h=t.getComponent(Cn),[p,,,c,d]=as(n,t),u=(o.leftWeapon.data.shootType!==wo.SHIELD||o.rightWeapon.data.shootType!==wo.SHIELD)&&(o.leftWeapon.data.shootType===wo.SHIELD&&o.leftWeapon.isFire)!==(o.rightWeapon.data.shootType===wo.SHIELD&&o.rightWeapon.isFire);l.hard=!0,l.blockX=0,l.speed=3;const m=n.getComponent(na);r.position.x-=Math.min(Math.PI/2,Math.max(-Math.PI/2,Math.PI/2*Math.sin(R(n.direction.x,m.dir))))*(Math.PI/16)*(1-m.value);let g=m.value;if(!p&&!u){const e=R(n.direction.x,m.dir),t=Math.abs(e/(Math.PI/2));g=e>0?a.inverse?m.value:m.value-.15*t:a.inverse?m.value-.15*t:m.value}const f=Math.sin(Math.min(1,g/.25)*Math.PI),y=Math.sin(Math.min(1,(g-.25)/.25)*Math.PI);r.position.y+=.1*f-.15*y,!!o.leftWeapon.data.grip==!!o.rightWeapon.data.grip&&((a.inverse?o.leftWeapon.isHoldFire:o.rightWeapon.isHoldFire)||c>0&&c<1||a.inverse||(a.inverse?o.rightWeapon.isHoldFire:o.leftWeapon.isHoldFire)||(r.position.y+=-.15),a.inverse?h.material=Xa(c,d,o.leftWeapon,o.leftWeapon.data.slidingMaterial):h.material=Xa(c,d,o.rightWeapon,o.rightWeapon.data.slidingMaterial))}}class $a{constructor(){this.name="coil"}update(e,t,n,i,s){const o=n.getComponent(Fo),a=t.getComponent(os),r=t.getComponent(bn),l=t.getComponent(qo),h=t.getComponent(Fa),p=t.getComponent(Cn);h.hard=!0,h.blockX=0,h.speed=0,h.mrotate=0,h.slide=0,l.rotate=0,l.scale=1,l.isRotateCenter=!1,a.inverse?(r.position.y=l.position.y=-1.5,p.material=o.leftWeapon.data.coilMaterial):(r.position.y=l.position.y=-1.5,p.material=o.rightWeapon.data.coilMaterial)}}class er{constructor(){this.name="grab"}update(e,t,n,i,o){const a=n.getComponent(Fo),r=t.getComponent(os),l=t.getComponent(Fa),h=t.getComponent(qo),p=t.getComponent(Cn),c=n.getComponent(ss),[,,,d,u]=as(n,t);if(l.hard=!1,l.blockX=.5,l.speed=0,c.climb){const e=-1!==a.rightWeapon.time?a.rightWeapon.time:a.rightWeapon.data.fireSpeed,t=-1!==a.leftWeapon.time?a.leftWeapon.time:a.leftWeapon.data.fireSpeed,n=s(Math.min(1,1-Math.min(1,e/a.rightWeapon.data.fireSpeed)),0),i=s(Math.min(1,1-Math.min(1,t/a.leftWeapon.data.fireSpeed)),0);(r.inverse?!a.leftWeapon.data.grip||0!==i&&1!==i:!a.rightWeapon.data.grip||0!==n&&1!==n)||(h.position.y=-1.5,p.material=r.inverse?Xa(d,u,a.leftWeapon,a.leftWeapon.data.grabMaterial):Xa(d,u,a.rightWeapon,a.rightWeapon.data.grabMaterial))}else{const{direction:e}=n,i=t.getComponent(os),s=R(c.angle,e.x);((i.inverse?s<0:s>0)||!c.canJump||c.canClimb||c.canThroug)&&(h.position.y=-1.5),i.inverse&&(p.flip.x=!0),i.inverse?p.material=Xa(d,u,a.leftWeapon,a.leftWeapon.data.grabMaterial):p.material=Xa(d,u,a.rightWeapon,a.rightWeapon.data.grabMaterial)}}}class tr{constructor(){this.name="wallrun"}update(e,t,n,i,s){const o=n.getComponent(Fo),{direction:a}=i.getCamera(),r=t.getComponent(os),l=t.getComponent(qo),h=t.getComponent(Fa),p=t.getComponent(Cn),c=n.getComponent($o),d=n.getComponent(jo),u=n.getComponent(oa),m=Math.sin(h.time%.5/.5*(2*Math.PI)),g=Math.cos(h.time%.5/.5*(2*Math.PI)),f=Math.sin((1-h.time%.5/.5)*(2*Math.PI)),y=Math.cos((1-h.time%.5/.5)*(2*Math.PI)),w=n.hasComponent(ds)?n.getComponent(ds).value:new C(0,0,0),x=-Math.min(1,Math.max(-1,R(W(w.x,w.z,0,0),a.x)/(Math.PI/2))),M=a.y/(Math.PI/2),[,,,E,v]=as(n,t),b=i.getCamera();if(h.hard=!1,h.blockX=.5,h.speed=b.hasComponent(ea)?b.getComponent(ea).speed:1.75,u.value>0&&(l.position.y-=1.5),o.leftWeapon.data.grip&&o.rightWeapon.data.grip)l.isRotateCenter=!1,d.move.z>0?r.inverse?(1===c.side?(l.position.x=(o.leftWeapon.data.grip?.325:.5)+.5*x-.375*m,l.position.y=-1.375-.25*Math.abs(x)+.375*M+1*m,l.scale=1.5+.5*f,l.rotate=.5*-x-1*g+(o.leftWeapon.data.grip?0:.375),l.isRotateCenter=!!o.leftWeapon.data.isRotateCenter):(l.rotate=o.leftWeapon.data.grip?0:.375,l.scale=1,l.position.x=.25,l.position.y=-1.5),(r.inverse?o.leftWeapon.isHoldFire:o.rightWeapon.isHoldFire)||E>0&&E<1?p.material=Xa(E,v,o.leftWeapon,o.leftWeapon.data.wallrunMaterial):p.material=o.leftWeapon.data.wallrunMaterial):(-1===c.side?(l.position.x=(o.rightWeapon.data.grip?-.325:-.5)+.5*x+.375*f,l.position.y=-1.2875-.25*Math.abs(x)+.375*M+1*f,l.scale=1.5+.5*m,l.rotate=.5*-x-1*y+(o.rightWeapon.data.grip?0:-.375),l.isRotateCenter=!!o.rightWeapon.data.isRotateCenter):(l.rotate=o.rightWeapon.data.grip?0:.375,l.scale=1,l.position.x=-.25,l.position.y=-1.5),(r.inverse?o.leftWeapon.isHoldFire:o.rightWeapon.isHoldFire)||E>0&&E<1?p.material=Xa(E,v,o.rightWeapon,o.rightWeapon.data.wallrunMaterial):p.material=o.rightWeapon.data.wallrunMaterial):(r.inverse?o.leftWeapon.isHoldFire:o.rightWeapon.isHoldFire)||E>0&&E<1?r.inverse?p.material=Xa(E,v,o.leftWeapon,o.leftWeapon.data.jumpMaterial):p.material=Xa(E,v,o.rightWeapon,o.rightWeapon.data.jumpMaterial):r.inverse?p.material=o.leftWeapon.data.jumpMaterial:p.material=o.rightWeapon.data.jumpMaterial;else{const e=(!n.hasComponent(ss)||!n.getComponent(ss).exec)&&(r.inverse&&!o.leftWeapon.data.grip?o.leftWeapon.isAmmo||o.leftWeapon.bullets.length>0:o.rightWeapon.isAmmo||o.rightWeapon.bullets.length>0);d.move.z>0&&(r.inverse&&!o.leftWeapon.data.grip||!r.inverse&&!o.rightWeapon.data.grip)?l.isRotateCenter=e:(l.isRotateCenter=!1,e&&(l.position.y-=1.5))}}}class nr{constructor(){this.name="death"}update(e,t,n,i,s){t.getComponent(Cn).material=oi.NONE}}class ir extends Va{constructor(){super(os,Fa,qo,bn,Cn),this.addAnimations(new ja,new Ka,new Ja,new qa,new Za,new Qa,new $a,new er,new tr,new nr)}offset(e,t,n){const i=n.getCamera();if(null!==i&&(!i.hasComponent(Ei)||i!==(t.hasComponent(Ei)?t.getComponent(Ei).value:null))){t.getComponent(Cn).material=oi.NONE}}}class sr extends wn{constructor(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];super(Oi,...t)}}class or extends sr{constructor(e){super(ea,Bo,Yo,Ei),this.setting=e}additional(e,t,n){const i=t.getComponent(Ei).value;if(null===i||!i.hasComponent(Gi))return;const o=t.getComponent(ea),a=i.getComponent(Gi);let r=!0,l=0,h=0,p=0,c=0;i instanceof Mn&&(i.hasComponent(ss)&&i.getComponent(ss).exec?i.getComponent(ss).move||(r=!1):a.isAir&&(r=!1));let d=0,u=0,m=0;if(!i.hasComponent(Gi)||null===i.getComponent(Gi).activeEntity){if(i.hasComponent(jo)){const e=i.getComponent(jo);d=0===e.move.x?a.axes.x.x:e.move.x,u=0===e.move.y?a.axes.x.y:e.move.z}else d=a.axes.x.x,u=a.axes.x.y;m=Math.min(1,Math.max(-1,1e3*(i.hasComponent(ji)&&i.getComponent(ji).enable?0:a.axes.y.x)))}const g=i.hasComponent($o)&&i.getComponent($o).exec?1:Math.min(1,Math.abs(d)+Math.abs(u)),f=this.setting.hasBob();if(0===d&&0===u||!r)o.oldTime=0;else{0===g?(o.time=0,o.oldTime=0):o.time+=s(e/60*g*o.speed,0);const a=o.time%1*Math.abs(g);if(i instanceof Mn&&(!i.hasComponent(na)||!i.getComponent(na).exec)){const e=o.time%.5;if(e<o.oldTime){const e=new Mn("foot-sound"),[s,a]=O(W(d,u,i.hasComponent(ss)&&i.getComponent(ss).exec?.11625:i.hasComponent(cs)?i.getComponent(cs).size.x/4:0,0),1,0),[r,l]=O(t.direction.x,s,a),h=o.time%1;e.position.x=i.position.x+(h<=.5?r:-r),e.position.z=i.position.z+(h<=.5?l:-l),e.position.y=i.hasComponent(ss)&&i.getComponent(ss).exec?t.position.y:i.position.y,n.createSound("./asset/sound/player/step-".concat(1+(4*Math.random()|0),".mp3"),e,"player-foot-step").play()}o.oldTime=e}if(f){let e=0,t=0;o.hard?(e=Math.min(1,Math.max(-1,2*Math.cos(a*(2*Math.PI))))*g*(o.moveFix?Math.max(.5,Math.abs(d)):.5),t=2*(1-Math.min(1,Math.max(-1,Math.abs(Math.cos(a*(2*Math.PI))))))*g*(o.moveFix?Math.max(.5,Math.abs(u)):1)):(e=Math.min(1,Math.max(-1,Math.cos(a*(2*Math.PI))))*g*(o.moveFix?Math.max(.5,Math.abs(d)):1),t=(1-Math.min(1,Math.max(-1,Math.cos(a*(4*Math.PI)))))*g*(o.moveFix?Math.max(.5,Math.abs(u)):1)),isNaN(e)||(l+=e*o.x*Math.abs(u),p+=e*o.rotate*(d/Math.abs(d)||1)),isNaN(t)||(h+=t*o.y),p+=Math.min(.175,Math.max(-.175,m+.075*d))*o.slide}}f?o.swais.slice().forEach((t=>{if(t.time<=t.tick){const n=s(Math.min(1,t.time/t.tick),0),i=(1-Math.sin(n*(Math.PI/2)))**t.reduce,o=Math.sin(n%t.par/t.par*Math.PI),a=s(((o<.5?o/.5:1-(o-.5)/.5)*i-i/2.5)/.5,0);p+=Math.PI*a*t.scale,c+=a*t.fov,t.time+=s(e/60,0)}else o.swais.splice(o.swais.indexOf(t),1)})):me(o.swais);const y=t.getComponent(Yo),w=!y.init||y.initTime!==o.initTime;o.initTime=y.initTime,(w||-1===o.old.position.x||Math.fround(y.position.x-o.move.position.x)!==Math.fround(o.old.position.x))&&(o.old.position.x=Math.fround(y.position.x)),(w||-1===o.old.position.y||Math.fround(y.position.y-o.move.position.y)!==Math.fround(o.old.position.y))&&(o.old.position.y=Math.fround(y.position.y)),(w||-1===o.old.position.z||Math.fround(y.position.z-o.move.position.z)!==Math.fround(o.old.position.z))&&(o.old.position.z=Math.fround(y.position.z)),(w||-1===o.old.rotate||Math.fround(i.direction.z-o.move.rotate)!==Math.fround(o.old.rotate))&&(o.old.rotate=Math.fround(i.direction.z)),(w||-1===o.old.fov||Math.fround(t.fov-o.move.fov)!==Math.fround(o.old.fov))&&(o.old.fov=Math.fround(t.fov));const x=.25*n.getSpeed();w||(y.position.x=Math.fround(j(y.position.x,o.old.position.x+l,x)),y.position.y=Math.fround(j(y.position.y,o.old.position.y+h,x)),y.position.z=Math.fround(j(y.position.z,o.old.position.z,x)),i.direction.z=Math.fround(j(i.direction.z,o.old.rotate+p,x)),t.fov=Math.fround(j(t.fov,o.old.fov+c,x))),o.move.position.x=Math.fround(y.position.x-o.old.position.x),o.move.position.y=Math.fround(y.position.y-o.old.position.y),o.move.position.z=Math.fround(y.position.z-o.old.position.z),o.move.rotate=Math.fround(i.direction.z-o.old.rotate),o.move.fov=Math.fround(t.fov-o.old.fov)}}class ar extends Bi{constructor(){super(ia,Gi,ds,jo,cs,ta,oa,ia)}slidingFilter(e){return Math.sin(e*(Math.PI/2))**5}additional(e,t,n){const i=t.getComponent(ds),s=t.getComponent(jo),o=t.getComponent(ta),a=t.getComponent(oa),r=t.getComponent(ia);let l=0,h=0;if(t.hasComponent(is)&&t.hasComponent(Uo)){const e=ha(t);l=(r.sprintSpeed-r.walkSpeed)*e,h=(r.walkSpeed-r.cluchSpeed)*e}const p=r.walkSpeed+l,c=r.cluchSpeed+h,d=r.sprintSpeed,u=r.tacticalSprintSpeed;let m=s.speed,g=.25;s.limit=!0;let f=!1;if(t.hasComponent(Fo)){const e=t.getComponent(Fo),n="hookshot"===$i(t,e.left,null)&&e.leftWeapon.bullets.length>0,i="hookshot"===$i(t,e.right,null)&&e.rightWeapon.bullets.length>0;f=(n||i)&&![...e.leftWeapon.bullets,...e.rightWeapon.bullets].some((e=>{if(e.hasLive()&&e.hasComponent(Gs)){const t=e.getComponent(Gs).bullet;if(null!==t)if(t.hasComponent(ps)&&t.getComponent(ps).hit){if(t.hasComponent(wa)&&t.getComponent(wa).isPull)return!0}else if(e.hasComponent(ps)&&e.getComponent(ps).hit)return!0}return!1}))}let y=!1,w=!1;if(t.hasComponent($o)&&t.getComponent($o).exec)m=t.getComponent($o).walkSpeed,g=.125;else if(0===i.value.y)if(t.hasComponent(na)&&t.getComponent(na).exec){const e=t.getComponent(na);m=(.25+.75*(1-this.slidingFilter(e.value)))*e.nowSpeed,g=.125}else t.hasComponent(ss)&&t.getComponent(ss).exec?(m=p,g=.125):o.enableCluch?m=c:r.enableTacticalSprint?(m=0===a.value?u:p,g=.05,w=!0,y=!0):r.enableSprint?(m=0===a.value?d:p,g=.05,y=!0):m=p;else f&&(m=p);r.isSprint=y,r.isTacticalSprint=w,s.speed=j(s.speed,m,g*e)}}class rr extends Bi{constructor(){super($o,Gi,jo,cs,ta)}checkEdge(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;const{position:r}=e,l=e.getComponent(cs),h=G(n),p=V(n);let c=!0,d=!0;for(let e=0,n=6;e<n;e=e+1|0){const[n,i,o,,]=t.hitScanVoxel(h,0,r.x,r.y+s(l.size.y/5*e,0),r.z,l.size.x/2+.1);-1!==n&&-1!==i&&-1!==o?d=!1:c=!1}return(o?!c:c||d)?(null!==a&&(a.hit=!1,d||(a.hit=!0)),!1):(null!==a&&(a.position.x=r.x,a.position.y=r.y,a.position.z=r.z,a.direction=G(i),a.wallAngle4=h,a.wallAngle8=p,a.hit=!0),!0)}cancel(e,t){const n=t.getComponent($o),i=t.getComponent(cs);n.exec=!1,n.through=!1,n.side=0,n.force.x=0,n.force.y=0,n.force.z=0,n.par=0,n.direction=0,n.value=0,i.hit.y>0?n.time=n.walkTime:n.time=0}offset(e,t,n){const{position:i,direction:o}=t,a=t.getComponent($o),r=t.getComponent(ta),l=t.getComponent(cs),h=t.getComponent(Gi),p=t.getComponent(jo),c=i.x,d=i.y,u=i.z,m=c-(-1===a.oldPosition.x?i.x:a.oldPosition.x),g=d-(-1===a.oldPosition.y?i.y:a.oldPosition.y),f=u-(-1===a.oldPosition.z?i.z:a.oldPosition.z),[y]=0!==m||0!==g||0!==f?N(m,g,f,0,0,0):[-1,-1],[w,x]=O(o.x,h.axes.x.x,h.axes.x.y),M=0!==h.axes.x.x||0!==h.axes.x.y?W(w,x,0,0):-1,E=!t.hasComponent(ds)||0===t.getComponent(ds).value.x&&0===t.getComponent(ds).value.z?-1:W(t.getComponent(ds).value.x,t.getComponent(ds).value.z,0,0);let C=!1,v=!1,b=-1;if(a.exec){const e=s(Math.min(1,a.time/a.walkTime),1);let i=a.side;switch(!0){case this.checkEdge(t,n,G(o.x),o.x,!0,a.start):i=0,v=!0,b=a.start.direction;break;case this.checkEdge(t,n,G(o.x+Math.PI/2),o.x,!0,a.start):i=1,b=a.start.direction,v=!0;break;case this.checkEdge(t,n,G(o.x-Math.PI/2),o.x,!0,a.start):i=-1,b=a.start.direction,v=!0}a.side=i,a.proplusion=Math.max(0,Math.min(1,Math.max(1,H(a.start.wallAngle4,t.direction.x)/(Math.PI/2))-.75*(1-H(a.start.wallAngle4,t.direction.x)/(Math.PI/2)))),a.par=e,a.direction=R(a.start.wallAngle4,o.x),a.value=e;const r=Math.min(1,Math.max(-1,R(a.start.wallAngle4,o.x)/(Math.PI/2))),c=Math.min(1,Math.max(0,1-Math.abs(r)-.25)/.75),d=r*(0===a.start.wallAngle4||a.start.wallAngle4===Math.PI/2*3?-1:1),u=0===a.start.direction?o.x>Math.PI?2*Math.PI:0:z(a.start.wallAngle4+Math.PI/2*(a.side>0?-1:1));let m=!1;if(!C&&t.hasComponent(Fo)){const e=t.getComponent(Fo),n="hookshot"===$i(t,e.left,null)&&e.leftWeapon.bullets.length>0,i="hookshot"===$i(t,e.right,null)&&e.rightWeapon.bullets.length>0;m=(n||i)&&![...e.leftWeapon.bullets,...e.rightWeapon.bullets].some((e=>{if(e.hasLive()&&e.hasComponent(Gs)){const t=e.getComponent(Gs);if(null!==t.bullet&&t.bullet.hasComponent(wa))return t.bullet.getComponent(wa).isPull}return!0}))}if(t.hasComponent(ss)&&t.getComponent(ss).exec&&(a.start.wallAngle4=-1,a.start.wallAngle8=-1,a.time=a.walkTime),!h.isAir||m||a.through||-1!==h.deathTime||a.time>=a.walkTime||0===h.axes.x.x&&0===h.axes.x.y||l.hit.y>0||0!==i&&this.checkEdge(t,n,G(p.look.x),p.look.x,!1,a.start)||!this.checkEdge(t,n,a.start.wallAngle4)||!v&&(-1!==M&&R(t.direction.x,M)>Math.PI/4*3&&Math.abs(h.axes.x.x)+Math.abs(h.axes.x.y)>.5||R(o.x,a.start.wallAngle4)>Math.PI/4*3.75))this.cancel(n,t);else{let e=0,i=0,s=0;if(n.hasSound("player-wallrun")){const e=new Mn("player-wallrun-sound"),[i,s]=O(a.start.wallAngle4,0,.375);e.position.x=t.position.x+i,e.position.y=t.position.y,e.position.z=t.position.z+s,n.getSound("player-wallrun").setTarget(e)}(0===a.side||H(u,o.x)>Math.PI/4)&&(i=c),0===a.start.wallAngle4||a.start.wallAngle4===Math.PI?(e=0,s=d):(e=d,s=0),a.force.x=e,a.force.y=i,a.force.z=s}}else h.isAir&&-1!==l.hit.angle.x||(a.lock=!1,a.time=0);if(!a.exec&&a.enable&&a.time<a.walkTime&&h.axes.x.y>0&&!r.enableCluch&&(!t.hasComponent(ss)||!t.getComponent(ss).exec)&&(!t.hasComponent(ss)||!t.getComponent(ss).through)&&(!t.hasComponent(aa)||!t.getComponent(aa).exec)&&(v||-1!==l.hit.angle.x&&H(l.hit.angle.x,o.x)<Math.PI/4*3||!(-1===M||R(t.direction.x,M)>Math.PI/4*3&&Math.abs(h.axes.x.x)+Math.abs(h.axes.x.y)>.5)||H(l.hit.angle.x,E)<Math.PI/4*3||H(l.hit.angle.x,y)<Math.PI/4*3)&&0===l.hit.y&&h.isAir&&!n.hasHitScanVoxelBold(0,-Math.PI/2,i.x,i.y,i.z,l.size.x,1)){let e=0,i=!0;if(a.start.hit=!1,!0===(-1!==l.hit.angle.x&&this.checkEdge(t,n,l.hit.angle.x,o.x,!0,a.start))){const t=R(o.x,a.start.wallAngle4);e=t>=Math.PI/4?-1:t<=-Math.PI/4?1:0}else if(v&&this.checkEdge(t,n,b,o.x,!0,a.start)){const t=R(o.x,a.start.wallAngle4);e=t>=Math.PI/4?-1:t<=-Math.PI/4?1:0}else i=!1;if(i){if(!a.lock){if(a.through=!1,a.exec=!0,a.lock=!0,a.side=e,a.value=0,C=!0,t.hasComponent(ds)){const e=t.getComponent(ds);e.value.x=0,e.value.y=0,e.value.z=0}if(!n.hasSound("player-wallrun")){const e=new Mn("player-wallrun-sound"),[i,s]=O(a.start.wallAngle4,0,.375);e.position.x=t.position.x+i,e.position.y=t.position.y,e.position.z=t.position.z+s,n.createSound("./asset/sound/player/wallrun.mp3",e,"player-wallrun").play()}}}else a.start.hit&&this.cancel(n,t)}a.exec?a.time+=s(e/60,0):n.hasSound("player-wallrun")&&n.getSound("player-wallrun").stop(),a.oldPosition.x=i.x,a.oldPosition.y=i.y,a.oldPosition.z=i.z}}class lr extends sr{constructor(){super(ea,Yo,Ya,Ei)}additional(e,t,n){const i=t.getComponent(Ei).value;if(null===i||!i.hasComponent(Gi))return;const s=t.getComponent(Yo),o=t.getComponent(Ya);if(-1===i.getComponent(Gi).deathTime&&(s.position.y=o.standY-(o.standY-o.cluchY)*(i.hasComponent(ta)?i.getComponent(ta).value:0)),!i.hasComponent(ia))return;const a=t.getComponent(ea),r=i.getComponent(ia),l=1-ha(i);if(a.hard=!0,i.hasComponent(ss)&&i.getComponent(ss).move)a.speed=2,a.x=.5*l,a.y=.5*l,a.rotate=-.025*l;else if(i.hasComponent(oa)&&i.getComponent(oa).cameraValue>0||i.hasComponent(aa)&&i.getComponent(aa).exec)s.position.z=0,a.speed=0,a.x=0,a.y=0,a.rotate=0;else if(i.hasComponent(na)&&i.getComponent(na).exec){const e=1-i.getComponent(na).value;s.position.z=-(i.hasComponent(cs)?i.getComponent(cs).size.y:0)/2,a.speed=1.5+1.5*e,a.x=(.25+.25*e)*l,a.y=(.25+.25*e)*l,a.rotate=-(.0125+.0125*e)*l}else{s.position.z=0;const e=!!i.hasComponent(ta)&&i.getComponent(ta).enableCluch;a.speed=r.enableSprint&&!e?2:1.5,a.x=(r.enableSprint&&!e?.5:.25)*l,a.y=(r.enableSprint&&!e?.5:.25)*l,a.rotate=-(r.enableSprint&&!e?.0125:.00625)*l}n.getCamera().fov=n instanceof Gh?n.getFOVToCamera():1}}const hr=[[0,0],[1,0],[0,1],[-1,0],[0,-1],[1,1],[1,-1],[-1,1],[-1,-1]];class pr extends Bi{constructor(){super(ta,Gi,cs,Hs,ds,oa,sa)}additional(e,t,n){let{position:i}=t;const s=t.getComponent(ta),o=t.getComponent(Gi),a=t.getComponent(cs).size,r=t.hasComponent(_n)?t.getComponent(_n).size:new E(0,0),l=t.hasComponent(Sn)?t.getComponent(Sn).size:new E(0,0),h=t.getComponent(sa);for(let p=0,c=2;p<c;p=p+1|0){if(1==p&&t.hasComponent(aa)){const e=t.getComponent(aa);if(0===e.value.x)break;if(e.exec){if(-1===e.oldPosition.x||-1===e.oldPosition.y||-1===e.oldPosition.z)break;i=new C(e.oldPosition.x,e.oldPosition.y,e.oldPosition.z)}else i=new C(i.x+e.moveValue.x,i.y+e.moveValue.y,i.z+e.moveValue.z)}if(t.hasComponent(Fo)){const e=t.getComponent(Fo);(e.rightWeapon.isFire||e.leftWeapon.isFire)&&(h.enable=!1)}let c=i.x,d=i.y,u=i.z;if(t.hasComponent(ss)){const e=t.getComponent(ss);e.climb&&(c=e.last.x,d=e.last.y,u=e.last.z)}const m=t.getComponent(oa),g=0===m.cluchValue&&!(t.hasComponent($o)&&t.getComponent($o).exec)&&(n.hasBlockScaleVoxel(c,d-.001,u,.999*a.x,.001)||t.hasComponent(aa)&&t.getComponent(aa).exec)&&n.hasBlockScaleVoxel(c,d,u,.999*a.x,s.standSizeY-.001)&&!n.hasBlockScaleVoxel(c,d,u,.999*a.x,.999);let f=a.y;if(-1!==o.respawnTime)f=s.standSizeY;else if(t.hasComponent(na)&&t.getComponent(na).exec)f=s.cluchSizeY;else if(h.enable){const n=t.getComponent(sa);f=j(f,n.sizeY,n.stretchSpeed*e)}else f=g?s.cluchSizeY:s.enableCluch?t.hasComponent(aa)&&t.getComponent(aa).exec?j(f,s.cluchSizeY+(s.standSizeY-s.cluchSizeY)*Math.max(0,o.axes.x.y),s.stretchSpeed*e):j(f,s.cluchSizeY,s.stretchSpeed*e):t.hasComponent(aa)&&t.getComponent(aa).exec?j(f,s.standSizeY-(s.standSizeY-s.cluchSizeY)*Math.max(0,-o.axes.x.y),s.stretchSpeed*e):j(f,s.standSizeY,s.stretchSpeed*e);if((!t.hasComponent(ss)||(t.getComponent(cs).enable||!t.getComponent(ss).exec||n.hasHitScanVoxel(0,-Math.PI/2,t.getComponent(ss).last.x,t.getComponent(ss).last.y,t.getComponent(ss).last.z,s.standSizeY)))&&n.hasBlockScaleVoxel(c,d+f,u,a.x,.001)){const e=a.x/2*.999;for(let t=0,i=0|hr.length;t<i;t=t+1|0){const i=W(hr[t][0],hr[t][1],0,0),s=Math.cos(i)*e,o=Math.sin(i)*e,[a,r,l]=A(0,-Math.PI/2,s,o,0);if(!n.hasBlockScaleVoxel(c+a,d+r+.01,u+l,.01,.01)){const[,,,e]=n.hitScanVoxel(0,-Math.PI/2,c+a,d+r,u+l,f);-1!==e&&e<f&&(f=e)}}}s.oldFeet=a.y,a.y=f,r.y=f,l.y=f,s.value=1-Math.min(1,Math.max(0,(a.y-s.cluchSizeY)/s.cluchSizeY)),t.hasComponent($o)&&t.getComponent($o).exec||0!==m.cluchValue||!(n.hasBlockScaleVoxel(c,d-.001,u,a.x,.001)||t.hasComponent(aa)&&t.getComponent(aa).exec)||!n.hasBlockScaleVoxel(c,d,u,a.x,s.standSizeY)||n.hasBlockScaleVoxel(c,d,u,a.x,s.cluchSizeY)?s.block=!1:s.block=!0}const p=t.getComponent(Hs),c=t.getComponent(ds),d=s.oldFeet;p.isFall&&(n.hasBlockScaleVoxel(i.x,i.y+d-a.y,i.z,a.x,Math.max(.001,Math.abs(d-a.y)))?n.hasBlockScaleVoxel(i.x,Math.ceil(i.y+d-a.y),i.z,a.x,Math.max(.001,Math.abs(d-a.y)))||(i.y=Math.ceil(i.y+d-a.y)):(h.enable||t.hasComponent(ss)&&t.getComponent(ss).exec||t.hasComponent($o)&&t.getComponent($o).exec&&0!==c.value.y)&&(i.y+=d-a.y))}}class cr{constructor(e,t,n,i,s,o,a,r,l,h,p){this.value=e,this.type=t,this.attacker=n,this.direction=new E(i,s),this.position=new C(o,a,r),this.force=new C(l,h,p)}}class dr extends Bi{constructor(){super(na,jo,cs,ds)}cancel(e){const t=e.getComponent(na);t.exec=!1,t.nowSpeed=0}additional(e,t,n){const i=t.getComponent(na),o=t.getComponent(jo);if(i.value>=1&&this.cancel(t),i.exec){const n=t.getComponent(ds);i.nowSpeed<=0&&(i.nowSpeed=Math.max(i.speed,o.speed)),i.dir=z(W(n.value.x,n.value.z,0,0)),i.value+=s(e/60/i.time,0)}else i.value=0,i.nowSpeed=0;let a=0;i.value>0?(i.slideTime=0,a=Math.min(1,i.value/.125)):a=1-Math.min(1,-1===i.slideTime?1:i.slideTime/.125),i.par=a,-1!==i.slideTime&&(i.slideTime+=s(e/60,0))}physical(e,t,n){const{position:i}=t,o=t.getComponent(na),a=t.getComponent(cs),r=i.x,l=i.y,h=i.z,p=-1===o.oldPosition.x?i.x:o.oldPosition.x,c=-1===o.oldPosition.y?i.y:o.oldPosition.y,d=-1===o.oldPosition.z?i.z:o.oldPosition.z;if(o.exec){if(n.hasSound("player-sliding")?n.getSound("player-sliding").setVolume(Math.max(0,.5*(1-o.value))):n.createSound("./asset/sound/player/sliding.mp3",t,"player-sliding").setVolume(.5).play(),o.push>0){const e=r-p,u=l-c,m=h-d,g=a.size.x/2,f=a.size.y/4,[y,w]=O(o.dir,0,g),[x,M]=O(o.dir,g,0);if(0!==e||0!==u||0!==m){const a=t.getComponent(cs),g=P(e,u,m,0,0,0),[E,C]=N(e,u,m,0,0,0),v=Math.min(g,a.size.x/4,a.size.y/4,.5),[b,_,S]=A(E,C,0,0,1);i.x=p,i.y=c,i.z=d;let k=0;for(;;){i.x=p+k*b,i.y=c+k*_,i.z=d+k*S;for(let e=0,s=5;e<s;e=e+1|0){const[,,,s,a]=n.hitScan("collision",o.dir,0,i.x+y,i.y+f*e,i.z+w,.5,[t.getID()]),[,,,r,l]=n.hitScan("collision",o.dir,0,i.x+x,i.y+f*e,i.z+M,.5,[t.getID()]),[,,,h,p]=n.hitScan("collision",o.dir,0,i.x-x,i.y+f*e,i.z-M,.5,[t.getID()]),c=[[a,s],[l,r],[p,h]];let d=!1;c.forEach((e=>{let[n,s]=e,a=0;if(-1!=s&&(a=1-Math.min(1,Math.max(0,s/.5))),a>0&&n&&n instanceof Mn)if(n.hasComponent(ds)&&n.hasComponent(Ws)&&void 0!==n.getNames().find((e=>o.targetNames.includes(e)))){const[e,s]=N(n.position.x,n.position.y,n.position.z,i.x,i.y,i.z),[a,r,l]=A(e,-Math.PI/4*.25,0,0,o.push*(1-o.value));n.getComponent(Ws).value.push(new cr(0,"melee",t,e,s,i.x,i.y,i.z,a,r,l))}else d=!0})),c.length>0&&d&&this.cancel(t)}if(k>=g)break;k=Math.min(g,s(k+v,g,1e5,Math.ceil))}i.x=r,i.y=l,i.z=h}}}else n.hasSound("player-sliding")&&n.getSound("player-sliding").stop()}offset(e,t,n){const{position:i}=t,s=t.getComponent(na);s.oldPosition.x=i.x,s.oldPosition.y=i.y,s.oldPosition.z=i.z}}class ur{constructor(){this.time=-1}}class mr{constructor(){this.name="still"}update(e,t,n,i,s){const{direction:o}=n,a=i.getCamera(),r=t.getComponent(bn),l=t.getComponent(qo),h=t.getComponent(Cn),p=n.getComponent(na),c=z(o.x-p.dir),d=z(o.y),u=c>Math.PI?c-2*Math.PI:c,m=d>Math.PI?d-2*Math.PI:d;l.isRotateCenter=!1,r.rotate=l.rotate=Math.max(-Math.PI/4,Math.min(Math.PI/4,-u))/(a.fov/Ci),r.scale=l.scale=2-.75*p.par,r.position.z=.05,r.position.x=l.position.x=u/(Math.PI/2),"coil"!==s&&(r.position.y=l.position.y=m+(3.5*p.par-4.25)-Math.sin(Math.abs(u))),h.material=oi.HUD_FOOT_SLIDING}}class gr{constructor(){this.name="coil"}update(e,t,n,i,s){const{direction:o}=n,a=i.getCamera(),r=t.getComponent(Cn),l=t.getComponent(bn),h=t.getComponent(qo),p=z(o.x-(n.hasComponent(sa)?n.getComponent(sa).dir:0)),c=p>Math.PI?p-2*Math.PI:p;h.rotate=0,h.scale=1.25,l.rotate=h.rotate=Math.max(-Math.PI/4,Math.min(Math.PI/4,-c/2))/(a.fov/Ci),l.position.x=h.position.x=c,h.position.y=-.825-Math.abs(c)/(Math.PI/2)*Math.sin(Math.abs(c))*1,r.material=oi.HUD_FOOT_COIL}}class fr{constructor(){this.name="death"}update(e,t,n,i,s){t.getComponent(Cn).material=oi.NONE}}class yr extends Va{constructor(){super(ur,bn,qo,Cn),this.addAnimations(new mr,new gr,new fr)}offset(e,t,n){const i=n.getCamera();if(null!==i&&(!i.hasComponent(Ei)||i!==(t.hasComponent(Ei)?t.getComponent(Ei).value:null))){t.getComponent(Cn).material=oi.NONE}}}class wr extends Bi{constructor(){super(oa,Gi,cs,ta)}check(e,t,n,i){const{position:s}=e,o=e.getComponent(oa),a=e.getComponent(cs);let r=o.length;for(let e=0,l=5;e<l;e=e+1|0){const[l,h,p,,]=t.hitScanVoxel(n,0,s.x,s.y+i/4*e,s.z,a.size.x/2+o.length);-1===l&&-1===h&&-1===p||(r=Math.min(r,Math.max(0,T(l,p,s.x,s.z)-a.size.x/2)))}return 1-Math.min(1,Math.max(0,r/o.length))}offset(e,t,n){const{direction:i}=t,s=t.getComponent(oa),o=t.getComponent(Gi),a=t.getComponent(cs),r=t.getComponent(ta),l=n.getCamera(),[h,p]=O(i.x,o.axes.x.x,o.axes.x.y),c=W(h,p,0,0);if(s.value=this.check(t,n,i.x,a.size.y),s.standValue=this.check(t,n,c,r.standSizeY),s.cluchValue=this.check(t,n,c,r.cluchSizeY),t.hasComponent(aa)){const e=t.getComponent(aa);s.leanValue=-1===e.startDir?0:Math.max(this.check(t,n,e.startDir,r.standSizeY),this.check(t,n,e.startDir,r.cluchSizeY))}else s.leanValue=0;const[,,,d]=n.hitScanVoxel(l.direction.x,l.direction.y,l.position.x,l.position.y,l.position.z,a.size.x/2+s.length);s.cameraValue=-1!==d?1-Math.min(1,Math.max(0,(d-a.size.x/2)/s.length)):0}}class xr{constructor(e){this.init=!1,this.point=e}}class Mr extends Bi{constructor(){super(xr,Gi,cs)}additional(e,t,n){const{direction:i}=t,s=t.getComponent(xr),o=t.getComponent(Gi),a=t.getComponent(cs);if(-1!==o.deathTime&&(o.respawnTime=-1),-1!==o.respawnTime){if(t.hasComponent(ds)){const e=t.getComponent(ds);e.value.x=0,e.value.y=0,e.value.z=0}if(o.time-o.respawnTime>1){if(n.setActorPosition(t,s.point.position.x,s.point.position.y,s.point.position.z),i.x=s.point.direction.x,i.y=s.point.direction.y,o.respawnTime=-1,a.enable=!0,a.old.x=s.point.position.x,a.old.y=s.point.position.y,a.old.z=s.point.position.z,t.hasComponent(_n)){const e=t.getComponent(_n);e.enable=!0,e.old.x=s.point.position.x,e.old.y=s.point.position.y,e.old.z=s.point.position.z}n.initTrees(t)}else if(a.enable=!1,t.hasComponent(_n)){t.getComponent(_n).enable=!1}}}offset(e,t,n){const{position:i,direction:s}=t,o=t.getComponent(xr),a=t.getComponent(Gi),r=t.getComponent(cs),[l,h,p]=n.getWorldSize();o.init||(o.point.position.x=i.x,o.point.position.y=i.y,o.point.position.z=i.z,o.init=!0),-1===a.respawnTime&&-1===a.deathTime&&(i.y<=0?a.respawnTime=a.time:i.x>.999&&i.x<l-2.001&&i.y>.999&&i.y<h-2.001&&i.z>.999&&i.z<p-2.001&&n.hasHitScanVoxel(0,Math.PI/2,i.x,i.y,i.z,.01)&&!n.hasBlockScaleVoxel(i.x,i.y,i.z,r.size.x,t.hasComponent(ta)?t.getComponent(ta).standSizeY:r.size.y)&&(o.point.position.x=i.x,o.point.position.y=i.y,o.point.position.z=i.z,o.point.direction.x=s.x,o.point.direction.y=s.y))}}class Er extends Ss{constructor(e,t,n){let i=arguments.length>7?arguments[7]:void 0,s=arguments.length>8?arguments[8]:void 0,o=arguments.length>9?arguments[9]:void 0,a=arguments.length>10?arguments[10]:void 0,r=arguments.length>11?arguments[11]:void 0,l=arguments.length>12?arguments[12]:void 0,h=arguments.length>13?arguments[13]:void 0,p=arguments.length>14?arguments[14]:void 0,c=arguments.length>15&&void 0!==arguments[15]?arguments[15]:0,d=arguments.length>16&&void 0!==arguments[16]?arguments[16]:0;super(arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,arguments.length>5&&void 0!==arguments[5]?arguments[5]:"none",arguments.length>6&&void 0!==arguments[6]?arguments[6]:"shoot",i,arguments.length>17&&void 0!==arguments[17]?arguments[17]:new Array),this.burst=0,this.burstTime=-1,this.burstTick=-1,this.shootPoint=new E(e,t),this.bulletType=n,this.fireSpeed=i,this.bulletCount=s,this.bulletScale=o,this.nearBulletSpread=a,this.farBulletSpread=r,this.radius=new E(l,h),this.bulletSpeed=p,this.burstCount=c,this.burstInterval=d}}class Cr extends Bi{constructor(){super(Ra,Ws,Ei,Cn,jo,cs,ds)}getMaterial(e,t,n){return t.hasOwnProperty(n)?t[n]:e}offset(e,t,n){const{position:i,direction:o}=t,a=t.getComponent(Ra),r=t.getComponent(Ws),l=t.getComponent(cs),h=t.getComponent(Ei).value,p=t.getComponent(ds);if(null===h||!(h instanceof Mn))return;if(t.hasComponent(_n)){t.getComponent(_n).targets.forEach((e=>{if(!e.hasComponent(Ra)||!e.hasComponent(Ws))return;const t=e.getComponent(Ws);r.attacker=r.attacker||t.attacker}))}const c=n.getCamera(),d=t.hasComponent(Er)?t.getComponent(Er).shootPoint:new E(0,l.size.y/4),u=h.hasComponent(Sn)?h.getComponent(Sn).size:new E(0,0),m=W(h.position.x,h.position.z,i.x,i.z),[g,f]=O(m,d.x,0),y=d.y,w=l.size.y/2+y,x=u.y/4*3,M=i.x+g,C=i.y+w,v=i.z+f,b=i.x+a.seePosition.x*l.size.x/2,_=i.y+l.size.y/2+a.seePosition.y*l.size.y/2,S=i.z+a.seePosition.z*l.size.x/2,k=h.position.x,T=h.position.y+x,I=h.position.z,L=P(k,T,I,M,C,v),z=W(k,I,M,v),[D,R]=O(z,(h.hasComponent(cs)?h.getComponent(cs).size.x:0)/2,0),[B,Y]=N(k,T,I,M,C,v),[G,V]=N(k+D,T,I+R,M,C,v),[X,j]=N(k-D,T,I-R,M,C,v),K=n instanceof Gh?n.getPlayer():null;let J=!1;if((null===K||!K.hasComponent(Gi)||(-1===K.getComponent(Gi).goleTime||K.getComponent(Gi).goleTime<1e3)&&(-1===K.getComponent(Gi).deathTime||K.getComponent(Gi).deathTime<1e3))&&(J=!n.hasHitScanVoxel(B,Y,b,_,S,L)||!n.hasHitScanVoxel(G,V,b,_,S,L)||!n.hasHitScanVoxel(X,j,b,_,S,L)),a.isSee=J,J){if(a.see||(a.see=!0,a.findVoices.length>0&&n.createSound(a.findVoices[a.findVoices.length*Math.random()|0],t,"enemy-voice-".concat(t.getID())).setVolume(10).play()),h.hasComponent(Gi)){const e=h.getComponent(Gi),t=n.getCamera(),[i,s]=N(M,C,v,t.position.x,t.position.y,t.position.z),[o,a]=U(i,s,t.direction.x,t.direction.y);e.readySlowMo=e.readySlowMo||o<Math.PI/3&&a<Math.PI/3}const[i,r]=F(B,Y,o.x,o.y);o.x+=s(i*Math.min(1,a.angleForce*e),0),o.y+=s(r*Math.min(1,a.angleForce*e),0)}else o.x=s(B,o.x),o.y=s(Y,o.y);const q=t.getComponent(Cn),Z=a.painTime>0&&-1===a.painStartTime?r.value.length>0:a.time-a.painStartTime<a.painTime,Q=a.blow&&(null!==r.attacker&&-1===a.blowStartTime?Math.abs(p.value.x)>.25||Math.abs(p.value.y)>.25||Math.abs(p.value.z)>.25:a.time-a.blowStartTime<a.blowTime),$=Q||Z,ee=t.hasComponent(Ss)?t.getComponent(Ss).attackType:"none",te=i.x,ne=i.y,ie=i.z,se=t.getComponent(jo);if($&&(Q?-1===a.blowStartTime&&(a.painVoices.length>0&&n.createSound(a.painVoices[a.painVoices.length*Math.random()|0],t,"enemy-voice-".concat(t.getID())).setVolume(10).play(),a.blowStartTime=a.time,q.flip.x=Math.random()>.5):-1===a.painStartTime&&(a.painVoices.length>0&&n.createSound(a.painVoices[a.painVoices.length*Math.random()|0],t,"enemy-voice-".concat(t.getID())).setVolume(10).play(),a.painStartTime=a.time,q.flip.x=Math.random()>.5)),$||(a.blowStartTime=-1,a.painStartTime=-1,q.flip.x=!1),!a.air&&(!t.hasComponent(ds)||0!==t.getComponent(ds).value.y)&&t.hasComponent(cs)&&t.getComponent(cs).hit.y>=0?a.isAir=!0:a.isAir=!1,t.hasComponent(Hs)){const e=t.getComponent(Hs);r.value.some((e=>"hook"===e.type))?e.fall=0:e.fall=1}if(a.isAir||$||0!==r.value.length||(r.attacker=null),a.isBlow=!1,a.isDown=!1,-1!==a.blowStartTime&&(Math.abs(p.value.x)>.1||Math.abs(p.value.y)>.1||Math.abs(p.value.z)>.1?(a.isBlow=!0,a.blowStartTime=a.time):a.isDown=!0),t.hasComponent(Sn)){const e=t.getComponent(Sn).size;if(a.isDown){if(e.y!==a.blowHeight){const e=a.stillHeight/a.blowHeight;t.hasComponent(cs)&&(t.getComponent(cs).size.y*=e),t.hasComponent(_n)&&(t.getComponent(_n).size.y*=e)}e.y=a.blowHeight}else{if(e.y!==a.stillHeight){const e=a.blowHeight/a.stillHeight;t.hasComponent(cs)&&(t.getComponent(cs).size.y*=e),t.hasComponent(_n)&&(t.getComponent(_n).size.y*=e)}e.y=a.stillHeight}}const[oe,ae,re]=A(t.direction.x,t.direction.y,(t.hasComponent(cs)?t.getComponent(cs).size.x:.1)/2,0,0),[le,he]=N(k,T,I,M,C,v),[pe,ce]=N(k,T,I,M+oe,C+ae,v+re),[de,ue]=N(k,T,I,M-oe,C+ae,v-re);if(!J||$||!a.air&&a.isAir||"melee"===ee&&L>=a.attackRangeMax?a.aimStartTime=-1:-1!==a.aimStartTime||"none"===ee||("shoot"===ee||"shoot-range"===ee?n.hasHitScanVoxel(le,he,M,C,v,L)||n.hasHitScanVoxel(pe,ce,M+oe,C+ae,v+re,L)||n.hasHitScanVoxel(de,ue,M-oe,C+ae,v-re,L):"melee"===ee&&!n.hitScanBold("collision",B,Y,M,C,v,l.size.x,L,[t.getID(),h.getID()]))||(a.aimStartTime=a.time),a.see){if(a.isBlow||a.isDown)se.move.x=0,se.move.y=0,se.move.z=0;else{if(se.speed>0&&!this.hasWaitAsync(t)&&a.time>a.nextFindTime){const e=a.time,s=new Tn(a.air);this.beginAsync(t,n.findPath(s,te,ne,ie,((e,i)=>{let s=e.x-e.stepX,o=e.y-e.stepY,r=e.z-e.stepZ;if((0|s)==(0|te)&&(0|o)==(0|ne)&&(0|r)==(0|ie)&&(s=te,o=ne,r=te),n.getVoxel(e.x,e.y,e.z)!==li&&n.hasBlockScaleVoxel(e.x,0|e.y,e.z,l.size.x,l.size.y)||!a.air&&(n.getVoxel(e.x,(0|e.y)-1,e.z)===li||!n.hasBlockScaleVoxel(e.x,(0|e.y)-1,e.z,l.size.x,.001))||(a.air?(0!==e.stepX&&0!==e.stepZ||0!==e.stepY&&(0!==e.stepX||0!==e.stepZ))&&n.hasBlockScaleVoxel(s+e.stepX/2,(0|o)+e.stepY/2,r-e.stepZ/2,l.size.x,l.size.y):0!==e.stepX&&0!==e.stepZ&&n.hasBlockScaleVoxel(s+e.stepX/2,0|o,r-e.stepZ/2,l.size.x,l.size.y)))i.block=!0;else if(n.hasBlockScale("collision",e.x,e.y,e.z,l.size.x,l.size.y,[t.getID(),h.getID(),...a.filters,...t.hasComponent(_n)?t.getComponent(_n).filter:[]])){const[p,c]=N(e.stepX,e.stepY,e.stepZ,0,0,0),[d,u,m,,g]=n.hitScanBold("collision",p,c,s,(0|o)+w,r,Math.min(l.size.x,l.size.y),P(e.x,e.y,e.z,e.x-e.stepX,e.y-e.stepY,e.z-e.stepZ),[t.getID(),h.getID(),...a.filters,...t.hasComponent(_n)?t.getComponent(_n).filter:[]]);-1!==d&&-1!==u&&-1!==m&&(i.block=!0,null===g&&(i.label="".concat(e.stepX,",").concat(e.stepY,",").concat(e.stepZ)))}}),(e=>{const t=P(k,T,I,e.x,(0|e.y)+w,e.z),[i,s]=N(k,T,I,e.x,(0|e.y)+w,e.z);let o,r,p,c,d,u,m,g;return"shoot"===ee||"shoot-range"===ee||"always"===ee?([o,,r]=A(i,s,.75,0,0),[p,c]=N(k,T,I,e.x,(0|e.y)+w,e.z),[d,u]=N(k,T,I,e.x+o,(0|e.y)+w,e.z+r),[m,g]=N(k,T,I,e.x-o,(0|e.y)+w,e.z-r)):([o,,r]=A(i,s,l.size.x/2,0,0),[p,c]=N(k,T,I,e.x,(0|e.y)+w,e.z),[d,u]=N(k+o,T,I+r,e.x+o,(0|e.y)+w,e.z+r),[m,g]=N(k-o,T,I-r,e.x-o,(0|e.y)+w,e.z-r)),!n.hasHitScanVoxel(p,c,e.x,(0|e.y)+w,e.z,t)&&!n.hasHitScanVoxel(d,u,e.x+o,(0|e.y)+w,e.z+r,t)&&!n.hasHitScanVoxel(m,g,e.x-o,(0|e.y)+w,e.z-r,t)&&!Ee(e.x,e.y,e.z,l.size.x,l.size.y,h.position.x,h.position.y,h.position.z,h.hasComponent(cs)?h.getComponent(cs).size.x:0,h.hasComponent(cs)?h.getComponent(cs).size.y:0)&&(t<=a.attackRangeMax&&t>=a.attackRangeMin||("shoot"===ee||"always"===ee?t>=a.attackRangeMin:t<=a.attackRangeMax))&&((0|e.x)==(0|te)&&(0|e.y)==(0|ne)&&(0|e.z)==(0|ie)||!!a.air||H(h.direction.x,W(k,I,e.x,e.z))<Math.PI/2||"shoot"!==ee&&"always"!==ee||t>=a.attackRangeMax)}),(e=>{if("shoot"===ee){const i=P(k,T,I,e.x,(0|e.y)+w,e.z),[s,o]=N(k,T,I,e.x,(0|e.y)+w,e.z);if(i<=a.attackRangeMin||!a.air&&("shoot"===ee&&H(h.direction.x,W(k,I,e.x,e.z))>Math.PI/1.5)&&(()=>{const[a,r,l]=A(s,o,(t.hasComponent(cs)?t.getComponent(cs).size.x:.1)/2,0,0),[h,p]=N(k,T,I,e.x,(0|e.y)+w,e.z),[c,d]=N(k,T,I,e.x+a,(0|e.y)+w+r,e.z+l),[u,m]=N(k,T,I,e.x-a,(0|e.y)+w+r,e.z-l);return!n.hasHitScanVoxel(h,p,e.x,(0|e.y)+w,e.z,i)&&!n.hasHitScanVoxel(c,d,e.x+a,(0|e.y)+w+r,e.z+l,i)&&!n.hasHitScanVoxel(u,m,e.x-a,(0|e.y)+w+r,e.z-l,i)}))return P(te,ne,ie,k,T,T)+e.cost}return e.getCost(k,T,I)}),(()=>a.see&&a.time-e<1&&h.hasLive()&&t.hasLive()),(()=>{const e=W(h.position.x,h.position.z,i.x,i.z),[t,s]=O(e,d.x,0),o=d.y,r=l.size.y/2+o,p=i.x+t,u=i.y+r,m=i.z+s,g=n.getWorldDistance();return Math.min(0,P(c.position.x,c.position.y,c.position.z,p,u,m)/g)+(a.isSee?0:1)}))).then((()=>{a.path=s,a.hide=!1,a.nextFindTime=a.time+a.findInterval+a.findIntervalRandom*Math.random()}),(e=>{const o=a.time;this.beginAsync(t,n.findPath(s,i.x,i.y,i.z,((e,i)=>{const[s,o]=N(e.stepX,e.stepY,e.stepZ,0,0,0);i.block=n.getVoxel(e.x,e.y,e.z)!==li&&n.hasBlockScaleVoxel(e.x,0|e.y,e.z,l.size.x,l.size.y)||!a.air&&(n.getVoxel(e.x,(0|e.y)-1,e.z)===li||!n.hasBlockScaleVoxel(e.x,(0|e.y)-1,e.z,l.size.x,.001))||n.hasBlockScale("collision",e.x,e.y,e.z,l.size.x,l.size.y)||n.hasHitScanBold("collision",s,o,e.x,(0|e.y)+w,e.z,l.size.x,P(0,0,0,1,1,1),[t.getID(),h.getID(),...a.filters,...t.hasComponent(_n)?t.getComponent(_n).filter:[]])}),(e=>{const t=P(k,T,I,e.x,(0|e.y)+w,e.z),[i,s]=N(k,T,I,e.x,(0|e.y)+w,e.z),[o,a]=O(i,l.size.x/2,0);return n.hasHitScanVoxel(i,s,e.x+o,0|e.y,e.z+a,t)&&n.hasHitScanVoxel(i,s,e.x-o,0|e.y,e.z-a,t)&&n.hasHitScanVoxel(i,s,e.x+o,(0|e.y)+w,e.z+a,t)&&n.hasHitScanVoxel(i,s,e.x-o,(0|e.y)+w,e.z-a,t)}),(e=>P(h.position.x,h.position.y,h.position.z,e.x,e.y,e.z)<a.attackRangeMin?1/0:e.getCost(k,T,I)*(H(h.direction.x,W(k,I,e.x,e.z))<Math.PI/2?2:1)),(()=>h.hasLive()&&t.hasLive()&&a.time-o<1),(()=>{const e=W(h.position.x,h.position.z,i.x,i.z),[t,s]=O(e,d.x,0),o=d.y,r=l.size.y/2+o,p=i.x+t,u=i.y+r,m=i.z+s,g=n.getWorldDistance();return Math.min(0,P(c.position.x,c.position.y,c.position.z,p,u,m)/g)+1+(a.isSee?0:1)}))).then((()=>{a.path=s,a.hide=!0,a.nextFindTime=a.time+a.findInterval+a.findIntervalRandom*Math.random()}))}))}if(se.look.x=0,se.move.z=0,a.air){const[e,t]=N(k,T,I,i.x,i.y,i.z);se.look.x=e,se.look.y=t}else se.look.x=W(k,I,i.x,i.z),se.look.y=0;if(a.see&&!$&&null!==a.path&&a.path.stack.length>0&&(!a.isAimWait||-1===a.aimStartTime||a.time-a.aimStartTime>a.aimTime)&&(a.air||n.hasBlockScaleVoxel(i.x,i.y-.001,i.z,l.size.x,.001))){let e=a.path.stack[0],t=a.path.stack[1],n=a.path.stack[2];for(;a.path.stack.length>3&&(0|e)<=i.x&&1+(0|e)>=i.x&&(0|t)<=i.y&&1+(0|t)>=i.y&&(0|n)<=i.z&&1+(0|n)>=i.z;)a.path.stack.shift(),a.path.stack.shift(),a.path.stack.shift(),e=a.path.stack[0],t=a.path.stack[1],n=a.path.stack[2];if(a.air){const[s,o]=N(e,t,n,i.x,i.y,i.z);se.look.x=s,se.look.y=o,se.move.z=Math.min(1,P(e,0|t,n,i.x,i.y,i.z))}else se.look.x=W(e,n,i.x,i.z),se.look.y=0,se.move.z=Math.min(1,P(e,0|t,n,i.x,i.y,i.z))}else se.move.z=0}if(t.hasComponent(Ss)){const e=t.getComponent(Ss),[n,s]=N(h.position.x,h.position.y,h.position.z,i.x,i.y,i.z),[r,l]=U(n,s,o.x,o.y);-1!==a.aimStartTime&&a.time-a.aimStartTime>a.aimTime&&("always"===ee||a.attackRadius>r&&a.attackRadius>l)?e.enable=!0:e.enable=!1}}else a.path=null,se.move.x=0,se.move.y=0,se.move.z=0,se.look.x=0,se.look.y=0,t.hasComponent(Ss)&&(t.getComponent(Ss).enable=!1);Q?a.isBlow?q.material=this.getMaterial(a.stillMaterial,a.otherMaterials,"blow"):a.isDown&&(q.material=this.getMaterial(a.stillMaterial,a.otherMaterials,"down")):-1!==a.painStartTime?q.material=this.getMaterial(a.stillMaterial,a.otherMaterials,"pain"):-1!==a.aimStartTime&&(a.time-a.aimStartTime)/a.aimTime>.5?q.material=this.getMaterial(a.stillMaterial,a.otherMaterials,"aim"):q.material=a.stillMaterial,a.angleRight.x=o.x+(G-B),a.angleRight.y=o.y+(G-Y),a.angleLeft.x=o.x-(B-X),a.angleLeft.y=o.y-(Y-j),a.time+=s(e/60,0)}}class vr extends Mn{constructor(e,t,n,i,s,o,a){super("bullet-trail",new Cn(o,i,s,a),new vn(!0,!0,!0)),this.position.x=e,this.position.y=t,this.position.z=n}}class br extends Bi{constructor(){super(hs)}physical(e,t,n){const{position:i,direction:s}=t,o=t.getComponent(hs);if(t.hasComponent(ps)){const e=t.getComponent(ps);let{target:a}=e;const{hitPosition:r}=e,l=null!==e.target?e.target.position:e.hitPosition,h=null!==e.target?o.fixPosition:new C(0,0,0);if(e.hit&&!e.over&&o.isDeath){let t=!1;if(null!==a){const[n,i]=N(a.position.x,a.position.y+(a.hasComponent(cs)?a.getComponent(cs).size.y:0)/2,a.position.z,e.hitPosition.x,e.hitPosition.y,e.hitPosition.z),s=es(a,"health",1);if((a.hasComponent(Ws)?a.getComponent(Ws).value.reduce(((e,t)=>e+t.value),0):0)>=s)e.hit=!1,e.over=!1,e.hitPosition.x=-1,e.hitPosition.y=-1,e.hitPosition.z=-1,e.target=null,t=!0;else if(a.hasComponent(Ws)&&!o.init){let t=0,s=0,r=0;e.hit&&([t,s,r]=A(e.originDirection.x,e.originDirection.y,0,o.force/2,o.force)),a.getComponent(Ws).value.push(new cr(o.damage*Math.max(1,Math.floor(1+Math.random()*o.random)),o.damageType,e.attacker,n,i,e.start.x,e.start.y,e.start.z,t,s,r))}}if(e.hit&&!e.over){const[t,i,a]=A(s.x,s.y,0,0,.1),l=o.getSpark(r.x-t,r.y-i,r.z-a,s.x,s.y,e.target,e.filter);null!==l&&n.addEntitys(l)}t||(o.init||null!==a&&(o.fixPosition.x=e.hitPosition.x-a.position.x,o.fixPosition.y=e.hitPosition.y-a.position.y,o.fixPosition.z=e.hitPosition.z-a.position.z),o.init=!0)}e.hit&&(null!==e.target&&"chain"===o.trailType?(i.x=l.x+h.x,i.y=l.y+h.y,i.z=l.z+h.z):(i.x=e.hitPosition.x,i.y=e.hitPosition.y,i.z=e.hitPosition.z)),!t.hasComponent(wa)&&(e.hit||e.over)&&o.isRemove&&t.remove()}else{if(t.hasComponent(_n)){const e=t.getComponent(_n);e.targets.forEach((e=>{if(!(e instanceof Mn))return;const[a,r]=N(e.position.x,e.position.y+(e.hasComponent(cs)?e.getComponent(cs).size.y:0)/2,e.position.z,i.x,i.y,i.z),l=es(e,"health",1);if((e.hasComponent(Ws)?e.getComponent(Ws).value.reduce(((e,t)=>e+t.value),0):0)<l&&e.hasComponent(Ws)){let n=0,s=0,l=0,h=null;if(t.hasComponent(us)){const e=t.getComponent(us);[n,s,l]=A(e.originDirection.x,e.originDirection.y,0,o.force/2,o.force),h=e.attacker}e.getComponent(Ws).value.push(new cr(o.damage*Math.max(1,Math.floor(1+Math.random()*o.random)),o.damageType,h,a,r,i.x,i.y,i.z,n,s,l))}const[h,p,c]=A(s.x,s.y,0,0,.1),d=o.getSpark(i.x-h,i.y-p,i.z-c,z(a+z(a-s.x)),z(r+z(r-s.y)),e,t.hasComponent(ps)?t.getComponent(ps).filter:[]);null!==d&&n.addEntitys(d)})),e.targets.length>0&&!t.hasComponent(wa)&&o.isRemove&&t.remove()}if(t.hasComponent(cs)){const e=t.getComponent(cs);if(0!==e.hit.x||0!==e.hit.y||0!==e.hit.z){const[a,r,l]=A(s.x,s.y,0,0,.1),h=o.getSpark(i.x-a,i.y-r,i.z-l,-1===e.hit.angle.x?z(s.x-Math.PI):z(e.hit.angle.x+z(e.hit.angle.x-s.x)),-1===e.hit.angle.y?s.y:z(e.hit.angle.y+z(e.hit.angle.y-s.y))-Math.PI,null,t.hasComponent(ps)?t.getComponent(ps).filter:[]);null!==h&&n.addEntitys(h),!t.hasComponent(wa)&&o.isRemove&&t.remove()}else{const[e,n]=t.hasComponent(ds)?N(t.getComponent(ds).value.x,t.getComponent(ds).value.y,t.getComponent(ds).value.z,0,0,0):[s.x,s.y];s.x=e,s.y=n}}}}rendering(e,t){const{position:n,direction:i}=e,s=e.getComponent(hs);if(e.hasComponent(ps)){const o=e.getComponent(ps);if(!o.hit&&s.images.length>0&&"flash"===s.trailType)if(e.hasComponent(ms)){const[o,a,r]=A(i.x,i.y,0,0,s.trailLength),l=0|s.effectCount,h=e.getComponent(ms).value;for(;h.length>l;){const e=h.pop();e&&e.hasLive()&&e.remove()}for(let e=0;e<l;e=e+1|0){const i=e/(l-1);if(h.length<=e){const l=s.startScale+(s.endScale-s.startScale)*i;l>0&&t.addEntitys(h[e]=new vr(n.x-o*i,n.y-a*i,n.z-r*i,l,s.isTrailRotateRandom?Math.PI*Math.random():0,s.images[(s.images.length-1)*i|0],s.trailBounding))}const p=h[e];p&&p instanceof Mn&&p.hasLive()&&(p.position.x=n.x-o*i,p.position.y=n.y-a*i,p.position.z=n.z-r*i)}}if("chain"===s.trailType)if(null!==o.attacker&&e.hasComponent(ms)){const i=t.getCamera(),[a,,,,,]=as(o.attacker),r=(s.invert?.045:-.045)/i.fov,l=-.125,h=o.attacker.hasComponent(cs)?o.attacker.getComponent(cs).size.x/2:0,[p,c,d]=A(i.direction.x,i.direction.y,a?0:r,l,h),u=P(i.position.x+p,i.position.y+c,i.position.z+d,n.x,n.y,n.z),[m,g]=N(n.x,n.y,n.z,i.position.x+p,i.position.y+c,i.position.z+d),f=u/.25|0,y=e.getComponent(ms).value;for(;y.length>f;){const e=y.pop();e&&e.hasLive()&&e.remove()}for(let e=0;e<f;e=e+1|0){const n=e/(f-1),[o,a,r]=A(m,g,0,0,u*(e/(f-1)));if(y.length<=e){const l=s.startScale+(s.endScale-s.startScale)*n;l>0&&t.addEntitys(y[e]=new vr(i.position.x+p+o,i.position.y+c+a,i.position.z+d+r,l,s.isTrailRotateRandom?Math.PI*Math.random():0,s.images[(s.images.length-1)*n|0],s.trailBounding))}const l=y[e];l&&l instanceof Mn&&l.hasLive()&&(l.position.x=i.position.x+p+o,l.position.y=i.position.y+c+a,l.position.z=i.position.z+d+r)}}}}}class _r extends Bi{constructor(){super(ps)}offset(e,t,n){const{position:i,direction:s}=t,o=t.getComponent(ps);let a=-1,r=-1,l=-1,h=1/0,p=null;o.size<=0?[a,r,l,h,p]=n.hitScan(o.tree,o.originDirection.x,o.originDirection.y,o.originPosition.x,o.originPosition.y,o.originPosition.z,h,[...o.attacker?[o.attacker.getID()]:[],...o.filter]):[a,r,l,h,p]=o.findTarget?n.hitScanBoldFind(o.tree,o.originDirection.x,o.originDirection.y,o.originPosition.x,o.originPosition.y,o.originPosition.z,o.size,h,[...o.attacker?[o.attacker.getID()]:[],...o.filter]):n.hitScanBold(o.tree,o.originDirection.x,o.originDirection.y,o.originPosition.x,o.originPosition.y,o.originPosition.z,o.size,h,[...o.attacker?[o.attacker.getID()]:[],...o.filter]);const[c,d,u]=n.getWorldSize(),[m,g,f]=A(o.originDirection.x,o.originDirection.y,0,0,o.speed*e);if(o.hit||o.over)o.originPosition.x=a-m,o.originPosition.y=r-g,o.originPosition.z=l-f;else{const[t,n]=N(a,r,l,i.x,i.y,i.z),[h,y,w]=A(t,n,0,0,o.speed*e);if((o.behind?P(o.originPosition.x,o.originPosition.y,o.originPosition.z,o.start.x,o.start.y,o.start.z):P(i.x,i.y,i.z,o.start.x,o.start.y,o.start.z))<o.distance&&i.x>0&&i.x<c&&i.y>0&&i.y<d&&i.z>0&&i.z<u){let e=0,x=0;if(o.behind){const t=o.originPosition.x,n=o.originPosition.y,i=o.originPosition.z,s=o.originPosition.x+m,h=o.originPosition.y+g,p=o.originPosition.z+f;e=P(t,n,i,a,r,l),x=P(t,n,i,s,h,p)}else{const t=i.x+h,n=i.y+y,s=i.z+w;e=P(i.x,i.y,i.z,a,r,l),x=P(i.x,i.y,i.z,t,n,s)}s.x=t,s.y=n,e<x&&(o.hit=!0,o.hitTime=o.time,o.hitPosition.x=a,o.hitPosition.y=r,o.hitPosition.z=l,o.target=p&&p instanceof Mn?p:null,(P(a,r,l,o.start.x,o.start.y,o.start.z)>o.distance||a<=0||a>=c-.001||r<=0||r>=d-.001||l<=0||l>=u-.001)&&(o.over=!0))}else o.over=!0;o.hit&&o.over||(i.x+=h,i.y+=y,i.z+=w,o.originPosition.x+=m,o.originPosition.y+=g,o.originPosition.z+=f)}o.time+=e/60}}class Sr extends Bi{constructor(){super(Er,Ei,Ra)}offset(e,t,n){const i=performance.now(),{position:o,direction:a}=t,r=t.getComponent(Er),l=t.getComponent(cs),h=t.getComponent(Ei).value,p=t.getComponent(Ra);if(null===h||!(h instanceof Mn))return;r.exec=!0;const c=W(h.position.x,h.position.z,o.x,o.z),[d,u,m]=A(c,0,r.shootPoint.x,r.shootPoint.y,0),g=l.size.y/2+u,f=(h.hasComponent(Sn)?h.getComponent(Sn).size.y:0)/2,y=o.x+d,w=o.y+g,x=o.z+m,M=h.position.x,E=h.position.y+f,C=h.position.z,v=r.time-r.time%r.fireSpeed;if(r.enable){const o=P(M,E,C,y,w,x),l=s(Math.min(1,o/(t.hasComponent(Ra)?t.getComponent(Ra).attackRangeMax:0)),0),h=r.nearBulletSpread+(r.farBulletSpread-r.nearBulletSpread)*l;if(r.fireTick!==v||r.burst>0&&r.burst<r.burstCount){r.fireTick!==v&&(r.burst=0),r.burst<r.burstCount&&(r.burstTime=-1===r.burstTime?0:r.burstTime+s(e/60,0));const l=r.burstTime-r.burstTime%r.burstInterval;if(r.burstTick!==l){const e=new Array;let s=a.x,l=a.y;n.hasHitScanVoxel(a.x,a.y,y,w,x,o)?n.hasHitScanVoxel(p.angleRight.x,p.angleRight.y,y,w,x,o)?n.hasHitScanVoxel(p.angleLeft.x,p.angleLeft.y,y,w,x,o)||(s=p.angleLeft.x,l=p.angleLeft.y):(s=p.angleRight.x,l=p.angleRight.y):(s=a.x,l=a.y);for(let n=0,i=0|r.bulletCount;n<i;n=n+1|0){const n=new r.bulletType(y,w,x,y,w,x,s+Math.cos(Math.random()*Math.PI*2)*h,l+Math.cos(Math.random()*Math.PI*2)*h,r.bulletSpeed,!1,1/0,r.bulletScale,!1,r.damage,r.random,r.bulletCount,0,!1,r.damageType,t,null,["enemy","object",...r.filter]);t.hasComponent(Ei)&&n.hasComponent(Ei)&&(n.getComponent(Ei).value=t.getComponent(Ei).value),e.push(n)}n.addEntitys(...e),n.createSound("./asset/sound/enemy/fire-magic.mp3",t,"fire-enemy-".concat(t.getID())).play(),r.burst=Math.min(r.burstCount,r.burst+1),r.fireStartTime=t.hasComponent(Ra)?t.getComponent(Ra).time:i}r.burstTick=l}else r.burstTime=-1,r.burstTick=-1;r.fireTick=v,r.burst>=r.burstCount&&(r.time+=s(e/60,0))}else r.time>0&&(r.burst=0,r.burstTick=-1,r.burstTime=-1,r.fireTick!==v?(r.fireTick=-1,r.time=0):(r.fireTick=v,r.time+=s(e/60,0)))}}class kr extends Ss{constructor(){let e=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,t=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:"none","melee",arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,arguments.length>6&&void 0!==arguments[6]?arguments[6]:new Array),this.air=!1,this.start=new C(-1,-1,-1),this.end=new C(-1,-1,-1),this.oldPosition=new C(-1,-1,-1),this.jumpForce=new E(e,t)}}class Tr extends Bi{constructor(){super(kr,Ei,cs,_n,ds)}additional(e,t,n){const{position:i}=t,s=t.getComponent(kr),o=t.getComponent(Ei).value,a=t.getComponent(_n);if(null===o||!(o instanceof Mn))return;const[r,l]=N(o.position.x,o.position.y+(o.hasComponent(cs)?o.getComponent(cs).size.y:0)/2,o.position.z,i.x,i.y,i.z);if(s.enable&&!s.air){const e=s.time-s.time%s.fireSpeed;if(s.fireTick!==e&&s.exec){const e=t.getComponent(ds),h=P(o.position.x,o.position.y+(o.hasComponent(cs)?o.getComponent(cs).size.y:0)/2,o.position.z,i.x,i.y,i.z),[p,c,d]=A(r,l,0,h*s.jumpForce.y,h*s.jumpForce.x);p>0?e.value.x=e.value.x<Math.abs(p)?Math.min(Math.abs(p),e.value.x+p):e.value.x:p<0&&(e.value.x=e.value.x>-Math.abs(p)?Math.max(-Math.abs(p),e.value.x+p):e.value.x),c>0?e.value.y=e.value.y<Math.abs(c)?Math.min(Math.abs(c),e.value.y+c):e.value.y:c<0&&(e.value.y=e.value.y>-Math.abs(c)?Math.max(-Math.abs(c),e.value.y+c):e.value.y),d>0?e.value.z=e.value.z<Math.abs(d)?Math.min(Math.abs(d),e.value.z+d):e.value.z:d<0&&(e.value.z=e.value.z>-Math.abs(d)?Math.max(-Math.abs(d),e.value.z+d):e.value.z),s.air=!0,a.filter.push(...s.filter),n.createSound("./asset/sound/enemy/fire-melee.mp3",t,"fire-enemy-".concat(t.getID())).play()}s.fireTick=e}s.air||(s.time+=e/60)}offset(e,t,n){var i;const s=performance.now(),{position:o}=t,a=t.getComponent(kr),r=t.getComponent(Ei).value,l=t.getComponent(cs),h=t.getComponent(_n);if(null===r||!(r instanceof Mn))return;const[p,c]=N(r.position.x,r.position.y+(r.hasComponent(cs)?r.getComponent(cs).size.y:0)/2,r.position.z,o.x,o.y,o.z),d=P(r.position.x,r.position.y,r.position.z,o.x,o.y,o.z),[u,m]=O(p,l.size.x/2,0);if(!n.hasBlockScaleVoxel(o.x,o.y-.001,o.z,l.size.x,.001)||n.hasBlockScaleVoxel(o.x,o.y,o.z,l.size.x,Math.ceil(l.size.y))||n.hasHitScan("collision",p,c,o.x+u,o.y+l.size.y/2,o.z+m,d,a.filter)||n.hasHitScan("collision",p,c,o.x-u,o.y+l.size.y/2,o.z-m,d,a.filter)?a.exec=!1:a.exec=!0,t.hasComponent(Hs)&&!t.getComponent(Hs).isFall){const e=t.getComponent(ds);a.air&&(e.value.x=0,e.value.z=0),a.air=!1,me(h.filter)}else if(a.enable&&a.air){const[e,h]=N(r.position.x,r.position.y+(r.hasComponent(cs)?r.getComponent(cs).size.y:0)/2,r.position.z,o.x,o.y,o.z),p=l.size.x,[c,d,u,,]=(null===(i=n.getTree("hitbox"))||void 0===i?void 0:i.getOldEntityProperty(t))||[o.x,o.y,o.z,0,0];if(r.hasComponent(Ws)&&n.hasHitScanActor("hitbox",e,h,c,d,u,p,[t.getID(),...a.filter])){r.getComponent(Ws).value.push(new cr(a.damage*Math.max(1,Math.floor(1+Math.random()*a.random)),a.damageType,t,e,h,o.x,o.y,o.z,0,0,0)),a.air=!1,a.fireStartTime=t.hasComponent(Ra)?t.getComponent(Ra).time:s}}a.oldPosition.x=o.x,a.oldPosition.y=o.y,a.oldPosition.z=o.z}}class Pr{constructor(e,t,n){this.offset=new C(e,t,n)}}class Ir{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.time=0,this.startScale=-1,this.speed=e,this.scale=t,this.loop=n}}class Lr{constructor(e,t,n,i,s){this.origin=new C(e,t,n),this.direction=new E(i,s)}}class Or{constructor(e,t){this.spawnTime=performance.now(),this.scale=e,this.attacker=t}}class Ar extends Mn{constructor(e,t,n,i){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,r=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;for(var l=arguments.length,h=new Array(l>8?l-8:0),p=8;p<l;p++)h[p-8]=arguments[p];super("effect blood",new Cn(e,0,0,.75,Math.random()>.5,!1),new vn(!0,!0,!0,0),new ds(.001,0,.001,0),new Hs(.5),new Ir(.5+.25*Math.random(),s,!1),new Ms(1.25),new Lr(t,n,i,...N(o,a,r,0,0,0)),...h);const{position:c}=this;c.x=t,c.y=n,c.z=i;const d=this.getComponent(ds);d.value.x=o,d.value.y=a,d.value.z=r}}class Wr extends Ar{constructor(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;super([oi.EFFECT_BLOOD_RED1,oi.EFFECT_BLOOD_RED2,oi.EFFECT_BLOOD_RED3][3*Math.random()|0],e,t,n,i,s,o,a)}}class Nr extends Ar{constructor(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;super([oi.EFFECT_BLOOD_GREEN1,oi.EFFECT_BLOOD_GREEN2,oi.EFFECT_BLOOD_GREEN3][3*Math.random()|0],e,t,n,i,s,o,a)}}class zr extends Mn{constructor(e,t,n,i,s){super("effect acid",new Cn(oi.EFFECT_ACID,e,Math.random()*w,.75,Math.random()>.5,!1),new vn(!1,!0,!1,0),new Or(e,s));const{position:o}=this;o.x=t,o.y=n,o.z=i}}function Dr(e){return Math.abs(Math.ceil(e)-e)<.1?Math.ceil(e):Math.abs(Math.floor(e)-e)<.1?Math.floor(e):e}class Rr extends Bi{constructor(){super(ks)}additional(e,t,n){const i=performance.now(),{position:o}=t,a=t.getComponent(ks),r=a.time-a.time%a.fireSpeed,l=Dr(o.x),h=Dr(o.y),p=Dr(o.z);if(a.exec=!0,a.enable){const c=new Array,d=t instanceof xs||t instanceof gs||t instanceof fs?t.attacker:t.hasComponent(Ws)?t.getComponent(Ws).attacker:null;if(n.getEntitysOfRange("hitbox",l,h,p,a.range.x,a.range.y).forEach((e=>{if(!((e=e.hasComponent(Pr)&&e.hasComponent(Ei)&&e.getComponent(Ei).value||e)instanceof Mn)||e.getNames().some((e=>a.filter.includes(e)))||c.includes(e))return;const[s,r]=N(e.position.x,e.position.y+(e.hasComponent(Sn)?e.getComponent(Sn).size.y:0)/2,e.position.z,l,h,p),u=P(e.position.x,e.position.y+(e.hasComponent(Sn)?e.getComponent(Sn).size.y:0)/2,e.position.z,l,h,p);if(e.hasComponent(Ws)&&!n.hasHitScanVoxel(s,r,l,h,p,u)){const n=e.getComponent(Ws),[l,h,p]=A(s,r,0,0,a.force);n.value.push(new cr(a.minDamage+(a.damage-a.minDamage)*(Math.random()*a.random+1|0)*(1-Math.min(1,u/Math.min(a.range.x,a.range.y)))|0,a.damageType,d,s,r,o.x,o.y,o.z,l,h,p)),c.push(e),a.fireStartTime=t.hasComponent(Ra)?t.getComponent(Ra).time:i}})),a.isAcid){const e=w*Math.random(),i=-Math.PI/4+-Math.PI/4*Math.random(),s=new Array;for(let n=0,a=30;n<a;n=n+1|0){const[n,a,r]=A(e,i,(Math.random()-.5)/.5,.25+.25*Math.random(),(Math.random()-.5)/.5);s.push(new Nr(o.x,o.y+.5*(t.hasComponent(cs)?t.getComponent(cs).size.y:0),o.z,1+2.5*Math.random(),.1*n,.25*a,.1*r))}const[,r,,,]=n.hitScanVoxel(0,Math.PI/2,o.x,o.y+.001,o.z,a.range.y/2);-1!==h&&h>0&&s.push(new zr(3+2*Math.random(),o.x,r+.01,o.z,null)),n.addEntitys(...s)}a.fireTick=r,a.time+=s(e/60,0)}else a.time>0&&(a.fireTick!==r?(a.fireTick=-1,a.time=0):(a.fireTick=r,a.time+=s(e/60,0)))}}class Hr extends fs{constructor(e,t,n,i,s,o,a,r,l,h,p,c,d,u,m,g,f,y){let w=arguments.length>18&&void 0!==arguments[18]?arguments[18]:"ammo",x=arguments.length>19&&void 0!==arguments[19]?arguments[19]:null,M=arguments.length>20&&void 0!==arguments[20]?arguments[20]:null,E=arguments.length>21&&void 0!==arguments[21]?arguments[21]:new Array;super("player-bullet cluster-child",p,h,u,m,f,y,w,e,t,n,i,s,o,a,r,.025,0,l,c,!0,((e,t,n,i,s,o,a)=>new Ts(e,t,n,.5,.5,0,128,"explode",x,a)),"flash",0,0,!1,oi.EFFECT_BULLET_GRENADE,[],1,1,1,.1,0,x,M,"hitbox",["cluster","cluster-child","player-hit-bullet","enemy-hit-bullet",...E],["cluster","cluster-child","player-hit-bullet","enemy-hit-bullet",...E],new Hs(.5))}}class Fr extends Bi{constructor(){super(Ds)}offset(e,t,n){const{position:i}=t,o=t.getComponent(Ds),a=o.time-o.time%o.fireSpeed;if(o.exec=!0,o.enable){const r=new Array;for(let e=0,n=0|o.clusterCount;e<n;e=e+1|0){const[n,s,a]=A(o.direction.x,o.direction.y,0,0,.5),l=new Hr(i.x+n,i.y+s,i.z+a,i.x+n,i.y+s,i.z+a,o.direction.x,o.direction.y,.25,!1,1/0,.1,!1,0,0,o.clusterCount,0,!1,o.damageType,t instanceof xs||t instanceof gs||t instanceof fs?t.attacker:t.hasComponent(Ws)?t.getComponent(Ws).attacker:null),h=l.getComponent(ds),[p,c]=O(2*Math.PI/o.clusterCount*e,0,.0375),[d,u,m]=A(o.direction.x,o.direction.y,p,c,.185);h.value.x=d,h.value.y=u,h.value.z=m,r.push(l)}n.addEntitys(...r),o.fireTick=a,o.time+=s(e/60,0)}else o.time>0&&(o.fireTick!==a?(o.fireTick=-1,o.time=0):(o.fireTick=a,o.time+=s(e/60,0)))}}class Ur extends Bi{constructor(){super(_n),this.targets=new WeakMap}getTargets(e){return this.targets.has(e)||this.targets.set(e,new Array),this.targets.get(e)||new Array}collectTarget(e,t){for(let n=0,i=0|t.length;n<i;n=n+1|0){const i=t[n],s=e.getEntityOfID(i);if(!(null!==s&&s.hasLive()&&s instanceof Mn))continue;const o=this.getTargets(s);for(let n=0,i=0|t.length;n<i;n=n+1|0){const i=t[n],a=e.getEntityOfID(i);if(!(null!==a&&s!==a&&a instanceof Mn&&a.hasLive()))continue;const r=this.getTargets(a);s.getNames().some((e=>(a.hasComponent(_n)?a.getComponent(_n).filter:[]).includes(e)))||a.getNames().some((e=>(s.hasComponent(_n)?s.getComponent(_n).filter:[]).includes(e)))||(!o.includes(a)&&o.push(a),!r.includes(s)&&r.push(s))}}}prephysical(e,t){const n=t.getTree("collision");if(null===n)return;const i=n.getAppendPoints();for(let e=0,s=0|i.length;e<s;e=e+1|0){const s=i[e],o=n.getCell(s);this.collectTarget(t,o)}}physical(e,t,n){const{position:i}=t,o=t.getComponent(_n),a=this.getTargets(t),r=i.x,l=i.y,h=i.z,p=-1===o.old.x?r:o.old.x,c=-1===o.old.y?l:o.old.y,d=-1===o.old.z?h:o.old.z,u=r-p,m=l-c,g=h-d;me(o.targets);const f=P(u,m,g,0,0,0),[y,w]=N(u,m,g,0,0,0),[x,M,E]=A(y,w,0,0,1);for(let e=0,n=0|a.length;e<n;e=e+1|0){const n=a[e];if(t===n||o.targets.includes(n)||!n.hasLive()||!n.hasComponent(_n)||!(n instanceof Mn))continue;const r=n.getComponent(_n),l=Math.min(f,o.size.x/2,o.size.y/2,r.size.x/2,r.size.y/2,.5);let h=l;for(;;){const e=p+h*x,a=c+h*M,y=d+h*E,{position:w}=n,C=w.x,v=w.y,b=w.z,_=-1===r.old.x?C:r.old.x,S=-1===r.old.y?v:r.old.y,k=-1===r.old.z?b:r.old.z,T=C-_,I=v-S,L=b-k;if(o.enable&&r.enable&&(!o.init||0!==u||0!==m||0!==g||!r.init||0!==T||0!==I||0!==L)){const s=P(T,I,L,0,0,0),[l,u]=N(T,I,L,0,0,0),[m,g,x]=A(l,u,0,0,1),M=s*(0!==f?h/f:1),E=_+M*m,C=S+M*g,v=k+M*x,[b,O,W,z,D,R]=Ce(e,a,y,o.size.x,o.size.y,E,C,v,r.size.x,r.size.y);if(0!==b||0!==O||0!==W||0!==z||0!==D||0!==R){const s=Math.abs(e-p),r=Math.abs(a-c),l=Math.abs(y-d),h=Math.abs(E-_),u=Math.abs(C-S),m=Math.abs(v-k),g=t.hasComponent(ds),f=t.hasComponent(ds),x=t.hasComponent(cs),M=n.hasComponent(cs),T=g?t.getComponent(ds).value.x:0,P=g?t.getComponent(ds).value.y:0,I=g?t.getComponent(ds).value.z:0,L=f?n.getComponent(ds).value.x:0,A=f?n.getComponent(ds).value.y:0,N=f?n.getComponent(ds).value.z:0,H=t.hasComponent(Hs)?t.getComponent(Hs).value:1,F=n.hasComponent(Hs)?n.getComponent(Hs).value:1,U=t.hasComponent(Hs)?t.getComponent(Hs).flex:0,B=n.hasComponent(Hs)?n.getComponent(Hs).flex:0,Y=Math.min(1,F/H),G=Math.min(1,H/F);let V=!1,X=!1;i.x=e+b*(0!==h?Math.min(1,0!==s||0!==h?s/h:0):Y),i.z=y+W*(0!==m?Math.min(1,0!==l||0!==m?l/m:0):Y),0===b||x&&(b>0?t.getComponent(cs).hit.x>0:b<0&&t.getComponent(cs).hit.x<0)||(T>=0&&L<=0||T<=0&&L>=0)&&(g&&(t.getComponent(ds).value.x=T+-T*Math.max(1,Y*U)+L*Y),V=!0),0===W||x&&(W>0?t.getComponent(cs).hit.z>0:W<0&&t.getComponent(cs).hit.z<0)||(I>=0&&N<=0||I<=0&&N>=0)&&(g&&(t.getComponent(ds).value.z=I+-I*Math.max(1,Y*U)+N*Y),V=!0),0!==b||0!==W||0===O||V||x&&(O>0?t.getComponent(cs).hit.y>0:O<0&&t.getComponent(cs).hit.y<0)||(i.y=O*Math.min(1,0!==r||0!==u?r/u:0),(P>=0&&A<=0||P<=0&&A>=0)&&g&&(t.getComponent(ds).value.y=P+-P*Math.max(1,Y*U)+A*Y)),w.x=E+z*(0!==h?Math.min(1,0!==s||0!==h?h/s:0):G),w.z=v+R*(0!==m?Math.min(1,0!==l||0!==m?m/l:0):G),0===z||M&&(z>0?n.getComponent(cs).hit.x>0:z<0&&n.getComponent(cs).hit.x<0)||(L>=0&&T<=0||L<=0&&T>=0)&&(f&&(n.getComponent(ds).value.x=L+-L*Math.max(1,G*B)+T*G),X=!0),0===R||M&&(R>0?n.getComponent(cs).hit.z>0:R<0&&n.getComponent(cs).hit.z<0)||(N>=0&&I<=0||N<=0&&I>=0)&&(f&&(n.getComponent(ds).value.z=N+-N*Math.max(1,G*B)+I*G),X=!0),0!==z||0!==R||0===D||X||M&&(D>0?n.getComponent(cs).hit.y>0:D<0&&n.getComponent(cs).hit.y<0)||(w.y=C+D*Math.min(1,0!==r||0!==u?u/r:0),(A>=0&&P<=0||A<=0&&P>=0)&&f&&(n.getComponent(ds).value.y=A+-A*Math.max(1,G*B)+P*G)),o.targets.includes(n)||o.targets.push(n)}}if(h>=f)break;h=Math.min(f,s(h+l,f,1e5,Math.ceil))}}o.enable?(o.old.x=i.x,o.old.y=i.y,o.old.z=i.z,o.init=!0):(o.old.x=-1,o.old.y=-1,o.old.z=-1,o.init=!1),me(a)}}class Br extends Bi{constructor(e){super(Ws,is),this.damageTypes=e}additional(e,t,n){const i=t.getComponent(Ws);if(t.hasComponent(Gi)){const e=t.getComponent(Gi);e.damages.slice().forEach((t=>{e.time-t.time>1&&e.damages.splice(e.damages.indexOf(t),1)}))}for(let e=0,n=0|i.removes.length;e<n;e=e+1|0){const n=i.removes[e];if(t.hasComponent(ds)&&!t.getNames().some((e=>"no-blow"===e))){const e=t.getComponent(ds);e.value.x+=n.force.x,e.value.y+=n.force.y,e.value.z+=n.force.z}i.value.splice(i.value.indexOf(n),1)}me(i.removes)}offset(e,t,n){const i=t.getComponent(Ws);if(t.hasComponent(Gi)){const e=t.getComponent(Gi);if(-1!==e.respawnTime||-1!==e.goleTime||-1!==e.intermissionTime)return void me(i.value)}for(let e=0,s=0|i.value.length;e<s;e=e+1|0){const s=i.value[e];if(i.removes.includes(s))continue;let o=s.value*(i.multiples.hasOwnProperty(s.type)?i.multiples[s.type]:1);isNaN(o)&&(o=0);let a=!1;for(const e in this.damageTypes){if(!e.split("|").some((e=>e===s.type)))continue;const r=this.damageTypes[e]||null;if(null!==r){r.exec(t,s,o)&&(i.attacker=s.attacker);for(const e in r.sounds){if(!e.split("|").some((e=>e===s.type)))continue;const i=r.sounds[e],o=i[Math.floor(i.length*Math.random())]||null;if(null!==o){n.createSound(o,t.hasComponent(Gi)?null:t,"damage-".concat(t.getID())).play();break}}a=!0;break}}if(!a)for(const e in this.damageTypes){if(!e.split("|").some((e=>"default"===e)))continue;const a=this.damageTypes[e]||null;if(null!==a){a.exec(t,s,o)&&(i.attacker=s.attacker);for(const e in a.sounds){if(!e.split("|").some((e=>e===s.type)))continue;const i=a.sounds[e],o=i[Math.floor(i.length*Math.random())]||null;if(null!==o){n.createSound(o,t.hasComponent(Gi)?null:t,"damage-".concat(t.getID())).play();break}}}}if(t.hasComponent(Gi)){const e=t.getComponent(Gi);e.damages.push(new Yi(s.position.x,s.position.y,s.position.z,e.time))}i.removes.push(s)}}}class Yr{}class Gr{constructor(e){this.target=e}}class Vr extends Mn{constructor(e,t,n,i,s,o,a){let r=arguments.length>7&&void 0!==arguments[7]?arguments[7]:{};for(var l=arguments.length,h=new Array(l>8?l-8:0),p=8;p<l;p++)h[p-8]=arguments[p];super("".concat(e.length>0?"".concat(e," "):"","shottarget"),new Pr(n,i,s),new Ws(r),new Ei(t),new Sn(o,a),...h)}}class Xr extends Vr{constructor(e,t,n){super("shot-target head head-".concat(e.getID()),e,0,1.375,0,t,n,{melee:1,ammo:1/0,mugnum:1/0,ball:1/0,plasma:1,rocket:1,explode:1},new Gr(e))}}class jr extends fs{constructor(e,t,n,i,s,o,a,r,l,h,p,c,d,u,m,g,f,y){let w=arguments.length>18&&void 0!==arguments[18]?arguments[18]:"ammo",x=arguments.length>19&&void 0!==arguments[19]?arguments[19]:null,M=arguments.length>20&&void 0!==arguments[20]?arguments[20]:null,E=arguments.length>21&&void 0!==arguments[21]?arguments[21]:new Array;super("player-bullet death-bomb",p,h,u,m,f,y,w,e,t,n,i,s,o,a,r,c,0,l,.1,!0,((e,t,n,i,s,o,a)=>new Ts(e,t,n,1,.25,0,128,"explode",x,a)),"flash",0,0,!1,oi.EFFECT_BULLET_DEATH_BOMB,[],3,3,3,.25,.25,x,M,"hitbox",["player-hit-bullet","enemy-hit-bullet","player","enemy",...E],["player-hit-bullet","enemy-hit-bullet",...E],new Hs(.5))}}class Kr{constructor(e,t,n,i){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[];this.override=!1,this.time=0,this.isOverPick=e,this.isPartPick=t,this.noPickupTime=n,this.items=i,this.soundNameSpace=s,this.pickUpSounds=o}}class Jr{constructor(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.secret=e}}class qr{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.sale=1,this.index=0,this.items=e}}class Zr{constructor(e,t,n,i){this.material=e,this.limit=t,this.isAngle=n,this.exec=i}spawn(e,t,n,i,s){return this.exec(e,t,n,i,s)}getLimit(){return this.limit}hasAngle(){return this.isAngle}getMaterial(){return this.material}}class Qr{constructor(e,t,n){this.tic=0,this.oldTic=0,this.limit=e,this.force=t,this.forceHoming=n}}class $r extends gs{constructor(e,t,n,i,s,o,a,r,l,h,p,c,d,u,m,g,f,y){let w=arguments.length>18&&void 0!==arguments[18]?arguments[18]:"ammo",x=arguments.length>19&&void 0!==arguments[19]?arguments[19]:null,M=arguments.length>20&&void 0!==arguments[20]?arguments[20]:null,E=arguments.length>21&&void 0!==arguments[21]?arguments[21]:new Array;super("enemy-bullet shot-target enemy-hit-bullet",p,h,u,m,f,y,w,e,t,n,i,s,o,a,r,c,0,l,d,0,!0,((e,t,n,i,s,o,a)=>new As(e,t,n,1,null===o,x,a)),"flash",.75,10,!1,null,[oi.EFFECT_BULLET_LASER_TRAIL],0,3.75,0,0,.1,x,M,"hitbox",["enemy-hit-bullet",...E],...Math.random()<.75?[new Qr(.046875*Math.PI,1,!1),new Ei]:[],new is({health:{value:1,max:1}}),new Ws({melee:1,ammo:1,mugnum:1,ball:1,rocket:1,explode:1}),new Sn(.5,.5),new wi(0,-.25,0),new Ms(5))}}class el extends gs{constructor(e,t,n,i,s,o,a,r,l,h,p,c,d,u,m,g,f,y){let w=arguments.length>18&&void 0!==arguments[18]?arguments[18]:"ammo",x=arguments.length>19&&void 0!==arguments[19]?arguments[19]:null,M=arguments.length>20&&void 0!==arguments[20]?arguments[20]:null,E=arguments.length>21&&void 0!==arguments[21]?arguments[21]:new Array;super("enemy-bullet",p,h,u,m,f,y,w,e,t,n,i,s,o,a,r,c,0,l,d,0,!0,((e,t,n,i,s,o,a)=>new As(e,t,n,1,null===o,x,a)),"flash",.75,10,!1,null,[oi.EFFECT_BULLET_BALL_TRAIL],0,1.5,0,0,.1,x,M,"hitbox",["enemy-hit-bullet",...E])}}class tl extends gs{constructor(e,t,n,i,s,o,a,r,l,h,p,c,d,u,m,g,f,y){let w=arguments.length>18&&void 0!==arguments[18]?arguments[18]:"ammo",x=arguments.length>19&&void 0!==arguments[19]?arguments[19]:null,M=arguments.length>20&&void 0!==arguments[20]?arguments[20]:null,E=arguments.length>21&&void 0!==arguments[21]?arguments[21]:new Array;super("enemy-bullet",p,h,u,m,f,y,w,e,t,n,i,s,o,a,r,c,0,l,d,0,!0,((e,t,n,i,s,o,a)=>new As(e,t,n,1,null===o,x,a)),"flash",.75,10,!1,null,[oi.EFFECT_BULLET_PLASMA_TRAIL],0,1.25,0,0,.1,x,M,"hitbox",["enemy-hit-bullet",...E])}}class nl extends gs{constructor(e,t,n,i,s,o,a,r,l,h,p,c,d,u,m,g,f,y){let w=arguments.length>18&&void 0!==arguments[18]?arguments[18]:"ammo",x=arguments.length>19&&void 0!==arguments[19]?arguments[19]:null,M=arguments.length>20&&void 0!==arguments[20]?arguments[20]:null,E=arguments.length>21&&void 0!==arguments[21]?arguments[21]:new Array;super("enemy-bullet shot-target enemy-hit-bullet",p,h,u,m,f,y,w,e,t,n,i,s,o,a,r,c,0,l,d,0,!0,((e,t,n,i,s,o,a)=>new As(e,t,n,1,null===o,x,a)),"none",.375,5,!1,oi.EFFECT_BULLET_MAGINC_MISSILE_TRAIL,[],2.5,0,0,.1,0,x,M,"hitbox",["enemy-hit-bullet",...E],new is({health:{value:1,max:1}}),new Ws({melee:1,ammo:1,mugnum:1,ball:1,rocket:1,explode:1}),new Sn(.75,.75),new _n(.75,.75,["player","enemy","object","item","player-bullet"]),new wi(0,-.375,0))}}class il{constructor(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.5,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:128,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"explode";this.fall=e,this.size=t,this.force=n,this.minDamage=i,this.maxDamage=s,this.damageType=o;for(var a=arguments.length,r=new Array(a>6?a-6:0),l=6;l<a;l++)r[l-6]=arguments[l];this.sparkTypes=r}}class sl{constructor(e,t){this.spawn=null,this.time=0,this.spawner=e,this.interval=t}}class ol{constructor(e){this.camera=null,this.editor=e}}class al extends Ui{constructor(){super(...arguments),this.mode=0,this.pawn=null,this.exit=!1,this.isStick=!1,this.cmda=new E(0,0)}}class rl{constructor(){this.enable=!1}}class ll extends Vr{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;super("shot-target helmet helmet-".concat(e.getID()),e,0,1.25,0,.75*t,.625*n,{melee:1,ammo:1,mugnum:1,ball:1,plasma:1,rocket:1,explode:0},new Yr,new is({health:{value:1,max:1}}),new Cn(oi.ENEMY_GUY_HELMET_STILL,2*n),new vn(!0,!1,!0,.0625))}}class hl{}class pl{constructor(){this.value=new E(0,0),this.position=new E(0,0),this.old=new E(0,0),this.time=0,this.force=0,this.startTime=0,this.subY=0}}class cl extends Mn{constructor(e,t,n,i){let s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];super("player",new Gi(!1,-.25,100),new xr(new Mn("fall-respawn-point")),new $o(.15,1.5),new ss(1.5,.25,.25),new aa,new Qo(.15,.2),new ia(.1,.05,.2,.275,2),new ta(1.75,.75,.25),new na(1,.25,.2,"object","enemy"),new sa(.25,.25),new oa(.25),new la,new is({health:{value:100,max:200},armor:{value:0,max:100},meat:{value:0,max:1/0},useshoppoint:{value:0,max:1/0},stamina:{value:100,max:100},clip:{value:1/0,max:1/0},magazine:{value:0,max:150},shell:{value:0,max:30},rocket:{value:0,max:10},cell:{value:0,max:100},combo:{value:0,max:Qs.length},gage:{value:0,max:1},score:{value:0,max:1/0},sumscore:{value:0,max:1/0},hordetime:{value:60,max:1/0},"key-red":{value:0,max:1},"key-blue":{value:0,max:2},"key-yellow":{value:0,max:3},hand:{value:s?null:"punch"},sidearm:{value:null},machingun:{value:null},shotgun:{value:null},launcher:{value:null},plasmagun:{value:null}}),new Fo("hand","hand"),new Ws({magic:1,slash:1,flame:1,corrode:1,explode:.25}),new pl,new Uo(1,7,3.5,1),new hl,new ji,new jo(.1),new ds(.025,0,.025,0),new Sn(.75,1.75,!1),new _n(.75,1.75,[],!1),new cs(.75,1.75),new Hs(1,1,0),new wi(0,0,0)),this.position.x=e,this.position.y=t,this.position.z=n,this.direction.x=(i+1e-4)%w,this.direction.y=1e-4}}class dl extends gs{constructor(e,t,n,i,s,o,a,r,l,h,p,c,d,u,m,g,f,y){let w=arguments.length>18&&void 0!==arguments[18]?arguments[18]:"ammo",x=arguments.length>19&&void 0!==arguments[19]?arguments[19]:null,M=arguments.length>20&&void 0!==arguments[20]?arguments[20]:null,E=arguments.length>21&&void 0!==arguments[21]?arguments[21]:new Array;super("enemy-bullet",p,h,u,m,f,y,w,e,t,n,i,s,o,a,r,c,0,l,d,.1,!0,((e,t,n,i,s,o,a)=>new Ts(e,t,n,1,0,0,48,"explode",x,a)),"flash",5,10,!0,oi.EFFECT_BULLET_PLASMA_TRAIL,[oi.EFFECT_FLAME1,oi.EFFECT_FLAME2,oi.EFFECT_FLAME3,oi.EFFECT_FLAME4,oi.EFFECT_FLAME5],3,.1,1,.1,1,x,M,"hitbox",["player-hit-bullet","enemy-hit-bullet","enemy",...E])}}class ul extends gs{constructor(e,t,n,i,s,o,a,r,l,h,p,c,d,u,m,g,f,y){let w=arguments.length>18&&void 0!==arguments[18]?arguments[18]:"ammo",x=arguments.length>19&&void 0!==arguments[19]?arguments[19]:null,M=arguments.length>20&&void 0!==arguments[20]?arguments[20]:null,E=arguments.length>21&&void 0!==arguments[21]?arguments[21]:new Array;super("enemy-bullet flame",p,h,u,m,f,y,w,e,t,n,i,s,o,a,r,c,Math.random()*Math.PI,l,d,.01,!0,((e,t,n,i,s,o,a)=>null),"flash",0,0,!1,oi.EFFECT_FLAME1,[],.5,0,0,1,0,x,M,"hitbox",["enemy-hit-bullet","player-hit-bullet",...E],new Es([oi.EFFECT_FLAME1,oi.EFFECT_FLAME2,oi.EFFECT_FLAME3,oi.EFFECT_FLAME4,oi.EFFECT_FLAME5],.5),new Ms(.5),new Ir(.5,2.5))}}class ml{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;this.time=0,this.old=-1,this.height=e,this.speed=t}}class gl{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this.isHover=!1,this.message=e,this.sound=n,this.volume=i,this.range=t}}class fl{constructor(){this.enable=!1}}class yl{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default",t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.attachActor=null,this.type=e,this.singleton=t}}class wl extends Ss{constructor(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,s=arguments.length>8?arguments[8]:void 0,o=arguments.length>9?arguments[9]:void 0,a=arguments.length>10?arguments[10]:void 0,r=arguments.length>11?arguments[11]:void 0,l=arguments.length>12?arguments[12]:void 0,h=arguments.length>13&&void 0!==arguments[13]?arguments[13]:0;super(arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,arguments.length>6&&void 0!==arguments[6]?arguments[6]:"none",arguments.length>7&&void 0!==arguments[7]?arguments[7]:"shoot",s,arguments.length>14&&void 0!==arguments[14]?arguments[14]:new Array),this.angleX=0,this.shootPoint=new E(e,t),this.bulletType=n,this.brancheCount=i,this.fireSpeed=s,this.bulletScale=o,this.radius=new E(a,r),this.bulletSpeed=l,this.rollTime=h}}const xl=["./asset/sound/enemy/find-pistol-1.mp3","./asset/sound/enemy/find-pistol-2.mp3","./asset/sound/enemy/find-pistol-3.mp3","./asset/sound/enemy/find-pistol-4.mp3"],Ml=["./asset/sound/enemy/find-shotgun-1.mp3","./asset/sound/enemy/find-shotgun-2.mp3","./asset/sound/enemy/find-shotgun-3.mp3","./asset/sound/enemy/find-shotgun-4.mp3","./asset/sound/enemy/find-shotgun-5.mp3"],El=["./asset/sound/enemy/find-machingun-1.mp3","./asset/sound/enemy/find-machingun-2.mp3","./asset/sound/enemy/find-machingun-3.mp3"],Cl=["./asset/sound/enemy/find-melee-1.mp3","./asset/sound/enemy/find-melee-2.mp3","./asset/sound/enemy/find-melee-3.mp3"],vl=["./asset/sound/enemy/pain-pistol-1.mp3","./asset/sound/enemy/pain-pistol-2.mp3"],bl=["./asset/sound/enemy/pain-shotgun-1.mp3","./asset/sound/enemy/pain-shotgun-2.mp3"],_l=["./asset/sound/enemy/pain-machingun-1.mp3","./asset/sound/enemy/pain-machingun-2.mp3"],Sl=["./asset/sound/enemy/pain-melee-1.mp3","./asset/sound/enemy/pain-melee-2.mp3"],kl=["./asset/sound/enemy/death-pistol-1.mp3"],Tl=["./asset/sound/enemy/death-shotgun-1.mp3"],Pl=["./asset/sound/enemy/death-machingun-1.mp3"],Il=["./asset/sound/enemy/death-melee-1.mp3"],Ll={PLAYER:new Zr(oi.UI_START_POINT,1,!0,((e,t,n,i,s)=>{const o=new cl(e,t,n,i,s instanceof Gh&&s.hasTutorial()),a=new Mn("death-respawn-point");a.position.x=e,a.position.y=t,a.position.z=n;const r=new Oi("camera",new Bo,new Yo(.25),new ea(.125,.125,.0125,.025*Math.PI,1.5),new Ya(1.5,.5),new Ei(o),new wi(0,1.5,0));r.fov=s instanceof Gh?s.getFOVToCamera():1;const l=new Mn("hud hand-right",new bn(-.25,-1.5,.025,1,0),new qo(.25),new Fa(.125,.125,Math.PI/2*.25,1,0,Math.PI/2,0,.25,!1,!0,!0),new os(!1),new Cn(oi.NONE,1,0,1,!1,!1),new vn(!0,!0,!0,0),new Ei(r)),h=new Mn("hud hand-left",new bn(.25,-1.5,.025,1,0),new qo(.25),new Fa(.125,.125,Math.PI/2*.25,1,.25,Math.PI/2,0,.25,!0,!0,!0),new os(!0),new Cn(oi.NONE,1,0,1,!1,!1),new vn(!0,!0,!0,0),new Ei(r)),p=new Mn("hud foot",new bn(0,-10,.05,1,0),new qo(.25),new ur,new Cn(oi.NONE,1,0,1,!1,!1),new vn(!0,!0,!0,0),new Ei(r));return s.addEntitys(o,a,r,l,h,p),s instanceof Ti&&s.setCamera(r),s instanceof Gh&&s.setPlayer(o),o})),HELP_1:new Zr(oi.UI_HELP_POINT,1,!1,((e,t,n,i,s)=>{const o=new Mn("help help-1",new Cn(oi.UI_HELP_POINT,1),new vn(!0,!1,!0,.5),new Ei(s instanceof Gh?s.getPlayer():null),new ml(.25,1),new gl((()=>["Steps are climbed automatically"]),1,"./asset/sound/system/help.mp3",1));return o.position.x=e,o.position.y=t+.5,o.position.z=n,s.addEntitys(o),o})),HELP_2:new Zr(oi.UI_HELP_POINT,1,!1,((e,t,n,i,s)=>{const o=s.getControlManager(),a=new Mn("help help-2",new Cn(oi.UI_HELP_POINT,1),new vn(!0,!1,!0,.5),new Ei(s instanceof Gh?s.getPlayer():null),new ml(.25,1),new gl((()=>["Climb the wall by jumping with the (".concat(s instanceof Gh?o.getKey("jump"):"space",")")," and continuing to move forward"]),1,"./asset/sound/system/help.mp3",1));return a.position.x=e,a.position.y=t+.5,a.position.z=n,s.addEntitys(a),a})),HELP_3:new Zr(oi.UI_HELP_POINT,1,!1,((e,t,n,i,s)=>{const o=new Mn("help help-3",new Cn(oi.UI_HELP_POINT,1),new vn(!0,!1,!0,.5),new Ei(s instanceof Gh?s.getPlayer():null),new ml(.25,1),new gl((()=>["Jump towards the wall and wall run"]),1,"./asset/sound/system/help.mp3",1));return o.position.x=e,o.position.y=t+.5,o.position.z=n,s.addEntitys(o),o})),HELP_4:new Zr(oi.UI_HELP_POINT,1,!1,((e,t,n,i,s)=>{const o=s.getControlManager(),a=new Mn("help help-4",new Cn(oi.UI_HELP_POINT,1),new vn(!0,!1,!0,.5),new Ei(s instanceof Gh?s.getPlayer():null),new ml(.25,1),new gl((()=>["Wall jump with (".concat(s instanceof Gh?o.getKey("jump"):"space",") during wall run")]),1,"./asset/sound/system/help.mp3",1));return a.position.x=e,a.position.y=t+.5,a.position.z=n,s.addEntitys(a),a})),HELP_5:new Zr(oi.UI_HELP_POINT,1,!1,((e,t,n,i,s)=>{const o=new Mn("help help-5",new Cn(oi.UI_HELP_POINT,1),new vn(!0,!1,!0,.5),new Ei(s instanceof Gh?s.getPlayer():null),new ml(.25,1),new gl((()=>["The cliff can be grabbed"]),1,"./asset/sound/system/help.mp3",1));return o.position.x=e,o.position.y=t+.5,o.position.z=n,s.addEntitys(o),o})),HELP_6:new Zr(oi.UI_HELP_POINT,1,!1,((e,t,n,i,s)=>{const o=s.getControlManager(),a=new Mn("help help-6",new Cn(oi.UI_HELP_POINT,1),new vn(!0,!1,!0,.5),new Ei(s instanceof Gh?s.getPlayer():null),new ml(.25,2),new gl((()=>["Turn to the direction you want to fly","and jump with the (".concat(s instanceof Gh?o.getKey("jump"):"space",")")]),1,"./asset/sound/system/help.mp3",1));return a.position.x=e,a.position.y=t+.5,a.position.z=n,s.addEntitys(a),a})),HELP_7:new Zr(oi.UI_HELP_POINT,1,!1,((e,t,n,i,s)=>{const o=new Mn("help help-7",new Cn(oi.UI_HELP_POINT,1),new vn(!0,!1,!0,.5),new Ei(s instanceof Gh?s.getPlayer():null),new ml(.25,1),new gl((()=>["You can move sideways while grabbing the cliff"]),1,"./asset/sound/system/help.mp3",1));return o.position.x=e,o.position.y=t+.5,o.position.z=n,s.addEntitys(o),o})),HELP_8:new Zr(oi.UI_HELP_POINT,1,!1,((e,t,n,i,s)=>{const o=new Mn("help help-8",new Cn(oi.UI_HELP_POINT,1),new vn(!0,!1,!0,.5),new Ei(s instanceof Gh?s.getPlayer():null),new ml(.25,1),new gl((()=>["Jump up and grab an overhead cliff"]),1,"./asset/sound/system/help.mp3",1));return o.position.x=e,o.position.y=t+.5,o.position.z=n,s.addEntitys(o),o})),HELP_9:new Zr(oi.UI_HELP_POINT,1,!1,((e,t,n,i,s)=>{const o=new Mn("help help-9",new Cn(oi.UI_HELP_POINT,1),new vn(!0,!1,!0,.5),new Ei(s instanceof Gh?s.getPlayer():null),new ml(.25,1),new gl((()=>["You can turn left and change direction","while climbing the wall"]),1,"./asset/sound/system/help.mp3",1));return o.position.x=e,o.position.y=t+.5,o.position.z=n,s.addEntitys(o),o})),HELP_10:new Zr(oi.UI_HELP_POINT,1,!1,((e,t,n,i,s)=>{const o=new Mn("help help-10",new Cn(oi.UI_HELP_POINT,1),new vn(!0,!1,!0,.5),new Ei(s instanceof Gh?s.getPlayer():null),new ml(.25,1),new gl((()=>["You can slide by crouching during the sprint"]),1,"./asset/sound/system/help.mp3",1));return o.position.x=e,o.position.y=t+.5,o.position.z=n,s.addEntitys(o),o})),HELP_11:new Zr(oi.UI_HELP_POINT,1,!1,((e,t,n,i,s)=>{const o=new Mn("help help-11",new Cn(oi.UI_HELP_POINT,1),new vn(!0,!1,!0,.5),new Ei(s instanceof Gh?s.getPlayer():null),new ml(.25,1),new gl((()=>["A coil can be created by crouching while jumping"]),1,"./asset/sound/system/help.mp3",1));return o.position.x=e,o.position.y=t+.5,o.position.z=n,s.addEntitys(o),o})),HELP_12:new Zr(oi.UI_HELP_POINT,1,!1,((e,t,n,i,s)=>{const o=new Mn("help help-12",new Cn(oi.UI_HELP_POINT,1),new vn(!0,!1,!0,.5),new Ei(s instanceof Gh?s.getPlayer():null),new ml(.25,1),new gl((()=>["Punches can tempolary flinch the enemy."]),1,"./asset/sound/system/help.mp3",1));return o.position.x=e,o.position.y=t+.5,o.position.z=n,s.addEntitys(o),o})),HELP_13:new Zr(oi.UI_HELP_POINT,1,!1,((e,t,n,i,s)=>{const o=new Mn("help help-12",new Cn(oi.UI_HELP_POINT,1),new vn(!0,!1,!0,.5),new Ei(s instanceof Gh?s.getPlayer():null),new ml(.25,1),new gl((()=>["Hold the button down for a while and then release it","you can spend stamina to blow up enemies."]),1,"./asset/sound/system/help.mp3",1));return o.position.x=e,o.position.y=t+.5,o.position.z=n,s.addEntitys(o),o})),HELP_14:new Zr(oi.UI_HELP_POINT,1,!1,((e,t,n,i,s)=>{const o=new Mn("help help-12",new Cn(oi.UI_HELP_POINT,1),new vn(!0,!1,!0,.5),new Ei(s instanceof Gh?s.getPlayer():null),new ml(.25,1),new gl((()=>["The aim is stable when crouching"]),1,"./asset/sound/system/help.mp3",1));return o.position.x=e,o.position.y=t+.5,o.position.z=n,s.addEntitys(o),o})),HELP_15:new Zr(oi.UI_HELP_POINT,1,!1,((e,t,n,i,s)=>{const o=s.getControlManager(),a=new Mn("help help-13",new Cn(oi.UI_HELP_POINT,1),new vn(!0,!1,!0,.5),new Ei(s instanceof Gh?s.getPlayer():null),new ml(.25,1),new gl((()=>["You can lean with ".concat(s instanceof Gh?"gamepad"===s.getControlManager().getInputType()?"(".concat(o.getKey("lean"),") and (left stick)"):"(".concat(o.getKey("lean-left"),") or (").concat(o.getKey("lean-right"),")"):"(q) or (e)"),"Leaning through the wall stabilizes the aim"]),1,"./asset/sound/system/help.mp3",1));return a.position.x=e,a.position.y=t+.5,a.position.z=n,s.addEntitys(a),a})),HELP_16:new Zr(oi.UI_HELP_POINT,1,!1,((e,t,n,i,s)=>{const o=s.getControlManager(),a=new Mn("help help-14",new Cn(oi.UI_HELP_POINT,1),new vn(!0,!1,!0,.5),new Ei(s instanceof Gh?s.getPlayer():null),new ml(.25,1),new gl((()=>["You can dual wild with ".concat(s instanceof Gh?"".concat("gamepad"===s.getControlManager().getInputType()?"(".concat(o.getKey("weapon-wheel"),")"):"(weapon selection key) or (".concat(o.getKey("weapon-wheel"),")")," and (").concat(o.getKey("fire-left"),") or (").concat(o.getKey("fire-right"),")"):"(weapon selection key) or (tab) and (mouse-left) or (mouse-right)")]),1,"./asset/sound/system/help.mp3",1));return a.position.x=e,a.position.y=t+.5,a.position.z=n,s.addEntitys(a),a})),HELP_17:new Zr(oi.UI_HELP_POINT,1,!1,((e,t,n,i,s)=>{const o=new Mn("help help-15",new Cn(oi.UI_HELP_POINT,1),new vn(!0,!1,!0,.5),new Ei(s instanceof Gh?s.getPlayer():null),new ml(.25,1),new gl((()=>["This is the end of the tutorial"]),1,"./asset/sound/system/help.mp3",1));return o.position.x=e,o.position.y=t+.5,o.position.z=n,s.addEntitys(o),o})),GOLE:new Zr(oi.UI_GOLE_POINT,1,!1,((e,t,n,i,s)=>{const o=new Mn("gole",new Jr(!1));return o.position.x=e,o.position.y=t,o.position.z=n,s.addEntitys(o),o})),SECRET:new Zr(oi.UI_SECRET_POINT,1,!1,((e,t,n,i,s)=>{const o=new Mn("secret",new Jr(!0));return o.position.x=e,o.position.y=t,o.position.z=n,s.addEntitys(o),o})),ENEMY_TARGET:new Zr(oi.ENEMY_TARGET_STILL,1/0,!1,((e,t,n,i,s)=>{const o=new Mn("enemy guy guy-target not-count",new Ra(oi.ENEMY_TARGET_STILL,{aim:oi.NONE,pain:oi.ENEMY_TARGET_PAIN,blow:oi.ENEMY_TARGET_BLOW,down:oi.ENEMY_TARGET_DOWN},0,.5,0,1/0,1/0,0,0,.75,!1,.25,1,.75,.25,1.25,.9,!1,!0),new is({health:{value:60,max:60}}),new Ws({melee:0,ammo:1,mugnum:1,ball:1,plasma:1,rocket:1,explode:2}),new ta(1.25,.9,1),new Cn(oi.ENEMY_GUY_TARGET_STILL,2),new vn(!0,!1,!0,.5),new _n(.75,1.9),new Sn(1.25,1.25),new cs(.75,1.9),new Ei(s instanceof Gh?s.getPlayer():null),new jo(0),new ds(.025,0,.025,0),new Hs(2)),a=new Xr(o,.5,.5);return o.position.x=e,o.position.y=t,o.position.z=n,o.direction.x=0,s.addEntitys(o,a),o})),ENEMY_GUY_PISTOL:new Zr(oi.ENEMY_GUY_PISTOL_STILL,1/0,!1,((e,t,n,i,s)=>{const o=1.1,a=new Mn("enemy guy guy-pistol",new Ra(oi.ENEMY_GUY_PISTOL_STILL,{aim:oi.ENEMY_GUY_PISTOL_AIM,pain:oi.ENEMY_GUY_PISTOL_PAIN,blow:oi.ENEMY_GUY_PISTOL_BLOW,down:oi.ENEMY_GUY_PISTOL_DOWN},0,.5,0,1/0,1/0,5,10,.75,!0,.25,1,.75,.25,1.375,.9*o,!1,!0,xl,vl,kl),new Er(0,.375,$r,1,15,"magic","shoot",.75,1,.5,0,0,0,0,.175,1,0,["shot-target"]),new is({health:{value:60,max:60}}),new Ws({melee:0,ammo:1,mugnum:1,ball:1,rocket:1,explode:2}),new ta(1.375,.9*o,1),new Cn(oi.ENEMY_GUY_PISTOL_STILL,2.2),new vn(!0,!1,!0,.5),new _n(.75*o,2.09),new Sn(1.375,1.375),new cs(.75*o,2.09),new Ei(s instanceof Gh?s.getPlayer():null),new jo(.175),new ds(.025,0,.025,0),new Hs(2)),r=new Xr(a,.55,.55);return a.position.x=e,a.position.y=t,a.position.z=n,a.direction.x=0,s.addEntitys(a,r),a})),ENEMY_GUY_SHOTGUN:new Zr(oi.ENEMY_GUY_SHOTGUN_STILL,1/0,!1,((e,t,n,i,s)=>{const o=new Mn("enemy guy guy-shotgun",new Ra(oi.ENEMY_GUY_SHOTGUN_STILL,{aim:oi.ENEMY_GUY_SHOTGUN_AIM,pain:oi.ENEMY_GUY_SHOTGUN_PAIN,blow:oi.ENEMY_GUY_SHOTGUN_BLOW,down:oi.ENEMY_GUY_SHOTGUN_DOWN},0,.5,0,1/0,1/0,2.5,5,.75,!1,.25,1,.75,.25,1.125,.81,!1,!0,Ml,bl,Tl),new Er(0,.375,el,1,15,"magic","shoot",1.25,3,.1,Math.PI/2*.05,Math.PI/2*.05,0,0,.275,1,0,["shot-target"]),new is({health:{value:30,max:30}}),new Ws({melee:0,ammo:1,mugnum:1,ball:1,plasma:1,rocket:1,explode:2}),new ta(1.125,.81,1),new Cn(oi.ENEMY_GUY_SHOTGUN_STILL,1.8),new vn(!0,!1,!0,.5),new _n(.675,1.71),new Sn(1.125,1.125),new cs(.675,1.71),new Ei(s instanceof Gh?s.getPlayer():null),new jo(.175),new ds(.025,0,.025,0),new Hs(2)),a=new Xr(o,.45,.45);return o.position.x=e,o.position.y=t,o.position.z=n,o.direction.x=0,s.addEntitys(o,a),o})),ENEMY_GUY_MACHINGUN:new Zr(oi.ENEMY_GUY_MACHINGUN_STILL,1/0,!1,((e,t,n,i,s)=>{const o=new Mn("enemy guy guy-machingun",new Ra(oi.ENEMY_GUY_MACHINGUN_STILL,{aim:oi.ENEMY_GUY_MACHINGUN_AIM,pain:oi.ENEMY_GUY_MACHINGUN_PAIN,blow:oi.ENEMY_GUY_MACHINGUN_BLOW,down:oi.ENEMY_GUY_MACHINGUN_DOWN},0,.5,0,1/0,1/0,5,10,.75,!1,.25,1,.75,.25,1.25,.9,!1,!0,El,_l,Pl),new Er(0,.375,tl,1,9,"magic","shoot",.125,1,.1,Math.PI/2*.05,Math.PI/2*.025,0,0,.25,1,0,["shot-target"]),new is({health:{value:45,max:45}}),new Ws({melee:0,ammo:1,mugnum:1,ball:1,plasma:1,rocket:1,explode:2}),new ta(1.25,.9,1),new Cn(oi.ENEMY_GUY_MACHINGUN_STILL,2),new vn(!0,!1,!0,.5),new _n(.75,1.9),new Sn(1.25,1.25),new cs(.75,1.9),new Ei(s instanceof Gh?s.getPlayer():null),new jo(.175),new ds(.025,0,.025,0),new Hs(2)),a=new Xr(o,.5,.5);return o.position.x=e,o.position.y=t,o.position.z=n,o.direction.x=0,s.addEntitys(o,a),o})),ENEMY_GUY_MELEE:new Zr(oi.ENEMY_GUY_MELEE_STILL,1/0,!1,((e,t,n,i,s)=>{const o=.9,a=new Mn("enemy guy guy-melee",new Ra(oi.ENEMY_GUY_MELEE_STILL,{aim:oi.ENEMY_GUY_MELEE_AIM,pain:oi.ENEMY_GUY_MELEE_PAIN,blow:oi.ENEMY_GUY_MELEE_BLOW,down:oi.ENEMY_GUY_MELEE_DOWN},0,.5,0,1/0,1/0,0,4.25,.25,!0,.5,1,.75,.25,1.125,.81,!1,!0,Cl,Sl,Il),new kr(1,15,"slash",.625,.1375,.03125,["enemy","object","shot-target","player-hit-bullet","enemy-hit-bullet"]),new is({health:{value:60,max:60}}),new Ws({melee:0,ammo:.5,mugnum:1,ball:3,plasma:1,rocket:1,explode:2}),new ta(1.125,.81,1),new Cn(oi.ENEMY_MELEE_LARGE_STILL,1.8),new vn(!0,!1,!0,.5),new _n(.675,1.71),new Sn(1.125,1.125),new cs(.675,1.71),new Ei(s instanceof Gh?s.getPlayer():null),new jo(.2),new ds(.025,0,.025,0),new Hs(2)),r=new ll(a,o,o);return a.position.x=e,a.position.y=t,a.position.z=n,a.direction.x=0,s.addEntitys(a,r),a})),ENEMY_GUY_MISSILE:new Zr(oi.ENEMY_GUY_MISSILE_STILL,1/0,!1,((e,t,n,i,s)=>{const o=new Mn("enemy guy guy-missile no-blow",new Ra(oi.ENEMY_GUY_MISSILE_STILL,{aim:oi.ENEMY_GUY_MISSILE_AIM,pain:oi.ENEMY_GUY_MISSILE_PAIN},0,-.75,0,1/0,1/0,5,10,.5,!1,.25,1,.75,.25,1.5,1.5,!0,!1),new Er(0,-.75,nl,1,5,"magic","shoot-range",.75,1,.75,Math.PI/2*.05,Math.PI/2*.025,0,0,.175,5,.1,["shot-target"]),new is({health:{value:125,max:125}}),new Ws({melee:0,ammo:1,mugnum:1,ball:1,plasma:.25,rocket:1,explode:3}),new Cn(oi.ENEMY_GUY_MISSILE_STILL,3),new vn(!0,!1,!0,.5),new _n(.9,1.875),new Sn(1.5,1.875),new cs(.9,1.875),new Ei(s instanceof Gh?s.getPlayer():null),new jo(.1),new ds(.025,.025,.025,1),new Hs(2.5,0));return o.position.x=e,o.position.y=t+.5,o.position.z=n,o.direction.x=0,s.addEntitys(o),o})),ENEMY_GUY_PISTOL_ARMOR:new Zr(oi.ENEMY_GUY_PISTOL_ARMOR_STILL,1/0,!1,((e,t,n,i,s)=>{const o=1.1,a=new Mn("enemy guy guy-pistol guy-armor no-blow",new Ra(oi.ENEMY_GUY_PISTOL_ARMOR_STILL,{aim:oi.ENEMY_GUY_PISTOL_ARMOR_AIM,pain:oi.ENEMY_GUY_PISTOL_ARMOR_PAIN},0,.5,0,1/0,1/0,5,10,.5,!1,0,1,.75,.25,2.0625,2.0625,!1,!1,xl),new Er(0,.375,$r,1,15,"magic","shoot",1,1,.5,Math.PI/2*.05,Math.PI/2*.025,0,0,.175,5,.125,["enemy","shot-target"]),new is({armor:{value:100,max:100},health:{value:200,max:200}}),new Ws({melee:1,ammo:.75,mugnum:1.25,ball:.75,plasma:1,rocket:1,explode:.75}),new Cn(oi.ENEMY_GUY_PISTOL_ARMOR_STILL,2.2),new vn(!0,!1,!0,.5),new _n(.75*o,2.09),new Sn(1.375,2.09),new cs(.75*o,2.09),new Ei(s instanceof Gh?s.getPlayer():null),new jo(.2),new ds(.025,0,.025,0),new Hs(2));return a.position.x=e,a.position.y=t,a.position.z=n,a.direction.x=0,s.addEntitys(a),a})),ENEMY_GUY_SHOTGUN_ARMOR:new Zr(oi.ENEMY_GUY_SHOTGUN_ARMOR_STILL,1/0,!1,((e,t,n,i,s)=>{const o=new Mn("enemy guy guy-shotgun guy-armor no-blow",new Ra(oi.ENEMY_GUY_SHOTGUN_ARMOR_STILL,{aim:oi.ENEMY_GUY_SHOTGUN_ARMOR_AIM,pain:oi.ENEMY_GUY_SHOTGUN_ARMOR_PAIN},0,.5,0,.0375,1/0,1.75,3.75,.5,!1,0,1,.75,.25,1.59375,1.59375,!1,!1,Ml),new Er(0,.375,ul,1,3,"flame","shoot-range",.05,1,.5,Math.PI/2*.05,Math.PI/2*.025,0,0,.25,1,0,["enemy","shot-target"]),new is({armor:{value:100,max:100},health:{value:200,max:200}}),new Ws({melee:1,ammo:.75,mugnum:1.25,ball:.75,plasma:1,rocket:1,explode:.75}),new Cn(oi.ENEMY_GUY_SHOTGUN_ARMOR_STILL,1.7),new vn(!0,!1,!0,.5),new _n(.6375,1.615),new Sn(1.0625,1.615),new cs(.6375,1.615),new Ei(s instanceof Gh?s.getPlayer():null),new jo(.2),new ds(.025,0,.025,0),new Hs(2));return o.position.x=e,o.position.y=t,o.position.z=n,o.direction.x=0,s.addEntitys(o),o})),ENEMY_GUY_MACHINGUN_ARMOR:new Zr(oi.ENEMY_GUY_MACHINGUN_ARMOR_STILL,1/0,!1,((e,t,n,i,s)=>{const o=new Mn("enemy guy guy-machingun guy-armor no-blow",new Ra(oi.ENEMY_GUY_MACHINGUN_ARMOR_STILL,{aim:oi.ENEMY_GUY_MACHINGUN_ARMOR_AIM,pain:oi.ENEMY_GUY_MACHINGUN_ARMOR_PAIN},0,.5,.0375,Math.PI/2*.1,1,5,10,.5,!1,0,1,.75,.25,1.875,1.875,!1,!1,El),new Er(0,.375,dl,10,2,"magic","shoot-range",1,1,.25,Math.PI/2*.05,Math.PI/2*.025,0,0,.125,1,0,["enemy","shot-target"]),new is({armor:{value:100,max:100},health:{value:200,max:200}}),new Ws({melee:1,ammo:.75,mugnum:1.25,ball:.75,plasma:1,rocket:1,explode:.75}),new Cn(oi.ENEMY_GUY_MACHINGUN_ARMOR_STILL,2),new vn(!0,!1,!0,.5),new _n(.75,1.9),new Sn(1.25,1.9),new cs(.75,1.9),new Ei(s instanceof Gh?s.getPlayer():null),new jo(.2),new ds(.025,0,.025,0),new Hs(2));return o.position.x=e,o.position.y=t,o.position.z=n,o.direction.x=0,s.addEntitys(o),o})),ENEMY_GUY_MELEE_ARMOR:new Zr(oi.ENEMY_GUY_MELEE_ARMOR_STILL,1/0,!1,((e,t,n,i,s)=>{const o=1.1,a=new Mn("enemy guy guy-melee guy-armor green-blood no-blow",new Ra(oi.ENEMY_GUY_MELEE_ARMOR_STILL,{aim:oi.ENEMY_GUY_MELEE_ARMOR_AIM,pain:oi.ENEMY_GUY_MELEE_ARMOR_PAIN},0,.5,0,1/0,1/0,0,4.25,.25,!0,0,1,.75,.25,2.0625,2.0625,!1,!1,Cl),new kr(1,15,"slash",.625,.1375,.03125,["enemy","object","shot-target","player-hit-bullet","enemy-hit-bullet"]),new is({armor:{value:100,max:100},health:{value:200,max:200}}),new Ws({melee:1,ammo:.75,mugnum:1.25,ball:.75,plasma:1,rocket:1,explode:.75}),new Cn(oi.ENEMY_GUY_MELEE_ARMOR_STILL,2.2),new vn(!0,!1,!0,.5),new il(!1,1,.25,0,128,"corrode",Ps),new _n(.75*o,2.09),new Sn(1.375,2.09),new cs(.75*o,2.09),new Ei(s instanceof Gh?s.getPlayer():null),new jo(.2),new ds(.025,0,.025,0),new Hs(2));return a.position.x=e,a.position.y=t,a.position.z=n,a.direction.x=0,s.addEntitys(a),a})),ENEMY_BALL_DRONE:new Zr(oi.ENEMY_TANK_BALL_STILL,1/0,!1,((e,t,n,i,s)=>{const o=new Mn("enemy ball ball-drone",new Ra(oi.ENEMY_TANK_BALL_STILL,{aim:oi.ENEMY_TANK_BALL_AIM,pain:oi.ENEMY_TANK_BALL_PAIN},0,.5,0,1/0,1/0,5,10,.25,!1,0,1,.75,.25,1,1,!1,!1,[]),new wl(.5,.5,tl,1,10,2,"magic","always",.0625,.1,0,0,.25,1,["shot-target"]),new is({armor:{value:25,max:25},health:{value:75,max:75}}),new Ws({melee:0,ammo:.75,mugnum:.75,ball:.75,plasma:1,rocket:1,explode:0}),new Cn(oi.ENEMY_TANK_BALL_ARMOR_STILL,1),new vn(!0,!1,!0,.5),new il(!1,.5,.25,0,64,"explode",Ts),new _n(1,1),new Sn(1,1),new cs(1,1),new Ei(s instanceof Gh?s.getPlayer():null),new jo(.2),new ds(.025,0,.025,0),new Hs(2));return o.position.x=e,o.position.y=t,o.position.z=n,o.direction.x=0,s.addEntitys(o),o})),ENEMY_BALL_TANK:new Zr(oi.ENEMY_TANK_BALL_STILL,1/0,!1,((e,t,n,i,s)=>{const o=1.75,a=new Mn("enemy ball ball-tank no-blow",new Ra(oi.ENEMY_TANK_BALL_STILL,{aim:oi.ENEMY_TANK_BALL_AIM,pain:oi.ENEMY_TANK_BALL_PAIN},0,.5,0,1/0,1/0,5,10,.25,!1,0,1,.75,.25,o,o,!1,!1,[]),new wl(.5,.5,tl,3,10,2,"magic","always",.0625,.1,0,0,.25,2.5,["shot-target"]),new is({armor:{value:100,max:100},health:{value:200,max:200}}),new Ws({melee:0,ammo:.25,mugnum:.25,ball:.25,plasma:1,rocket:1,explode:0}),new Cn(oi.ENEMY_TANK_BALL_ARMOR_STILL,o),new vn(!0,!1,!0,.5),new il(!1,1,.25,0,128,"explode",Ts),new _n(o,o),new Sn(o,o),new cs(o,o),new Ei(s instanceof Gh?s.getPlayer():null),new jo(.2),new ds(.025,0,.025,0),new Hs(2));return a.position.x=e,a.position.y=t,a.position.z=n,a.direction.x=0,s.addEntitys(a),a})),OBJECT_SHOP:new Zr(oi.OBJECT_SHOP,1/0,!1,((e,t,n,i,s)=>{const o=new Mn("object shop",new qr({pistol:50,machingun:100,shotgun:200,launcher:500,magazine:10,shell:10,rocket:10}),new rl,new Cn(oi.OBJECT_SHOP,2),new vn(!0,!1,!0,.5),new ds(.025,0,.025,0),new _n(1,1.99),new cs(1,1.99),new Hs(1/0));return o.position.x=e,o.position.y=t,o.position.z=n,o.direction.x=0,s.addEntitys(o),o})),OBJECT_EDITOR:new Zr(oi.OBJECT_EDITOR,1,!1,((e,t,n,i,s)=>{const o=new Oi("editor",new al,new ji,new jo(.1),new ds(.025,.025,.025)),a=new Mn("object edtior",new ol(o),new rl,new Cn(oi.OBJECT_EDITOR,2),new vn(!0,!1,!0,.5),new ds(.025,0,.025,0),new _n(1.25,1.99),new cs(1.25,1.99),new Hs(1/0));return a.position.x=e,a.position.y=t,a.position.z=n,o.position.x=e,o.position.y=t+1,o.position.z=n,a.direction.x=0,s.addEntitys(a,o),a})),OBJECT_DRUM:new Zr(oi.OBJECT_DRUM,1/0,!1,((e,t,n,i,s)=>{const o=new Mn("object drum",new il(!1,1,.5,0,128,"explode",Ts),new is({health:{value:20,max:20}}),new Ws({melee:0,ammo:1,mugnum:1,ball:1,rocket:1,explode:1}),new Cn(oi.OBJECT_DRUM,3),new vn(!0,!1,!0,.5),new _n(.75,1.5),new Sn(1,1.75),new ds(.025,0,.025,0),new cs(.75,1.5),new Hs(2.5));return o.position.x=e,o.position.y=t,o.position.z=n,o.direction.x=0,s.addEntitys(o),o})),ITEM_HEALTH_STIM:new Zr(oi.ITEM_HEALTH_STIM,1/0,!1,((e,t,n,i,s)=>{const o=new Mn("item meat stim",new Kr(!0,!0,0,{health:10,gage:.25,meat:250,score:250},"player-pickup-meat",ti),new Cn(oi.ITEM_HEALTH_STIM,2),new vn(!0,!1,!0,.5),new ds(.025,0,.025,0),new cs(.75,.375),new Hs(1));return o.position.x=e,o.position.y=t,o.position.z=n,o.direction.x=0,s.addEntitys(o),o})),ITEM_HEALTH_MEDIKIT:new Zr(oi.ITEM_HEALTH_MEDIKIT,1/0,!1,((e,t,n,i,s)=>{const o=new Mn("item meat medikit",new Kr(!0,!0,0,{health:50,gage:.5,meat:1e3,score:1e3},"player-pickup-meat",ti),new Cn(oi.ITEM_HEALTH_MEDIKIT,2),new vn(!0,!1,!0,.5),new ds(.025,0,.025,0),new cs(.75,.375),new Hs(1));return o.position.x=e,o.position.y=t,o.position.z=n,o.direction.x=0,s.addEntitys(o),o})),ITEM_HEALTH_ELIXIR:new Zr(oi.ITEM_HEALTH_ELIXIR,1/0,!1,((e,t,n,i,s)=>{const o=new Mn("item meat elixir",new Kr(!0,!0,0,{health:100,gage:1,meat:1e4,score:1e4},"player-pickup-meat",ti),new Cn(oi.ITEM_HEALTH_ELIXIR,2),new vn(!0,!1,!0,.5),new ds(.025,0,.025,0),new cs(.75,.375),new Hs(1));return o.position.x=e,o.position.y=t,o.position.z=n,o.direction.x=0,s.addEntitys(o),o})),ITEM_ARMOR_ELIXIR:new Zr(oi.ITEM_ARMOR_ELIXIR,1/0,!1,((e,t,n,i,s)=>{const o=new Mn("item armor elixir",new Kr(!0,!1,0,{armor:100},"player-pickup-armor",ii),new Cn(oi.ITEM_ARMOR_ELIXIR,2),new vn(!0,!1,!0,.5),new ds(.025,0,.025,0),new cs(.75,.375),new Hs(1));return o.position.x=e,o.position.y=t,o.position.z=n,o.direction.x=0,s.addEntitys(o),o})),ITEM_STAMINA_ELIXIR:new Zr(oi.ITEM_STAMINA_ELIXIR,1/0,!1,((e,t,n,i,s)=>{const o=new Mn("item armor elixir",new Kr(!0,!1,0,{stamina:100},"player-pickup-stamina",si),new Cn(oi.ITEM_STAMINA_ELIXIR,2),new vn(!0,!1,!0,.5),new ds(.025,0,.025,0),new cs(.75,.375),new Hs(1));return o.position.x=e,o.position.y=t,o.position.z=n,o.direction.x=0,s.addEntitys(o),o})),ITEM_CLIP:new Zr(oi.ITEM_AMMO_CLIP,1/0,!1,((e,t,n,i,s)=>{const o=new Mn("item ammo clip",new Kr(!1,!0,0,{clip:12},"player-pickup-ammo",ti),new Cn(oi.ITEM_AMMO_CLIP,2),new vn(!0,!1,!0,.5),new ds(.025,0,.025,0),new cs(.75,.375),new Hs(1));return o.position.x=e,o.position.y=t,o.position.z=n,o.direction.x=0,s.addEntitys(o),o})),ITEM_MAGAZINE:new Zr(oi.ITEM_AMMO_MAGAZINE,1/0,!1,((e,t,n,i,s)=>{const o=new Mn("item ammo magazine",new Kr(!1,!0,0,{magazine:30},"player-pickup-ammo",Qn),new Cn(oi.ITEM_AMMO_MAGAZINE,2),new vn(!0,!1,!0,.5),new ds(.025,0,.025,0),new cs(.75,.375),new Hs(1));return o.position.x=e,o.position.y=t,o.position.z=n,o.direction.x=0,s.addEntitys(o),o})),ITEM_SHELL:new Zr(oi.ITEM_AMMO_SHELL,1/0,!1,((e,t,n,i,s)=>{const o=new Mn("item ammo shell",new Kr(!1,!0,0,{shell:6},"player-pickup-ammo",Qn),new Cn(oi.ITEM_AMMO_SHELL,2),new vn(!0,!1,!0,.5),new ds(.025,0,.025,0),new cs(.75,.375),new Hs(1));return o.position.x=e,o.position.y=t,o.position.z=n,o.direction.x=0,s.addEntitys(o),o})),ITEM_ROCKET:new Zr(oi.ITEM_AMMO_ROCKET,1/0,!1,((e,t,n,i,s)=>{const o=new Mn("item ammo rocket",new Kr(!1,!0,0,{rocket:1},"player-pickup-ammo",Qn),new Cn(oi.ITEM_AMMO_ROCKET,2),new vn(!0,!1,!0,.5),new ds(.025,0,.025,0),new cs(.75,.375),new Hs(1));return o.position.x=e,o.position.y=t,o.position.z=n,o.direction.x=0,s.addEntitys(o),o})),ITEM_CELL:new Zr(oi.ITEM_AMMO_CELL,1/0,!1,((e,t,n,i,s)=>{const o=new Mn("item ammo cell",new Kr(!1,!0,0,{cell:20},"player-pickup-ammo",Qn),new Cn(oi.ITEM_AMMO_CELL,2),new vn(!0,!1,!0,.5),new ds(.025,0,.025,0),new cs(.75,.375),new Hs(1));return o.position.x=e,o.position.y=t,o.position.z=n,o.direction.x=0,s.addEntitys(o),o})),ITEM_PUNCH:new Zr(oi.ITEM_WEAPON_PUNCH,1/0,!1,((e,t,n,i,s)=>{const o=new Mn("item weapon punch",new Kr(!1,!0,0,{hand:"punch"},"player-pickup-weapon",Qn),new Cn(oi.ITEM_WEAPON_PUNCH,2),new vn(!0,!1,!0,.5),new ds(.025,0,.025,0),new cs(.75,.375),new _n(.75,.375,["player","enemy"]),new Hs(1));return o.position.x=e,o.position.y=t,o.position.z=n,o.direction.x=0,s.addEntitys(o),o})),ITEM_BINOCULARS:new Zr(oi.ITEM_WEAPON_BINOCULARS,1/0,!1,((e,t,n,i,s)=>{const o=new Mn("item weapon binoculars",new Kr(!1,!0,0,{hand:"binoculars"},"player-pickup-weapon",$n),new Cn(oi.ITEM_WEAPON_BINOCULARS,2),new vn(!0,!1,!0,.5),new ds(.025,0,.025,0),new cs(.75,.375),new _n(.75,.375,["player","enemy"]),new Hs(1));return o.position.x=e,o.position.y=t,o.position.z=n,o.direction.x=0,s.addEntitys(o),o})),ITEM_SLOWBALL:new Zr(oi.ITEM_WEAPON_SLOWBALL,1/0,!1,((e,t,n,i,s)=>{const o=new Mn("item weapon slowball",new Kr(!1,!0,0,{hand:"slowball"},"player-pickup-weapon",$n),new Cn(oi.ITEM_WEAPON_SLOWBALL,2),new vn(!0,!1,!0,.5),new ds(.025,0,.025,0),new cs(.75,.375),new _n(.75,.375,["player","enemy"]),new Hs(1));return o.position.x=e,o.position.y=t,o.position.z=n,o.direction.x=0,s.addEntitys(o),o})),ITEM_ENERGYSHIELD:new Zr(oi.ITEM_WEAPON_ENERGYSHIELD,1/0,!1,((e,t,n,i,s)=>{const o=new Mn("item weapon energyshield",new Kr(!1,!0,0,{hand:"energyshield"},"player-pickup-weapon",$n),new Cn(oi.ITEM_WEAPON_ENERGYSHIELD,2),new vn(!0,!1,!0,.5),new ds(.025,0,.025,0),new cs(.75,.375),new _n(.75,.375,["player","enemy"]),new Hs(1));return o.position.x=e,o.position.y=t,o.position.z=n,o.direction.x=0,s.addEntitys(o),o})),ITEM_COMBOBOOSTER:new Zr(oi.ITEM_WEAPON_COMBOBOOSTER,1/0,!1,((e,t,n,i,s)=>{const o=new Mn("item weapon combobooster",new Kr(!1,!0,0,{hand:"combobooster"},"player-pickup-weapon",$n),new Cn(oi.ITEM_WEAPON_COMBOBOOSTER,2),new vn(!0,!1,!0,.5),new ds(.025,0,.025,0),new cs(.75,.375),new _n(.75,.375,["player","enemy"]),new Hs(1));return o.position.x=e,o.position.y=t,o.position.z=n,o.direction.x=0,s.addEntitys(o),o})),ITEM_GRENADE:new Zr(oi.ITEM_WEAPON_GRENADE,1/0,!1,((e,t,n,i,s)=>{const o=new Mn("item weapon slowball",new Kr(!1,!0,0,{hand:"corrodegrenade"},"player-pickup-weapon",$n),new Cn(oi.ITEM_WEAPON_GRENADE,2),new vn(!0,!1,!0,.5),new ds(.025,0,.025,0),new cs(.75,.375),new _n(.75,.375,["player","enemy"]),new Hs(1));return o.position.x=e,o.position.y=t,o.position.z=n,o.direction.x=0,s.addEntitys(o),o})),ITEM_HOOKSHOT:new Zr(oi.ITEM_WEAPON_HOOKSHOT,1/0,!1,((e,t,n,i,s)=>{const o=new Mn("item wapon hookshot",new Kr(!1,!0,0,{hand:"hookshot"},"player-pickup-weapon",$n),new Cn(oi.ITEM_WEAPON_HOOKSHOT,2),new vn(!0,!1,!0,.5),new ds(.025,0,.025,0),new cs(.75,.375),new _n(.75,.375,["player","enemy"]),new Hs(1));return o.position.x=e,o.position.y=t,o.position.z=n,o.direction.x=0,s.addEntitys(o),o})),ITEM_PISTOL:new Zr(oi.ITEM_WEAPON_PISTOL,1/0,!1,((e,t,n,i,s)=>{const o=new Mn("item weapon pistol",new Kr(!1,!0,0,{sidearm:"pistol"},"player-pickup-weapon",Qn),new Cn(oi.ITEM_WEAPON_PISTOL,2),new vn(!0,!1,!0,.5),new ds(.025,0,.025,0),new cs(.75,.375),new _n(.75,.375,["player","enemy"]),new Hs(1));return o.position.x=e,o.position.y=t,o.position.z=n,o.direction.x=0,s.addEntitys(o),o})),ITEM_HANDCANNON:new Zr(oi.ITEM_WEAPON_HANDCANNON,1/0,!1,((e,t,n,i,s)=>{const o=new Mn("item weapon handcannon",new Kr(!1,!0,0,{sidearm:"handcannon"},"player-pickup-weapon",Qn),new Cn(oi.ITEM_WEAPON_HANDCANNON,2),new vn(!0,!1,!0,.5),new ds(.025,0,.025,0),new cs(.75,.375),new _n(.75,.375,["player","enemy"]),new Hs(1));return o.position.x=e,o.position.y=t,o.position.z=n,o.direction.x=0,s.addEntitys(o),o})),ITEM_MACHINGUN:new Zr(oi.ITEM_WEAPON_MACHINGUN,1/0,!1,((e,t,n,i,s)=>{const o=new Mn("item weapon machingun",new Kr(!1,!0,0,{machingun:"machingun",magazine:30},"player-pickup-weapon",$n),new Cn(oi.ITEM_WEAPON_MACHINGUN,2),new vn(!0,!1,!0,.5),new ds(.025,0,.025,0),new cs(.75,.375),new _n(.75,.375,["player","enemy"]),new Hs(1));return o.position.x=e,o.position.y=t,o.position.z=n,o.direction.x=0,s.addEntitys(o),o})),ITEM_CHAINSHOTGUN:new Zr(oi.ITEM_WEAPON_CHAINSHOTGUN,1/0,!1,((e,t,n,i,s)=>{const o=new Mn("item weapon chainshotgun",new Kr(!1,!0,0,{machingun:"chainshotgun",magazine:30},"player-pickup-weapon",$n),new Cn(oi.ITEM_WEAPON_CHAINSHOTGUN,2),new vn(!0,!1,!0,.5),new ds(.025,0,.025,0),new cs(.75,.375),new _n(.75,.375,["player","enemy"]),new Hs(1));return o.position.x=e,o.position.y=t,o.position.z=n,o.direction.x=0,s.addEntitys(o),o})),ITEM_SHOTGUN:new Zr(oi.ITEM_WEAPON_SHOTGUN,1/0,!1,((e,t,n,i,s)=>{const o=new Mn("item weapon shotgun",new Kr(!1,!0,0,{shotgun:"shotgun",shell:6},"player-pickup-weapon",$n),new Cn(oi.ITEM_WEAPON_SHOTGUN,2),new vn(!0,!1,!0,.5),new ds(.025,0,.025,0),new cs(.75,.375),new _n(.75,.375,["player","enemy"]),new Hs(1));return o.position.x=e,o.position.y=t,o.position.z=n,o.direction.x=0,s.addEntitys(o),o})),ITEM_HEAVYCANNON:new Zr(oi.ITEM_WEAPON_HEAVYCANNON,1/0,!1,((e,t,n,i,s)=>{const o=new Mn("item weapon heavycannon",new Kr(!1,!0,0,{shotgun:"heavycannon",shell:6},"player-pickup-weapon",$n),new Cn(oi.ITEM_WEAPON_HEAVYCANNON,2),new vn(!0,!1,!0,.5),new ds(.025,0,.025,0),new cs(.75,.375),new _n(.75,.375,["player","enemy"]),new Hs(1));return o.position.x=e,o.position.y=t,o.position.z=n,o.direction.x=0,s.addEntitys(o),o})),ITEM_LAUNCHER:new Zr(oi.ITEM_WEAPON_LAUNCHER,1/0,!1,((e,t,n,i,s)=>{const o=new Mn("item weapon launcher",new Kr(!1,!0,0,{launcher:"launcher",rocket:2},"player-pickup-weapon",$n),new Cn(oi.ITEM_WEAPON_LAUNCHER,2),new vn(!0,!1,!0,.5),new ds(.025,0,.025,0),new cs(.75,.375),new _n(.75,.375,["player","enemy"]),new Hs(1));return o.position.x=e,o.position.y=t,o.position.z=n,o.direction.x=0,s.addEntitys(o),o})),ITEM_CLUSTERBOW:new Zr(oi.ITEM_WEAPON_CLUSTERBOW,1/0,!1,((e,t,n,i,s)=>{const o=new Mn("item weapon clusterbow",new Kr(!1,!0,0,{launcher:"clusterbow",rocket:3},"player-pickup-weapon",$n),new Cn(oi.ITEM_WEAPON_CLUSTERBOW,2),new vn(!0,!1,!0,.5),new ds(.025,0,.025,0),new cs(.75,.375),new _n(.75,.375,["player","enemy"]),new Hs(1));return o.position.x=e,o.position.y=t,o.position.z=n,o.direction.x=0,s.addEntitys(o),o})),ITEM_PLASMAGUN:new Zr(oi.ITEM_WEAPON_PLASMAGUN,1/0,!1,((e,t,n,i,s)=>{const o=new Mn("item weapon plasmagun",new Kr(!1,!0,0,{plasmagun:"plasmagun",cell:20},"player-pickup-weapon",$n),new Cn(oi.ITEM_WEAPON_PLASMAGUN,2),new vn(!0,!1,!0,.5),new ds(.025,0,.025,0),new cs(.75,.375),new _n(.75,.375,["player","enemy"]),new Hs(1));return o.position.x=e,o.position.y=t,o.position.z=n,o.direction.x=0,s.addEntitys(o),o})),ITEM_PLASMASMG:new Zr(oi.ITEM_WEAPON_PLASMASMG,1/0,!1,((e,t,n,i,s)=>{const o=new Mn("item weapon plasmasmg",new Kr(!1,!0,0,{plasmagun:"plasmasmg",cell:20},"player-pickup-weapon",$n),new Cn(oi.ITEM_WEAPON_PLASMASMG,2),new vn(!0,!1,!0,.5),new ds(.025,0,.025,0),new cs(.75,.375),new _n(.75,.375,["player","enemy"]),new Hs(1));return o.position.x=e,o.position.y=t,o.position.z=n,o.direction.x=0,s.addEntitys(o),o})),ITEM_KEY_RED:new Zr(oi.ITEM_KEY_RED,1,!1,((e,t,n,i,s)=>{const o=new Mn("item key key-red",new Kr(!0,!1,0,{"key-red":1},"player-pickup-key",ei),new Cn(oi.ITEM_KEY_RED,2),new vn(!0,!1,!0,.5),new ds(.025,0,.025,0),new cs(.75,.375),new Hs(1));return o.position.x=e,o.position.y=t,o.position.z=n,o.direction.x=0,s.addEntitys(o),o})),ITEM_KEY_BLUE:new Zr(oi.ITEM_KEY_BLUE,1,!1,((e,t,n,i,s)=>{const o=new Mn("item key key-blue",new Kr(!0,!1,0,{"key-blue":1},"player-pickup-key",ei),new Cn(oi.ITEM_KEY_BLUE,2),new vn(!0,!1,!0,.5),new ds(.025,0,.025,0),new cs(.75,.375),new Hs(1));return o.position.x=e,o.position.y=t,o.position.z=n,o.direction.x=0,s.addEntitys(o),o})),ITEM_KEY_YELLOW:new Zr(oi.ITEM_KEY_YELLOW,1,!1,((e,t,n,i,s)=>{const o=new Mn("item key key-yellow",new Kr(!0,!1,0,{"key-yellow":1},"player-pickup-key",ei),new Cn(oi.ITEM_KEY_YELLOW,2),new vn(!0,!1,!0,.5),new ds(.025,0,.025,0),new cs(.75,.375),new Hs(1));return o.position.x=e,o.position.y=t,o.position.z=n,o.direction.x=0,s.addEntitys(o),o})),ITEM_KEY_RANDOM:new Zr(oi.ITEM_KEY_RANDOM,3,!1,((e,t,n,i,s)=>{const o=new Array;return 0===s.getEntitysOfName("key-red").length&&o.push(Ll.ITEM_KEY_RED),0===s.getEntitysOfName("key-blue").length&&o.push(Ll.ITEM_KEY_BLUE),0===s.getEntitysOfName("key-yellow").length&&o.push(Ll.ITEM_KEY_YELLOW),o.length>0?o[o.length*Math.random()|0].spawn(e,t,n,0,s):null})),CHECKPOINT:new Zr(oi.OBJECT_CHECKPOINT_DISABLE,1/0,!1,((e,t,n,i,s)=>{const o=new Mn("checkpoint",new fl,new Cn(oi.NONE,2),new vn(!0,!1,!0,.5),new cs(.5,.001),new ds(.025,0,.025,0),new Hs(1));return o.position.x=e,o.position.y=t,o.position.z=n,s.addEntitys(o),o})),SPAWNER_HEALTH_ELIXER:new Zr(oi.OBJECT_SPAWNER,1/0,!1,((e,t,n,i,s)=>{const o=new Mn("spawner spawner-elixer",new sl(Ll.ITEM_HEALTH_ELIXIR,s instanceof Gh&&(s.hasPractice()||s.hasTutorial())?2.5:45),new Cn(oi.OBJECT_SPAWNER,1),new vn(!0,!1,!0,.5),new En(1,1),new cs(.5,.001),new ds(.025,0,.025,0),new Hs(1));return o.position.x=e,o.position.y=t,o.position.z=n,o.direction.x=0,s.addEntitys(o),o})),SPAWNER_ARMOR_ELIXER:new Zr(oi.OBJECT_SPAWNER,1/0,!1,((e,t,n,i,s)=>{const o=new Mn("spawner spawner-elixer",new sl(Ll.ITEM_ARMOR_ELIXIR,s instanceof Gh&&(s.hasPractice()||s.hasTutorial())?2.5:45),new Cn(oi.OBJECT_SPAWNER,1),new vn(!0,!1,!0,.5),new En(1,1),new cs(.5,.001),new ds(.025,0,.025,0),new Hs(1));return o.position.x=e,o.position.y=t,o.position.z=n,o.direction.x=0,s.addEntitys(o),o})),SPAWNER_STAMINA_ELIXER:new Zr(oi.OBJECT_SPAWNER,1/0,!1,((e,t,n,i,s)=>{const o=new Mn("spawner spawner-elixer",new sl(Ll.ITEM_STAMINA_ELIXIR,s instanceof Gh&&(s.hasPractice()||s.hasTutorial())?2.5:45),new Cn(oi.OBJECT_SPAWNER,1),new vn(!0,!1,!0,.5),new En(1,1),new cs(.5,.001),new ds(.025,0,.025,0),new Hs(1));return o.position.x=e,o.position.y=t,o.position.z=n,o.direction.x=0,s.addEntitys(o),o})),SPAWNER_MAGAZINE:new Zr(oi.OBJECT_SPAWNER,1/0,!1,((e,t,n,i,s)=>{const o=new Mn("spawner spawner-elixer",new sl(Ll.ITEM_MAGAZINE,s instanceof Gh&&(s.hasPractice()||s.hasTutorial())?2.5:45),new Cn(oi.OBJECT_SPAWNER,1),new vn(!0,!1,!0,.5),new En(1,1),new cs(.5,.001),new ds(.025,0,.025,0),new Hs(1));return o.position.x=e,o.position.y=t,o.position.z=n,o.direction.x=0,s.addEntitys(o),o})),SPAWNER_SHELL:new Zr(oi.OBJECT_SPAWNER,1/0,!1,((e,t,n,i,s)=>{const o=new Mn("spawner spawner-elixer",new sl(Ll.ITEM_SHELL,s instanceof Gh&&(s.hasPractice()||s.hasTutorial())?2.5:45),new Cn(oi.OBJECT_SPAWNER,1),new vn(!0,!1,!0,.5),new En(1,1),new cs(.5,.001),new ds(.025,0,.025,0),new Hs(1));return o.position.x=e,o.position.y=t,o.position.z=n,o.direction.x=0,s.addEntitys(o),o})),SPAWNER_ROCKET:new Zr(oi.OBJECT_SPAWNER,1/0,!1,((e,t,n,i,s)=>{const o=new Mn("spawner spawner-elixer",new sl(Ll.ITEM_ROCKET,s instanceof Gh&&(s.hasPractice()||s.hasTutorial())?2.5:45),new Cn(oi.OBJECT_SPAWNER,1),new vn(!0,!1,!0,.5),new En(1,1),new cs(.5,.001),new ds(.025,0,.025,0),new Hs(1));return o.position.x=e,o.position.y=t,o.position.z=n,o.direction.x=0,s.addEntitys(o),o})),SPAWNER_CELL:new Zr(oi.OBJECT_SPAWNER,1/0,!1,((e,t,n,i,s)=>{const o=new Mn("spawner spawner-elixer",new sl(Ll.ITEM_CELL,s instanceof Gh&&(s.hasPractice()||s.hasTutorial())?2.5:45),new Cn(oi.OBJECT_SPAWNER,1),new vn(!0,!1,!0,.5),new En(1,1),new cs(.5,.001),new ds(.025,0,.025,0),new Hs(1));return o.position.x=e,o.position.y=t,o.position.z=n,o.direction.x=0,s.addEntitys(o),o})),SPAWNER_TARGET:new Zr(oi.OBJECT_SPAWNER,1/0,!1,((e,t,n,i,s)=>{const o=new Mn("spawner spawner-target",new sl(Ll.ENEMY_TARGET,2.5),new Cn(oi.OBJECT_SPAWNER,1),new vn(!0,!1,!0,.5),new En(1,1),new cs(.5,.001),new ds(.025,0,.025,0),new Hs(1));return o.position.x=e,o.position.y=t,o.position.z=n,o.direction.x=0,s.addEntitys(o),o})),SPAWNER_SHOP:new Zr(oi.OBJECT_SPAWNER,1/0,!1,((e,t,n,i,s)=>{const o=new Mn("spawner spawner-shop",new sl(Ll.OBJECT_SHOP,2.5),new Cn(oi.OBJECT_SPAWNER,1),new vn(!0,!1,!0,.5),new En(1,1),new cs(.5,.001),new ds(.025,0,.025,0),new Hs(1));return o.position.x=e,o.position.y=t,o.position.z=n,o.direction.x=0,s.addEntitys(o),o})),HORDE_GROUND_SPAWNER:new Zr(oi.UI_HORDE_SPAWN_POINT,1/0,!1,((e,t,n,i,s)=>{const o=new Mn("horde-spawn-point",new yl("default",!1));return o.position.x=e,o.position.y=t+.5,o.position.z=n,s.addEntitys(o),o})),HORDE_SNIPER_SPAWNER:new Zr(oi.UI_HORDE_SPAWN_POINT,1/0,!1,((e,t,n,i,s)=>{const o=new Mn("horde-spawn-point",new yl("sniper",!0));return o.position.x=e,o.position.y=t+.5,o.position.z=n,s.addEntitys(o),o})),HORDE_SKY_SPAWNER:new Zr(oi.UI_HORDE_SPAWN_POINT,1/0,!1,((e,t,n,i,s)=>{const o=new Mn("horde-spawn-point",new yl("sky",!0));return o.position.x=e,o.position.y=t+.5,o.position.z=n,s.addEntitys(o),o}))};class Ol{constructor(e,t){this.landing=!1,this.feel=!1,this.min=e,this.max=t}}class Al{constructor(){this.init=!1,this.rotSpeed=0,this.landing=!1}}class Wl{constructor(){this.spawnTime=performance.now(),this.init=!1,this.rotSpeed=0,this.rot=0}}class Nl extends Mn{constructor(e,t,n,i,s){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,r=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;for(var l=arguments.length,h=new Array(l>8?l-8:0),p=8;p<l;p++)h[p-8]=arguments[p];super("item".concat(e.length>0?" ".concat(e):""),new ds(.001,0,.001,0),new Hs(s),new cs(.25,.25),...h);const{position:c}=this;c.x=t,c.y=n+.01,c.z=i;const d=this.getComponent(cs);d.old.x=c.x,d.old.y=c.y,d.old.z=c.z;const u=this.getComponent(ds);u.value.x=o,u.value.y=a,u.value.z=r}}class zl extends Nl{constructor(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;super("item gib piece",e,t,n,1,arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,new Al,new Kr(!0,!0,.5,{health:3,gage:.05,meat:s,score:s},"player-pickup-meat",ti),new Ol(2.5,10),new Cn([oi.EFFECT_GIB1,oi.EFFECT_GIB2,oi.EFFECT_GIB3,oi.EFFECT_GIB4][4*Math.random()|0],0,Math.random()*Math.PI*2,.25,Math.random()>.5,Math.random()>.5),new vn(!0,!0,!0,.1),new Bs(1+.5*Math.random(),Math.random()>.5,!0),new Ir(.1+.4*Math.random(),i,!1))}}class Dl extends Nl{constructor(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super("effect stuff",e,t,n,1,arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,new Wl,new Kr(!1,!0,.5,{stamina:10},"player-pickup-stamina",si),new Ol(2.5,2.5),new Cn(oi.EFFECT_STUFF,1*i,0,1,Math.random()>.5,Math.random()>.5),new vn(!0,!1,!0,.1),new Bs(1+.5*Math.random(),Math.random()>.5,!0))}}class Rl extends Nl{constructor(e,t,n,i,s){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,r=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,h=arguments.length>9?arguments[9]:void 0;for(var p=arguments.length,c=new Array(p>10?p-10:0),d=10;d<p;d++)c[d-10]=arguments[d];super("effect armor".concat(0===e.length?"":" ".concat(e)),t,n,i,1,a,r,l,new Al,new Kr(!1,!0,.5,{armor:h},"player-pickup-armor",ii),new Ol(2.5,2.5),new Cn(s,2*o,Math.random()*Math.PI*2,.25,!1,!1),new vn(!0,!1,!0,.1),new Bs(1+.5*Math.random(),Math.random()>.5,!0),...c)}}class Hl extends Rl{constructor(e,t,n,i){super("effect helmet",e,t,n,oi.ENEMY_GUY_HELMET_STILL,i,arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,5)}}class Fl extends Rl{constructor(e,t,n){super("effect armor-helmet",e,t,n,oi.ENEMY_GUY_ARMOR_HELMET,arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,5)}}class Ul extends Rl{constructor(e,t,n){super("effect armor-body",e,t,n,oi.ENEMY_GUY_ARMOR_BODY,arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,5)}}class Bl extends Rl{constructor(e,t,n){super("effect armor-arm",e,t,n,oi.ENEMY_GUY_ARMOR_ARM,arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,1)}}class Yl extends Rl{constructor(e,t,n){super("effect armor-sholder",e,t,n,oi.ENEMY_GUY_ARMOR_SHOULDER,arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,1)}}class Gl extends Rl{constructor(e,t,n){super("effect armor-waist",e,t,n,oi.ENEMY_GUY_ARMOR_WAIST,arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,1)}}const Vl=Math.PI/2;class Xl extends Bi{constructor(e){super(Ws),this.setting=e}offset(e,t,n){const i=performance.now(),{position:s}=t,o=t.getComponent(Ws);let a=0;const r=t.getNames();if(!o.isDeath){const e=new Array;if(r.some((e=>"guy-armor"===e))&&es(t,"armor")<=0&&(o.isDeath=!0,t.hasComponent(Ra)))if(r.some((e=>"guy-melee"===e)))Qi(t,"health",0);else{const l=o.attacker||o.value.find((e=>e.attacker)),h=n instanceof Gh?n.getPlayer():null;if(null!==h&&l===h&&h.hasComponent(Uo)){const e=h.getComponent(Uo);if(a=Math.min(e.max,es(h,"combo")+1),Qi(h,"combo",a),h.hasComponent(Gi)){const e=h.getComponent(Gi);e.comboTime=e.time}es(h,"combo",0)>=e.start&&Qi(h,"gage",1)}let p=0,c=0;const d=o.value[o.value.length-1]||null;if(null!==d&&(p=d.direction.x,c=d.direction.y),null!==h&&o.attacker===h){const e=7.5;if(h.hasComponent(Gi)){const t=h.getComponent(Gi);t.startAddTime=i,t.addTimeValue=e,t.bonusType=2}Qi(h,"hordetime",es(h,"hordetime",0)+e)}e.push(new Os(s.x,s.y+.5*(t.hasComponent(cs)?t.getComponent(cs).size.y:0),s.z),...[Fl,Ul,Yl,Yl,Bl,Bl,Gl,Gl].map((e=>{const[n,i,o]=A(p,c,Math.random()-.5,.5*Math.random(),2*Math.random());return new e(s.x,s.y+.5*(t.hasComponent(cs)?t.getComponent(cs).size.y:0),s.z,1,.1*n,.25+.1*i,.1*o)}))),n.createSound("./asset/sound/enemy/death-armor.mp3",t).setVolume(20).play();let u=null;r.some((e=>"guy-pistol"===e))?u=Ll.ENEMY_GUY_PISTOL.spawn(t.position.x,t.position.y,t.position.z,t.direction.x,n):r.some((e=>"guy-shotgun"===e))?u=Ll.ENEMY_GUY_SHOTGUN.spawn(t.position.x,t.position.y,t.position.z,t.direction.x,n):r.some((e=>"guy-machingun"===e))&&(u=Ll.ENEMY_GUY_MACHINGUN.spawn(t.position.x,t.position.y,t.position.z,t.direction.x,n)),null!==u&&(u.hasComponent(Ra)&&(u.getComponent(Ra).see=!0),Qi(u,"health",es(t,"health",es(u,"health",0)))),t.remove()}if(es(t,"health")<=0){o.isDeath=!0;const r=o.attacker||o.value.find((e=>e.attacker));if(t.hasComponent(Gi))if(n instanceof Gh&&n.hasPractice()){const e=n.getCamera();if(n.getEntitysOfName("death-respawn-point").forEach((e=>{e instanceof Mn&&(Qi(t,"health",100),t.position.x=e.position.x,t.position.y=e.position.y+.01,t.position.z=e.position.z)})),t.direction.x=1e-4,t.direction.y=1e-4,t.direction.z=0,e.hasComponent(wi)){const t=e.getComponent(wi);t.position.x=0,t.position.y=0,t.position.z=0}if(t.hasComponent(ds)){const e=t.getComponent(ds);e.value.x=0,e.value.y=0,e.value.z=0}o.isDeath=!1}else{const e=t.getComponent(Gi),s=n.getCamera(),a=o.value[o.value.length-1]||null;let r=t.direction.x-Math.PI;if(null!==a&&(r=a.direction.x),s.hasComponent(wi)){const e=s.getComponent(wi);e.position.x=0,e.position.y=.125,e.position.z=0}if(s.hasComponent(Yo)){const e=s.getComponent(Yo);e.position.x=0,e.position.y=.125,e.position.z=0,e.init=!1}if(t.hasComponent(cs)){t.getComponent(cs).size.y=.25,t.position.y=s.position.y-.125}const[l,h]=O(r,0,.15);if(t.hasComponent(ds)){const e=t.getComponent(ds);e.value.x=l,e.value.y=0,e.value.z=h}o.deathAngle=R(r,t.direction.x),n instanceof Gh&&n.hasHorde()&&(!this.setting.hasCheckPoint()||this.setting.hasPermaDeath())?e.goleTime=i:e.deathTime=i}if(t.hasComponent(Ra)){const l=t.getNames(),h=t.getComponent(Ra),p=n instanceof Gh?n.getPlayer():null;if(null!==p&&r===p&&p.hasComponent(Uo)){const e=p.getComponent(Uo);if(a=Math.min(e.max,es(p,"combo")+1),Qi(p,"combo",a),p.hasComponent(Gi)){const e=p.getComponent(Gi);e.comboTime=e.time}es(p,"combo",0)>=e.start&&Qi(p,"gage",1),p.hasComponent(Gi)&&(p.getComponent(Gi).killTime=performance.now())}let c=0,d=0;const u=o.value[o.value.length-1]||null;if(null!==u&&(c=u.direction.x,d=u.direction.y),!l.some((e=>"green-blood"===e)))for(let n=0,i=10;n<i;n=n+1|0){const[n,i,o]=A(c,d,(Math.random()-.5)/.5,.5*Math.random(),(Math.random()-.5)/.5);e.push(new Wr(s.x,s.y+.5*(t.hasComponent(cs)?t.getComponent(cs).size.y:0),s.z,1+1.5*Math.random(),.025*n,.125*Math.random()+.025*i,.025*o))}for(let n=0,i=0|a;n<i;n=n+1|0){const[i,o,a]=A(c,d,Math.random()-.5,.5*Math.random(),2*Math.random());e.push(new zl(s.x,s.y+.5*(t.hasComponent(cs)?t.getComponent(cs).size.y:0),s.z,1+1.5*Math.random(),251+7*n,.1*i,.25+.1*o,.1*a))}if(l.some((e=>"guy-armor"===e))){if(null!==p&&o.attacker===p){const e=7.5;if(p.hasComponent(Gi)){const t=p.getComponent(Gi);t.startAddTime=i,t.addTimeValue=e,t.bonusType=2}Qi(p,"hordetime",es(p,"hordetime",0)+e)}e.push(...[Fl,Ul,Yl,Yl,Bl,Bl,Gl,Gl].map((e=>{const[n,i,o]=A(c,d,Math.random()-.5,.5*Math.random(),2*Math.random());return new e(s.x,s.y+.5*(t.hasComponent(cs)?t.getComponent(cs).size.y:0),s.z,1,.1*n,.25+.1*i,.1*o)})))}else n instanceof Gh&&r===p&&n.countKillEnemy();if(h.deathVoices.length>0&&n.createSound(h.deathVoices[h.deathVoices.length*Math.random()|0],t,"enemy-voice-".concat(t.getID())).setVolume(10).play(),Math.random()<(n instanceof Gh?this.setting.getRandomWeaponDrop():0)){const e=[Ll.ITEM_PUNCH,Ll.ITEM_SLOWBALL,Ll.ITEM_BINOCULARS,Ll.ITEM_ENERGYSHIELD,Ll.ITEM_COMBOBOOSTER,Ll.ITEM_GRENADE,Ll.ITEM_HOOKSHOT,Ll.ITEM_PISTOL,Ll.ITEM_HANDCANNON,Ll.ITEM_MACHINGUN,Ll.ITEM_CHAINSHOTGUN,Ll.ITEM_SHOTGUN,Ll.ITEM_HEAVYCANNON,Ll.ITEM_LAUNCHER,Ll.ITEM_CLUSTERBOW,Ll.ITEM_PLASMAGUN,Ll.ITEM_PLASMASMG];e[Math.random()*e.length|0].spawn(t.position.x,t.position.y,t.position.z,t.direction.x,n)}if(l.includes("guy-pistol")||l.includes("guy-shotgun")||l.includes("guy-machingun")){const[n,i,o]=A(c,d,Math.random()-.5,0,2*Math.random());e.push(new Dl(s.x,s.y+.5*(t.hasComponent(cs)?t.getComponent(cs).size.y:0),s.z,1,.075*n,.075*i,.075*o))}else if(l.includes("guy-missile")){if(null!==p&&o.attacker===p){const e=10;if(p.hasComponent(Gi)){const t=p.getComponent(Gi);t.startAddTime=i,t.addTimeValue=e,t.bonusType=1}Qi(p,"hordetime",es(p,"hordetime",0)+e)}e.push(new jr(s.x,s.y,s.z,s.x,s.y,s.z,0,Math.PI/2,0,!1,1/0,.5,!1,0,0,0,0,!1,"explode",t,null,[t.getID()]))}n.createSound("./asset/sound/effect/splash.mp3",t,"blood-splash-".concat(t.getID())).play(),t.remove()}if(t.hasComponent(ms)&&t.remove(),t.hasComponent(Yr)){const[e,i,o]=A(2*Math.PI*Math.random(),-(Math.PI/4+Math.PI/4*Math.random()),Math.random()-.5,0,2*Math.random());if(n.addEntitys(new Hl(s.x,s.y+.5*(t.hasComponent(cs)?t.getComponent(cs).size.y:0),s.z,1,.1*e,.1*i,.1*o)),t.hasComponent(Ei)){const e=t.getComponent(Ei).value;e&&n.addEntitys(new Xr(e,.5,.5))}t.remove()}}else!t.hasComponent(Gi)&&s.y<=0&&(t.hasComponent(is)&&t.getComponent(is).value.hasOwnProperty("health")?Qi(t,"health",0):t.remove());if(o.isDeath&&t.hasComponent(il)){const n=t.getComponent(il);e.push(...n.sparkTypes.map((e=>new e(t.position.x,t.position.y,t.position.z,n.size,n.force,n.minDamage,n.maxDamage,n.damageType,o.attacker,[])))),t.remove()}n.addEntitys(...e)}if(o.isDeath&&t.hasComponent(Gi)&&es(t,"health")<=0){const e=o.deathAngle;let n=0;n=e>0?(e>Vl?Vl-(e-Vl):e)/Vl*-Vl:(e<-Vl?e+Vl+Vl:-e)/Vl*Vl;const i=Math.abs(e);let s=0;s=i>Vl?(i-Vl)/Vl*-Vl:(Vl-i)/Vl*Vl,t.direction.z=j(t.direction.z,n,.25),t.direction.y=j(t.direction.y,s,.25)}}}class jl extends Bi{constructor(e){super(Fo,Gi,is),this.weapons={},this.setting=e;for(const e in Ho)this.addWeapon(e,Ho[e])}addWeapon(e,t){this.weapons[e]=t}getWeapon(e){return(this.weapons[e]||this.weapons.punch).create()}additional(e,t,n){const{direction:i}=t,a=t.getComponent(Fo),r=t.getComponent(Gi),l=$i(t,a.left,null),h=$i(t,a.right,null);"string"==typeof l&&"string"==typeof h&&(a.isLeftChange=l!==a.leftOld,a.isRightChange=h!==a.rightOld,a.isLeftChange&&"string"==typeof l&&(a.leftWeapon=this.getWeapon(l),a.leftChangeTime=r.time),a.isRightChange&&"string"==typeof h&&(a.rightWeapon=this.getWeapon(h),a.rightChangeTime=r.time),a.leftOld=l,a.rightOld=h);const p=n.getCamera(),c=n.getEntitysOfName("hand-right")[0]||null,d=n.getEntitysOfName("hand-left")[0]||null,u=[[a.rightWeapon,c,a.isFireRight,a.toggleFireRight,a.isRightChange,!1,-.0625,-.125,.125],[a.leftWeapon,d,a.isFireLeft,a.toggleFireLeft,a.isLeftChange,!0,.0625,-.125,.125]];let m=t.hasComponent(aa)?t.getComponent(aa).oldPosition:t.position,g=t.hasComponent(aa)?t.getComponent(aa).startDir:t.direction.x;-1!==m.x&&-1!==m.y&&-1!==m.z||(m=t.position),-1===g&&(g=t.direction.x);const f=t.hasComponent(oa)&&t.getComponent(oa).cameraValue>0;let y=!1;a.isBlock===f||f||r.isAir||t.hasComponent(ss)&&t.getComponent(ss).climb||!t.hasComponent(aa)||!t.getComponent(aa).exec||u.forEach((e=>{let[,t,,,,]=e;t&&t.hasComponent(bn)&&t.getComponent(Fa).swais.push(new ra(.5,.375,1.75,2,0))})),a.isBlock=f,p.zoom=1;const w=ha(t),[x,,,,,]=as(t),M=a.leftWeapon.data.shootType===wo.SHIELD&&a.leftWeapon.isFire||a.rightWeapon.data.shootType===wo.SHIELD&&a.rightWeapon.isFire,E=new Array,C=!!t.hasComponent(ss)&&(t.getComponent(ss).exec&&!t.getComponent(ss).climb),v=!!t.hasComponent(ji)&&t.getComponent(ji).enable;let b=!1;a.isCanShoot=!C,E.push((()=>{a.isAction=b||!!t.hasComponent(sa)&&t.getComponent(sa).enable||t.hasComponent(ta)&&t.hasComponent(aa)&&t.hasComponent(Gi)&&(!t.getComponent(aa).exec&&t.getComponent(ta).enableCluch||t.getComponent(aa).exec&&(t.getComponent(ta).enableCluch?Math.floor(100*t.getComponent(Gi).axes.x.y)/100<=0:Math.floor(100*t.getComponent(Gi).axes.x.y)/100<0))||t.hasComponent($o)&&t.getComponent($o).exec||t.hasComponent(na)&&t.getComponent(na).exec||(null!==m&&-1!==m.x&&-1!==m.y&&-1!==m.z?n.hasHitScanVoxel(g,0,m.x,t.position.y+(p.hasComponent(wi)?p.getComponent(wi).position.y:0),m.z,(t.hasComponent(cs)?t.getComponent(cs).size.x:0)/2+(t.hasComponent(oa)?t.getComponent(oa).length:0))||n.hasHitScanVoxel(g,0,m.x,t.position.y+(p.hasComponent(ta)?p.getComponent(ta).cluchSizeY:0)/2,m.z,(t.hasComponent(cs)?t.getComponent(cs).size.x/2:0)+(t.hasComponent(oa)?t.getComponent(oa).length:0)):!!t.hasComponent(ss)&&(t.getComponent(ss).exec||t.getComponent(ss).climb))})),u.forEach((l=>{let[h,m,g,f,_,S,k,T,P]=l;if(null===h)return;const I=h.bullets.some((e=>e.hasLive()));if(!I&&h.bullets.length>0&&(h.bullets.forEach((e=>e.remove())),me(h.bullets),h.isFire=!1),h.isShootable=!1,h.isCanShoot=a.isCanShoot,h.data.fireSpeed>0&&-1===r.respawnTime){const l=h.data.shootType===wo.AUTO,L=h.data.shootType===wo.SLOW||h.data.shootType===wo.ZOOM||h.data.shootType===wo.SHIELD,O=h.data.shootType===wo.SPIN,W=h.data.shootType===wo.CHARGE,N=W&&!r.isWaitActive&&!!r.keys.use&&r.keys.use!==r.presss.use,z=g||f,D=h.chargePar>=1,R=D?h.data.ammoReduceMax:h.data.ammoReduceMin,H=null===h.data.ammoType||h.data.shootType!==wo.SPIN&&h.chargePar>0||es(t,h.data.ammoType)>=R,F=!(S?(a.rightWeapon.data.isEndFire&&a.rightWeapon.isFire||a.rightWeapon.data.shootType===wo.CHARGE&&a.rightWeapon.chargePar>0)&&a.rightWeapon.data.ammoType===h.data.ammoType&&es(t,a.rightWeapon.data.ammoType||"",0)>0&&es(t,a.rightWeapon.data.ammoType||"",0)-(D?a.rightWeapon.data.ammoReduceMax:a.rightWeapon.data.ammoReduceMin)<R:(a.leftWeapon.data.isEndFire&&a.leftWeapon.isFire||a.rightWeapon.data.shootType===wo.CHARGE&&a.leftWeapon.chargePar>0)&&a.leftWeapon.data.ammoType===h.data.ammoType&&es(t,a.leftWeapon.data.ammoType||"",0)>0&&es(t,a.leftWeapon.data.ammoType||"",0)-(D?a.leftWeapon.data.ammoReduceMax:a.leftWeapon.data.ammoReduceMin)<R)&&(h.data.shootType===wo.ZOOM||H);if(h.isAmmo=F,!h.data.isEndFire&&_||null!==r.activeEntity||N||L&&!z||C||v&&(!L&&!W&&!h.data.isEndFire&&0===h.chargePar))h.time=-1,h.isFire=!1,h.isFireWait=!1,h.isHoldFire=!1,(N||L&&!z||!L&&!W||O&&!a.isCanShoot||h.data.isEndFire)&&(h.chargePar=0,h.chargeLateTime=0,h.isNoChargeFire=!1,h.isChargeStart=!1,h.isChargeEnable=!1,S?a.isFireLeft=!1:a.isFireRight=!1);else{h.isHoldFire=L&&z;let C=!1;if(g||(h.isFirePress=!1,h.isEmpty=!1),h.isCanShoot&&-1!==h.time){const t=h.time+s(e/60,0);h.time=a.isCanShoot?t:Math.max(h.data.fireSpeed,t)}if(!O||(h.isChargeStart||f)&&g&&F&&!v){if((h.data.shootType===wo.CHARGE||h.data.shootType===wo.SPIN)&&h.data.chargeTime>0&&F&&(h.isChargeStart||h.isNoChargeFire?g:f)){const i=!h.data.ammoType||es(t,h.data.ammoType)>=h.data.ammoReduceMax,o=O?0:this.setting.getWeaponChargeStandTime()/1e3;h.chargeLateTime=Math.min(h.data.chargeTime+o,h.chargeLateTime+e/60);const r=O?1:Math.min(1,h.data.ammoType?es(t,h.data.ammoType)/(S?a.leftWeapon.chargePar>0?a.leftWeapon.data.ammoReduceMax:0:a.rightWeapon.chargePar>0?a.rightWeapon.data.ammoReduceMax:0):h.data.ammoReduceMax),l=Math.max(h.chargePar,Math.min(r,s((h.chargeLateTime-o)/(h.data.chargeTime*(1-ha(t))),1,100,Math.ceil)));i&&(h.chargePar=Math.max(0,Math.min(1,l)),h.chargePar>=1&&!h.isChargeMax&&n.createSound("./asset/sound/weapon/charge-complete.mp3",null,"player-charge-full".concat(t.getID())).setVolume(2).play(),h.isChargeEnable=h.chargePar>0,h.isChargeMax=h.chargePar>=1,h.isChargeStart=!0),h.isNoChargeFire=0===l}}else h.chargeLateTime=Math.max(0,h.chargeLateTime-e/60),h.chargeLateTime<0&&(h.chargeLateTime=0),h.chargePar=s(Math.max(0,Math.min(1,h.chargeLateTime/h.data.chargeTime)),0,100,Math.ceil),h.isChargeEnable=!1,h.isChargeMax=!1,h.isChargeStart=!1;const _=D?h.data.bulletLengthMax:h.data.bulletLengthMin,N=D?h.data.bulletScaleMax:h.data.bulletScaleMin,H=D?h.data.chargeFindTarget:h.data.normalFindTarget,U=["player-hit-bullet","enemy-hit-bullet",t.getID()],B=t.hasComponent(aa)?t.getComponent(aa).value.x:0,[Y,G,V]=A(p.direction.x,p.direction.y,(x||M?Math.abs(k)*B*.5:k+Math.abs(k)*B*.5)/p.fov,T/p.fov,P/p.fov),[X,K,q,,Z]=N>0?H?n.hitScanBoldFind("hitbox",p.direction.x,p.direction.y,p.position.x,p.position.y,p.position.z,N,_,U):n.hitScanBold("hitbox",p.direction.x,p.direction.y,p.position.x,p.position.y,p.position.z,N,_,U):n.hitScan("hitbox",p.direction.x,p.direction.y,p.position.x,p.position.y,p.position.z,_,U),Q=!(t.hasComponent(ss)&&(t.getComponent(ss).exec&&!t.getComponent(ss).climb))&&(!(D?h.data.isChargeHitShoot:h.data.isNormalHitShoot)||(()=>{switch(D?h.data.chargeFindType:h.data.normalFindType){case Mo:return!(null===Z&&(-1===X||-1===K||-1===q||n instanceof Ti&&n.hasOutOfWorld(X,K,q)));case Eo:return!(null!==Z||-1===X||-1===K||-1===q||n instanceof Ti&&n.hasOutOfWorld(X,K,q));case Co:return null!==Z}return!1})());h.isShootable=Q,h.shootableTarget=Z,a.enable&&!h.isFire&&Q&&F&&(W&&(h.isChargeStart||h.isNoChargeFire)?!g:(O||l?g:f)&&(O||(-1===h.time||h.time>=h.data.fireSpeed)))?(h.isNoChargeFire=!1,h.time=l&&h.time>=h.data.fireSpeed?h.time-h.data.fireSpeed:0,h.fireTime=-1,h.fireStartTime=-1,h.data.isEndFire?(h.isFire=!0,-1===h.fireStartTime&&(h.fireStartTime=r.time)):C=!0,x?((null==c?void 0:c.hasComponent(os))||(null==d?void 0:d.hasComponent(os)))&&(c.getComponent(os).isFireAnimation=!1,d.getComponent(os).isFireAnimation=!1):(null==m?void 0:m.hasComponent(os))&&(m.getComponent(os).isFireAnimation=!1)):h.chargePar<=0&&f&&!F&&!h.isEmpty?(h.data.isEmptySound&&n.createSound("./asset/sound/weapon/out-of-ammo.mp3",null,"player-fire-".concat(Ve())).play(),h.isEmpty=!0,h.chargePar=0):g||f||!(O||l&&h.time>=h.data.fireSpeed)?!g&&W&&(h.chargeLateTime=0,h.chargePar=0,h.isChargeEnable=!1,h.isChargeMax=!1,h.isChargeStart=!1):(h.time=h.data.fireSpeed,h.isFire=!1),h.data.isEndFire&&h.isFire&&h.time>=h.data.fireSpeed&&(a.isCanShoot?C=!0:h.isFire=!1),h.data.isEndFire||!h.isFire||(!(h.time>h.data.waitTime)||h.data.shootType===wo.HOOK&&I||h.data.shootType!==wo.AUTO&&h.data.shootType!==wo.SEMIAUTO&&h.data.shootType!==wo.ZOOM&&h.data.shootType!==wo.COMBO&&h.data.shootType!==wo.BURST&&h.data.shootType!==wo.SPIN&&h.data.shootType!==wo.CHARGE&&h.data.shootType!==wo.COMBO&&g)&&a.isCanShoot||(h.isFire=!1);const $=h.data.damageMin+(h.data.damageMax-h.data.damageMin)*(D?1:0);if(E.push((()=>{const t=Math.max(0,y?0:a.isAction?D?h.data.actionBulletSpreadMax:h.data.actionBulletSpreadMin:o(D?h.data.standBulletSpreadMax:h.data.standBulletSpreadMin,D?h.data.actionBulletSpreadMax:h.data.actionBulletSpreadMin,w));h.spread=j(h.spread,t,.25*e)})),(C||g&&L)&&(!O||h.chargePar>=1)&&"air"!==r.state&&a.isCanShoot){let e=!1;const s=h.time-h.time%h.data.waitTime;if(h.data.shootType===wo.SLOW)-1===h.fireStartTime&&(h.fireStartTime=r.time),null!==h.data.ammoType&&h.fireTime!==s&&Qi(t,h.data.ammoType,Math.max(0,es(t,h.data.ammoType)-R)),h.fireTime=s,null!==h.data.ammoType&&es(t,h.data.ammoType)-R>=0&&(r.speed=Math.min(r.speed,$),p.light=Math.max(p.light,h.data.lightForce)),h.isFire=!0,h.isFirePress=!0;else if(h.data.shootType===wo.ZOOM){if(-1===h.fireStartTime&&(h.fireStartTime=r.time),null!==h.data.ammoType&&h.fireTime!==s&&Qi(t,h.data.ammoType,Math.max(0,es(t,h.data.ammoType)-R)),h.fireTime=s,null!==h.data.ammoType&&es(t,h.data.ammoType)-R>=0){const e=D?h.data.bulletSpeedMax:h.data.bulletSpeedMin;p.light=Math.max(p.light,h.data.lightForce),r.speed=Math.min(r.speed,e),y=!0}const e=.2125,n=Math.min(1,(r.time-h.fireStartTime)/e);if(n>.25){const e=Math.max(0,n-.25)/.75;p.zoom=1+Math.max(0,$-1)*e/p.fov,r.isZoomAnimation=!0,r.zoomAnimationPar=e}else p.zoom=1,r.isZoomAnimation=!1,r.zoomAnimationPar=0;h.isFire=!0,h.isFirePress=!0}else if(h.data.shootType===wo.SHIELD)-1===h.fireStartTime&&(h.fireStartTime=r.time),p.light=Math.max(p.light,h.data.lightForce),null!==h.data.ammoType&&h.fireTime!==s&&Qi(t,h.data.ammoType,Math.max(0,es(t,h.data.ammoType)-R)),h.fireTime=s,b=!0,h.isFire=!0,h.isFirePress=!0;else if(h.data.shootType===wo.COMBO){if(t.hasComponent(Uo)){-1===h.fireStartTime&&(h.fireStartTime=r.time);const e=t.getComponent(Uo),n=Math.min(e.max,es(t,"combo")+$);if(null!==h.data.ammoType&&Qi(t,h.data.ammoType,Math.max(0,es(t,h.data.ammoType)-R)),Qi(t,"combo",n),t.hasComponent(Gi)){const e=t.getComponent(Gi);e.comboTime=e.time}n>0&&es(t,"combo",0)>=e.start&&(Qi(t,"gage",1),p.light=Math.max(p.light,h.data.lightForce)),b=!0,h.isFire=!0,h.isFirePress=!0,r.powerupTime=r.time}}else if(!h.isFire){if(-1===h.fireStartTime&&(h.fireStartTime=r.time),e=!0,h.data.shootType!==wo.HOOK&&null!==h.data.ammoType&&Qi(t,h.data.ammoType,Math.max(0,es(t,h.data.ammoType)-R)),null!==h.data.fireSound&&(n.createSound(W&&D&&h.data.chargeFireSound||h.data.fireSound,null,"player-fire-".concat(Ve())).play(),h.data.isEmptySound&&n.createSound("./asset/sound/weapon/out-of-ammo.mp3",null,"player-fire-low-ammo".concat(Ve())).setVolume(null!==h.data.ammoType?2*(1-Math.min(1,es(t,h.data.ammoType)/(ns(t,h.data.ammoType)/4))):0).play()),h.data.shootType!==wo.HOOK||!I){if(h.isChargeAttack=D,E.push((()=>{const e=W&&D?h.data.chargeBulletType:h.data.normalBulletType;if(null===e)return;const i=new Array,s=D?h.data.bulletCountMax:h.data.bulletCountMin,o=D?h.data.bulletSpeedMax:h.data.bulletSpeedMin,a=D?h.data.bulletLengthMax:h.data.bulletLengthMin;if(h.data.spreadBullet)for(let n=0,r=0|s;n<r;n=n+1|0){const n=p.direction.x+Math.cos(Math.random()*Math.PI*2)*h.spread,r=p.direction.y+Math.cos(Math.random()*Math.PI*2)*h.spread;i.push(new e(p.position.x+Y,p.position.y+G,p.position.z+V,p.position.x,p.position.y,p.position.z,n,r,o,S,a,N,H,$,h.data.random,s,D?1:0,y,h.data.damageType,t,h,[t.getID()]))}else{const n=p.direction.x+Math.cos(Math.random()*Math.PI*2)*h.spread,r=p.direction.y+Math.cos(Math.random()*Math.PI*2)*h.spread;for(let l=0,c=0|s;l<c;l=l+1|0)i.push(new e(p.position.x+Y,p.position.y+G,p.position.z+V,p.position.x,p.position.y,p.position.z,n,r,o,S,a,N,H,$,h.data.random,s,D?1:0,y,h.data.damageType,t,h,[t.getID()]))}n.addEntitys(...i),h.data.shootType===wo.HOOK&&h.bullets.push(...i)})),e){if(x)u.forEach((e=>{let[,t,,,]=e;if(null===t)return;t.getComponent(Fa).swais.push(new ra(h.data.swaiTime,h.data.swaiPar,h.data.swaiForce,h.data.swaiReduce,0))}));else if(null!==m){m.getComponent(Fa).swais.push(new ra(h.data.swaiTime,h.data.swaiPar,h.data.swaiForce,h.data.swaiReduce,0))}if(p.hasComponent(ea)){const e=a.time,n=setInterval((()=>{if(t.hasLive()){if(a.time-e>.1){p.getComponent(ea).swais.push(new ra(h.data.bobTime,h.data.bobPar,h.data.bobForce*(1-w),h.data.bobReduce,h.data.bobFov)),clearInterval(n)}}else clearInterval(n)}));if(t.hasComponent(pl)){const e=t.getComponent(pl),n=(Math.random()-.5)/.5*.5,s=(a.isAction?h.data.actionRecoilForce:h.data.standRecoilForce)*(1-w),[o,l]=J(n*s,(.75+.25*(1-Math.abs(n)))*s,i.z);e.value.x+=o,e.value.y+=l,e.force=1-Math.min(1,Math.max(o,l)/.375),e.startTime=r.time}}}p.light=Math.max(p.light,h.data.lightForce),h.isFire=!0,h.isFirePress=!0}W&&(h.chargeLateTime=0,h.chargePar=0)}h.data.isEndFire&&(h.isFire=!1)}else L&&(h.fireStartTime=-1);(h.isEmpty||!F&&h.data.shootType!==wo.SPIN&&0===h.chargePar||"grab"===r.state&&!g||-1!==r.respawnTime||null!==r.activeEntity)&&(h.chargeLateTime=0,h.chargePar=0)}}else h.time=-1,h.fireTime=-1,h.fireStartTime=-1,h.isFire=!1,h.isFirePress=!1,h.isEmpty=!1,h.isFireWait=!1,h.isNoChargeFire=!1,h.isChargeEnable=!1,h.isChargeMax=!1,h.isChargeStart=!1,h.chargeLateTime=0,h.chargePar=0,h.isHoldFire=!1})),E.forEach((e=>e())),p.light=j(p.light,0,.25*e),a.time+=s(e/60,0)}offset(e,t,n){const{position:i,direction:s}=t,o=t.getComponent(Fo),a=o.leftWeapon.data.shootType===wo.SHIELD&&o.leftWeapon.isFire||o.rightWeapon.data.shootType===wo.SHIELD&&o.rightWeapon.isFire,r=new Array;if(o.leftWeapon.data.shootType===wo.SHIELD&&(r.includes(o.leftWeapon.data.ammoType)||r.push(o.leftWeapon.data.ammoType)),o.rightWeapon.data.shootType===wo.SHIELD&&(r.includes(o.rightWeapon.data.ammoType)||r.push(o.rightWeapon.data.ammoType)),a&&t.hasComponent(Ws)){const e=t.getComponent(Ws);e.value.forEach((n=>{const[o,a]=N(n.position.x,n.position.y,n.position.z,i.x,i.y,i.z),[l,h]=U(s.x,s.y,o,a);if(l>Math.PI/2&&h>Math.PI/2)return;let p=!1;r.forEach((e=>{const i=es(t,e);n.value<i?(Qi(t,e,i-n.value),p=!0):(Qi(t,e,Math.max(0,i-n.value)),n.value-=i)})),p&&e.removes.push(n)}))}}}class Kl extends Bi{constructor(){super(Ms)}offset(e,t,n){const i=t.getComponent(Ms);i.time>i.speed&&t.remove(),i.time+=s(e/60,0)}}class Jl extends Bi{constructor(){super(Ir,Cn)}offset(e,t,n){const i=t.getComponent(Ir),o=t.getComponent(Cn);-1===i.startScale&&(i.startScale=o.scale),i.time>i.speed&&(i.loop?i.time%=i.speed:i.time=i.speed);const a=s(i.time/i.speed,0);o.scale=i.startScale+(i.scale-i.startScale)*a,i.time+=s(e/60,0)}}class ql extends Bi{constructor(){super(Wl,Cn,Bs),this.spawn_limit=10}preadditional(e,t){const n=t.getEntitys((e=>e.hasComponent(Wl)));ue(n).desc((e=>e.getComponent(Wl).spawnTime));for(let e=this.spawn_limit;e<n.length;e++){const t=n[e];t.hasComponent(Ms)||t.setComponents(new Ms(2),new Ir(2,0))}}offset(e,t,n){const i=t.getComponent(Wl),s=t.getComponent(Cn),o=t.getComponent(Bs);i.init||(i.rotSpeed=o.speed,i.rot=s.rotate,i.init=!0),0===(t.hasComponent(ds)?t.getComponent(ds).value.y:0)&&(t.hasComponent(cs)?t.getComponent(cs).hit.y:-1)<0?(o.speed=0,s.rotate=0):0!==(t.hasComponent(ds)?t.getComponent(ds).value.y:0)&&0===(t.hasComponent(cs)?t.getComponent(cs).hit.y:0)&&(o.speed=i.rotSpeed,s.rotate=i.rot)}}class Zl extends Bi{constructor(){super(Bs,Cn)}offset(e,t,n){const i=t.getComponent(Bs),o=t.getComponent(Cn);if(0===i.speed)return;i.time>=i.speed&&(i.loop?i.time%=i.speed:i.time=i.speed);let a=i.time/i.speed;i.reverse&&(a=1-a),o.rotate=a*Math.PI*2,i.time+=s(e/60,0)}}class Ql extends Bi{constructor(){super(Pr,Ws,Ei,Sn)}physical(e,t,n){const{position:i}=t,s=t.getComponent(Pr),o=t.getComponent(Ei).value;if(null===o||!o.hasComponent(Ws))return;const a=n.getCamera(),[r,l]=O(a.direction.x,0,.1);i.x=o.position.x+s.offset.x-r,i.y=o.position.y+s.offset.y,i.z=o.position.z+s.offset.z-l}offset(e,t,n){const i=performance.now(),{position:s}=t,o=t.getComponent(Pr),a=t.getComponent(Ws),r=t.getComponent(Ei).value;if(null===r||!r.hasComponent(Ws))return;if(!r.hasLive())return t.remove();const l=n.getCamera(),[h,p]=O(l.direction.x,0,.1);s.x=r.position.x+o.offset.x-h,s.y=r.position.y+o.offset.y,s.z=r.position.z+o.offset.z-p;let c=!1,d=!1;const u=r.getComponent(Ws);for(let e=0,t=0|a.value.length;e<t;e=e+1|0){const t=a.value[e],n=t.type,i=t.value*a.multiples[n];u.value.push(new cr(i,n,t.attacker,t.direction.x,t.direction.y,t.position.x,t.position.y,t.position.z,t.force.x,t.force.y,t.force.z)),c=i*a.multiples[n]>=1/0,d=!0}if(t.hasComponent(is)||me(a.value),d&&c){if(n instanceof Gh&&n.hasHorde()){const e=n.getPlayer();if(null!==e){const t=2.5;if(e.hasComponent(Gi)){const n=e.getComponent(Gi);n.startAddTime=i,n.addTimeValue=t,n.bonusType=0}Qi(e,"hordetime",es(e,"hordetime",0)+t)}}n.addEntitys(new Ls(t.position.x,t.position.y,t.position.z)),n.createSound("./asset/sound/effect/head-shot.mp3",null,"shoot-target-hit-".concat(r.getID())).setVolume(2.5).play()}}}class $l extends Bi{constructor(){super(Ol,ds)}offset(e,t,n){const{position:i}=t,s=t.getComponent(Ol);if(!(n instanceof Gh&&t.hasComponent(Ol)&&t.hasComponent(ds)))return;(t.hasComponent(cs)?t.getComponent(cs).hit.y:-1)<0&&(s.landing=!0);const o=n instanceof Gh?n.getPlayer():null;let a=!0;if(t.hasComponent(Kr)){const e=t.getComponent(Kr);if(a=e.isOverPick,!a&&null!==o)for(const t in e.items){const n=e.items[t];if("number"==typeof n&&ns(o,t)>es(o,t,0)||"string"==typeof n&&null===$i(o,t,"")){a=!0;break}}}if(null===o||!o.hasComponent(Gi)||-1===o.getComponent(Gi).respawnTime&&-1===o.getComponent(Gi).deathTime&&-1===o.getComponent(Gi).goleTime||(a=!1),i.y<=0&&(a?s.feel=!0:t.remove()),a){if(null!==o&&o instanceof Mn){const e=ha(o),n=P(o.position.x,o.position.y,o.position.z,i.x,i.y,i.z);if(s.landing&&n<s.min+(s.max-s.min)*e||s.feel){const e=t.getComponent(ds),n=o.hasComponent(cs)?o.getComponent(cs).size:new E(0,0),[a,r]=N(o.position.x,o.position.y+n.y/2,o.position.z,i.x,i.y,i.z),l=P(o.position.x,o.position.y+n.y/2,o.position.z,i.x,i.y,i.z),[h,p,c]=A(a,r,0,0,Math.min(l,.25));e.value.x=h,e.value.y=p,e.value.z=c,s.feel=!0,t.removeComponent(cs)}}}else s.feel=!1}}class eh extends Bi{constructor(){super(Al,Bs)}offset(e,t,n){const i=t.getComponent(Al);i.init||(i.rotSpeed=t.hasComponent(Bs)?t.getComponent(Bs).speed:0,i.init=!0),0===(t.hasComponent(ds)?t.getComponent(ds).value.y:0)&&(t.hasComponent(cs)?t.getComponent(cs).hit.y:-1)<0&&(i.landing=!0);const s=t.getComponent(Bs);i.landing?s.speed=0:s.speed=i.rotSpeed}}class th extends Bi{constructor(){super(Jr)}offset(e,t,n){const i=performance.now(),{position:s}=t,o=t.getComponent(Jr);n.getEntitysOfRange("collision",s.x,s.y,s.z,1,1).forEach((e=>{if(!e.getNames().includes("player")||!e.hasComponent(Gi))return;const t=e.getComponent(Gi);-1===t.deathTime&&-1===t.goleTime&&-1===t.intermissionTime&&(t.goleTime=i,t.gole=t.time,t.secret=o.secret,n instanceof Gh&&n.addGoleTime(1e3*t.gole))}))}}class nh extends Bi{constructor(){super(Gi,pl)}additional(e,t,n){const i=t.getComponent(pl),o=t.getComponent(Gi);let a=0,r=0,l=0,h=0;l=i.position.x,h=i.position.y;const p=e+Math.max(0,1-e)*i.force;if(i.position.x=j(i.position.x,i.value.x,p),i.position.y=j(i.position.y,i.value.y,p),i.time-i.startTime>.175&&(i.value.x=j(i.value.x,0,.05*e),i.value.y=j(i.value.y,0,.05*e)),i.value.x<0){const e=Math.max(0,-o.cmda.x),t=i.value.x+e;a=Math.min(0,i.value.x-t),i.value.x=Math.min(0,t)}else if(i.value.x>0){const e=Math.min(0,-o.cmda.x),t=i.value.x+e;a=Math.max(0,i.value.x-t),i.value.x=Math.max(0,t)}if(i.value.y>0){const e=i.value.y,t=e+Math.min(0,-o.cmda.y);r=Math.max(0,e-t),i.value.y=Math.max(0,t)}o.cmda.x+=i.old.x-l-a;let c=i.old.y-h-r;if(t.direction.y+Math.min(0,c)<=-Math.PI/2&&(i.subY+=Math.min(0,c)),i.subY<0){const e=i.subY+Math.max(0,c),t=i.subY+c;i.subY=Math.min(0,e),c=i.subY<0?0:t}o.cmda.y+=c,i.old.x=l,i.old.y=h,i.time+=s(e/60,0)}}class ih extends Bi{constructor(){super(Es,Cn)}movable(e,t,n){const i=t.getComponent(Es),o=t.getComponent(Cn);if(0===i.frames.length)return;i.name!==i.oldName&&(i.time=0),i.time+=s(e/60,0),i.time>=i.speed&&(i.loop?i.time%=i.speed:i.time=i.speed);const a=s(i.time/i.speed,0),r=Math.min(i.frames.length-1,Math.floor(i.frames.length*a));o.material=i.frames[r],i.frame=r,i.oldName=i.name}}class sh extends Bi{constructor(){super(ys)}offset(e,t,n){const i=t.getComponent(ys);i.init?t.hasComponent(Ss)&&(t.getComponent(Ss).enable=!1):(t.hasComponent(Ss)&&(t.getComponent(Ss).enable=!0),i.init=!0)}}class oh extends Bi{constructor(){super(Qr,ps,Ei)}offset(e,t,n){const i=t.getComponent(Qr),s=t.getComponent(ps),o=t.getComponent(Ei).value;if(null!==o){const a=n.getCamera(),r=o.hasComponent(Gi)&&a.hasComponent(wi)?a.getComponent(wi).position.y:(o.hasComponent(Sn)?o.getComponent(Sn).size.y:0)/2,[l,h]=N(o.position.x,o.position.y+r,o.position.z,t.position.x,t.position.y,t.position.z),[p,c]=F(l,h,t.direction.x,t.direction.y),d=e*(1e3/60)/35;i.tic+=d;let u=i.tic-i.tic%1;u>3&&(i.tic-=0|i.tic,u=0),(i.forceHoming||u>1&&i.oldTic!==u)&&(s.originDirection.x+=Math.min(i.limit,Math.max(-i.limit,p*i.force)),s.originDirection.y+=Math.min(i.limit,Math.max(-i.limit,c*i.force))),i.oldTic=u,s.originPosition.x=t.position.x,s.originPosition.y=t.position.y,s.originPosition.z=t.position.z}}}class ah extends Bi{constructor(){super(wa,hs,ps)}hasChain(e){const{position:t}=e,n=e.getComponent(ps);if(n.attacker){const[e,i]=N(t.x,t.y,t.z,n.attacker.position.x,n.attacker.position.y,n.attacker.position.z),[s,o]=U(e,i,n.attacker.direction.x,n.attacker.direction.y);return s>Math.PI/1.5&&o>Math.PI/1.5}return!1}additional(e,t,n){const{position:i}=t,a=t.getComponent(wa),r=t.getComponent(hs),l=t.getComponent(ps),h=null!==l.target&&l.target.hasComponent(Pr)&&l.target.hasComponent(Ei)&&l.target.getComponent(Ei).value||l.target;if(l.hit&&null!==l.attacker&&null!==h&&h.hasComponent(Ws)){h.getComponent(Ws).value.push(new cr(0,"hook",l.attacker,0,0,0,0,0,0,0,0))}r.isRemove=!1;let p=!1;if(l.over)t.remove(),n.hasSound("hook-bullet-".concat(t.getID()))&&n.getSound("hook-bullet-".concat(t.getID())).stop();else if(l.hit&&null!==l.attacker){const c=n.getCamera(),d=(l.attacker.hasComponent(cs)?Math.max(l.attacker.getComponent(cs).size.x,l.attacker.getComponent(cs).size.y):1)+.1,{position:u,direction:m}=n.getCamera(),[g,f]=N(u.x,u.y,u.z,i.x,i.y,i.z),y=P(u.x,u.y,u.z,i.x,i.y,i.z),w=P(u.x,u.y,u.z,l.hitPosition.x,l.hitPosition.y,l.hitPosition.z),x=w/(t instanceof gs&&null!==t.weapon?o(t.weapon.data.bulletLengthMin,t.weapon.data.bulletLengthMax,t.weapon.chargePar):w),M=n.getEntitysOfRange("collision",i.x,i.y,i.z,d,d).some((e=>e.getNames().some((e=>"player"===e)))),E=null!==h?a.time>=a.pullTime||M&&l.attacker.hasComponent(_n)&&l.attacker.getComponent(_n).targets.includes(h):M&&l.attacker.hasComponent(cs)&&(0!==l.attacker.getComponent(cs).hit.x||0!==l.attacker.getComponent(cs).hit.y||0!==l.attacker.getComponent(cs).hit.z);if(-1===a.oldDist&&(a.oldDist=y),a.init||(a.ropeLength=y,a.init=!0),E||l.attacker.hasComponent(ss)&&l.attacker.getComponent(ss).exec||l.attacker.hasComponent($o)&&l.attacker.getComponent($o).exec||l.attacker.hasComponent(Qo)&&l.attacker.getComponent(Qo).enable||null!==l.attacker&&(0===es(l.attacker,"stamina",1/0)||l.attacker.hasComponent(Fo)&&null!==l.attacker&&"hookshot"!==$i(l.attacker,r.invert?l.attacker.getComponent(Fo).left:l.attacker.getComponent(Fo).right,null))||null!==h&&(!h.hasLive()||h.hasComponent(Ws)&&h.getComponent(Ws).value.some((e=>"hook"!==e.type)))){if(t.remove(),null==h?void 0:h.hasComponent(ds)){const e=h.getComponent(ds);e.value.x=0,e.value.y=0,e.value.z=0}if(!(E&&null===h&&Math.abs(f)<Math.PI/4&&l.attacker.hasComponent(ss))||l.attacker.hasComponent(Qo)&&l.attacker.getComponent(Qo).exec){if(y<=d&&null!==h&&l.attacker.hasComponent(ds)){const e=l.attacker.getComponent(ds);e.value.x=0,e.value.y=Math.max(0,e.value.y),e.value.z=0}}else{const e=Math.ceil(i.y)-(c.hasComponent(wi)?c.getComponent(wi).position.y:0);bi(n.getVoxel(l.attacker.position.x,l.attacker.position.y,l.attacker.position.z),li)&&!n.hasBlockScaleVoxel(l.attacker.position.x,e,l.attacker.position.z,t.hasComponent(cs)?t.getComponent(cs).size.x:.001,t.hasComponent(cs)?t.getComponent(cs).size.y:.001)&&(l.attacker.position.y=e)}n.hasSound("hook-bullet-".concat(t.getID()))&&n.getSound("hook-bullet-".concat(t.getID())).stop()}else{p=!0;let o=!1;if(l.attacker.hasComponent(Gi)){const e=l.attacker.getComponent(Gi);(r.invert?e.keys["fire-left"]:e.keys["fire-right"])>0&&(o=!0)}let c=0;const d=Math.min(1,Math.max(0,a.time/(a.pullTime*x)));if(null!==h&&(a.isPull||o&&(null==h?void 0:h.hasComponent(ds)))){const t=Math.abs(Math.cos(d*(Math.PI/2)+Math.PI/2)),[n,s]=N(u.x,u.y,u.z,l.hitPosition.x,l.hitPosition.y,l.hitPosition.z),[o,r,p]=A(n,s,0,0,w*t),m=l.hitPosition.x+o,g=l.hitPosition.y+r,f=l.hitPosition.z+p,[y,x]=N(m,g,f,i.x,i.y,i.z),M=P(m,g,f,i.x,i.y,i.z),[E,C,v]=A(y,x,0,0,M*e*(h.hasComponent(Hs)?h.getComponent(Hs).value:1)),b=h.getComponent(ds);E>0?b.value.x=b.value.x<Math.abs(E)?Math.min(Math.abs(E),b.value.x+E):b.value.x:E<0&&(b.value.x=b.value.x>-Math.abs(E)?Math.max(-Math.abs(E),b.value.x+E):b.value.x),C>0?b.value.y=b.value.y<Math.abs(C)?Math.min(Math.abs(C),b.value.y+C):b.value.y:C<0&&(b.value.y=b.value.y>-Math.abs(C)?Math.max(-Math.abs(C),b.value.y+C):b.value.y),v>0?b.value.z=b.value.z<Math.abs(v)?Math.min(Math.abs(v),b.value.z+v):b.value.z:v<0&&(b.value.z=b.value.z>-Math.abs(v)?Math.max(-Math.abs(v),b.value.z+v):b.value.z),c=M,a.isPull=!0}else if(l.attacker.hasComponent(ds)){const e=Math.max(0,a.minShrinkForce+(a.maxShrinkForce-a.minShrinkForce)*d),t=-1===a.old.x?i.x:a.old.x,n=-1===a.old.y?i.y:a.old.y,s=-1===a.old.z?i.z:a.old.z,[o,r,h]=A(g,f,0,0,a.length);let[p,w,x]=b(i.x+o,i.y+r,i.z+h,u.x-(t-(i.x+o))*(a.length>a.ropeLength?1:a.bending),u.y-(n-(i.y+r))*(a.length>a.ropeLength?1:a.bending),u.z-(s-(i.z+h))*(a.length>a.ropeLength?1:a.bending));a.old.x=i.x,a.old.y=i.y,a.old.z=i.z,p*=a.spring.x,w*=a.spring.y,x*=a.spring.z;const M=l.attacker.getComponent(ds),E=p-(M.value.x-p)*a.ropeForce.x,C=w-(M.value.y-w)*a.ropeForce.y,v=x-(M.value.z-x)*a.ropeForce.z,_=Math.max(-Math.abs(u.x-i.x),Math.min(Math.abs(u.x-i.x),E)),S=Math.max(-Math.abs(u.y-i.y),Math.min(Math.abs(u.y-i.y),C)),k=Math.max(-Math.abs(u.z-i.z),Math.min(Math.abs(u.z-i.z),v)),[T,P]=U(m.x,m.y,g,f),I=Math.min(1,Math.max(T/(Math.PI/2),P/(Math.PI/2)));a.minDistance<y?(M.value.x+=_*e,M.value.y+=S*e,M.value.z+=k*e,c=Math.max(a.minDistance,y-e*(1-I))):c=a.minDistance,a.lookPar=I,a.isPull=!1}const M=a.oldDist-y;M<=0?n.hasSound("hook-bullet-".concat(t.getID()))&&n.getSound("hook-bullet-".concat(t.getID())).stop():n.hasSound("hook-bullet-".concat(t.getID()))||n.createSound("./asset/sound/weapon/hook-bullet.mp3",null,"hook-bullet-".concat(t.getID())).play(!0);const E=Math.max(0,M+a.sub),C=4*E|0;Qi(l.attacker,"stamina",Math.max(0,es(l.attacker,"stamina",1/0)-C)),a.sub=E%.25,a.oldDist=y,a.length=c,a.time+=s(e/60,0)}a.oldDist=y}r.isReduceAmmo=p}offset(e,t,n){var i;const{position:s}=t,o=t.getComponent(wa),a=t.getComponent(hs),r=t.getComponent(ps),l=(null===(i=r.target)||void 0===i?void 0:i.hasComponent(Pr))&&r.target.hasComponent(Ei)&&r.target.getComponent(Ei).value||r.target;a.isRemove=!1;r.over?(t.remove(),n.hasSound("hook-bullet-".concat(t.getID()))&&n.getSound("hook-bullet-".concat(t.getID())).stop()):r.hit&&null!==r.attacker&&null!==l&&(o.init||(o.fixPosition.x=r.hitPosition.x-l.position.x,o.fixPosition.y=r.hitPosition.y-l.position.y,o.fixPosition.z=r.hitPosition.z-l.position.z),s.x=l.position.x+o.fixPosition.x,s.y=l.position.y+o.fixPosition.y,s.z=l.position.z+o.fixPosition.z),a.isReduceAmmo=!1}}const rh=[[0,0,0],[1,0,0],[-1,0,0],[0,1,0],[0,-1,0],[0,0,1],[0,0,-1]];function lh(e,t,n,i,s){rh.forEach((o=>{let[a,r,l]=o;const h=e+a,p=t+r,c=n+l,d=i.getVoxel(h,p,c);d!==li&&s(d)&&(i.setVoxel(h,p,c,li,!1),i.setDistanceField(h,p,c,1),lh(h,p,c,i,s))}))}class hh extends Bi{constructor(){super(Gi,la,is)}offset(e,t,n){const{direction:i,position:s}=n.getCamera(),o=t.getComponent(la),a=t.getComponent(Gi),r=t.getComponent(is),[l,h,p,,c]=n.hitScan("collision",i.x,i.y,s.x,s.y,s.z,(t.hasComponent(cs)?t.getComponent(cs).size.x:0)/2+(t.hasComponent(oa)?t.getComponent(oa).length:1),[t.getID()]),d=a.keys.use>0&&a.keys.use!==a.presss.use,u=-1!==l&&-1!==h&&-1!==p&&null===c,m=-1!==l&&-1!==h&&-1!==p&&null!==c;o.exec=!1;let g=-1,f=-1,y=-1,w=null,x=-1;if(u){const[e,s,o]=A(i.x,i.y,0,0,1/256);g=Math.floor(l+e),f=Math.floor(h+s),y=Math.floor(p+o),w=n.getVoxel(g,f,y),mi(w)?x=0:gi(w)&&r.value.hasOwnProperty("key-red")&&es(t,"key-red")>0?x=1:fi(w)&&r.value.hasOwnProperty("key-blue")&&es(t,"key-blue")>0?x=2:yi(w)&&r.value.hasOwnProperty("key-yellow")&&es(t,"key-yellow")>0&&(x=3)}const M=-1!==x,E=m&&null!==c&&c.hasComponent(rl);if(o.hasDoorMessage=M,a.isWaitActive=M||E,d)if(null!==c&&E)a.activeEntity=c,a.activeEntity.getComponent(rl).enable=!0;else if(u&&null!==w){let e=!1;switch(x){case 0:lh(g,f,y,n,mi),e=!0;break;case 1:lh(g,f,y,n,gi),e=!0;break;case 2:lh(g,f,y,n,fi),e=!0;break;case 3:lh(g,f,y,n,yi),e=!0}e?(n.createSound("./asset/sound/player/open.mp3",null,"player-door-open").play(),o.exec=!0):n.createSound("./asset/sound/player/lock.mp3",null,"player-door-lock").play()}}}class ph extends Bi{constructor(){super(aa,Gi,cs,wi)}movable(e,t,n){const{position:i,direction:o}=t,a=t.getComponent(aa),r=t.getComponent(Gi),l=t.getComponent(cs),h=t.getComponent(wi);let p=0;if(r.isAir||r.isHookAccel||t.hasComponent(Qo)&&t.getComponent(Qo).exec||t.hasComponent($o)&&t.getComponent($o).exec||t.hasComponent(ss)&&t.getComponent(ss).exec?a.exec=!1:r.keys.lean?(p=-r.axes.x.x,a.exec=!0):r.keys["lean-right"]?(p=1,a.exec=!0):r.keys["lean-left"]?(p=-1,a.exec=!0):a.exec=!1,a.exec&&0!==p&&(-1===a.oldPosition.x&&-1===a.oldPosition.y&&-1===a.oldPosition.z?(t.position.x+=h.position.x,t.position.z+=h.position.z,h.position.x=0,h.position.z=0,a.oldPosition.x=t.position.x,a.oldPosition.y=t.position.y,a.oldPosition.z=t.position.z,a.diffPosition.x=t.position.x-a.oldPosition.x,a.diffPosition.y=t.position.y-a.oldPosition.y,a.diffPosition.z=t.position.z-a.oldPosition.z):(a.oldPosition.x=t.position.x-a.diffPosition.x,a.oldPosition.y=t.position.y-a.diffPosition.y,a.oldPosition.z=t.position.z-a.diffPosition.z)),a.exec?a.startDir=-1===a.startDir?o.x:a.startDir:a.startDir=-1,a.isGround=-1!==a.oldPosition.x&&-1!==a.oldPosition.y&&-1!==a.oldPosition.z?n.hasBlockScaleVoxel(a.oldPosition.x,a.oldPosition.y-.001,a.oldPosition.z,t.hasComponent(cs)?t.getComponent(cs).size.x:.001,.001):n.hasBlockScaleVoxel(i.x+a.moveValue.x,i.y+a.moveValue.y-.001,i.z+a.moveValue.z,t.hasComponent(cs)?t.getComponent(cs).size.x:.001,.001),a.isHitStand=-1!==a.oldPosition.x&&-1!==a.oldPosition.y&&-1!==a.oldPosition.z?n.hasBlockScaleVoxel(a.oldPosition.x,a.oldPosition.y+(t.hasComponent(ta)?t.getComponent(ta).standSizeY:0),a.oldPosition.z,t.hasComponent(cs)?t.getComponent(cs).size.x:.001,.001):n.hasBlockScaleVoxel(i.x+a.moveValue.x,i.y+a.moveValue.y+(t.hasComponent(ta)?t.getComponent(ta).standSizeY:0),i.z+a.moveValue.z,t.hasComponent(cs)?t.getComponent(cs).size.x:.001,.001),a.isHitCluch=-1!==a.oldPosition.x&&-1!==a.oldPosition.y&&-1!==a.oldPosition.z?n.hasBlockScaleVoxel(a.oldPosition.x,a.oldPosition.y+(t.hasComponent(ta)?t.getComponent(ta).cluchSizeY:0),a.oldPosition.z,t.hasComponent(cs)?t.getComponent(cs).size.x:.001,.001):n.hasBlockScaleVoxel(i.x+a.moveValue.x,i.y+a.moveValue.y+(t.hasComponent(ta)?t.getComponent(ta).cluchSizeY:0),i.z+a.moveValue.z,t.hasComponent(cs)?t.getComponent(cs).size.x:.001,.001),a.isGround?0!==a.value.x&&(a.exec=!0):(a.exec=!1,p=0),0===p){-1!==a.oldPosition.x&&-1!==a.oldPosition.y&&-1!==a.oldPosition.z&&(a.moveValue.x=a.oldPosition.x-t.position.x,a.moveValue.z=a.oldPosition.z-t.position.z,a.movePar=Math.abs(a.moveValue.x)+Math.abs(a.moveValue.z),a.oldPosition.x=-1,a.oldPosition.y=-1,a.oldPosition.z=-1);const n=t.position.x,i=t.position.z;t.position.x=j(t.position.x,t.position.x+a.moveValue.x,.25*e),t.position.z=j(t.position.z,t.position.z+a.moveValue.z,.25*e),a.moveValue.x-=t.position.x-n,a.moveValue.z-=t.position.z-i,h.position.x=s(a.moveValue.x,0,100),h.position.z=s(a.moveValue.z,0,100);const o=s(0===a.movePar?0:(Math.abs(h.position.x)+Math.abs(h.position.z))/a.movePar,0);a.value.x=o<.01?0:o}else{const i=t.direction.x+Math.PI/2*Math.sign(p),o=5;let r=1/0,c=r;for(let e=0,s=o-1|0;e<s;e=e+1|0){const[,,,s]=n.hitScanVoxel(i,0,a.oldPosition.x,a.oldPosition.y+l.size.y/o*(e+1),a.oldPosition.z,l.size.x);-1!==s&&(r=Math.min(r,s),c=Math.max(0,r-(t.hasComponent(cs)?t.getComponent(cs).size.x:0)/2))}const[,,,d,u]=n.hitScanBold("collision",i,0,a.oldPosition.x,a.oldPosition.y+l.size.y/2,a.oldPosition.z,l.size.x,l.size.x/2+Math.abs(p),t.getNames());-1!==d&&null!==u&&(r=d,c=Math.max(0,r-(t.hasComponent(_n)?t.getComponent(_n).size.x:0)/2));const m=Math.min(c,Math.abs(p));a.value.x=m/1*Math.sign(p),t.position.x=j(t.position.x,a.oldPosition.x+Math.cos(i)*m,.25*e),t.position.z=j(t.position.z,a.oldPosition.z+Math.sin(i)*m,.25*e),h.position.x=s(a.oldPosition.x-t.position.x,0,100),h.position.z=s(a.oldPosition.z-t.position.z,0,100),a.diffPosition.x=t.position.x-a.oldPosition.x,a.diffPosition.y=t.position.y-a.oldPosition.y,a.diffPosition.z=t.position.z-a.oldPosition.z}}}class ch{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.daytimeSpeed=e,this.nightSpeed=t}}class dh extends wn{constructor(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];super(Li,...t)}}class uh extends dh{constructor(){super(ch)}additional(e,t,n){var i;const s=n.getCamera();let o=null;s.hasComponent(Ei)&&(o=s.getComponent(Ei).value);const a=t.getComponent(ch);if(!(o&&o.hasComponent(Gi)&&(-1!==o.getComponent(Gi).goleTime||-1!==o.getComponent(Gi).deathTime||o.getComponent(Gi).activeEntity&&(null===(i=o.getComponent(Gi).activeEntity)||void 0===i?void 0:i.hasComponent(qr))))){const n=z(t.direction.y+Math.PI/2*3);t.direction.y=z(t.direction.y+(n<Math.PI/2*3+Math.PI/2*.1&&n>Math.PI/2-Math.PI/2*.1?a.daytimeSpeed:a.nightSpeed)*e)}}}class mh extends Bi{constructor(e){super(Kr),this.setting=e}offset(e,t,n){if(!(n instanceof Gh))return;const i=n.getPlayer();if(!(i&&i instanceof Mn&&i.hasComponent(Gi)&&i.hasComponent(is)))return;const s=i.getComponent(Gi);if(-1!==s.goleTime||-1!==s.deathTime||-1!==s.intermissionTime)return;const o=t.getComponent(Kr);if(o.time>=o.noPickupTime){const{position:e}=t,[a,r]=N(i.position.x,i.position.y+1*(i.hasComponent(cs)?i.getComponent(cs).size.y:0),i.position.z,e.x,e.y+.25,e.z),[l,h]=N(i.position.x,i.position.y+.5*(i.hasComponent(cs)?i.getComponent(cs).size.y:0),i.position.z,e.x,e.y+.25,e.z),[p,c]=N(i.position.x,i.position.y+0*(i.hasComponent(cs)?i.getComponent(cs).size.y:0),i.position.z,e.x,e.y+.25,e.z),d=P(i.position.x,i.position.y+1*(i.hasComponent(cs)?i.getComponent(cs).size.y:0),i.position.z,e.x,e.y+.25,e.z),u=P(i.position.x,i.position.y+.5*(i.hasComponent(cs)?i.getComponent(cs).size.y:0),i.position.z,e.x,e.y+.25,e.z),m=P(i.position.x,i.position.y+0*(i.hasComponent(cs)?i.getComponent(cs).size.y:0),i.position.z,e.x,e.y+.25,e.z);if((d<(i.hasComponent(cs)?i.getComponent(cs).size.x:0)/2+1.25||u<(i.hasComponent(cs)?i.getComponent(cs).size.x:0)/2+1.25||m<(i.hasComponent(cs)?i.getComponent(cs).size.x:0)/2+1.25)&&(t.hasComponent(Ol)||!n.hasHitScanVoxel(a,r,e.x,e.y+.25,e.z,d)||!n.hasHitScanVoxel(l,h,e.x,e.y+.25,e.z,u)||!n.hasHitScanVoxel(p,c,e.x,e.y+.25,e.z,m))){let e=!1,a=!1;for(const t in o.items){if(0===es(i,"combo")&&"gage"===t)continue;const r=o.items[t];if("number"==typeof r){const e=es(i,t);if(e>=ns(i,t))continue;const n=e+r;if(o.isPartPick)if(ns(i,t)>=n)Qi(i,t,n),delete o.items[t];else{const e=n-ns(i,t);Qi(i,t,ns(i,t)),o.items[t]=e}else ns(i,t)>e&&(Qi(i,t,n),delete o.items[t]);switch(o.isOverPick&&delete o.items[t],a=!0,t){case"health":if(r<10)break}}else if("string"==typeof r){const l=$i(i,t,null),h=("punch"===$i(i,"hand",null)||"none"===$i(i,"hand",null))&&null===$i(i,"sidearm",null)&&null===$i(i,"machingun",null)&&null===$i(i,"shotgun",null)&&null===$i(i,"launcher",null)&&null===$i(i,"plasmagun",null),p=!s.isWaitActive&&null===s.activeEntity&&s.keys.use>0&&s.keys.use!==s.presss.use&&l!==r;if(!s.isPick&&p||null===l||o.override||h){if(i.hasComponent(Fo)){const e=i.getComponent(Fo);if(o.override||null===l||"string"!=typeof l){if(h){const i=n.getControlManager().getInputType();"gamepad"===i||"touchpad"===i?e.right=t:e.left=t}}else{$i(i,e.right,null)===l&&(e.right=t),$i(i,e.left,null)===l&&(e.left=t);const s={};s[t]=l;const o=new Mn("item weapon ".concat(l),new Kr(!1,!0,.5,s,"player-pickup-weapon",$n),new Cn(Ho[l].itemMaterial,2),new vn(!0,!1,!0,.5),new ds(.025,0,.025,0),new cs(.75,.375),new _n(.75,.375,["player","enemy"]),new Hs(1)),a=n.getCamera();o.position.x=a.position.x,o.position.y=a.position.y,o.position.z=a.position.z;const r=o.getComponent(ds),[h,p,c]=A(a.direction.x,a.direction.y,0,0,.1);r.value.x=h,r.value.y=p,r.value.z=c,n.addEntitys(o)}}Zi(i,t,r),delete o.items[t],a=!0,s.isPick=!0,e=!0}else l===r||s.isPick||(s.pickMessage="press ".concat("gamepad"===n.getControlManager().getInputType()?"X":"f"," to change ").concat(r),s.isPick=!0)}e=e||o.override||0===Object.keys(o.items).length}const r=o.pickUpSounds!==ti||this.setting.hasEatSound()?o.pickUpSounds:ni;if(a){const e=r[r.length*Math.random()|0];n.createSound(e,null,o.soundNameSpace).play(),s.pickupTime=s.time}(o.isPartPick&&o.isOverPick||e)&&t.remove()}}o.time+=e/60}}class gh extends Bi{constructor(){super(Cs)}offset(e,t,n){const i=t.getComponent(Cs);i.init||n.hasSound(i.namespace)||(n.createSound(i.sounds[i.sounds.length*Math.random()|0],t,i.namespace).setVolume(i.volume).play(i.loop),i.init=!0),i.unliveStop&&!t.hasLive()&&n.hasSound(i.namespace)&&n.getSound(i.namespace).stop()}}const fh="0.18.1";class yh extends Li{constructor(e){super(e,new ch(arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0))}}function wh(e){let t="".concat(e);for(;t.length<4;)t="0".concat(t);return"".concat(t.substring(0,t.length-3),".").concat(t.substring(t.length-3,t.length))}function xh(e){let t="".concat(e);for(;t.length<2;)t="0".concat(t);return t}function Mh(e){let t="".concat(e);for(;t.length<3;)t=" ".concat(t);return t}class Eh extends Bi{constructor(){super(qr,rl)}createShopWheelMenu(e,t,n,i,s,o,a){const{position:r,direction:l}=t;return new Xi(s,e,!1,(()=>!!t.hasComponent(is)&&(!(t.getComponent(is).value.hasOwnProperty(s)&&"number"==typeof t.getComponent(is).value[s].value&&es(t,s)>=ns(t,s)||Do.some((e=>"string"==typeof t.getComponent(is).value[e].value&&t.getComponent(is).value[e].value===s)))&&(!(es(t,"meat")<o)||"low"))),(()=>"".concat(wh(o),"kg")),(()=>{if(qi(t,"useshoppoint",o),es(t,"meat")>=o){qi(t,"meat",-o),qi(n,"meat",o);const e=a.spawn(r.x,r.y,r.z,l.x,i);null!==e&&e.hasComponent(Kr)&&(e.getComponent(Kr).override=!0),i.createSound("./asset/sound/menu/buy.mp3",null,"player-buy").play()}}))}cancel(e,t){e.activeEntity=null,t.getComponent(rl).enable=!1}offset(e,t,n){const i=t.getComponent(qr),s=t.getComponent(rl),o=n.getSun(),a=n instanceof Gh&&!n.hasPractice()&&o.direction.y<Math.PI-.1*Math.PI;if(t.hasComponent(Cn)){t.getComponent(Cn).material=a?oi.OBJECT_SHOP_SALE:oi.OBJECT_SHOP}if(s.enable&&n instanceof Gh){const e=n.getPlayer();if(null!==e&&e.hasComponent(Gi)){const[,,,,s]=js(e),o=e.getComponent(Gi);if(i.sale=n instanceof Gh&&(n.hasPractice()||n.hasPreview())?0:Math.ceil((a?.5:1)*s*100)/100,o.activeEntity===t&&o.activeEntity.hasComponent(qr)){const s=e.getComponent(ji);s.enable=!0,me(s.menus);const a=["next"],r=i.sale;switch(i.index){case 0:s.menus.push(new Xi("exit",a,!1,(()=>!0),(()=>""),(()=>this.cancel(o,t))),new Xi("hand",a,!1,(()=>!0),(()=>"open"),(()=>i.index=1)),new Xi("sidearm",a,!1,(()=>!0),(()=>"open"),(()=>i.index=2)),new Xi("magazine",a,!1,(()=>!0),(()=>"open"),(()=>i.index=3)),new Xi("shell",a,!1,(()=>!0),(()=>"open"),(()=>i.index=4)),new Xi("rocket",a,!1,(()=>!0),(()=>"open"),(()=>i.index=5)),new Xi("cell",a,!1,(()=>!0),(()=>"open"),(()=>i.index=6)));break;case 1:s.menus.push(new Xi("back",a,!1,(()=>!0),(()=>""),(()=>i.index=0)),this.createShopWheelMenu(a,e,o.activeEntity,n,"punch",1e4*r,Ll.ITEM_PUNCH),this.createShopWheelMenu(a,e,o.activeEntity,n,"slowball",25e3*r,Ll.ITEM_SLOWBALL),this.createShopWheelMenu(a,e,o.activeEntity,n,"binoculars",5e4*r,Ll.ITEM_BINOCULARS),this.createShopWheelMenu(a,e,o.activeEntity,n,"energyshield",75e3*r,Ll.ITEM_ENERGYSHIELD),this.createShopWheelMenu(a,e,o.activeEntity,n,"combobooster",1e5*r,Ll.ITEM_COMBOBOOSTER),this.createShopWheelMenu(a,e,o.activeEntity,n,"corrodegrenade",15e4*r,Ll.ITEM_GRENADE),this.createShopWheelMenu(a,e,o.activeEntity,n,"hookshot",2e5*r,Ll.ITEM_HOOKSHOT));break;case 2:s.menus.push(new Xi("back",a,!1,(()=>!0),(()=>""),(()=>i.index=0)),this.createShopWheelMenu(a,e,o.activeEntity,n,"pistol",1e4*r,Ll.ITEM_PISTOL),this.createShopWheelMenu(a,e,o.activeEntity,n,"handcannon",5e4*r,Ll.ITEM_HANDCANNON));break;case 3:s.menus.push(new Xi("back",a,!1,(()=>!0),(()=>""),(()=>i.index=0)),this.createShopWheelMenu(a,e,o.activeEntity,n,"magazine",2500*r,Ll.ITEM_MAGAZINE),this.createShopWheelMenu(a,e,o.activeEntity,n,"machingun",25e3*r,Ll.ITEM_MACHINGUN),this.createShopWheelMenu(a,e,o.activeEntity,n,"chainshotgun",5e4*r,Ll.ITEM_CHAINSHOTGUN));break;case 4:s.menus.push(new Xi("back",a,!1,(()=>!0),(()=>""),(()=>i.index=0)),this.createShopWheelMenu(a,e,o.activeEntity,n,"shell",3e3*r,Ll.ITEM_SHELL),this.createShopWheelMenu(a,e,o.activeEntity,n,"shotgun",5e4*r,Ll.ITEM_SHOTGUN),this.createShopWheelMenu(a,e,o.activeEntity,n,"heavycannon",75e3*r,Ll.ITEM_HEAVYCANNON));break;case 5:s.menus.push(new Xi("back",a,!1,(()=>!0),(()=>""),(()=>i.index=0)),this.createShopWheelMenu(a,e,o.activeEntity,n,"rocket",5e3*r,Ll.ITEM_ROCKET),this.createShopWheelMenu(a,e,o.activeEntity,n,"launcher",75e3*r,Ll.ITEM_LAUNCHER),this.createShopWheelMenu(a,e,o.activeEntity,n,"clusterbow",1e5*r,Ll.ITEM_CLUSTERBOW));break;case 6:s.menus.push(new Xi("back",a,!1,(()=>!0),(()=>""),(()=>i.index=0)),this.createShopWheelMenu(a,e,o.activeEntity,n,"cell",4e3*r,Ll.ITEM_CELL),this.createShopWheelMenu(a,e,o.activeEntity,n,"plasmagun",5e4*r,Ll.ITEM_PLASMAGUN),this.createShopWheelMenu(a,e,o.activeEntity,n,"plasmasmg",75e3*r,Ll.ITEM_PLASMASMG))}o.keys.cancel>0&&o.keys.cancel!==o.presss.cancel&&(0!==i.index?i.index=0:this.cancel(o,t))}}}}}class Ch extends Bi{constructor(){super(Yr,Ei,Pr,Cn)}offset(e,t,n){const i=t.getComponent(Ei).value;if(null!==i)if(!i.hasLive()||es(i,"health")<=0)Qi(t,"health",0);else{const e=t.getComponent(Cn);if(i.hasComponent(Ra)){const t=i.getComponent(Ra);-1===t.blowStartTime&&-1!==t.painStartTime&&t.time-t.painStartTime<t.painTime?e.material=oi.ENEMY_GUY_HELMET_PAIN:e.material=oi.ENEMY_GUY_HELMET_STILL,e.flip.x=!!i.hasComponent(Cn)&&i.getComponent(Cn).flip.x}if(i.hasComponent(Sn)){const e=t.getComponent(Pr),n=i.getComponent(Sn);e.offset.y=n.size.y}}}}class vh extends Bi{constructor(){super(sl)}offset(e,t,n){const i=t.getComponent(sl);null===i.spawn||!i.spawn.hasLive()&&i.time>i.interval?(i.spawn=i.spawner.spawn(t.position.x,t.position.y,t.position.z,t.direction.x,n),n.createSound("./asset/sound/item/spawn.mp3",t,"spawn-".concat(t.getID())).play(),i.time=0):i.spawn.hasLive()||(i.time+=s(e/60,0))}}class bh extends Bi{constructor(){super(ol,rl)}cancel(e,t){t.getComponent(rl).enable=!1,e.activeEntity=null}offset(e,t,n){if(!(n instanceof Gh))return;const i=n.getPlayer();if(null!==i&&i.hasComponent(Gi)){const e=i.getComponent(Gi);if(e.activeEntity===t){const i=t.getComponent(ol);if(i.editor!==n.getCamera()){const e=n.getCamera();n.setCamera(i.editor),i.camera=e}if(null!==i.camera&&(i.editor.fov=i.camera.fov,i.editor.zoom=i.camera.zoom),i.editor.hasComponent(al)){const s=i.editor.getComponent(al);s.exit&&(null!==i.camera&&n.setCamera(i.camera),this.cancel(e,t),s.exit=!1)}}}}}class _h extends Bi{constructor(e,t,n){super(al,jo,ji),this.keys={},this.presss={},this.toggles={},this.releases={},this.updateButtons={},this.keyWalk=new E(0,0),this.walk=new E(0,0),this.look=new E(0,0),this.oldWalk=new E(0,0),this.oldLook=new E(0,0),this.lookInputType=null,this.isUpdateWalkToKeyboard=!0,this.isAxesUpdateWalkX=!1,this.isAxesUpdateWalkY=!1,this.isAxesUpdateLookX=!1,this.isAxesUpdateLookY=!1,this.isResetLookX=!1,this.isResetLookY=!1,this.isResetWalkX=!1,this.isResetWalkY=!1,this.lockLockTime=0,this.activeSceneName="none",this.setting=e,this.scenes=t,this.controls=n,n.axes(((e,i,s)=>{var o;if(!Rn()&&t.getActiveSceneName()===this.activeSceneName&&(null===(o=t.getScene(this.activeSceneName))||void 0===o?void 0:o.hasRun()))switch(e){case"x":this.isAxesUpdateWalkX?(this.walk.x=Math.abs(this.walk.x)>Math.abs(i)?this.walk.x:-i,this.oldWalk.x=Math.abs(this.oldWalk.x)<Math.abs(i)?this.oldWalk.x:-i,this.isResetWalkX=0===i):0===i?(this.walk.x=0,this.oldWalk.x=0):(this.walk.x=-i,this.oldWalk.x=-i,this.isAxesUpdateWalkX=!0),this.isAxesUpdateWalkY?(this.walk.y=Math.abs(this.walk.y)>Math.abs(s)?this.walk.y:s,this.oldWalk.y=Math.abs(this.oldWalk.y)<Math.abs(s)?this.oldWalk.y:s,this.isResetWalkY=0===s):0===s?(this.walk.y=0,this.oldWalk.y=0):(this.walk.y=s,this.oldWalk.y=s,this.isAxesUpdateWalkY=!0);break;case"y":this.lookInputType=n.getInputType(),this.isAxesUpdateLookX?"gamepad"===this.lookInputType?(this.look.x=Math.abs(this.look.x)>Math.abs(i)?this.look.x:i,this.oldLook.x=Math.abs(this.oldLook.x)<Math.abs(i)?this.oldLook.x:i,this.isResetLookX=0===i):(this.look.x+=i,this.oldLook.x+=i,this.isResetLookX=!0):0===i?(this.look.x=0,this.oldLook.x=0):(this.look.x=i,this.oldLook.x=i,this.isAxesUpdateLookX=!0),this.isAxesUpdateLookY?"gamepad"===this.lookInputType?(this.look.y=Math.abs(this.look.y)>Math.abs(s)?this.look.y:s,this.oldLook.y=Math.abs(this.oldLook.y)<Math.abs(s)?this.oldLook.y:s,this.isResetLookY=0===s):(this.look.y+=s,this.oldLook.y+=s,this.isResetLookY=!0):0===s?(this.look.y=0,this.oldLook.y=0):(this.look.y=s,this.oldLook.y=s,this.isAxesUpdateLookY=!0)}else this.walk.x=0,this.walk.y=0,this.look.x=0,this.look.y=0,this.oldWalk.x=0,this.oldWalk.y=0,this.oldLook.x=0,this.oldLook.y=0})),n.press(((e,n)=>{var i;const s=performance.now();if(!Rn()&&t.getActiveSceneName()===this.activeSceneName&&(null===(i=t.getScene(this.activeSceneName))||void 0===i?void 0:i.hasRun())){if(-1!==e.indexOf("gamepad_")||-1!==e.indexOf("touchpad_")||Na()){let i=!1;this.updateButtons[e]?this.releases[e]||n||(this.releases[e]=!0):(this.toggles[e]!==n&&(i=!0),this.enablePresss(e,n,i,t,s),this.toggles[e]=n,this.updateButtons[e]=!0)}}else{for(const e in this.keys)this.keys[e]=0;for(const e in this.presss)this.presss[e]=0;for(const e in this.releases)this.enablePresss(e,!1,!1,t,s),delete this.releases[e];for(const e in this.updateButtons)delete this.updateButtons[e]}}))}enablePresss(e,t,n,i,s){const o=this.controls;switch(!0){case o.hasKey("forward",e):this.keyWalk.y=t?1:1===this.keyWalk.y?0:this.keyWalk.y,this.isUpdateWalkToKeyboard=!0;break;case o.hasKey("back",e):this.keyWalk.y=t?-1:-1===this.keyWalk.y?0:this.keyWalk.y,this.isUpdateWalkToKeyboard=!0;break;case o.hasKey("left",e):this.keyWalk.x=t?1:1===this.keyWalk.x?0:this.keyWalk.x,this.isUpdateWalkToKeyboard=!0;break;case o.hasKey("right",e):this.keyWalk.x=t?-1:-1===this.keyWalk.x?0:this.keyWalk.x,this.isUpdateWalkToKeyboard=!0;break;case o.hasKey("weapon-wheel",e):case o.hasKey("weapon-wheel-right",e):case o.hasKey("weapon-wheel-left",e):this.keys.menu=t?s:0;break;case"touchpad_a"===e:case"gamepad_rt"===e:case"mouse_left"===e:this.keys.primary=t?s:0;break;case"touchpad_b"===e:case"gamepad_lt"===e:case"mouse_right"===e:this.keys.secondary=t?s:0;break;case"touchpad_select"===e:case"gamepad_b"===e:case"keyboard_f"===e:this.keys.exit=t?s:0}}updateWalk(){const e=Math.min(T(this.keyWalk.x,this.keyWalk.y,0,0),1),t=W(this.keyWalk.x,this.keyWalk.y,0,0),n=Math.cos(t)*e,i=Math.sin(t)*e;this.isAxesUpdateWalkX?(this.walk.x=Math.abs(this.walk.x)>Math.abs(n)?this.walk.x:-n,this.oldWalk.x=Math.abs(this.oldWalk.x)<Math.abs(n)?this.oldWalk.x:-n):0===n?(this.walk.x=0,this.oldWalk.x=0):(this.walk.x=n,this.oldWalk.x=n,this.isAxesUpdateWalkX=!0),this.isAxesUpdateWalkY?(this.walk.y=Math.abs(this.walk.y)>Math.abs(i)?this.walk.y:i,this.oldWalk.y=Math.abs(this.oldWalk.y)<Math.abs(i)?this.oldWalk.y:i):0===i?(this.walk.y=0,this.oldWalk.y=0):(this.walk.y=i,this.oldWalk.y=i,this.isAxesUpdateWalkX=!0)}additional(e,t,n){var i;if(!(n instanceof Gh))return!1;const o=null===(i=n.getPlayer())||void 0===i?void 0:i.getComponent(Gi),a=t.getComponent(al),r=n.getCamera();if(this.activeSceneName=n.getName(),!(void 0===o||t.hasComponent(ji)&&t.getComponent(ji).enable)){const t=o.activeEntity;if(null!==t&&t.hasComponent(ol))for(const e in this.keys)a.keys[e]=this.keys[e];else for(const e in this.keys)a.keys[e]=0;const i=this.setting.getSensibility();a.cmda.x=this.look.x*i/r.zoom*s("gamepad"===this.lookInputType?e/n.getSpeed():1,0)*(this.setting.hasInvertX()?-1:1),a.cmda.y=this.look.y*i/r.zoom*s("gamepad"===this.lookInputType?e/n.getSpeed():1,0)*(this.setting.hasInvertY()?-1:1)}}offset(e,t,n){var i;if(!(n instanceof Gh))return!1;const s=performance.now(),{position:o,direction:a}=t,r=t.getComponent(al),l=t.getComponent(jo),h=n.getPlayer(),p=n.getCamera(),c=n.getControlManager();if(l.move.x=0,l.move.z=0,l.look.x=0,l.look.y=0,null!==h&&h.hasComponent(Gi)){const e=h.getComponent(Gi).activeEntity;if(null!==e&&e.hasComponent(ol)){if(p.getNames().some((e=>"editor"===e))){const e=t.hasComponent(ji)&&t.getComponent(ji).enable;c.hasStick()!==e&&(c.changeStick("y",e),this.look.x=0,this.look.y=0)}r.axes.x.x=Math.min(1,Math.max(-1,this.walk.x)),r.axes.x.y=Math.min(1,Math.max(-1,this.walk.y)),r.axes.y.x=Math.min(1,Math.max(-1,this.look.x)),r.axes.y.y=Math.min(1,Math.max(-1,this.look.y));const e=t.getComponent(ji),s=[];e.enable=this.keys.menu>0,e.enable?(me(e.menus),e.menus.push(new Xi("block",s,!0,(()=>!0),(()=>""),(()=>r.mode=0)),new Xi("target",s,!0,(()=>!0),(()=>""),(()=>{r.mode=1,r.pawn=Ll.SPAWNER_TARGET})),new Xi("health",s,!0,(()=>!0),(()=>""),(()=>{r.mode=1,r.pawn=Ll.SPAWNER_HEALTH_ELIXER})),new Xi("armor",s,!0,(()=>!0),(()=>""),(()=>{r.mode=1,r.pawn=Ll.SPAWNER_ARMOR_ELIXER})),new Xi("stamina",s,!0,(()=>!0),(()=>""),(()=>{r.mode=1,r.pawn=Ll.SPAWNER_STAMINA_ELIXER}))),this.lockLockTime=performance.now()):t.hasComponent(ji)&&-1!==t.getComponent(ji).value&&performance.now()-this.lockLockTime<175?(r.cmda.x=0,r.cmda.y=0,this.look.x=0,this.look.y=0):this.keys.menu||(a.x+=r.cmda.x,a.y+=r.cmda.y),t.direction.y=Math.max(-Math.PI/2,Math.min(Math.PI/2,t.direction.y));const[h,d,u,,m]=n.hitScan("range",a.x,a.y,o.x,o.y,o.z,1/0,[t.getID()]),[g,f,y]=A(a.x,a.y,0,0,1/256);let w=Math.floor(h+g),x=Math.floor(d+f),M=Math.floor(u+y);switch(r.mode){case 0:if((!(n instanceof Ti)||!n.hasOutOfWorld(w,x,M))&&this.keys.primary&&this.keys.primary!==this.presss.primary){const[e,t]=N(h,d,u,Math.floor(w)+.5,Math.floor(x)+.5,Math.floor(M)+.5);switch(!0){case t<-Math.PI/4:x+=1;break;case t>Math.PI/4:x-=1;break;case Math.abs(e)>Math.PI/4*3:w-=1;break;case Math.abs(e)<Math.PI/4:w+=1;break;case e<-Math.PI/4:M-=1;break;case e>Math.PI/4:M+=1}if(x<35&&n.getVoxel(w,x,M)===li&&(!(n instanceof Ti)||!n.hasOutOfWorld(w,x,M)))for(let e=0|x;e>=0;e=e-1|0){if("EDIT_ZONE"===n.getVoxel(w,e,M).bottom){n.setVoxel(w,x,M,pi.EDIT_BLOCK,!0,!0);break}}}break;case 1:if((!(n instanceof Ti)||!n.hasOutOfWorld(w,x,M))&&this.keys.primary&&this.keys.primary!==this.presss.primary){const[e,t]=N(h,d,u,Math.floor(w)+.5,Math.floor(x)+.5,Math.floor(M)+.5);switch(!0){case t<-Math.PI/4:x+=1;break;case t>Math.PI/4:x-=1;break;case Math.abs(e)>Math.PI/4*3:w-=1;break;case Math.abs(e)<Math.PI/4:w+=1;break;case e<-Math.PI/4:M-=1;break;case e>Math.PI/4:M+=1}n instanceof Ti&&n.hasOutOfWorld(w,x,M)||n.getVoxel(w,x,M)!==li||0===n.getEntitysOfRange("range",w+.5,x,M+.5,1,1).filter((e=>e.hasComponent(_n))).length&&(null===(i=r.pawn)||void 0===i||i.spawn(w+.5,x,M+.5,0,n))}}if(this.keys.secondary&&this.keys.secondary!==this.presss.secondary)if(null!==m||n instanceof Ti&&n.hasOutOfWorld(w,x,M)||"EDIT_BLOCK"!==n.getVoxel(w,x,M).bottom){if(null!==m){if(m.hasComponent(sl)){const e=m.getComponent(sl);null!==e.spawn&&e.spawn.remove()}m.remove()}}else{const[e,t,i]=n.getWorldSize(),s=2*n.getMargin()+1;(e>s||t>s||i>s)&&n.setVoxel(w,x,M,li,!0,!0)}r.keys.exit&&r.keys.exit!==this.presss.exit&&(r.exit=!0),l.move.x=this.walk.x,l.move.z=this.walk.y,l.look.x=t.direction.x,l.look.y=t.direction.y}else{for(const e in this.keys)this.keys[e]=0;this.keyWalk.x=0,this.keyWalk.y=0,this.updateWalk()}}else r.axes.x.x=0,r.axes.x.y=0,r.axes.y.x=0,r.axes.y.y=0;const[d,u,m]=n.getWorldSize();o.x=Math.min(d-1,Math.max(0,o.x)),o.y=Math.min(u-1,Math.max(0,o.y)),o.z=Math.min(m-1,Math.max(0,o.z)),this.isUpdateWalkToKeyboard&&(this.updateWalk(),this.isUpdateWalkToKeyboard=!1),this.isAxesUpdateWalkX=!1,this.isAxesUpdateWalkY=!1,this.isAxesUpdateLookX=!1,this.isAxesUpdateLookY=!1;for(const e in this.updateButtons)this.updateButtons[e]=!1;for(const e in this.keys)this.presss[e]=this.keys[e];for(const e in this.releases)this.enablePresss(e,!1,!1,this.scenes,s),delete this.releases[e];this.walk.x=this.oldWalk.x,this.walk.y=this.oldWalk.y,"gamepad"===this.controls.getInputType()&&(this.look.x=this.oldLook.x,this.look.y=this.oldLook.y),r.cmda.x=0,r.cmda.y=0,this.isResetWalkX&&(this.walk.x=0,this.oldWalk.x=0,this.isResetWalkX=!1),this.isResetWalkY&&(this.walk.y=0,this.oldWalk.y=0,this.isResetWalkY=!1),this.isResetLookX&&(this.look.x=0,this.oldLook.x=0,this.isResetLookX=!1),this.isResetLookY&&(this.look.y=0,this.oldLook.y=0,this.isResetLookY=!1)}}class Sh extends Bi{constructor(){super(Gi)}offset(e,t,n){const i=t.getComponent(Gi);i.isPause||i.loading?(-1===i.oldSpeed&&(i.oldSpeed=n.getSpeed()),n.setSpeed(0),mn()):(gn(),-1!==i.oldSpeed&&n.setSpeed(i.oldSpeed),i.oldSpeed=-1,-1!==i.deathTime||-1!==i.goleTime||-1!==i.intermissionTime?n.setSpeed(1):n.getSpeed()!==i.speed&&n.setSpeed(s(j(n.getSpeed(),i.speed,.1*e),0,1e3)))}}class kh extends Bi{constructor(){super(Gr,Ei,Pr)}offset(e,t,n){const i=t.getComponent(Ei).value;if(null!==i&&i.hasLive()&&i.hasComponent(Sn)){const e=t.getComponent(Pr),n=i.getComponent(Sn);e.offset.y=n.size.y}}}class Th extends gs{constructor(e,t,n,i,s,o,a,r,l,h,p,c,d,u,m,g,f,y){let w=arguments.length>18&&void 0!==arguments[18]?arguments[18]:"ammo",x=arguments.length>19&&void 0!==arguments[19]?arguments[19]:null,M=arguments.length>20&&void 0!==arguments[20]?arguments[20]:null,E=arguments.length>21&&void 0!==arguments[21]?arguments[21]:new Array;super("player-bullet hook",p,h,0,0,f,y,w,e,t,n,i,s,o,a,r,c,0,l,d,0,!1,((e,t,n,i,s,o,a)=>null),"chain",0,0,!1,oi.EFFECT_BULLET_HOOK_HEAD,[oi.EFFECT_BULLET_HOOK_CHAIN],1,1,1,.25,.25,x,M,"hitbox",["player-hit-bullet","enemy-hit-bullet",...E],new wa(0,.005,.005,.005,1e-4,1e-4,1e-4,.25,1,0,1),new Qr(Math.PI,1,!0),new Ei)}}class Ph extends Bi{constructor(){super(Gs,hs,ps)}offset(e,t,n){var i;const{position:s}=t,o=t.getComponent(ps),a=t.getComponent(hs),r=t.getComponent(Gs),l=(null===(i=o.target)||void 0===i?void 0:i.hasComponent(Pr))&&o.target.hasComponent(Ei)&&o.target.getComponent(Ei).value||o.target;if(null===l||r.init||(r.fixPosition.x=o.hitPosition.x-l.position.x,r.fixPosition.y=o.hitPosition.y-l.position.y,r.fixPosition.z=o.hitPosition.z-l.position.z,r.init=!0),a.isRemove=!1,o.over||null!==r.bullet&&!r.bullet.hasLive())t.remove(),null!==r.bullet&&(r.bullet.hasComponent(ps)&&r.bullet.hasComponent(wa)?r.bullet.getComponent(ps).over=!0:r.bullet.remove());else if(o.hit&&null!==o.attacker){if(null===r.bullet){const e=n.getCamera(),[i,,,,,]=as(o.attacker),s=(a.invert?.045:-.045)/e.fov,l=-.125,h=o.attacker.hasComponent(cs)?o.attacker.getComponent(cs).size.x/2:0,[p,c,d]=A(e.direction.x,e.direction.y,i?0:s,l,h),u=new Th(e.position.x+p,e.position.y+c,e.position.z+d,e.position.x,e.position.y,e.position.z,e.direction.x,e.direction.y,1,a.invert,1/0,0,!1,0,0,0,0,!1,a.damageType,o.attacker,t instanceof gs?t.weapon:null,[o.attacker.getID()]);n.addEntitys(u),u.getComponent(Ei).value=t,r.bullet=u}null!==l&&(s.x=l.position.x+r.fixPosition.x,s.y=l.position.y+r.fixPosition.y,s.z=l.position.z+r.fixPosition.z)}}}var Ih=n(242),Lh=n.n(Ih);class Oh extends Bi{constructor(){super(ms)}destructor(e,t){if(e.hasComponent(ms)){const t=e.getComponent(ms).value;for(;t.length>0;){const e=t.shift()||null;null!==e&&e.hasLive()&&e.remove()}}}}class Ah extends Bi{constructor(){super(ml)}offset(e,t,n){const{position:i}=t,s=t.getComponent(ml);s.time>=s.speed&&(s.time%=s.speed);const o=s.time,a=Math.cos(o*(2*Math.PI))*s.height;let r=s.old;-1===r&&(r=0),i.y=i.y-r+a,s.old=a,s.time+=e/60}}class Wh extends Bi{constructor(){super(gl,Ei)}offset(e,t,n){const i=t.getComponent(Ei).value;if(null===i)return;const{position:s}=t,{position:o}=i,a=t.getComponent(gl),r=P(o.x,o.y,o.z,s.x,0|s.y,s.z)<a.range;if(null!==a.sound&&r&&a.isHover!==r&&n.createSound(a.sound,null,"message-".concat(t.getID())).setVolume(a.volume).play(),a.isHover=r,!(n instanceof Gh))return;const l=n.getPlayer();if(null!==l&&l.hasComponent(Gi)){const e=l.getComponent(Gi);r&&e.helpMessages.push(...a.message())}}}const Nh=[30,60,90,120,1/0];class zh{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.setting=e,this.init(t)}init(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.setFramerate(this.setting.hasOwnProperty("framerate")?this.setting.framerate:1),this.setFOV(this.setting.hasOwnProperty("fov")?this.setting.fov:130,e),this.setInnerDeadzoneX(this.setting.stickInnerDeadzoneX||0),this.setOuterDeadzoneX(this.setting.stickOuterDeadzoneX||0),this.setInnerDeadzoneY(this.setting.stickInnerDeadzoneY||0),this.setOuterDeadzoneY(this.setting.stickOuterDeadzoneY||0),this.setSoundVolume(this.setting.hasOwnProperty("soundVolume")?this.setting.soundVolume:1),this.setClusterResolution(this.setting.hasOwnProperty("clusterResolution")?this.setting.clusterResolution:16),this.setFullscreen(this.setting.hasOwnProperty("isFullscreen")?this.setting.isFullscreen:!!f()),this.setBrowserFullscreen(!!this.setting.hasOwnProperty("isBrowserFullscreen")&&this.setting.isBrowserFullscreen),this.setReolutionIndex(this.setting.hasOwnProperty("resolutionIndex")?this.setting.resolutionIndex:-1),this.setReflectionCount(this.setting.hasOwnProperty("reflectionCount")?this.setting.reflectionCount:2),this.setShadow(!this.setting.hasOwnProperty("isShadow")||this.setting.isShadow),this.setSoftShadow(!this.setting.hasOwnProperty("isSoftShadow")||this.setting.isSoftShadow),this.setRoughness(!this.setting.hasOwnProperty("isRoughness")||this.setting.isRoughness),this.setBloom(!this.setting.hasOwnProperty("isBloom")||this.setting.isBloom),this.setMuzzleFlash(!this.setting.hasOwnProperty("isMuzzleFlash")||this.setting.isMuzzleFlash),this.setPixelizedLighting(!this.setting.hasOwnProperty("isPixelizedLighting")||this.setting.isPixelizedLighting),this.setLightingDotScale(this.setting.hasOwnProperty("lightingDotScale")?this.setting.lightingDotScale:1),this.setBlurDotScale(this.setting.hasOwnProperty("blurDotScale")?this.setting.blurDotScale:4),this.setContrast(this.setting.hasOwnProperty("contrast")?this.setting.contrast:1),this.setBrightness(this.setting.hasOwnProperty("brightness")?this.setting.brightness:1),this.setCRTEnable(!!this.setting.hasOwnProperty("isCRT")&&this.setting.isCRT),this.setCRTSubPixel(this.setting.hasOwnProperty("crtSubPixel")?this.setting.crtSubPixel:3),this.setCRTLens(this.setting.hasOwnProperty("crtLens")?this.setting.crtLens:.075),this.setCRTDeep(this.setting.hasOwnProperty("crtDeep")?this.setting.crtDeep:.075),this.setCRTEdge(this.setting.hasOwnProperty("crtEdge")?this.setting.crtEdge:.025),this.setCRTVig(this.setting.hasOwnProperty("crtVig")?this.setting.crtVig:.175),this.setCRTShadowMask(!!this.setting.hasOwnProperty("isCRTShadowMask")&&this.setting.isCRTShadowMask),this.setHUD(!this.setting.hasOwnProperty("isHUD")||this.setting.isHUD),this.setSensibility(this.setting.hasOwnProperty("sensibility")?this.setting.sensibility:50),this.setInvertX(!!this.setting.hasOwnProperty("invertX")&&this.setting.invertX),this.setInvertY(!!this.setting.hasOwnProperty("invertY")&&this.setting.invertY),this.setBob(!this.setting.hasOwnProperty("bob")||this.setting.bob),this.setToggleSprint(!this.setting.hasOwnProperty("toggleSprint")||this.setting.toggleSprint),this.setToggleCluch(!this.setting.hasOwnProperty("toggleCluch")||this.setting.toggleCluch),this.setWeaponChargeStandTime(this.setting.hasOwnProperty("weaponChargeStandTime")?this.setting.weaponChargeStandTime:180),this.setWeaponWheelStandTime(this.setting.hasOwnProperty("weaponWheelStandTime")?this.setting.weaponWheelStandTime:180),this.setEatSound(!this.setting.hasOwnProperty("eatSound")||this.setting.eatSound),this.setCheckPoint(!this.setting.hasOwnProperty("isCheckPoint")||this.setting.isCheckPoint),this.setDeadLoseWeapon(!!this.setting.hasOwnProperty("isDeadLoseWeapon")&&this.setting.isDeadLoseWeapon),this.setPermaDeath(!!this.setting.hasOwnProperty("isPermaDeath")&&this.setting.isPermaDeath),this.setSSSSlowMo(!this.setting.hasOwnProperty("isSSSSlowMo")||this.setting.isSSSSlowMo),this.setRandomWeaponDrop(this.setting.hasOwnProperty("randomWeaponDrop")?this.setting.randomWeaponDrop:0),this.setRandomHeightEnemy(this.setting.hasOwnProperty("randomHeightEnemy")?this.setting.randomHeightEnemy:1),this.setNotSpawnAcotrs(!!this.setting.hasOwnProperty("isNotSpawnActors")&&this.setting.isNotSpawnAcotrs),this.setDebugLog(!!this.setting.hasOwnProperty("isDebugLog")&&this.setting.isDebugLog)}reset(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const e in this.setting)delete this.setting[e];this.init(e)}saveSetting(){fa("setting")}setHUD(e){this.setting.isHUD=e,this.saveSetting()}setSensibility(e){this.setting.sensibility=e,this.saveSetting()}setInvertX(e){this.setting.invertX=e,this.saveSetting()}setInvertY(e){this.setting.invertY=e,this.saveSetting()}setBob(e){this.setting.bob=e,this.saveSetting()}setToggleSprint(e){this.setting.toggleSprint=e,this.saveSetting()}setToggleCluch(e){this.setting.toggleCluch=e,this.saveSetting()}setWeaponChargeStandTime(e){this.setting.weaponChargeStandTime=e,this.saveSetting()}setWeaponWheelStandTime(e){this.setting.weaponWheelStandTime=e,this.saveSetting()}setEatSound(e){this.setting.eatSound=e,this.saveSetting()}setCheckPoint(e){this.setting.isCheckPoint=e,this.saveSetting()}setDeadLoseWeapon(e){this.setting.isDeadLoseWeapon=e,this.saveSetting()}setPermaDeath(e){this.setting.isPermaDeath=e,this.saveSetting()}setSSSSlowMo(e){this.setting.isSSSSlowMo=e,this.saveSetting()}setRandomWeaponDrop(e){this.setting.randomWeaponDrop=e,this.saveSetting()}setRandomHeightEnemy(e){this.setting.randomHeightEnemy=e,this.saveSetting()}setNotSpawnAcotrs(e){this.setting.isNotSpawnActors=e,this.saveSetting()}setDebugLog(e){this.setting.isDebugLog=e,this.saveSetting()}setFOV(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;null!==t&&t.getScenes().forEach((t=>{if(!(t instanceof Ti))return;t.getCamera().fov=K(e)})),this.setting.fov=e,this.saveSetting()}setFramerate(e){e>=Nh.length&&(e=1),this.setting.framerate=e,this.saveSetting()}setSoundVolume(e){this.setting.soundVolume=e,this.saveSetting()}setClusterResolution(e){this.setting.clusterResolution=e,this.saveSetting()}setFullscreen(e){this.setting.isFullscreen=e,this.saveSetting()}setBrowserFullscreen(e){this.setting.isBrowserFullscreen=e,this.saveSetting()}setReolutionIndex(e){this.setting.resolutionIndex=e,this.saveSetting()}setReflectionCount(e){this.setting.reflectionCount=e,this.saveSetting()}setShadow(e){this.setting.isShadow=e,this.saveSetting()}setSoftShadow(e){this.setting.isSoftShadow=e,this.saveSetting()}setRoughness(e){this.setting.isRoughness=e,this.saveSetting()}setBloom(e){this.setting.isBloom=e,this.saveSetting()}setMuzzleFlash(e){this.setting.isMuzzleFlash=e,this.saveSetting()}setPixelizedLighting(e){this.setting.isPixelizedLighting=e,this.saveSetting()}setLightingDotScale(e){this.setting.lightingDotScale=e,this.saveSetting()}setBlurDotScale(e){this.setting.blurDotScale=e,this.saveSetting()}setContrast(e){this.setting.contrast=e,this.saveSetting()}setBrightness(e){this.setting.brightness=e,this.saveSetting()}setCRTEnable(e){this.setting.isCRT=e,this.saveSetting()}setCRTDeep(e){this.setting.crtDeep=e,this.saveSetting()}setCRTSubPixel(e){this.setting.crtSubPixel=e,this.saveSetting()}setCRTLens(e){this.setting.crtLens=e,this.saveSetting()}setCRTEdge(e){this.setting.crtEdge=e,this.saveSetting()}setCRTVig(e){this.setting.crtVig=e,this.saveSetting()}setCRTShadowMask(e){this.setting.isCRTShadowMask=e,this.saveSetting()}setInnerDeadzoneX(e){this.setting.stickInnerDeadzoneX=e,this.saveSetting()}setOuterDeadzoneX(e){this.setting.stickOuterDeadzoneX=e,this.saveSetting()}setInnerDeadzoneY(e){this.setting.stickInnerDeadzoneY=e,this.saveSetting()}setOuterDeadzoneY(e){this.setting.stickOuterDeadzoneY=e,this.saveSetting()}getRandomWeaponDrop(){return this.setting.randomWeaponDrop}getRandomHeightEnemy(){return this.setting.randomHeightEnemy}hasBob(){return this.setting.bob}hasToggleSprint(){return this.setting.toggleSprint}hasToggleCluch(){return this.setting.toggleCluch}getWeaponChargeStandTime(){return this.setting.weaponChargeStandTime}getWeaponWheelStandTime(){return this.setting.weaponWheelStandTime}hasEatSound(){return this.setting.eatSound}hasHUD(){return this.setting.isHUD}hasCheckPoint(){return this.setting.isCheckPoint}hasDeadLoseWeapon(){return this.setting.isDeadLoseWeapon}hasPermaDeath(){return this.setting.isPermaDeath}hasSSSSlowMo(){return this.setting.isSSSSlowMo}hasNotSpawnActors(){return this.setting.isNotSpawnActors}hasDebugLog(){return this.setting.isDebugLog}getSoundVolume(){return this.setting.soundVolume}getReflectionCount(){return this.setting.reflectionCount}getLightingDotScale(){return this.hasCRT()?1:this.setting.lightingDotScale}getBlurDotScale(){return this.hasCRT()?1:this.setting.blurDotScale}getClusterResolution(){return this.setting.clusterResolution}hasShadow(){return this.setting.isShadow}hasSoftShadow(){return this.setting.isSoftShadow}hasRoughness(){return this.setting.isRoughness}hasBloom(){return this.setting.isBloom}hasMuzzleFlash(){return this.setting.isMuzzleFlash}hasPixelizedLighting(){return this.setting.isPixelizedLighting}getContrast(){return this.setting.contrast}getBrightness(){return this.setting.brightness}hasCRT(){return this.setting.isCRT}getResolutionIndex(){return this.setting.resolutionIndex}hasFullscreen(){return this.setting.isFullscreen}hasBrowserFullscreen(){return this.setting.isBrowserFullscreen}getCRTSubPixel(){return this.hasCRT()?this.setting.crtSubPixel:1}getCRTLens(){return this.setting.crtLens}getCRTDeep(){return this.setting.crtDeep}getCRTEdge(){return this.setting.crtEdge}getCRTVig(){return this.setting.crtVig}hasCRTShadowMask(){return this.setting.isCRTShadowMask}getSensibility(){return this.setting.sensibility}hasInvertX(){return this.setting.invertX}hasInvertY(){return this.setting.invertY}getInnerDeadzoneX(){return this.setting.stickInnerDeadzoneX}getOuterDeadzoneX(){return this.setting.stickOuterDeadzoneX}getInnerDeadzoneY(){return this.setting.stickInnerDeadzoneY}getOuterDeadzoneY(){return this.setting.stickOuterDeadzoneY}getFramerate(){return f()?Nh[this.setting.framerate]:1/0}getFramerateIndex(){return this.setting.framerate}getFOV(){return this.setting.fov}getVolume(){return this.setting.soundVolume}}class Dh extends Bi{constructor(){super(Js,hs,ps)}offset(e,t,n){const i=t.getComponent(ps);if(i.hit&&!i.over&&null!==i.attacker){const[e,s]=N(i.attacker.position.x,i.attacker.position.y,i.attacker.position.z,i.hitPosition.x,i.hitPosition.y,i.hitPosition.z);let o=i.attacker.position.x,a=i.attacker.position.y,r=i.attacker.position.z;if(null!==i.target){const[t,n]=O(e,0,((i.attacker.hasComponent(_n)?i.attacker.getComponent(_n).size.x:0)+(i.target.hasComponent(_n)?i.target.getComponent(_n).size.x:0))/2);o=i.target.position.x+t,a=i.target.position.y,r=i.target.position.z+n}if(i.attacker.position.x=o,i.attacker.position.y=a,i.attacker.position.z=r,i.attacker.hasComponent(ds)){const e=i.attacker.getComponent(ds);e.value.x=0,e.value.y=0,e.value.z=0}if(i.attacker.hasComponent(ss)){i.attacker.getComponent(ss).through=!0}if(i.attacker.hasComponent($o)){i.attacker.getComponent($o).through=!0}i.attacker.hasComponent(Gi)&&(i.attacker.getComponent(Gi).hitWaitStartTime=i.attacker.getComponent(Gi).time),i.attacker.hasComponent(na)&&(i.attacker.getComponent(na).exec=!1);const l=new Array,h=t.getComponent(Js),[p,c]=N(i.hitPosition.x,i.hitPosition.y,i.hitPosition.z,i.start.x,i.start.y,i.start.z);n.getEntitysOfRange("hitbox",o,a,r,h.range.x,h.range.y).forEach((e=>{if(!(e instanceof Mn)||e.getNames().some((e=>{var t,n;return(null===(t=i.attacker)||void 0===t?void 0:t.getID())===e||(null===(n=i.target)||void 0===n?void 0:n.getID())===e}))||l.includes(e)||null===i.attacker)return;const n=P(e.position.x,e.position.y+(e.hasComponent(Sn)?e.getComponent(Sn).size.y:0)/2,e.position.z,o,a,r),[s,d]=N(e.position.x,e.position.y+(e.hasComponent(Sn)?e.getComponent(Sn).size.y:0)/2,e.position.z,o,a,r),u=t.getComponent(hs);if(e.hasComponent(Ws)){const t=e.getComponent(Ws),o=(1-Math.min(1,n/Math.min(h.range.x,h.range.y)))*h.damagePar,[a,r,m]=A(p,c,0,0,u.force*o);t.value.push(new cr(u.damage*o,u.damageType,i.attacker,s,d,i.attacker.position.x,i.attacker.position.y,i.attacker.position.z,a,r,m)),l.push(e)}}))}}}class Rh extends Bi{constructor(e){super(fl),this.setting=e}offset(e,t,n){if(!(n instanceof Gh))return;const i=n.getPlayer();if(!(i&&i instanceof Mn&&i.hasComponent(Gi)))return;const s=i.getComponent(Gi);if(-1===s.goleTime&&-1===s.deathTime&&-1===s.intermissionTime)if(this.setting.hasCheckPoint()){const{position:e}=t,s=t.getComponent(fl);if(!s.enable){const o=P(i.position.x,i.position.y+1*(i.hasComponent(cs)?i.getComponent(cs).size.y:0),i.position.z,e.x,e.y+.25,e.z),a=P(i.position.x,i.position.y+.5*(i.hasComponent(cs)?i.getComponent(cs).size.y:0),i.position.z,e.x,e.y+.25,e.z),r=P(i.position.x,i.position.y+0*(i.hasComponent(cs)?i.getComponent(cs).size.y:0),i.position.z,e.x,e.y+.25,e.z),l=s.enable;(o<(i.hasComponent(cs)?i.getComponent(cs).size.x:0)/2+1.25||a<(i.hasComponent(cs)?i.getComponent(cs).size.x:0)/2+1.25||r<(i.hasComponent(cs)?i.getComponent(cs).size.x:0)/2+1.25)&&(n.getEntitys((e=>e.hasComponent(fl))).forEach((e=>{e.getComponent(fl).enable=!1})),s.enable=!0,t.direction.x=G(i.direction.x),l||n.createSound("./asset/sound/item/checkpoint.mp3",null,"player-checkpoint").play()),t.hasComponent(Cn)&&(t.getComponent(Cn).material=s.enable?oi.OBJECT_CHECKPOINT_ACTIVE:oi.OBJECT_CHECKPOINT_DISABLE)}}else t.hasComponent(Cn)&&(t.getComponent(Cn).material=oi.NONE)}}class Hh extends Bi{constructor(){super(Lr,Cn)}offset(e,t,n){const i=n.getCamera(),s=t.getComponent(Lr),o=t.getComponent(Cn),a=R(s.direction.x,i.direction.x);o.rotate=Math.sin(a)*(x/4)}}class Fh extends Bi{constructor(){super(Or),this.spawn_limit=5,this.time=0,this.damageTime=0,this.isDamage=!1}preadditional(e,t){const n=this.time-this.time%.25;this.isDamage=this.damageTime!==n,this.damageTime=n,this.time+=e/60;const i=t.getEntitys((e=>e.hasComponent(Or)));ue(i).desc((e=>e.getComponent(Or).spawnTime));for(let e=this.spawn_limit;e<i.length;e++){const t=i[e];t.hasComponent(Ms)||t.setComponents(new Ms(2),new Ir(2,0))}}additional(e,t,n){const{position:i}=t,s=t.getComponent(Or),o=new Array;this.isDamage&&n.getEntitysOfRange("hitbox",i.x,i.y,i.z,s.scale,1).forEach((e=>{if(!(e instanceof Mn)||o.includes(e)||e.hasComponent(cs)&&e.getComponent(cs).hit.y>=0)return;const[t,a]=N(e.position.x,e.position.y+(e.hasComponent(Sn)?e.getComponent(Sn).size.y:0)/2,e.position.z,i.x,i.y,i.z),r=P(e.position.x,e.position.y+(e.hasComponent(Sn)?e.getComponent(Sn).size.y:0)/2,e.position.z,i.x,i.y,i.z);if(e.hasComponent(Ws)&&!n.hasHitScanVoxel(t,a,i.x,i.y,i.z,r)){const n=e.getComponent(Ws);0===n.value.length&&n.value.push(new cr(5,"corrode",s.attacker,t,a,i.x,i.y,i.z,0,0,0))}}))}}class Uh extends Bi{constructor(){super(yl),this.enemySpawnLimit=20,this.extendEnemyReplaceLimit=10,this.normalEnemyTypes=[Ll.ENEMY_GUY_PISTOL,Ll.ENEMY_GUY_SHOTGUN,Ll.ENEMY_GUY_MACHINGUN,Ll.ENEMY_GUY_MELEE],this.extendEnemyTypes=[Ll.ENEMY_GUY_PISTOL_ARMOR,Ll.ENEMY_GUY_SHOTGUN_ARMOR,Ll.ENEMY_GUY_MACHINGUN_ARMOR,Ll.ENEMY_GUY_MELEE_ARMOR],this.sniperEnemyTypes=[Ll.ENEMY_GUY_MACHINGUN],this.extendSniperEnemyTypes=[Ll.ENEMY_GUY_MACHINGUN_ARMOR],this.skyEnemyTypes=[Ll.ENEMY_GUY_MISSILE]}preadditional(e,t){const n=performance.now(),i=t instanceof Gh?t.getPlayer():null;if(!i||i.hasComponent(Gi)&&i.getComponent(Gi).hordeStartTime<5&&(!(t instanceof Gh)||!t.hasPreview()))return;const s=t instanceof Gh?t.getMaxKillEnemy():0,o=t instanceof Gh?t.getCountKillEnemy():0;if(t instanceof Gh&&t.hasHorde()){const t=i.getComponent(Gi);if(i.hasComponent(Gi)&&(es(i,"hordetime",0)<=0||s<=o||-1!==t.goleTime))return void(-1===t.deathTime&&-1===t.goleTime&&(t.goleTime=n));Qi(i,"hordetime",Math.max(0,es(i,"hordetime",0)-e/60))}const r=Math.min(this.enemySpawnLimit,Math.max(5,t instanceof Gh?Math.floor(o/(s/2)*this.enemySpawnLimit):0)),l=t.getEntitys((e=>e.getNames().includes("enemy"))),h=Math.min(1,Math.max(0,o-s/4)/(s/4))*(this.extendEnemyReplaceLimit/this.enemySpawnLimit),p=Math.min(1,Math.max(0,o-s/3)/(s/3))*(this.extendEnemyReplaceLimit/this.enemySpawnLimit),c=Math.min(1,Math.max(0,o-s/2)/(s/2))*(this.extendEnemyReplaceLimit/this.enemySpawnLimit);let d=l.length;if(r>d){const e=t.getEntitys((e=>{if(e.hasComponent(yl)&&e instanceof Mn){const n=e.getComponent(yl),[s,o]=N(i.position.x,i.position.y,i.position.z,e.position.x,e.position.y,e.position.z),a=P(i.position.x,i.position.y,i.position.z,e.position.x,e.position.y,e.position.z);return(null===n.attachActor||!n.attachActor.hasLive())&&a>20&&t.hasHitScanVoxel(s,o,e.position.x,e.position.y,e.position.z,a)}return!1}));ue(e).asc((()=>Math.random()-.5));for(let n=0;n<e.length;n++){const i=e[n];if(!(i instanceof Mn)||t.hasBlockScale("collision",i.position.x,i.position.y,i.position.z,1,2))continue;const s=i.getComponent(yl),l=a(o)<c;let u=null;switch(s.type){case"sniper":if(a(o)>h||o<50)continue;u=(l?this.sniperEnemyTypes.shift():this.extendSniperEnemyTypes.shift())||null;break;case"sky":if(a(o)>p||o<50)continue;u=this.skyEnemyTypes.shift()||null;break;default:u=(l?this.extendEnemyTypes.shift():this.normalEnemyTypes.shift())||null}if(null===u)continue;const m=u.spawn(i.position.x,0|i.position.y,i.position.z,i.direction.x,t);switch(s.singleton&&(i.getComponent(yl).attachActor=m),s.type){case"sniper":l?this.extendSniperEnemyTypes.push(u):this.sniperEnemyTypes.push(u);break;case"sky":this.skyEnemyTypes.push(u);break;default:l?this.extendEnemyTypes.push(u):this.normalEnemyTypes.push(u)}if((null==m?void 0:m.hasComponent(Ra))&&(m.getComponent(Ra).see=!0),d++,r<=d)break}}}}class Bh extends Bi{constructor(){super(ws,Ss)}additional(e,t,n){const{position:i}=t,s=t.getComponent(ws);if(!s.enable&&n.getEntitysOfRange("hitbox",i.x,i.y,i.z,s.range.x,s.range.y,s.filter).length>0){const e=t.getComponent(Ss);s.enable=!0,e.enable=!0,t.setComponents(...s.execAddComponents())}}}class Yh extends Bi{constructor(){super(wl,Ra)}offset(e,t,n){const i=performance.now(),{position:o}=t,a=t.getComponent(wl),r=t.getComponent(cs);a.exec=!0;const l=r.size.y/2,h=o.x,p=o.y+l,c=o.z,d=a.time-a.time%a.fireSpeed;if(a.enable){if(a.fireTick!==d){const e=new Array,s=0;for(let n=0,i=0|a.brancheCount;n<i;n=n+1|0){const i=a.angleX+w/a.brancheCount*n,o=new a.bulletType(h,p,c,h,p,c,i,s,a.bulletSpeed,!1,1/0,a.bulletScale,!1,a.damage,a.random,1,0,!1,a.damageType,t,null,["enemy","object",...a.filter]);t.hasComponent(Ei)&&o.hasComponent(Ei)&&(o.getComponent(Ei).value=t.getComponent(Ei).value),e.push(o)}n.addEntitys(...e),n.createSound("./asset/sound/enemy/fire-magic.mp3",t,"fire-enemy-".concat(t.getID())).play(),a.fireStartTime=t.hasComponent(Ra)?t.getComponent(Ra).time:i}a.fireTick=d,a.angleX+=a.time%a.rollTime/a.rollTime*w,a.time+=s(e/60,0)}else a.time>0&&(a.fireTick!==d?(a.fireTick=-1,a.time=0):(a.fireTick=d,a.time+=s(e/60,0)))}}class Gh extends Ti{constructor(e,t,n,i,s,o,a,r,l,h,p,c){const d=new Oi("camera"),u=new Li("sun"),m=new zh(n);super(e,21,21,21,10,t,s,o,a,r,l,h,p,n,d,u),this.addSystems(new th,new wr,new pr,new hh,new Ha(m,s,this.getControlManager()),new _h(m,s,this.getControlManager()),new Ki,new ph,new Ba,new dr,new ir,new yr,new Ua,new Zo,new lr,new or(m),new Go,new Xo(.01),new bh,new Eh,new Cr,new sh,new Bh,new Sr,new Yh,new Tr,new Rr,new Fr,new Fh,new Uh,new _r,new oh,new ah,new Ph,new Dh,new br,new jl(m),new nh,new Hh,new ar,new Ko,new vh,new eh,new ql,new kh,new $l,new mh(m),new Rh(m),new Br({"default|ammo|ball|magic|slash":{sounds:{"ammo|ball":["./asset/sound/effect/damage-ammo.mp3"],magic:["./asset/sound/effect/damage-magic.mp3"],slash:["./asset/sound/effect/damage-slash.mp3"]},exec:(e,t,n)=>{const i=es(e,"armor",0),s=es(e,"health",0);if(i>0){const t=Math.max(0===n?0:1,n/3*2);n=Math.max(0===n?0:1,n/3),Qi(e,"armor",0|Math.max(0,i-t))}return Qi(e,"health",0|Math.max(0,s-n)),s>0}},melee:{sounds:{melee:["./asset/sound/effect/damage-melee.mp3"]},exec:(e,t,n)=>{const i=es(e,"armor",0),s=es(e,"health",0);return Qi(e,"armor",0|Math.max(0,i-n)),s>0}},"mugnum|plasma":{sounds:{magnum:["./asset/sound/effect/damage-ammo.mp3"],plasma:["./asset/sound/effect/damage-magic.mp3"]},exec:(e,t,n)=>{const i=es(e,"armor",0),s=es(e,"health",0);if(i>0){const t=n;n=Math.max(0===n?0:1,n/3),Qi(e,"armor",0|Math.max(0,i-t))}return Qi(e,"health",0|Math.max(0,s-n)),s>0}},flame:{sounds:{frame:["./asset/sound/effect/damage-flame.mp3"]},exec:(e,t,n)=>{const i=es(e,"health",0);return Qi(e,"health",0|Math.max(0,i-n)),i>0}},corrode:{sounds:{corrode:["./asset/sound/effect/damage-corrosive1.mp3","./asset/sound/effect/damage-corrosive2.mp3"]},exec:(e,t,n)=>{const i=es(e,"armor",0),s=es(e,"health",0);return Qi(e,"armor",0|Math.max(0,i-n)),Qi(e,"health",0|Math.max(0,s-n/3)),s>0}}}),new pa,new Ch,new Oh,new Ah,new Kl,new Jl,new Zl,new ih,new Ur,new Vo,new Jo,new Ga,new rr,new Mr,new Xl(m),new Ql,new Wh,new uh,new Sh,new gh),this.gamedata={times:new Array,deaths:new Array,isContinue:!1,isHorde:!1,isPreview:!1,isPractice:!1,isTutorial:!1,episodeNumber:-1,mapNumber:-1,secretIndex:-1},this.player=null,this.mapData=null,this.setting=m,this.saveData=c,this.enemyLength=-1,this.meatLength=-1,this.killEnemy=0}getFramerate(){return this.setting.getFramerate()}getFOVToCamera(){return K(this.setting.getFOV())}hasContinue(){return this.gamedata.isContinue}hasHorde(){return this.gamedata.isHorde}hasPractice(){return this.gamedata.isPractice}hasPreview(){return this.gamedata.isPreview}hasTutorial(){return this.gamedata.isTutorial}getEpisodeNumber(){return this.gamedata.episodeNumber}getMapNumber(){return this.gamedata.mapNumber}getSecretIndex(){return this.gamedata.secretIndex}getTimes(){return this.gamedata.times}getDeaths(){return this.gamedata.deaths}getPlayer(){return this.player}getMaxKillEnemy(){return 150}hasSecret(){const e=this.getSecretIndex(),t=this.getDeaths();return-1!==e&&e===t.length-1}hasSaveData(){return Object.keys(this.saveData).length>0}setPlayer(e){this.player=e}deleteSave(){for(const e in this.saveData)delete this.saveData[e];this.gamedata.isContinue=!1,ya("save-data")}async continueLoad(){if(this.hasSaveData()){const{isTutorial:e,episodeNumber:t,mapNumber:n,deaths:i,times:s,secretIndex:o,playerInventory:a,playerWeapon:r,playerPrevWeapon:l,time:h}=this.saveData;me(this.gamedata.deaths),me(this.gamedata.times),this.gamedata.episodeNumber=t||1,this.gamedata.mapNumber=n||0,this.gamedata.deaths.push(...i||[]),this.gamedata.times.push(...s||[]),this.gamedata.secretIndex=o||-1,this.stop();try{if(e)await this.loadTutorial();else{this.gamedata.isContinue=!0,this.gamedata.isHorde=!1,this.gamedata.isPreview=!1,this.gamedata.isPractice=!1,this.gamedata.isTutorial=!1,this.mapData=(await Hn(this.hasSecret()?"./map/e".concat(this.getEpisodeNumber(),"ms.json"):"./map/e".concat(this.getEpisodeNumber(),"m").concat(this.getMapNumber(),".json"),"json")).source,await this.importLevel(this.mapData,!0,!1);const e=this.getPlayer();if(e){for(const t in a)Zi(e,t,a[t].value);if(e.hasComponent(Fo)){const t=e.getComponent(Fo);t.right=(null==r?void 0:r.right)||"hand",t.left=(null==r?void 0:r.left)||"hand",t.prevWeapon.right=(null==l?void 0:l.right)||"hand",t.prevWeapon.left=(null==l?void 0:l.left)||"hand;"}}this.getSun().direction.y=h||0}}finally{this.run()}}}quickSave(){const e=this.getPlayer(),t=this.getSun(),n=e&&e.hasComponent(Fo)?e.getComponent(Fo):{right:"hand",left:"hand",prevWeapon:{right:"hand",left:"hand"}},i=this.saveData,s={version:fh,isTutorial:this.hasTutorial(),episodeNumber:this.getEpisodeNumber(),mapNumber:this.getMapNumber(),deaths:this.getDeaths().slice(),times:this.getTimes().slice(),secretIndex:this.getSecretIndex(),playerInventory:e&&e.hasComponent(is)?Lh()(e.getComponent(is).value):{},playerWeapon:{right:n.right,left:n.left},playerPrevWeapon:{right:n.prevWeapon.right,left:n.prevWeapon.left},time:t?t.direction.y:0};for(const e in s)i[e]=s[e];fa("save-data")}async quickLoad(){if(this.hasSaveData()){const{isTutorial:e,playerInventory:t,playerWeapon:n,playerPrevWeapon:i,time:s}=this.saveData;this.gamedata.isContinue=!0,this.gamedata.isHorde=!1,this.gamedata.isPractice=!1,this.gamedata.isPreview=!1,this.gamedata.isTutorial=!!e,await this.importLevel(this.mapData,!0,!1);const o=this.getPlayer();if(o){for(const e in t)Zi(o,e,t[e].value);if(o.hasComponent(Fo)){const e=o.getComponent(Fo);e.right=(null==n?void 0:n.right)||"hand",e.left=(null==n?void 0:n.left)||"hand",e.prevWeapon.right=(null==i?void 0:i.right)||"hand",e.prevWeapon.left=(null==i?void 0:i.left)||"hand"}}this.getSun().direction.y=s||0}}async newGame(e){this.gamedata.episodeNumber=e,this.gamedata.mapNumber=1,this.gamedata.secretIndex=-1;const t=this.getTimes(),n=this.getDeaths();me(t),me(n),this.stop(),n.push(0),this.gamedata.isContinue=!0,this.gamedata.isHorde=!1,this.gamedata.isPractice=!1,this.gamedata.isPreview=!1,this.gamedata.isTutorial=!1,this.mapData=(await Hn("./map/e".concat(this.getEpisodeNumber(),"m").concat(this.getMapNumber(),".json"),"json")).source,await this.importLevel(this.mapData,!0,!1),this.quickSave(),this.run()}async newHorde(e){this.gamedata.episodeNumber=e,this.gamedata.mapNumber=1,this.gamedata.secretIndex=-1;const t=this.getTimes(),n=this.getDeaths();me(t),me(n),this.stop(),n.push(0),this.gamedata.isContinue=!1,this.gamedata.isHorde=!0,this.gamedata.isPractice=!1,this.gamedata.isPreview=!1,this.gamedata.isTutorial=!1,this.mapData=(await Hn("./map/horde".concat(this.getEpisodeNumber(),".json"),"json")).source,await this.importLevel(this.mapData,!0,!1),this.run()}async continueLevel(){const e=this.getDeaths();if(e[e.length-1]=e[e.length-1]+1,this.setting.hasCheckPoint()){const e=this.getEntitys().find((e=>e.hasComponent(fl)&&e.getComponent(fl).enable))||null;if(null!==e&&e instanceof Mn)return e}const t=this.getPlayer();if(this.stop(),this.gamedata.isContinue=!0,this.gamedata.isHorde=!1,this.gamedata.isPractice=!1,this.gamedata.isPreview=!1,this.gamedata.isTutorial=!1,this.hasSaveData()){await this.quickLoad();const e=this.getPlayer();t&&e&&(Qi(e,"meat",es(t,"meat")),Qi(e,"sumscore",es(t,"sumscore")),Qi(e,"useshoppoint",es(t,"useshoppoint")))}else await this.importLevel(this.mapData,!0,!0);return this.quickSave(),this.run(),null}async nextLevel(e){const t=this.getPlayer();if(null===t)return;const n=t.getComponent(is),i=t.getComponent(Fo),s=es(t,"sumscore")+es(t,"score"),o=this.hasTutorial();e||o||this.gamedata.mapNumber++,this.stop();let a=null;try{this.mapData=(await Hn(e?"./map/e".concat(this.getEpisodeNumber(),"ms.json"):"./map/e".concat(this.getEpisodeNumber(),"m").concat(this.getMapNumber(),".json"),"json")).source;const t=this.getDeaths();t.push(0),this.gamedata.secretIndex=-1===this.gamedata.secretIndex&&e?t.length-1:this.getSecretIndex(),this.gamedata.isContinue=!0,this.gamedata.isHorde=!1,this.gamedata.isPractice=!1,this.gamedata.isPreview=!1,this.gamedata.isTutorial=!1,await this.importLevel(this.mapData,!0,!0);const a=this.getPlayer();if(null!==a&&!o){const e=a.getComponent(is),t=a.getComponent(Fo);if(void 0!==e){for(const t in n.value){const i=n.value[t];"gage"!==t&&"combo"!==t&&"score"!==t&&"key-red"!==t&&"key-blue"!==t&&"key-yellow"!==t||(i.value=0),e.value[t]=i}for(const t in e.value)n.value.hasOwnProperty(t)||delete e.value[t];Qi(a,"sumscore",s)}t&&(t.right=i.right,t.left=i.left,t.prevWeapon.right=i.prevWeapon.right,t.prevWeapon.left=i.prevWeapon.left)}this.quickSave()}catch(e){a=e}finally{this.run()}if(a)throw a}async previewLevel(e){this.gamedata.mapNumber=1,this.gamedata.isContinue=!1,this.gamedata.isHorde=!1,this.gamedata.isPractice=!1,this.gamedata.isPreview=!0,this.gamedata.isTutorial=!1,this.mapData=e,await this.importLevel(e,!0,!1)}async loadTutorial(){this.gamedata.episodeNumber=1,this.gamedata.mapNumber=1,this.gamedata.secretIndex=-1;const e=this.getTimes(),t=this.getDeaths();me(e),me(t),this.stop(),t.push(0),this.gamedata.isContinue=!1,this.gamedata.isHorde=!1,this.gamedata.isPractice=!1,this.gamedata.isPreview=!1,this.gamedata.isTutorial=!0,this.mapData=(await Hn("./map/tutorial.json","json")).source,await this.importLevel(this.mapData,!0,!1),this.quickSave(),this.run()}async loadPracticeArea(){this.gamedata.episodeNumber=1,this.gamedata.mapNumber=1,this.gamedata.secretIndex=-1;const e=this.getTimes(),t=this.getDeaths();me(e),me(t),this.stop(),t.push(0),this.gamedata.isContinue=!1,this.gamedata.isHorde=!1,this.gamedata.isPractice=!0,this.gamedata.isPreview=!1,this.gamedata.isTutorial=!1,this.mapData=(await Hn("./map/practice.json","json")).source,await this.importLevel(this.mapData,!0,!1),this.run()}async importLevel(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const{tileset:i,background:s,voxels:o,entitys:a,map:r,offset:l}=e,h=this.getEntitysOfName("sun")[0]||null;let p;this.stop(),this.clear(),t?(p=new yh("sun",25e-5,.001),p.direction.x=1.2875*Math.PI,p.direction.y=Math.PI-Math.PI/4*.1,n&&null!==h&&h instanceof Li&&(p.direction.y=h.direction.y)):(p=new Li("sun"),p.direction.x=1.2875*Math.PI,p.direction.y=Math.PI-.0125*Math.PI+(Math.PI+.025*Math.PI)*((this.getMapNumber()-1)/4)),this.setSun(p),this.addEntitys(p),this.setTileSet(ai[i]||null),this.setBackground(ri[s]||0);const c=this.getVoxelManager(),d={};this.setWorldSize(r.size.width,r.size.height,r.size.depth,l.top,l.bottom,l.front,l.back,l.right,l.left),c.addVoxels(...o.map(((e,t)=>d[t+1]=new Xn(e.position.x,e.position.y,e.position.z,e.front,e.back,e.right,e.left,e.top,e.bottom,e.flipXFront,e.flipYFront,e.flipXBack,e.flipYBack,e.flipXRight,e.flipYRight,e.flipXLeft,e.flipYLeft,e.flipXTop,e.flipYTop,e.flipXBottom,e.flipYBottom))));for(let e=0,t=0|r.size.width;e<t;e=e+1|0)for(let t=0,n=0|r.size.height;t<n;t=t+1|0)for(let n=0,i=0|r.size.depth;n<i;n=n+1|0)d[r.data[e][t][n]]&&this.setVoxel(e,t,n,d[r.data[e][t][n]],!1,!1),this.setDistanceField(e,t,n,r.distance_field[e][t][n]);this.getMap().finalize(),ue(a).asc((e=>"PLAYER"===e.id?0:1)),a.forEach((e=>{this.setting.hasNotSpawnActors()&&"PLAYER"!==e.id&&-1===e.id.indexOf("KEY_")&&"OBJECT_SHOP"!==e.id&&"GOLE"!==e.id&&"SECRET"!==e.id||Ll[e.id].spawn(e.position.x,e.position.y,e.position.z,e.direction.x,this)})),this.meatLength=-1,this.enemyLength=-1,this.killEnemy=0}addGoleTime(e){this.getTimes().push(e)}getEndIntermissionTime(){return 1e3+250*this.getTimes().length+600+1500}clear(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.player=null,e&&(this.gamedata.isContinue=!1,this.gamedata.isHorde=!1,this.gamedata.isPreview=!1,this.gamedata.isPractice=!1,this.gamedata.isTutorial=!1),super.clear()}hordeStats(e){const t=1e3*es(e,"hordetime",0),n=new Date(t),i=("0"+n.getUTCMinutes()).slice(-2),s=("0"+n.getUTCSeconds()).slice(-2),o=("0"+n.getUTCMilliseconds()).slice(-2),a=e.hasComponent(Gi)?(performance.now()-e.getComponent(Gi).startAddTime)/2e3:0,r=a<.75?Math.min(1,a/.125):1-(a-.75)/.25,l=t<3e4?t/3e4:1,h=[1,1*l,1*l];return[...this.hasHorde()?[new Fi("horde-time","./asset/font.png",5,5,di,"time limit",-1,-.9,1,1,1,1,h),new Fi("horde-time","./asset/font.png",5,5,di,"".concat(i,":").concat(s,":").concat(o),-1,-.8,1,1,1,1,h),new Fi("kill-count","./asset/font.png",5,5,di,"kill norma",1,-.9,1,-1,1,1,[1,1,1]),new Fi("kill-count","./asset/font.png",5,5,di,"".concat(this.getCountKillEnemy(),"/").concat(this.getMaxKillEnemy()),1,-.8,1,-1,1,1,[1,1,1]),...r>0?[new Fi("badge-effect","./asset/horde_badge.png",64,64,"012","".concat(e.hasComponent(Gi)?e.getComponent(Gi).bonusType:0),0,-.65,1*r,0,0,1*r),new Fi("badge-name","./asset/font.png",5,5,di,"".concat(to[e.hasComponent(Gi)?e.getComponent(Gi).bonusType:0]),0,-.5,1,0,0,1*r,[1,1,1]),new Fi("add-time-effect","./asset/font.png",5,5,di,"+ ".concat(e.hasComponent(Gi)?e.getComponent(Gi).addTimeValue:0," SEC"),.375,0,1,0,0,1*r,[1,1,0])]:[]]:[]]}statsBar(e){var t,n;if(!e.hasComponent(is)||!e.hasComponent(Fo))return[];const i=e.getComponent(Fo),s=(es(e,"health"),es(e,"health")),o=(es(e,"armor"),es(e,"armor")),a=es(e,"meat"),r=e.hasComponent(Fo)&&i.rightWeapon.data.ammoType||null,l=e.hasComponent(Fo)&&i.leftWeapon.data.ammoType||null,h=!!e.hasComponent(Fo)&&es(e,e.getComponent(Fo).rightWeapon.data.ammoType||"",0)>=(0===i.rightWeapon.data.ammoReduceMin?i.rightWeapon.data.ammoReduceMax:i.rightWeapon.data.ammoReduceMin),p=!!e.hasComponent(Fo)&&es(e,e.getComponent(Fo).leftWeapon.data.ammoType||"",0)>=(0===i.leftWeapon.data.ammoReduceMin?i.leftWeapon.data.ammoReduceMax:i.leftWeapon.data.ammoReduceMin),c=["stamina","clip","magazine","shell","rocket","cell"],d=!e.hasComponent(ji)||e.getComponent(ji).enable;return[...d?[]:[o>0?[new Fi("health-value","./asset/font.png",5,5,di,"".concat(s===1/0?"":Math.floor(s)),-.125,.9,2,-1,-1,1,[1,Math.min(1,s===1/0?1:s),s===1/0?1:s]),new Fi("health-icon","./asset/icon.png",5,5,ui,"0",-.125,.9,2,1,-1),new Fi("armor-value","./asset/font.png",5,5,di,"".concat(o===1/0?"":Math.floor(o)),.125,.9,2,-1,-1,1,[1,1,1]),new Fi("armor-icon","./asset/icon.png",5,5,ui,"1",.125,.9,2,1,-1)]:[new Fi("health-value","./asset/font.png",5,5,di,"".concat(s===1/0?"":Math.floor(s)),0,.9,2,-1,-1,1,[1,Math.min(1,s===1/0?1:s),s===1/0?1:s]),new Fi("health-icon","./asset/icon.png",5,5,"0123","0",0,.9,2,1,-1)],null===r?null:new Fi("right-ammo-value","./asset/font.png",5,5,di,"".concat(es(e,r,0)===1/0?"":es(e,r,0)),.75,.9,2,-1,-1,1,h?[1,1,1]:[.5,.25,.25]),null===r?null:new Fi("right-ammo-icon","./asset/icon.png",5,5,ui,"".concat(c.indexOf(r)+2),.75,.9,2,1,-1),null===l?null:new Fi("left-ammo-value","./asset/font.png",5,5,di,"".concat(es(e,l,0)===1/0?"":es(e,l,0)),-.75,.9,2,1,-1,1,p?[1,1,1]:[.5,.25,.25]),null===l?null:new Fi("left-ammo-icon","./asset/icon.png",5,5,ui,"".concat(c.indexOf(l)+2),-.75,.9,2,-1,-1),es(e,"key-yellow")>0?new Fi("key-yellow","./asset/key.png",7,14,"012","2",.05,.8,1,1,-1):null,es(e,"key-blue")>0?new Fi("key-blue","./asset/key.png",7,14,"012","1",0,.8,1,0,-1):null,es(e,"key-red")>0?new Fi("key-red","./asset/key.png",7,14,"012","0",-.05,.8,1,-1,-1):null],...d&&!(null===(t=e.getComponent(Gi).activeEntity)||void 0===t?void 0:t.hasComponent(qr))?[]:[new Fi("stamina-ammo-value","./asset/font.png",5,5,di,"".concat(es(e,"stamina",0)===1/0?"":Mh(es(e,"stamina")),"/").concat(Mh(ns(e,"stamina"))),-.75,.425+(d?.2:0),1,1,0,1,[1,1,1]),new Fi("stamina-ammo-icon","./asset/icon.png",5,5,ui,"".concat(c.indexOf("stamina")+2),-.75,.425+(d?.2:0),1,-1,0),new Fi("magazine-ammo-value","./asset/font.png",5,5,di,"".concat(es(e,"magazine",0)===1/0?"":Mh(es(e,"magazine")),"/").concat(Mh(ns(e,"magazine"))),-.75,.5+(d?.2:0),1,1,0,1,[1,1,1]),new Fi("magazine-ammo-icon","./asset/icon.png",5,5,ui,"".concat(c.indexOf("magazine")+2),-.75,.5+(d?.2:0),1,-1,0),new Fi("shell-ammo-value","./asset/font.png",5,5,di,"".concat(es(e,"shell",0)===1/0?"":Mh(es(e,"shell")),"/").concat(Mh(ns(e,"shell"))),-.75,.575+(d?.2:0),1,1,0,1,[1,1,1]),new Fi("shell-ammo-icon","./asset/icon.png",5,5,ui,"".concat(c.indexOf("shell")+2),-.75,.575+(d?.2:0),1,-1,0),new Fi("rocket-ammo-value","./asset/font.png",5,5,di,"".concat(es(e,"rocket",0)===1/0?"":Mh(es(e,"rocket")),"/").concat(Mh(ns(e,"rocket"))),-.75,.65+(d?.2:0),1,1,0,1,[1,1,1]),new Fi("rocket-ammo-icon","./asset/icon.png",5,5,ui,"".concat(c.indexOf("rocket")+2),-.75,.65+(d?.2:0),1,-1,0),new Fi("cell-ammo-value","./asset/font.png",5,5,di,"".concat(es(e,"cell",0)===1/0?"":Mh(es(e,"cell")),"/").concat(Mh(ns(e,"cell"))),-.75,.725+(d?.2:0),1,1,0,1,[1,1,1]),new Fi("cell-ammo-icon","./asset/icon.png",5,5,ui,"".concat(c.indexOf("cell")+2),-.75,.725+(d?.2:0),1,-1,0)],...!e.hasComponent(ji)||e.getComponent(ji).enable&&!(null===(n=e.getComponent(Gi).activeEntity)||void 0===n?void 0:n.hasComponent(qr))?[]:[new Fi("meat-value","./asset/font.png",5,5,di,"".concat(wh(a),"kg"),.75,.725+(d?.2:0),1,-1,0,1,[1,1,1])],...this.hasTutorial()||this.hasPractice()||this.hasPreview()||e.hasComponent(ji)&&e.getComponent(ji).enable?[]:[new Fi("meat-value","./asset/font.png",5,5,di,this.hasSecret()?"SECRET":"E".concat(this.getEpisodeNumber(),"M").concat(this.getMapNumber()),0,.65,1,0,0,1,[1,1,1])]]}reticle(e){if(!(e.hasComponent(is)&&e.hasComponent(Uo)&&e.hasComponent($o)&&e.hasComponent(Fo)))return[];const t=e.getComponent(Fo),n=performance.now(),i=e.getComponent(Gi),s=es(e,"gage"),o=es(e,"combo"),a=e.getComponent(Uo),r=n%100<50?n%100/50:1-(n%100-50)/50,l=o>=a.start,h=Math.min(1,(o-a.start)/(a.max-a.start)),p=l?r*h:1,c=l?0:1,d=l?1-r:1,u="rgba(".concat(Math.floor(255*p),",").concat(Math.floor(255*c),",").concat(Math.floor(255*d),", ").concat(i.isSlowMo?1:.5,")"),m="keyboard"===this.getControlManager().getInputType(),g=e.getComponent($o),f=m?t.rightWeapon:t.leftWeapon,y=m?t.leftWeapon:t.rightWeapon,w=Math.max(f.data.isReticle&&(null==f?void 0:f.spread)||0,y.data.isReticle&&(null==y?void 0:y.spread)||0,0),x=t.rightWeapon.data.ammoType||null,M=t.leftWeapon.data.ammoType||null,E=f.spread,C=y.spread,v=f.data.isReticle&&y.data.isReticle,b=this.getCamera().fov*this.getCamera().zoom,_=null!==x&&0===es(e,x,0)||null!==M&&0===es(e,M,0)||!f.data.isReticle||!y.data.isReticle;return[new Ri("reticle-center","rgba(255,255,255,0.5)",1,!0,1,0,0,.0025,0,2*Math.PI,!0,0,0),...t.isCanShoot?!_&&v?[...f.data.isReticle?Math.floor(1e3*E)/1e3<=0?[]:[new zi("reticle-top","rgba(255,255,255,0.25)",-E*b*2,-E*b*2,-E*b*2-.01,-E*b*2-.01,.0025),new zi("reticle-bottom","rgba(255,255,255,0.5)",E*b*2,E*b*2,E*b*2+.01,E*b*2+.01,.0025),new zi("reticle-left","rgba(255,255,255,0.25)",-E*b*2,E*b*2,-E*b*2-.01,E*b*2+.01,.0025),new zi("reticle-bottom","rgba(255,255,255,0.5)",E*b*2,-E*b*2,E*b*2+.01,-E*b*2-.01,.0025)]:[],...y.data.isReticle?Math.floor(1e3*C)/1e3<=0?[]:[new Di("reticle-top","rgba(255,255,255,0.5)",!0,1,0,-C*b*2.5-.01,.0025,.01,0,0),new Di("reticle-bottom","rgba(255,255,255,0.5)",!0,1,0,C*b*2.5+.01,.0025,.01,0,0),new Di("reticle-left","rgba(255,255,255,0.5)",!0,1,-C*b*2.5-.01,0,.01,.0025,0,0),new Di("reticle-right","rgba(255,255,255,0.25)",!0,1,C*b*2.5+.01,0,.01,.0025,0,0)]:[]]:[...f.data.isReticle||y.data.isReticle?Math.floor(1e4*w)/1e3<=0?[]:[new Di("reticle-top","rgba(255,255,255,0.5)",!0,1,0,-w*b*2.5-.01,.0025,.01,0,0),new Di("reticle-bottom","rgba(255,255,255,0.5)",!0,1,0,w*b*2.5+.01,.0025,.01,0,0),new Di("reticle-left","rgba(255,255,255,0.5)",!0,1,-w*b*2.5-.01,0,.01,.0025,0,0),new Di("reticle-right","rgba(255,255,255,0.5)",!0,1,w*b*2.5+.01,0,.01,.0025,0,0)]:[]]:[],...t.rightWeapon.isShootable&&"hand"===t.right&&"hookshot"===ts(e,"hand","none")&&0===t.rightWeapon.bullets.length||t.leftWeapon.isShootable&&"hand"===t.left&&"hookshot"===ts(e,"hand","none")&&0===t.leftWeapon.bullets.length?[new Fi("hook-icon","./asset/icon.png",5,5,ui,"+",0,.1,2,0,0,.75,null===f.shootableTarget?[1,1,1]:[1,0,0])]:[],...t.rightWeapon.isShootable&&"hand"===t.right&&"punch"===ts(e,"hand","none")&&t.rightWeapon.isChargeMax||t.leftWeapon.isShootable&&"hand"===t.left&&"punch"===ts(e,"hand","none")&&t.leftWeapon.isChargeMax?[new Fi("hook-icon","./asset/icon.png",5,5,ui,"9",0,.1,2,0,0,.75,[1,0,0])]:[],n-i.killTime<250?new Fi("kill-icon","./asset/icon.png",5,5,ui,"8",0,0,0+2*Math.min(1,(n-i.killTime)/100),0,0,1,[1,0,0]):[],new Ri("combo-arc",u,1,!1,1,0,0,.05,-Math.PI/2+2*Math.PI*s,-Math.PI/2),o>=a.start?new Fi("combo-text","./asset/font.png",5,5,di,"".concat(Qs[o-1]),0,.2,6-3*(-1===i.comboTime?1:Math.min(1,(i.time-i.comboTime)/.25)),0,0,i.isSlowMo?1:.5,[p,c,d]):null,...t.rightWeapon.data.shootType===wo.CHARGE||t.rightWeapon.data.shootType===wo.SPIN?[t.rightWeapon.data.chargeTime>0?new Ri("charge-arc-right-background","rgba(125,125,125,0.25)",1,!1,2,0,0,.15,-Math.PI/2+Math.PI/4+Math.PI/8,-Math.PI/2+Math.PI/8):null,t.rightWeapon.chargePar>0?new Ri("charge-arc-right","rgba(255,255,255,0.25)",1,!1,2,0,0,.15,-Math.PI/2+Math.PI/4*t.rightWeapon.chargePar+Math.PI/8,-Math.PI/2+Math.PI/8):null,t.rightWeapon.data.chargeTime>0?new Fi("chrage-text","./asset/font.png",5,5,di,t.rightWeapon.data.shootType===wo.SPIN?"spin":"charge",.25,-.25,1,1,0,t.rightWeapon.chargePar>=1?1:.5,[1,1,1]):null]:[],...t.leftWeapon.data.shootType===wo.CHARGE||t.leftWeapon.data.shootType===wo.SPIN?[t.leftWeapon.data.chargeTime>0?new Ri("charge-arc-left-background","rgba(125,125,125,0.25)",1,!1,2,0,0,.15,-Math.PI/2-Math.PI/8,-Math.PI/2-Math.PI/4-Math.PI/8):null,t.leftWeapon.chargePar>0?new Ri("charge-arc-left","rgba(255,255,255,0.25)",1,!1,2,0,0,.15,-Math.PI/2-Math.PI/4*t.leftWeapon.chargePar-Math.PI/8,-Math.PI/2-Math.PI/8,!1):null,t.leftWeapon.data.chargeTime>0?new Fi("chrage-text","./asset/font.png",5,5,di,t.leftWeapon.data.shootType===wo.SPIN?"spin":"charge",-.25,-.25,1,-1,0,t.leftWeapon.chargePar>=1?1:.5,[1,1,1]):null]:[],g.exec?new Ri("wallrun-arc-background","rgba(125,125,125,0.25)",1,!1,2,0,0,.15,Math.PI/2+Math.PI/4,Math.PI/2-Math.PI/4):null,g.exec?new Ri("wallrun-arc","rgba(255,255,255,0.25)",1,!1,2,0,0,.15,Math.PI/2+Math.PI/4,Math.PI/2-Math.PI/4+Math.PI/2*g.par):null,e.hasComponent(ia)&&(i.isSprint||e.getComponent(ia).enableTacticalSprint)?new Fi("sprint-text","./asset/font.png",5,5,di,e.getComponent(ia).enableTacticalSprint?"tac sprint":"sprint",0,.375,1,0,-1):null]}BloodScreen(e){const t=(es(e,"health"),es(e,"health"));return t<50?[new Ri("blood-screen",["rgba(0,0,0,0.0)","rgba(255,0,0,".concat(.5*(1-t/50),")")],.75,!0,0,0,0,1.125,0,2*Math.PI,!0,0,0)]:[]}ZoomAnimation(e){const t=e.getComponent(Gi);return[t.zoomAnimationPar>0?new Ri("zoom-fog",["rgba(0,0,0,0.0)","rgba(0,0,0,1.0)"],.5*t.zoomAnimationPar,!0,0,0,0,1.125,0,2*Math.PI,!0,0,0):new Di("zoom-fog","rgb(0,0,0)",!0,0,0,0,10,10,0,0)]}shopHUD(e){const t=e.getComponent(Gi),[n,i,s,o]=js(e);return[...null!==t.activeEntity&&t.activeEntity.hasComponent(qr)&&t.activeEntity.getComponent(qr).sale<1?[new Di("sale-background","rgba(0,0,0,0.75)",!0,1,.65,-1,.275,.125,0,1),new Fi("sale-number","./asset/font.png",5,5,di,"".concat(Math.round(100*(1-t.activeEntity.getComponent(qr).sale)),"%off"),.65,-.825,3,0,-1,1,[1,1,1])]:[],new Di("buy-gage-background","rgba(0,0,0,0.75)",!0,1,-.65,-1,.275,null===n?.075:.275,0,1),...0===o?[new Di("buy-gage-background","rgba(255,255,255,0.25)",!0,1,-.65,-.9,.25,.025,0,-1),new Di("buy-gage-value","rgba(255,255,255,0.5)",!0,1,-.9,-.9,.25,.025,1,-1)]:[new Di("buy-gage-background","rgba(255,255,255,0.25)",!0,1,-.65,-.9,.25,.025,0,-1),new Di("buy-gage-value","rgba(255,255,255,0.5)",!0,1,-.9,-.9,.25*i,.025,1,-1)],...0===o?[new Fi("buy-gage-number","./asset/font.png",5,5,di,"max rank!",-.65,-.875,1,0,0,1,[1,1,1])]:[new Fi("buy-gage-number","./asset/font.png",5,5,di,"".concat(wh(s),"kg/").concat(wh(o),"kg"),-.65,-.875,1,0,0,1,[1,1,1])],...null===n?[]:[new Hi("members-card",n,-.65,-.65,.75,.75)]]}intermission(e){const t=performance.now()-e.getComponent(Gi).intermissionTime,n=es(e,"sumscore")+es(e,"score"),i=this.getTimes();return[new Di("intermission-background","rgb(0,0,0)",!0,0,0,0,10,10,0,0),new Hi("title","./asset/title-prod.png",0,-.625,1,1,null,null,null,null,0,0,Math.max(0,Math.min(1,(t-500)/250))),new Fi("intermission-episode","./asset/font.png",5,5,di,"episode ".concat(this.getEpisodeNumber()),0,-.5,2,0,0,Math.max(0,Math.min(1,(t-500)/250)),[1,1,1]),...i.map(((e,n)=>{const i=new Date(e);return new Fi("intermission-result","./asset/font.png",5,5,di,"".concat(-1!==this.getSecretIndex()?"".concat(n===this.getSecretIndex()?"SECRET":"MAP".concat(n+1+(n>this.getSecretIndex()?-1:0))):"MAP".concat(n+1)," TIME/").concat(xh(i.getMinutes())," ").concat(xh(i.getSeconds())," ").concat(xh(i.getMilliseconds()/10|0)," DEATH/").concat(this.getDeaths()[n]||0),0,.1*n-.25,1,0,-1,Math.max(0,Math.min(1,(t-(1e3+100*n))/250)),[1,1,1])})),new Fi("intermission-score","./asset/font.png",5,5,di,"SCORE/".concat(n),0,.5,2,0,-1,Math.max(0,Math.min(1,(t-(1e3+250*this.getTimes().length+500))/100)),[1,1,1]),new Fi("intermission-message","./asset/font.png",5,5,di,"THANK YOU FOR PLAYING",0,.75,3,0,-1,Math.max(0,Math.min(1,(t-(1e3+250*this.getTimes().length+600+1e3))/500)),[1,1,0])]}gameOver(e){if(!e.hasComponent(Gi))return[];const t=performance.now(),n=e.getComponent(Gi);let i=0;i=t-n.deathTime>1e3?Math.min(1,(t-n.deathTime-1e3)/500):0;const s="rgba(0,0,0,".concat(i,")"),o=es(e,"score");return[...this.BloodScreen(e),...this.hasHorde()&&this.setting.hasCheckPoint()?this.hordeStats(e):[],new Di("gameover-background",s,!0,0,0,0,10,10,0,0),new Fi("gameover-message","./asset/font.png",5,5,di,"YOU DIED!",0,-.375,5,0,-1,1,[1,0,0]),...this.hasHorde()&&this.setting.hasCheckPoint()?[]:[new Fi("gameover-score","./asset/font.png",5,5,di,"MEAT MILEAGE ".concat(wh(o),"kg"),0,0,1,0,0,1,[1,1,1])],-1!==n.deathTime&&(this.hasHorde()&&5-Math.floor((performance.now()-n.deathTime)/1e3)>0||i>=1&&t%2e3>1e3)?new Fi("gameover-continue","./asset/font.png",5,5,di,this.setting.hasPermaDeath()?"press ".concat("keyboard"!==this.getControlManager().getInputType()?"a":"mouse left"," return title"):this.setting.hasCheckPoint()?this.hasHorde()&&(performance.now()-n.deathTime)/1e3<5?"RESPAWN IN ".concat(5-Math.floor((performance.now()-n.deathTime)/1e3)):"press ".concat("keyboard"!==this.getControlManager().getInputType()?"a":"mouse left"," respawn"):"press ".concat("keyboard"!==this.getControlManager().getInputType()?"a":"mouse left"," restart"),0,.5,2,0,0,1,[1,1,1]):null]}stageClear(e){if(!e.hasComponent(Gi))return[];const t=performance.now(),n=e.getComponent(Gi);let i=0;i=t-n.goleTime>1e3?Math.min(1,(t-n.goleTime-1e3)/500):0;const s="rgba(0,0,0,".concat(i,")"),o=es(e,"score",0),a=new Date(1e3*n.gole),r=new Array;let l="",h=0;if(this.hasHorde()){const t=this.getCountKillEnemy(),n=Math.floor(es(e,"hordetime",0)),i=t>=this.getMaxKillEnemy();r.push(...i||t>0?["KILL BONUS ".concat(t," / ").concat(this.getMaxKillEnemy()," X ").concat(1e3)]:[],...i||n>0?["TIME BONUS ".concat(n," SEC X ").concat(2500)]:[],...i||o>0?["MEAT MILEAGE ".concat(wh(o),"kg")]:[]),h=1e3*t+2500*n+o,l="TOTAL SCORE ".concat(h)}else this.hasTutorial()||(r.push("TIME ".concat(xh(a.getMinutes())," ").concat(xh(a.getSeconds())," ").concat(xh(a.getMilliseconds()/10|0)),"MEAT MILEAGE ".concat(wh(o),"kg")),this.meatLength>0&&r.push("PICK PUT MEAT ".concat(this.meatLength-this.getEntitysOfName("meat").length,"/").concat(this.meatLength)),this.enemyLength>0&&r.push("KILL ENEMY ".concat(this.enemyLength-this.getEntitysOfName("enemy").filter((e=>!e.getNames().some((e=>"not-count"===e)))).length,"/").concat(this.enemyLength)));return[this.BloodScreen(e),new Di("stageclear-background",s,!0,0,0,0,10,10,0,0),new Fi("stageclear-message","./asset/font.png",5,5,di,this.hasHorde()?"HORDE ENDED":"LEVEL COMPLETE",0,-.45,5,0,-1,1,[1,1,0]),new Fi("stageclear-message","./asset/font.png",5,5,di,this.hasHorde()?"MAP HORDE".concat(this.getEpisodeNumber()):this.hasTutorial()?"":"E".concat(this.getEpisodeNumber(),"M").concat(this.getMapNumber()),0,-.375,2,0,-1,1,[1,1,1]),...r.map(((e,t)=>new Fi("result-log","./asset/font.png",5,5,di,e,0,.125*t-.25,1,0,0,1,[1,1,1]))),this.hasHorde()?new Fi("horde-result","./asset/font.png",5,5,di,l,0,.25,2,0,0,1,[1,1,1]):null,this.hasHorde()?new Fi("horde-result","./asset/font.png",5,5,di,"".concat(qs(h)[0]),.75,.25,5,0,0,1,qs(h)[1]):null,i>=1&&t%2e3>1e3?new Fi("stageclear-continue","./asset/font.png",5,5,di,this.hasHorde()?"press ".concat("keyboard"!==this.getControlManager().getInputType()?"a":"mouse left"," return title"):"press ".concat("keyboard"!==this.getControlManager().getInputType()?"a":"mouse left"," continue"),0,.5,2,0,0,1,[1,1,1]):null]}hordeCountdown(e){const t=e.getComponent(Gi);return[new Fi("horde-countdown","./asset/font.png",5,5,di,"".concat(Math.ceil(5-Math.min(5,t.hordeStartTime))),0,0,5,0,0,1,[1,1,1])]}respawn(e){return[new Di("respawn-fog","rgb(0,0,0)",!0,0,0,0,10,10,0,0)]}countKillEnemy(){(!this.hasHorde()||this.killEnemy<this.getMaxKillEnemy())&&this.killEnemy++}getCountKillEnemy(){return this.killEnemy}createTransferUIData(){const e=this.getPlayer();if(null!==e&&e.hasComponent(Gi)){const t=e.getComponent(Gi);if(-1!==t.intermissionTime)return this.intermission(e);if(-1!==t.deathTime)return this.gameOver(e);if(-1!==t.goleTime)return this.stageClear(e);if(-1!==t.respawnTime)return this.respawn(e);if(this.hasHorde()&&t.hordeStartTime<5)return this.hordeCountdown(e);if(null!==t.activeEntity&&t.activeEntity.hasComponent(ol))return[new Ri("reticle-center","rgba(255, 255, 255, 0.75)",1,!0,1,0,0,.005,0,2*Math.PI,!0,0,0),new Fi("menu","./asset/font.png",5,5,di,"mode change to (".concat(this.getControlManager().getKey("weapon-wheel"),")"),1,.9,1,-1,-1,1,[1,1,1]),new Fi("menu","./asset/font.png",5,5,di,"exit to (".concat("keyboard"===this.getControlManager().getInputType()?"f":"b",")"),-1,.9,1,1,-1,1,[1,1,1]),...Ji(this.getCamera().hasComponent(al)?this.getCamera():e,this,0,0,.45)];{const n=new Array;if(!e.hasComponent(ji)||!e.getComponent(ji).enable){const i=this.getControlManager();e.hasComponent(la)&&e.getComponent(la).hasDoorMessage?n.push("press (".concat(i.getKey("use"),") open")):!e.hasComponent(la)||!t.isWaitActive||e.hasComponent(Gi)&&null!==e.getComponent(Gi).activeEntity?null!==t.pickMessage&&n.push(t.pickMessage):n.push("press (".concat(i.getKey("use"),") active")),e.hasComponent(ss)&&e.getComponent(ss).canJump&&n.push("press (".concat(i.getKey("jump"),") to jump")),e.hasComponent(ss)&&e.getComponent(ss).canClimb&&n.push("press (".concat(i.getKey("jump"),") or (").concat(i.getKey("sprint"),") to climb")),e.hasComponent(ss)&&e.getComponent(ss).exec&&!e.getComponent(ss).climb&&!e.getComponent(ss).canJump&&e.getComponent(ss).canMove&&n.push("".concat("gamepad"===i.getInputType()?"(left stick)":"(".concat(i.getKey("left","keyboard"),") or (").concat(i.getKey("right","keyboard"),")")," to move")),e.hasComponent(ss)&&e.getComponent(ss).exec&&!e.getComponent(ss).climb&&n.push("press (".concat(i.getKey("cluch"),") to grab cancel")),e.hasComponent(Fo)&&!t.isWaitActive&&(e.getComponent(Fo).rightWeapon.isChargeEnable&&e.getComponent(Fo).rightWeapon.data.shootType===wo.CHARGE||e.getComponent(Fo).leftWeapon.isChargeEnable&&e.getComponent(Fo).leftWeapon.data.shootType===wo.CHARGE)&&n.push("press (".concat(i.getKey("use"),") to charge cancel"))}const i=!e.hasComponent(ji)||e.getComponent(ji).enable;return[...t.isZoomAnimation?this.ZoomAnimation(e):[],...!this.setting.hasHUD()||t.isPause?[]:this.BloodScreen(e),...!this.setting.hasHUD()||t.isPause?[]:this.hordeStats(e),...!this.setting.hasHUD()||t.isPause?[]:[new Di("pickup-flash","rgba(255, 255, 0, ".concat(.125*(-1===t.pickupTime?0:1-(t.time-t.pickupTime)/.1),")"),!0,0,0,0,10,10,0,0)],...!this.setting.hasHUD()||t.isPause?[]:[new Di("powerup-flash","rgba(255, 0, 255, ".concat(.375*(-1===t.powerupTime?0:1-(t.time-t.powerupTime)/.1),")"),!0,0,0,0,10,10,0,0)],...!this.setting.hasHUD()||t.isPause||i?[]:this.reticle(e),...!this.setting.hasHUD()||t.isPause?[]:this.statsBar(e),...!this.setting.hasHUD()||t.isPause?[]:e instanceof Mn?t.damages.map((n=>new Ri("damage-flash","rgba(255, 0, 0, ".concat(.125*(-1===n.time?0:1-(t.time-n.time)/1),")"),1,!1,2,0,0,.25,W(n.position.x,n.position.z,e.position.x,e.position.z)-e.direction.x+Math.PI/8-Math.PI/2,W(n.position.x,n.position.z,e.position.x,e.position.z)-e.direction.x-Math.PI/8-Math.PI/2,!0,0,0))):[],...i?[new Di("background","rgba(0,0,0,0.5)",!0,0,0,0,10,10,0,0)]:[],...t.helpMessages.map(((e,t)=>new Fi("info-message","./asset/font.png",5,5,di,e,0,.05*t-.375,1,0,0,1,[1,1,1]))),...!this.setting.hasHUD()||t.isPause?[]:n.map(((e,t)=>new Fi("info-messages","./asset/font.png",5,5,di,e,0,.525+.05*t,1,0,0,1,[1,1,1]))),...t.isPause?[]:Ji(this.getCamera().hasComponent(al)?this.getCamera():e,this,0,0,.45),...null===t.activeEntity&&i&&e.hasComponent(Fo)?[new Fi("equip-weapon-right","./asset/font.png",5,5,di,"".concat($i(e,e.getComponent(Fo).right,null),"\n\n").concat(this.getControlManager().getKey("fire-right")),1,.8,2,0,-1,1,[1,1,1]),new Fi("equip-weapon-left","./asset/font.png",5,5,di,"".concat($i(e,e.getComponent(Fo).left,null),"\n\n").concat(this.getControlManager().getKey("fire-left")),-1,.8,2,0,-1,1,[1,1,1])]:[],...!this.hasPractice()&&null!==t.activeEntity&&t.activeEntity.hasComponent(qr)&&es(e,"useshoppoint",0)>0?this.shopHUD(e):[]]}}return[]}onupdate(e){super.onupdate(e),-1===this.meatLength&&(this.meatLength=this.getEntitysOfName("meat").length),-1===this.enemyLength&&(this.enemyLength=this.getEntitysOfName("enemy").filter((e=>!e.getNames().some((e=>"not-count"===e)))).length)}async onactive(e){await za(),!f()&&this.setting.hasBrowserFullscreen()&&await ka()}}class Vh extends Ui{constructor(){super(),this.mode=0,this.isStick=!1,this.pallets=new Array,this.cmda=new E(0,0),this.isFullscreen=!1,this.isPointerLock=!1,this.voxelMode=0}}class Xh extends Mn{constructor(e,t,n,i,s,o){super(e.length>0?"pawn ".concat(e):"pawn",new Cn(o.getMaterial(),2,0,1,!1,!1),new vn(!0,!1,!0,.5),new En(1,1)),this.pawn=o,this.position.x=Math.floor(t)+.5,this.position.y=Math.floor(n),this.position.z=Math.floor(i)+.5,this.direction.x=s}}const jh={THEME:0,BACKGROUND:1,VOXEL:2,TEXTURE:3,PLAYER:4,SPAWNER:5,ITEM:6,WEAPON:7,ENEMY:8,TUTORIAL:9,MOVIE:10};class Kh{constructor(){this.speed=0}}class Jh{constructor(e){this.target=e}}class qh extends Mn{constructor(e){super("angle",new Cn(oi.UI_ANGLE,1,0,1,!1,!1),new vn(!1,!0,!1,0),new Jh(e))}}class Zh extends Bi{constructor(e,t,n){let i;super(Vh,jo),this.keys={},this.presss={},this.toggles={},this.releases={},this.updateButtons={},this.keyWalk=new E(0,0),this.walk=new E(0,0),this.look=new E(0,0),this.oldWalk=new E(0,0),this.oldLook=new E(0,0),this.lookInputType=null,this.isUpdateWalkToKeyboard=!0,this.isAxesUpdateWalkX=!1,this.isAxesUpdateWalkY=!1,this.isAxesUpdateLookX=!1,this.isAxesUpdateLookY=!1,this.isResetLookX=!1,this.isResetLookY=!1,this.isResetWalkX=!1,this.isResetWalkY=!1,this.lockLockTime=0,this.activeSceneName="none",this.isChangeTime=!1,this.isTimeLaps=!1,this.setting=e,this.scenes=t,this.controls=n,n.axes(((e,i,s)=>{var o;if(!Rn()&&t.getActiveSceneName()===this.activeSceneName&&(null===(o=t.getScene(this.activeSceneName))||void 0===o?void 0:o.hasRun()))switch(e){case"x":this.isAxesUpdateWalkX?(this.walk.x=Math.abs(this.walk.x)>Math.abs(i)?this.walk.x:-i,this.oldWalk.x=Math.abs(this.oldWalk.x)<Math.abs(i)?this.oldWalk.x:-i,this.isResetWalkX=0===i):0===i?(this.walk.x=0,this.oldWalk.x=0):(this.walk.x=-i,this.oldWalk.x=-i,this.isAxesUpdateWalkX=!0),this.isAxesUpdateWalkY?(this.walk.y=Math.abs(this.walk.y)>Math.abs(s)?this.walk.y:s,this.oldWalk.y=Math.abs(this.oldWalk.y)<Math.abs(s)?this.oldWalk.y:s,this.isResetWalkY=0===s):0===s?(this.walk.y=0,this.oldWalk.y=0):(this.walk.y=s,this.oldWalk.y=s,this.isAxesUpdateWalkY=!0);break;case"y":this.lookInputType=n.getInputType(),this.isAxesUpdateLookX?"gamepad"===this.lookInputType?(this.look.x=Math.abs(this.look.x)>Math.abs(i)?this.look.x:i,this.oldLook.x=Math.abs(this.oldLook.x)<Math.abs(i)?this.oldLook.x:i,this.isResetLookX=0===i):(this.look.x+=i,this.oldLook.x+=i,this.isResetLookX=!0):0===i?(this.look.x=0,this.oldLook.x=0):(this.look.x=i,this.oldLook.x=i,this.isAxesUpdateLookX=!0),this.isAxesUpdateLookY?"gamepad"===this.lookInputType?(this.look.y=Math.abs(this.look.y)>Math.abs(s)?this.look.y:s,this.oldLook.y=Math.abs(this.oldLook.y)<Math.abs(s)?this.oldLook.y:s,this.isResetLookY=0===s):(this.look.y+=s,this.oldLook.y+=s,this.isResetLookY=!0):0===s?(this.look.y=0,this.oldLook.y=0):(this.look.y=s,this.oldLook.y=s,this.isAxesUpdateLookY=!0)}else this.walk.x=0,this.walk.y=0,this.look.x=0,this.look.y=0,this.oldWalk.x=0,this.oldWalk.y=0,this.oldLook.x=0,this.oldLook.y=0})),n.press(((e,n)=>{var i;const s=performance.now();if(!Rn()&&t.getActiveSceneName()===this.activeSceneName&&(null===(i=t.getScene(this.activeSceneName))||void 0===i?void 0:i.hasRun())){if(-1!==e.indexOf("gamepad_")||-1!==e.indexOf("touchpad_")||Na()){let i=!1;this.updateButtons[e]?this.releases[e]||n||(this.releases[e]=!0):(this.toggles[e]!==n&&(i=!0),this.enablePresss(e,n,i,t,s),this.toggles[e]=n,this.updateButtons[e]=!0)}}else{for(const e in this.keys)this.keys[e]=0;for(const e in this.presss)this.presss[e]=0;for(const e in this.releases)this.enablePresss(e,!1,!1,this.scenes,s),delete this.releases[e];for(const e in this.updateButtons)delete this.updateButtons[e]}})),n.editor((e=>{var n;if("editor"===t.getActiveSceneName()&&(null===(n=t.getActiveScene())||void 0===n?void 0:n.hasRun())&&!Rn()){const n=t.getActiveScene();if(null===n||!(n instanceof op))return;const s=()=>{this.clearControls(),"editor"===t.getActiveSceneName()&&(!f()&&this.setting.hasBrowserFullscreen()&&ka(),za(),i=setTimeout((()=>n.run()),500))};switch(e){case"open":clearTimeout(i),Da(),n.stop(),n.openMap().finally(s);break;case"save":clearTimeout(i),Da(),n.stop(),n.saveMap().finally(s);break;case"new":clearTimeout(i),Da(),n.newMap(!0);break;case"build":n.stop(),n.getMap().refleshDistanceField().then((()=>{n.run()}));break;case"preview":clearTimeout(i),n.previewMap()}}}))}enablePresss(e,t,n,i,s){const o=this.controls;switch(!0){case o.hasKey("forward",e):this.keyWalk.y=t?1:1===this.keyWalk.y?0:this.keyWalk.y,this.isUpdateWalkToKeyboard=!0;break;case o.hasKey("back",e):this.keyWalk.y=t?-1:-1===this.keyWalk.y?0:this.keyWalk.y,this.isUpdateWalkToKeyboard=!0;break;case o.hasKey("left",e):this.keyWalk.x=t?1:1===this.keyWalk.x?0:this.keyWalk.x,this.isUpdateWalkToKeyboard=!0;break;case o.hasKey("right",e):this.keyWalk.x=t?-1:-1===this.keyWalk.x?0:this.keyWalk.x,this.isUpdateWalkToKeyboard=!0;break;case o.hasKey("weapon-wheel",e):case o.hasKey("weapon-wheel-right",e):case o.hasKey("weapon-wheel-left",e):this.keys.mode_change=t?s:0;break;case"touchpad_select"===e:case"gamepad_select"===e:this.keys.start=t?s:0;break;case"touchpad_start"===e:case"gamepad_start"===e:case"keyboard_escape"===e:this.keys.escape=t?s:0;break;case"touchpad_a"===e:case"gamepad_rt"===e:case"mouse_left"===e:this.keys.primary=t?s:0;break;case"touchpad_b"===e:case"gamepad_lt"===e:case"mouse_right"===e:this.keys.secondary=t?s:0;break;case"mouse_wheel_up"===e:case"gamepad_right"===e:this.keys.add=t?s:0;break;case"mouse_wheel_down"===e:case"gamepad_left"===e:this.keys.sub=t?s:0}}clearControls(){this.controls.clear();for(const e in this.keys)this.keys[e]=0;this.keyWalk.x=0,this.keyWalk.y=0,this.updateWalk()}updateWalk(){const e=Math.min(T(this.keyWalk.x,this.keyWalk.y,0,0),1),t=W(this.keyWalk.x,this.keyWalk.y,0,0),n=Math.cos(t)*e,i=Math.sin(t)*e;this.isAxesUpdateWalkX?(this.walk.x=Math.abs(this.walk.x)>Math.abs(n)?this.walk.x:-n,this.oldWalk.x=Math.abs(this.oldWalk.x)<Math.abs(n)?this.oldWalk.x:-n):0===n?(this.walk.x=0,this.oldWalk.x=0):(this.walk.x=n,this.oldWalk.x=n,this.isAxesUpdateWalkX=!0),this.isAxesUpdateWalkY?(this.walk.y=Math.abs(this.walk.y)>Math.abs(i)?this.walk.y:i,this.oldWalk.y=Math.abs(this.oldWalk.y)<Math.abs(i)?this.oldWalk.y:i):0===i?(this.walk.y=0,this.oldWalk.y=0):(this.walk.y=i,this.oldWalk.y=i,this.isAxesUpdateWalkX=!0)}additional(e,t,n){const i=t.getComponent(Vh),o=n.getCamera();this.activeSceneName=n.getName();for(const e in this.keys)i.keys[e]=this.keys[e];n.getSoundManager().setVolume(this.setting.getSoundVolume());const a=t.getComponent(jo);if(!t.hasComponent(ji)||!t.getComponent(ji).enable){const t=n instanceof op?this.setting.getSensibility():1;i.cmda.x=this.look.x*t/o.zoom*s("gamepad"===this.lookInputType?e/n.getSpeed():1,0)*(n instanceof op&&this.setting.hasInvertX()?-1:1),i.cmda.y=this.look.y*t/o.zoom*s("gamepad"===this.lookInputType?e/n.getSpeed():1,0)*(n instanceof op&&this.setting.hasInvertX()?-1:1)}a.move.x=this.walk.x,a.move.z=this.walk.y,a.look.x=t.direction.x,a.look.y=t.direction.y,i.axes.x.x=Math.min(1,Math.max(-1,this.walk.x)),i.axes.x.y=Math.min(1,Math.max(-1,this.walk.y)),i.axes.y.x=Math.min(1,Math.max(-1,this.look.x)),i.axes.y.y=Math.min(1,Math.max(-1,this.look.y)),n.getSoundManager().setVolume(1)}offset(e,t,n){const i=performance.now(),s=n.getControlManager(),{position:o,direction:a}=t,r=t.getComponent(Vh);this.setting.hasBrowserFullscreen()&&!_a()&&(this.keys.escape=i);const l=_a(),h=Na(),p=s.getInputType();if(!Rn()&&((f()||"gamepad"===p||"touchpad"===p?this.keys.escape>0&&this.keys.escape!==this.presss.escape:!f()&&!l&&l!==r.isFullscreen)||"keyboard"===p&&!h&&h!==r.isPointerLock)){const e=n.getSceneManager();n instanceof op&&n.save(),e.activeScene("title")}if(r.isFullscreen=l,r.isPointerLock=h,n instanceof op)if(this.keys.start&&i-this.keys.start>250){if(this.keys.start=0,this.presss.start=0,n.newMap(!0))return}else!this.keys.start&&this.presss.start&&this.keys.start!==this.presss.start&&n.previewMap();const[c,d,u]=n.getWorldSize(),[m,g,y,,x]=n.hitScan("range",a.x,a.y,o.x,o.y,o.z,1/0,[t.getID()]),[M,E,C]=A(a.x,a.y,0,0,1/256);let v=Math.floor(m+M),b=Math.floor(g+E),_=Math.floor(y+C);if(this.keys.mode_change&&i-this.keys.mode_change>this.setting.getWeaponWheelStandTime()?this.keys.menu||(this.keys.menu=i):this.keys.menu||this.keys.mode_change||!this.presss.mode_change?this.keys.menu=0:(r.mode++,r.mode>=Object.values(jh).length&&(r.mode=0)),r.mode!==jh.MOVIE&&(this.isChangeTime=!1,this.isTimeLaps=!1),!this.keys.menu)switch(r.mode){case jh.VOXEL:if((!(n instanceof Ti)||!n.hasOutOfWorld(v,b,_))&&this.keys.primary&&this.keys.primary!==this.presss.primary){const[e,t]=N(m,g,y,Math.floor(v)+.5,Math.floor(b)+.5,Math.floor(_)+.5);switch(!0){case t<-Math.PI/4:b+=1;break;case t>Math.PI/4:b-=1;break;case Math.abs(e)>Math.PI/4*3:v-=1;break;case Math.abs(e)<Math.PI/4:v+=1;break;case e<-Math.PI/4:_-=1;break;case e>Math.PI/4:_+=1}const i=r.pallets[r.mode];n instanceof Ti&&n.hasOutOfWorld(v,b,_)||n.getVoxel(v,b,_)!==li||!(i instanceof Xn)||n.setVoxel(v,b,_,i,!0,!0)}if((!(n instanceof Ti)||!n.hasOutOfWorld(v,b,_))&&this.keys.secondary&&this.keys.secondary!==this.presss.secondary){const e=2*n.getMargin()+1;(c>e||d>e||u>e)&&n.setVoxel(v,b,_,li,!0,!0)}break;case jh.TEXTURE:const e=r.pallets[r.mode];if(!(n instanceof Ti&&n.hasOutOfWorld(v,b,_)||n.getVoxel(v,b,_)===li||"string"!=typeof e)&&this.keys.primary&&this.keys.primary!==this.presss.primary){const[t,i]=N(m,g,y,Math.floor(v)+.5,Math.floor(b)+.5,Math.floor(_)+.5),s=n.getVoxel(v,b,_);let o=s.front,a=s.back,r=s.right,l=s.left,h=s.top,p=s.bottom;switch(!0){case i<-Math.PI/4&&n.getVoxel(v,b+1,_)===li:p=e;break;case i>Math.PI/4&&n.getVoxel(v,b-1,_)===li:h=e;break;case Math.abs(t)>Math.PI/4*3&&n.getVoxel(v-1,b,_)===li:o=e;break;case Math.abs(t)<Math.PI/4&&n.getVoxel(v+1,b,_)===li:a=e;break;case t<-Math.PI/4&&n.getVoxel(v,b,_-1)===li:l=e;break;case t>Math.PI/4&&n.getVoxel(v,b,_+1)===li:r=e}const c=new Xn(s.position.x,s.position.y,s.position.z,o,a,r,l,h,p,s.flipXFront,s.flipYFront,s.flipXBack,s.flipYBack,s.flipXRight,s.flipYRight,s.flipXLeft,s.flipYLeft,s.flipXTop,s.flipYTop,s.flipXBottom,s.flipYBottom);n.setVoxel(v,b,_,c,!1,!1)}break;case jh.PLAYER:case jh.SPAWNER:case jh.ITEM:case jh.WEAPON:case jh.ENEMY:case jh.TUTORIAL:if(n instanceof Ti&&n.hasOutOfWorld(v,b,_)||!(x instanceof Mn)||(this.keys.add&&this.keys.add!==this.presss.add?x.direction.x=(x.direction.x+Math.PI/4)%w:this.keys.sub&&this.keys.sub!==this.presss.sub&&(x.direction.x=(x.direction.x-Math.PI/4)%w)),(!(n instanceof Ti)||!n.hasOutOfWorld(v,b,_))&&this.keys.primary&&this.keys.primary!==this.presss.primary){const[e,t]=N(m,g,y,Math.floor(v)+.5,Math.floor(b)+.5,Math.floor(_)+.5);switch(!0){case t<-Math.PI/4:b+=1;break;case t>Math.PI/4:b-=1;break;case Math.abs(e)>Math.PI/4*3:v-=1;break;case Math.abs(e)<Math.PI/4:v+=1;break;case e<-Math.PI/4:_-=1;break;case e>Math.PI/4:_+=1}const i=r.pallets[r.mode];if((!(n instanceof Ti)||!n.hasOutOfWorld(v,b,_))&&n.getVoxel(v,b,_)===li&&i instanceof Zr&&0===n.getEntitysOfRange("range",v+.5,b,_+.5,1,1).filter((e=>e instanceof Xh)).length){const e=i.getLimit();let t=0;n.getEntitys().reverse().filter((n=>n instanceof Xh&&n.pawn===i&&(t++,t>=e))).forEach((e=>e.remove()));const s=new Xh("pawn",v,b,_,0,i);n.addEntitys(s),i.hasAngle()&&n.addEntitys(new qh(s))}}n instanceof Ti&&n.hasOutOfWorld(v,b,_)||!this.keys.secondary||this.keys.secondary===this.presss.secondary||null===x||x.remove()}const S=t.hasComponent(ji)&&t.getComponent(ji).enable;s.hasStick()!==S&&(s.changeStick("y",S),this.look.x=0,this.look.y=0),r.mode===jh.MOVIE?mn():gn();const k=r.axes.y,T=t.getComponent(ji);if(T.enable=this.keys.menu>0,T.enable){me(T.menus);const e=[];switch(r.mode){case jh.THEME:T.menus.push(new Xi("EPISODE1",e,!0,(()=>!0),(()=>""),(()=>n.setTileSet(ai.EPISODE1))),new Xi("EPISODE2",e,!0,(()=>!0),(()=>""),(()=>n.setTileSet(ai.EPISODE2))));break;case jh.BACKGROUND:T.menus.push(new Xi("GRASS",e,!0,(()=>!0),(()=>""),(()=>n.setBackground(ri.GRASS))),new Xi("DESERT",e,!0,(()=>!0),(()=>""),(()=>n.setBackground(ri.DESERT))),new Xi("SEA",e,!0,(()=>!0),(()=>""),(()=>n.setBackground(ri.SEA))),new Xi("LAVA",e,!0,(()=>!0),(()=>""),(()=>n.setBackground(ri.LAVA))),new Xi("BLOOD",e,!0,(()=>!0),(()=>""),(()=>n.setBackground(ri.BLOOD))));break;case jh.VOXEL:T.menus.push(new Xi("default",e,!0,(()=>!0),(()=>""),(()=>r.pallets[r.mode]=pi.DEFAULT)),new Xi("door default",e,!0,(()=>!0),(()=>""),(()=>r.pallets[r.mode]=pi.DOOR_DEFAULT)),new Xi("door red",e,!0,(()=>!0),(()=>""),(()=>r.pallets[r.mode]=pi.DOOR_RED)),new Xi("door blue",e,!0,(()=>!0),(()=>""),(()=>r.pallets[r.mode]=pi.DOOR_BLUE)),new Xi("door yellow",e,!0,(()=>!0),(()=>""),(()=>r.pallets[r.mode]=pi.DOOR_YELLOW)),new Xi("edit block",e,!0,(()=>!0),(()=>""),(()=>r.pallets[r.mode]=pi.EDIT_BLOCK)));break;case jh.TEXTURE:T.menus.push(new Xi("wall",e,!0,(()=>!0),(()=>""),(()=>r.pallets[r.mode]="WALL")),new Xi("floor",e,!0,(()=>!0),(()=>""),(()=>r.pallets[r.mode]="FLOOR")),new Xi("ceil",e,!0,(()=>!0),(()=>""),(()=>r.pallets[r.mode]="CEIL")),new Xi("wall1",e,!0,(()=>!0),(()=>""),(()=>r.pallets[r.mode]="WALL1")),new Xi("wall2",e,!0,(()=>!0),(()=>""),(()=>r.pallets[r.mode]="WALL2")),new Xi("wall3",e,!0,(()=>!0),(()=>""),(()=>r.pallets[r.mode]="WALL3")),new Xi("wall4",e,!0,(()=>!0),(()=>""),(()=>r.pallets[r.mode]="WALL4")),new Xi("grab",e,!0,(()=>!0),(()=>""),(()=>r.pallets[r.mode]="GRAB_WALL")),new Xi("assist grab",e,!0,(()=>!0),(()=>""),(()=>r.pallets[r.mode]="ASSIST_GRAB_WALL")),new Xi("wallrun",e,!0,(()=>!0),(()=>""),(()=>r.pallets[r.mode]="WALLRUN_WALL")),new Xi("gole",e,!0,(()=>!0),(()=>""),(()=>r.pallets[r.mode]="GOLE_WALL")),new Xi("secret",e,!0,(()=>!0),(()=>""),(()=>r.pallets[r.mode]="SECRET_WALL")),new Xi("door default",e,!0,(()=>!0),(()=>""),(()=>r.pallets[r.mode]="DOOR_DEFAULT")),new Xi("door red",e,!0,(()=>!0),(()=>""),(()=>r.pallets[r.mode]="DOOR_RED")),new Xi("door blue",e,!0,(()=>!0),(()=>""),(()=>r.pallets[r.mode]="DOOR_BLUE")),new Xi("door yellow",e,!0,(()=>!0),(()=>""),(()=>r.pallets[r.mode]="DOOR_YELLOW")),new Xi("edit zone",e,!0,(()=>!0),(()=>""),(()=>r.pallets[r.mode]="EDIT_ZONE")));break;case jh.PLAYER:T.menus.push(new Xi("start",e,!0,(()=>!0),(()=>""),(()=>r.pallets[r.mode]=Ll.PLAYER)),new Xi("gole",e,!0,(()=>!0),(()=>""),(()=>r.pallets[r.mode]=Ll.GOLE)),new Xi("secret",e,!0,(()=>!0),(()=>""),(()=>r.pallets[r.mode]=Ll.SECRET)),new Xi("shop",e,!0,(()=>!0),(()=>""),(()=>r.pallets[r.mode]=Ll.OBJECT_SHOP)),new Xi("checkpoint",e,!0,(()=>!0),(()=>""),(()=>r.pallets[r.mode]=Ll.CHECKPOINT)),new Xi("block editor",e,!0,(()=>!0),(()=>""),(()=>r.pallets[r.mode]=Ll.OBJECT_EDITOR)),new Xi("drum",e,!0,(()=>!0),(()=>""),(()=>r.pallets[r.mode]=Ll.OBJECT_DRUM)),new Xi("key red",e,!0,(()=>!0),(()=>""),(()=>r.pallets[r.mode]=Ll.ITEM_KEY_RED)),new Xi("key blue",e,!0,(()=>!0),(()=>""),(()=>r.pallets[r.mode]=Ll.ITEM_KEY_BLUE)),new Xi("key yellow",e,!0,(()=>!0),(()=>""),(()=>r.pallets[r.mode]=Ll.ITEM_KEY_YELLOW)),new Xi("key random",e,!0,(()=>!0),(()=>""),(()=>r.pallets[r.mode]=Ll.ITEM_KEY_RANDOM)));break;case jh.SPAWNER:T.menus.push(new Xi("meat spawner",e,!0,(()=>!0),(()=>""),(()=>r.pallets[r.mode]=Ll.SPAWNER_HEALTH_ELIXER)),new Xi("armor spawner",e,!0,(()=>!0),(()=>""),(()=>r.pallets[r.mode]=Ll.SPAWNER_ARMOR_ELIXER)),new Xi("stamina spawner",e,!0,(()=>!0),(()=>""),(()=>r.pallets[r.mode]=Ll.SPAWNER_STAMINA_ELIXER)),new Xi("magazine spawner",e,!0,(()=>!0),(()=>""),(()=>r.pallets[r.mode]=Ll.SPAWNER_MAGAZINE)),new Xi("shell spawner",e,!0,(()=>!0),(()=>""),(()=>r.pallets[r.mode]=Ll.SPAWNER_SHELL)),new Xi("rocket spawner",e,!0,(()=>!0),(()=>""),(()=>r.pallets[r.mode]=Ll.SPAWNER_ROCKET)),new Xi("cell spawner",e,!0,(()=>!0),(()=>""),(()=>r.pallets[r.mode]=Ll.SPAWNER_CELL)),new Xi("target spawner",e,!0,(()=>!0),(()=>""),(()=>r.pallets[r.mode]=Ll.SPAWNER_TARGET)),new Xi("shop spawner",e,!0,(()=>!0),(()=>""),(()=>r.pallets[r.mode]=Ll.SPAWNER_SHOP)),new Xi("horde ground",e,!0,(()=>!0),(()=>""),(()=>r.pallets[r.mode]=Ll.HORDE_GROUND_SPAWNER)),new Xi("horde sniper",e,!0,(()=>!0),(()=>""),(()=>r.pallets[r.mode]=Ll.HORDE_SNIPER_SPAWNER)),new Xi("horde air",e,!0,(()=>!0),(()=>""),(()=>r.pallets[r.mode]=Ll.HORDE_SKY_SPAWNER)));break;case jh.ITEM:T.menus.push(new Xi("stim",e,!0,(()=>!0),(()=>""),(()=>r.pallets[r.mode]=Ll.ITEM_HEALTH_STIM)),new Xi("medikit",e,!0,(()=>!0),(()=>""),(()=>r.pallets[r.mode]=Ll.ITEM_HEALTH_MEDIKIT)),new Xi("elixir",e,!0,(()=>!0),(()=>""),(()=>r.pallets[r.mode]=Ll.ITEM_HEALTH_ELIXIR)),new Xi("magazine",e,!0,(()=>!0),(()=>""),(()=>r.pallets[r.mode]=Ll.ITEM_MAGAZINE)),new Xi("shell",e,!0,(()=>!0),(()=>""),(()=>r.pallets[r.mode]=Ll.ITEM_SHELL)),new Xi("rocket",e,!0,(()=>!0),(()=>""),(()=>r.pallets[r.mode]=Ll.ITEM_ROCKET)),new Xi("cell",e,!0,(()=>!0),(()=>""),(()=>r.pallets[r.mode]=Ll.ITEM_CELL)));break;case jh.WEAPON:T.menus.push(new Xi("punch",e,!0,(()=>!0),(()=>""),(()=>r.pallets[r.mode]=Ll.ITEM_PUNCH)),new Xi("slowball",e,!0,(()=>!0),(()=>""),(()=>r.pallets[r.mode]=Ll.ITEM_SLOWBALL)),new Xi("binoculars",e,!0,(()=>!0),(()=>""),(()=>r.pallets[r.mode]=Ll.ITEM_BINOCULARS)),new Xi("combobooster",e,!0,(()=>!0),(()=>""),(()=>r.pallets[r.mode]=Ll.ITEM_COMBOBOOSTER)),new Xi("corrodegrenade",e,!0,(()=>!0),(()=>""),(()=>r.pallets[r.mode]=Ll.ITEM_GRENADE)),new Xi("pistol",e,!0,(()=>!0),(()=>""),(()=>r.pallets[r.mode]=Ll.ITEM_PISTOL)),new Xi("handcannon",e,!0,(()=>!0),(()=>""),(()=>r.pallets[r.mode]=Ll.ITEM_HANDCANNON)),new Xi("hookshot",e,!0,(()=>!0),(()=>""),(()=>r.pallets[r.mode]=Ll.ITEM_HOOKSHOT)),new Xi("machingun",e,!0,(()=>!0),(()=>""),(()=>r.pallets[r.mode]=Ll.ITEM_MACHINGUN)),new Xi("chainshotgun",e,!0,(()=>!0),(()=>""),(()=>r.pallets[r.mode]=Ll.ITEM_CHAINSHOTGUN)),new Xi("shotgun",e,!0,(()=>!0),(()=>""),(()=>r.pallets[r.mode]=Ll.ITEM_SHOTGUN)),new Xi("heavycannon",e,!0,(()=>!0),(()=>""),(()=>r.pallets[r.mode]=Ll.ITEM_HEAVYCANNON)),new Xi("launcher",e,!0,(()=>!0),(()=>""),(()=>r.pallets[r.mode]=Ll.ITEM_LAUNCHER)),new Xi("clusterbow",e,!0,(()=>!0),(()=>""),(()=>r.pallets[r.mode]=Ll.ITEM_CLUSTERBOW)),new Xi("plasmagun",e,!0,(()=>!0),(()=>""),(()=>r.pallets[r.mode]=Ll.ITEM_PLASMAGUN)),new Xi("plasmasmg",e,!0,(()=>!0),(()=>""),(()=>r.pallets[r.mode]=Ll.ITEM_PLASMASMG)));break;case jh.ENEMY:T.menus.push(new Xi("melee guy",e,!0,(()=>!0),(()=>""),(()=>r.pallets[r.mode]=Ll.ENEMY_GUY_MELEE)),new Xi("pistol guy",e,!0,(()=>!0),(()=>""),(()=>r.pallets[r.mode]=Ll.ENEMY_GUY_PISTOL)),new Xi("shotgun guy",e,!0,(()=>!0),(()=>""),(()=>r.pallets[r.mode]=Ll.ENEMY_GUY_SHOTGUN)),new Xi("machingun guy",e,!0,(()=>!0),(()=>""),(()=>r.pallets[r.mode]=Ll.ENEMY_GUY_MACHINGUN)),new Xi("armor pistol guy",e,!0,(()=>!0),(()=>""),(()=>r.pallets[r.mode]=Ll.ENEMY_GUY_PISTOL_ARMOR)),new Xi("armor shotgun guy",e,!0,(()=>!0),(()=>""),(()=>r.pallets[r.mode]=Ll.ENEMY_GUY_SHOTGUN_ARMOR)),new Xi("armor machingun guy",e,!0,(()=>!0),(()=>""),(()=>r.pallets[r.mode]=Ll.ENEMY_GUY_MACHINGUN_ARMOR)),new Xi("armor melee guy",e,!0,(()=>!0),(()=>""),(()=>r.pallets[r.mode]=Ll.ENEMY_GUY_MELEE_ARMOR)),new Xi("missile guy",e,!0,(()=>!0),(()=>""),(()=>r.pallets[r.mode]=Ll.ENEMY_GUY_MISSILE)),new Xi("ball drone",e,!0,(()=>!0),(()=>""),(()=>r.pallets[r.mode]=Ll.ENEMY_BALL_DRONE)),new Xi("ball tank",e,!0,(()=>!0),(()=>""),(()=>r.pallets[r.mode]=Ll.ENEMY_BALL_TANK)));break;case jh.TUTORIAL:T.menus.push(new Xi("help 1",e,!0,(()=>!0),(()=>""),(()=>r.pallets[r.mode]=Ll.HELP_1)),new Xi("help 2",e,!0,(()=>!0),(()=>""),(()=>r.pallets[r.mode]=Ll.HELP_2)),new Xi("help 3",e,!0,(()=>!0),(()=>""),(()=>r.pallets[r.mode]=Ll.HELP_3)),new Xi("help 4",e,!0,(()=>!0),(()=>""),(()=>r.pallets[r.mode]=Ll.HELP_4)),new Xi("help 5",e,!0,(()=>!0),(()=>""),(()=>r.pallets[r.mode]=Ll.HELP_5)),new Xi("help 6",e,!0,(()=>!0),(()=>""),(()=>r.pallets[r.mode]=Ll.HELP_6)),new Xi("help 7",e,!0,(()=>!0),(()=>""),(()=>r.pallets[r.mode]=Ll.HELP_7)),new Xi("help 8",e,!0,(()=>!0),(()=>""),(()=>r.pallets[r.mode]=Ll.HELP_8)),new Xi("help 9",e,!0,(()=>!0),(()=>""),(()=>r.pallets[r.mode]=Ll.HELP_9)),new Xi("help 10",e,!0,(()=>!0),(()=>""),(()=>r.pallets[r.mode]=Ll.HELP_10)),new Xi("help 11",e,!0,(()=>!0),(()=>""),(()=>r.pallets[r.mode]=Ll.HELP_11)),new Xi("help 12",e,!0,(()=>!0),(()=>""),(()=>r.pallets[r.mode]=Ll.HELP_12)),new Xi("help 13",e,!0,(()=>!0),(()=>""),(()=>r.pallets[r.mode]=Ll.HELP_13)),new Xi("help 14",e,!0,(()=>!0),(()=>""),(()=>r.pallets[r.mode]=Ll.HELP_14)),new Xi("help 15",e,!0,(()=>!0),(()=>""),(()=>r.pallets[r.mode]=Ll.HELP_15)),new Xi("help 16",e,!0,(()=>!0),(()=>""),(()=>r.pallets[r.mode]=Ll.HELP_16)),new Xi("help 17",e,!0,(()=>!0),(()=>""),(()=>r.pallets[r.mode]=Ll.HELP_17)));break;case jh.MOVIE:T.menus.push(new Xi("change time ".concat(this.isChangeTime?"on":"off"),e,!0,(()=>!0),(()=>""),(()=>{this.isChangeTime=!this.isChangeTime,this.isChangeTime&&(this.isTimeLaps=!1)})),new Xi("time laps ".concat(this.isTimeLaps?"on":"off"),e,!0,(()=>!0),(()=>""),(()=>{this.isTimeLaps=!this.isTimeLaps,this.isTimeLaps&&(this.isChangeTime=!1)})))}this.lockLockTime=performance.now()}else t.hasComponent(ji)&&-1!==t.getComponent(ji).value&&performance.now()-this.lockLockTime<175&&(r.cmda.x=0,r.cmda.y=0,this.look.x=0,this.look.y=0);if(!(this.keys.menu||this.presss.menu||this.keys.mode_change||this.presss.mode_change)){const e=n.getSun(),t=e.getComponent(Kh);if(r.mode===jh.MOVIE&&(this.isChangeTime||this.isTimeLaps))if("gamepad"===p||"touchpad"===p)(Math.abs(k.x)>25e-5||Math.abs(k.y)>25e-5)&&(this.isChangeTime&&(e.direction.y=W(k.x,k.y,0,0),t.speed=0),this.isTimeLaps&&(t.speed=(W(-k.x,-k.y,0,0)-Math.PI)/Math.PI*.01));else{let n=0;this.keys.add&&this.keys.add!==this.presss.add?n=1:this.keys.sub&&this.keys.sub!==this.presss.sub&&(n=-1),this.isChangeTime&&(e.direction.y+=2*Math.PI/50*n,t.speed=0),this.isTimeLaps&&(t.speed+=2*Math.PI/50*n*1e-4),a.x+=r.cmda.x,a.y+=r.cmda.y}else a.x+=r.cmda.x,a.y+=r.cmda.y}t.direction.y=Math.max(-Math.PI/2,Math.min(Math.PI/2,t.direction.y));const[P,I,L]=n.getWorldSize();o.x=Math.min(P-1,Math.max(0,o.x)),o.y=Math.min(I-1,Math.max(0,o.y)),o.z=Math.min(L-1,Math.max(0,o.z)),this.isUpdateWalkToKeyboard&&(this.updateWalk(),this.isUpdateWalkToKeyboard=!1),this.isAxesUpdateWalkX=!1,this.isAxesUpdateWalkY=!1,this.isAxesUpdateLookX=!1,this.isAxesUpdateLookY=!1;for(const e in this.updateButtons)this.updateButtons[e]=!1;for(const e in this.keys)this.presss[e]=this.keys[e];for(const e in this.releases)this.enablePresss(e,!1,!1,this.scenes,i),delete this.releases[e];for(const e in this.updateButtons)delete this.updateButtons[e];this.walk.x=this.oldWalk.x,this.walk.y=this.oldWalk.y,"gamepad"===this.controls.getInputType()&&(this.look.x=this.oldLook.x,this.look.y=this.oldLook.y),r.cmda.x=0,r.cmda.y=0,this.isResetWalkX&&(this.walk.x=0,this.isResetWalkX=!1),this.isResetWalkY&&(this.walk.y=0,this.isResetWalkY=!1),this.isResetLookX&&(this.look.x=0,this.isResetLookX=!1),this.isResetLookY&&(this.look.y=0,this.isResetLookY=!1),fn("player-position","x:".concat(Math.floor(10*o.x)/10,",y:").concat(Math.floor(10*o.y)/10,",z:").concat(Math.floor(10*o.z)/10)),fn("player-direction","x:".concat(Math.floor(10*a.x)/10,",y:").concat(Math.floor(10*a.y)/10))}}class Qh extends Bi{constructor(){super(jo)}movable(e,t,n){const{position:i}=t,s=t.getComponent(jo);let[o,a,r]=A(s.look.x,s.look.y,s.move.x*s.speed,s.move.y*s.speed,s.move.z*s.speed);o*=e,a*=e,r*=e,0===(t.hasComponent(cs)?t.getComponent(cs).hit.x:0)&&(o>0||o<0)&&(i.x+=o),0===(t.hasComponent(cs)?t.getComponent(cs).hit.y:0)&&(a>0||a<0)&&(i.y+=a),0===(t.hasComponent(cs)?t.getComponent(cs).hit.z:0)&&(r>0||r<0)&&(i.z+=r)}}class $h extends dh{constructor(){super(Kh)}additional(e,t,n){const i=t.getComponent(Kh);0!==i.speed&&(t.direction.y=z(t.direction.y+i.speed*Math.PI*2*e))}}class ep extends Li{constructor(e){super(e,new Kh)}}class tp extends Bi{constructor(){super(Cn,Jh)}offset(e,t,n){const i=t.getComponent(Cn),s=t.getComponent(Jh).target;t.position.x=s.position.x,t.position.y=s.position.y+.01,t.position.z=s.position.z,i.rotate=s.direction.x-Math.PI/2,s.hasLive()||t.remove()}}function np(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function ip(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?np(Object(n),!0).forEach((function(t){sp(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):np(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function sp(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class op extends Ti{constructor(e,t,n,i,s,o,a,r,l,h,p,c){const d=new Oi("camera"),u=new Li("sun");super(e,21,21,21,10,t,s,o,a,r,l,h,p,n,d,u);const m=new zh(n);this.addSystems(new $h,new Zh(m,s,this.getControlManager()),new Ki,new Qh,new tp),this.addEntitys(u,d),this.isLoad=!1,this.editorData=c,this.setting=m}getFOVToCamera(){return K(this.setting.getFOV())}getFramerate(){return this.setting.getFramerate()}hasLoad(){return this.isLoad}hasSaveData(){return Object.keys(this.editorData).length>0}load(){this.importJSON(this.editorData)}save(){const e=this.editorData,t=this.exportJSON();for(const n in t)e[n]=t[n];fa("editor-data")}newMap(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!e||e){this.clear();const e=this.getMargin();this.setWorldSize(21,21,21,e,e,e,e,e,e);const[t,n,i]=this.getWorldSize();for(let e=0;e<t;e=e+1|0)for(let t=0;t<n;t=t+1|0)for(let n=0;n<i;n=n+1|0)this.setVoxel(e,t,n,pi.NONE,!1);const s=new Oi("camera",new Vh,new jo(.1),new ji);s.position.x=12.5,s.position.y=12.5,s.position.z=12.5,s.direction.x=Math.PI/4*5,s.direction.y=Math.PI/4*.5,s.fov=this.getFOVToCamera();const o=new ep("sun");if(o.direction.x=1.2875*Math.PI,o.direction.y=1.2875*Math.PI,this.setCamera(s),this.setSun(o),this.addEntitys(s,o),!this.setting.hasNotSpawnActors()){const e=new Xh("start-point",10.5,11,10.5,0,Ll.PLAYER);this.addEntitys(e),Ll.PLAYER.hasAngle()&&this.addEntitys(new qh(e))}return this.setTileSet(ai.EPISODE1),this.setVoxel(10,10,10,pi.DEFAULT,!0,!1),this.getMap().requestRefleshDistanceField(),this.isLoad=!0,!0}return!1}async openMap(){const e=await Un("Open map file.",["application/json"],["json"]);try{null!==e&&this.importJSON(JSON.parse(e))}finally{za()}}async saveMap(){try{const e=JSON.stringify(this.exportJSON());await Bn("Save map file.",["application/json"],["json"],"blob",e)}finally{za()}}previewMap(){if(this.getEntitys().some((e=>e instanceof Xh&&e.pawn===Ll.PLAYER))){const e=this.getSceneManager().getScene("preview");null!==e&&e instanceof Gh&&(this.save(),e.previewLevel(this.exportJSON()),this.getSceneManager().activeScene("preview"))}}exportJSON(){const e=this.getCamera(),t={position:ip({},e.position),direction:ip({},e.direction)},n=this.getTileSet(),i=null!==n&&Object.keys(ai)[Object.values(ai).indexOf(n)]||"EPISODE1",s=Object.keys(ri)[Object.values(ri).indexOf(this.getBackground()||ri.DEFAULT)],o=this.getVoxelManager().getVoxels().filter((e=>e!==li)).map((e=>null===e?null:{position:ip({},e.position),front:e.front,back:e.back,right:e.right,left:e.left,top:e.top,bottom:e.bottom,flipXFront:e.flipXFront,flipYFront:e.flipYFront,flipXBack:e.flipXBack,flipYBack:e.flipYBack,flipXRight:e.flipXRight,flipYRight:e.flipYRight,flipXLeft:e.flipXLeft,flipYLeft:e.flipYLeft,flipXTop:e.flipXTop,flipYTop:e.flipYTop,flipXBottom:e.flipXBottom,flipYBottom:e.flipYBottom})),a=this.getEntitys((e=>e instanceof Xh)).map((e=>({position:ip({},e.position),direction:ip({},e.direction),id:Object.keys(Ll)[Object.values(Ll).indexOf(e.pawn)]}))),r=this.getMap(),[l,h,p]=r.getSize(),c=r.getFilter(),d=r.getDistanceField(),u={data:new Array,distance_field:new Array,size:{width:l,height:h,depth:p}};for(let e=0;e<l;e=e+1|0){u.data[e]=new Array,u.distance_field[e]=new Array;for(let t=0;t<h;t=t+1|0){u.data[e][t]=new Array,u.distance_field[e][t]=new Array;for(let n=0;n<p;n=n+1|0)u.data[e][t][n]=r.get(0,e,t,n,c)-1,u.distance_field[e][t][n]=r.get(0,e,t,n,d)}}return{camera:t,tileset:i,background:s,voxels:o,entitys:a,map:u,offset:this.getOffset()}}importJSON(e){const{camera:t,tileset:n,background:i,voxels:s,entitys:o,map:a,offset:r}=e;this.clear();const l=new Oi("camera",new Vh,new jo(.1),new ji);l.position.x=t.position.x,l.position.y=t.position.y,l.position.z=t.position.z,l.direction.x=t.direction.x,l.direction.y=t.direction.y,l.direction.z=t.direction.z,l.fov=this.getFOVToCamera();const h=new ep("sun");h.direction.x=1.2875*Math.PI,h.direction.y=1*Math.PI,this.setCamera(l),this.setSun(h),this.addEntitys(l,h),this.setTileSet(ai[n]||"EPISODE1"),this.setBackground(ri[i]||ri.DEFALUT);const p=this.getVoxelManager(),c={};this.setWorldSize(a.size.width,a.size.height,a.size.depth,r.top,r.bottom,r.front,r.back,r.right,r.left),p.addVoxels(...s.map(((e,t)=>c[t+1]=new Xn(e.position.x,e.position.y,e.position.z,e.front,e.back,e.right,e.left,e.top,e.bottom,e.flipXFront,e.flipYFront,e.flipXBack,e.flipYBack,e.flipXRight,e.flipYRight,e.flipXLeft,e.flipYLeft,e.flipXTop,e.flipYTop,e.flipXBottom,e.flipYBottom))));for(let e=0,t=0|a.size.width;e<t;e=e+1|0)for(let t=0,n=0|a.size.height;t<n;t=t+1|0)for(let n=0,i=0|a.size.depth;n<i;n=n+1|0)c[a.data[e][t][n]]&&this.setVoxel(e,t,n,c[a.data[e][t][n]],!1,!1),this.setDistanceField(e,t,n,a.distance_field[e][t][n]);this.getMap().finalize(),this.setting.hasNotSpawnActors()||o.forEach((e=>{if(!Ll.hasOwnProperty(e.id))return;const t=new Xh("",e.position.x,e.position.y,e.position.z,e.direction.x,Ll[e.id]);this.addEntitys(t),Ll[e.id].hasAngle()&&this.addEntitys(new qh(t))})),this.isLoad=!0}createTransferUIData(){const e=this.getCamera();if(e.hasComponent(Vh)){const t=e.getComponent(Vh),n=this.getControlManager();return[...t.keys.menu?Ji(e,this,0,0,.45):t.mode===jh.MOVIE?[]:[new Ri("rectile-rect","rgba(255, 255, 255, 0.75)",1,!0,1,0,0,.005,0,2*Math.PI,!0,0,0),new Fi("editor-mode-font","./asset/font.png",5,5,di,"".concat(Object.keys(jh)[Object.values(jh)[t.mode]]," mode"),0,.75,1,0,0,1,[1,1,1]),new Fi("control-help","./asset/font.png",5,5,di,"set item",-.75,.35,1,1,0,1,[1,1,1]),new Fi("control-key","./asset/font.png",5,5,di,"".concat(n.getKey("keyboard"===n.getInputType()?"fire-left":"fire-right")),-.8,.35,1,-1,0),new Fi("control-help","./asset/font.png",5,5,di,"remove item",-.75,.425,1,1,0,1,[1,1,1]),new Fi("control-key","./asset/font.png",5,5,di,"".concat(n.getKey("keyboard"===n.getInputType()?"fire-right":"fire-left")),-.8,.425,1,-1,0),new Fi("control-help","./asset/font.png",5,5,di,"change item angle",-.75,.5,1,1,0,1,[1,1,1]),new Fi("control-key","./asset/font.png",5,5,di,"".concat("keyboard"===n.getInputType()?"mouse wheel":"right or left"),-.8,.5,1,-1,0),new Fi("control-help","./asset/font.png",5,5,di,"tool menu",-.75,.575,1,1,0,1,[1,1,1]),new Fi("control-key","./asset/font.png",5,5,di,"".concat(n.getKey("weapon-wheel"),"(hold)"),-.8,.575,1,-1,0),new Fi("control-help","./asset/font.png",5,5,di,"change tool",-.75,.65,1,1,0,1,[1,1,1]),new Fi("control-key","./asset/font.png",5,5,di,"".concat(n.getKey("weapon-wheel"),"(tap)"),-.8,.65,1,-1,0)]]}return[]}async onactive(e){!f()&&this.setting.hasBrowserFullscreen()&&await ka(),"keyboard"===this.getControlManager().getInputType()&&await za()}}const ap=[[1920,1080],[1280,720],[800,600],[900,600],[300,200]];class rp{constructor(e){this.value=e}getValue(e){return this.value}hasVisible(e){return!0}hasAjastMouseWheel(){return!1}}class lp{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>!0,i=arguments.length>3?arguments[3]:void 0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:e=>!1;this.name=e,this.value=t,this.visible=n,this.exec=s,this.isAjastMouseWheel=i}hasValue(){return null!==this.value}getName(e){return this.name instanceof Function?this.name(e):this.name}getValue(e){return this.value instanceof Function?this.value(e):this.value}hasVisible(e){return this.visible(e)}hasAjastMouseWheel(){return this.isAjastMouseWheel}execute(e,t){return this.exec(e,t)}}let hp=!1,pp=null,cp=null;class dp extends lp{constructor(e,t,n){super(n,(()=>{var n,i;return hp&&pp===t?performance.now()%2e3<1e3?"...":"":(null===(i=null===(n=e[t])||void 0===n?void 0:n.find((e=>e.includes("keyboard")||e.includes("mouse"))))||void 0===i?void 0:i.replace(/^keyboard_/g,""))||"none"}),(()=>!0),!1,((e,n)=>0===n&&(hp=!0,pp=t,cp="pc",!0)))}}class up extends lp{constructor(e,t,n){super(n,(()=>{var n,i;return hp&&pp===t?performance.now()%2e3<1e3?"...":"":(null===(i=null===(n=e[t])||void 0===n?void 0:n.find((e=>e.includes("gamepad"))))||void 0===i?void 0:i.replace(/^gamepad_/g,""))||"none"}),(()=>!0),!1,((e,n)=>0===n&&(hp=!0,pp=t,cp="gamepad",!0)))}}const mp=["keyboard","gamepad"],gp=["Wait! Are you going to challenge Ultra nightmare of DOOM Eternal 100% speed run of world recode?","Wait! Are you going to challenge Mein leben of Wolfenstein 2 no glitch speed run of world recode?","Wait! You're going to donate 5000 cho yen my game?","Wait! Your dad wants you to ride the EVA.","Wait! Do you remember signing a contract to work as a magical girl?","Wait! Do you like Akaiheya?","I might as well go with this (No)!","Are you talking about Kuririn?!","Wait! Would you like to rush into the temp agency headquarters naked?"];class fp extends Mi{constructor(e,t,n,i,s,o,a,r,l){let h=arguments.length>9&&void 0!==arguments[9]&&arguments[9];super(e,s,o,a,r,l),this.keys={},this.presss={},this.toggles={},this.releases={},this.updateButtons={},this.titles=new Array,this.menus=new Array,this.walk=new E(0,0),this.look=new E(0,0),this.menuPoints=[0],this.loading=!1,this.how_to_play=-1,this.upTime=-1,this.upInterval=-1,this.upID=-1,this.downTime=-1,this.downInterval=-1,this.downID=-1,this.rightTime=-1,this.rightInterval=-1,this.rightID=-1,this.leftTime=-1,this.leftInterval=-1,this.leftID=-1,this.isUpdateButton=!1,this.isFocusAjastMenu=!1,this.isDemo=!1,this.setting=new zh(t),this.keyconfig=n,this.hordeLoadout=i,this.isDemo=h;const p=()=>[new lp("continue","",(e=>{const t=e.getSceneManager().getScene("game");return null!==t&&t instanceof Gh&&(t.hasSaveData()||t.hasContinue()||t.hasHorde()||t.hasTutorial())}),!1,((e,t)=>{if(0!==t)return!1;const n=e.getSceneManager(),i=n.getScene("game");return null!==i&&i instanceof Gh&&!i.hasContinue()&&!i.hasTutorial()&&!i.hasHorde()&&i.hasSaveData()&&i.continueLoad(),n.activeScene("game"),!0})),new lp("retry","",(e=>{var t;const n=e.getSceneManager().getScene("game");return null!==n&&n instanceof Gh&&(!this.setting.hasDeadLoseWeapon()||-1===(null===(t=n.getPlayer())||void 0===t?void 0:t.getComponent(Gi).deathTime))&&!this.setting.hasPermaDeath()&&(n.hasSaveData()&&n.hasContinue()||n.hasTutorial()||n.hasHorde())}),!1,(async(e,t)=>{if(0!==t)return!1;const n=e.getSceneManager(),i=n.getScene("game");return null!==i&&i instanceof Gh&&(this.loading=!0,i.hasTutorial()?await i.loadTutorial():i.hasHorde()?await i.newHorde(i.getEpisodeNumber()):await i.quickLoad(),this.loading=!1),n.activeScene("game"),!0})),new lp("new game","",(()=>!0),!1,((e,t)=>{if(0!==t)return!1;const n=e.getSceneManager(),i=n.getScene("game"),s=async(e,t)=>{if(n.activeScene("game"),null!==i&&i instanceof Gh&&(this.loading=!0,0===e?await i.loadTutorial():await i.newGame(e),this.loading=!1),t)for(let e=0,n=0|t;e<n;e=e+1|0)this.cancelMenu(!1);this.cancelMenu(!0)},o=async(e,t)=>{if(n.activeScene("game"),null!==i&&i instanceof Gh&&(this.loading=!0,await i.newHorde(e),this.loading=!1),t)for(let e=0,n=0|t;e<n;e=e+1|0)this.cancelMenu(!1);this.cancelMenu(!0)},a=e=>{const t=async()=>{const t=h?{1:!!await Fn("./map/e1m1.json"),2:!1,3:!1,4:!1,5:!1,6:!1}:{1:!!await Fn("./map/e1m1.json"),2:!!await Fn("./map/e2m1.json"),3:!!await Fn("./map/e3m1.json"),4:!!await Fn("./map/e4m1.json"),5:!!await Fn("./map/e5m1.json"),6:!!await Fn("./map/e6m1.json")};this.pushMenus("choice episode",new lp("episode1","",(()=>t[1]),!1,((t,n)=>0===n&&(this.pushMenus("",new rp("Do you want to play the tutorial?"),new lp("Yes",null,(()=>!0),!1,((t,n)=>0===n&&(s(0,e+1),!0))),new lp("No",null,(()=>!0),!1,((t,n)=>0===n&&(s(1,e+1),!0)))),!0))),new lp("episode2","",(()=>t[2]),!1,((t,n)=>0===n&&(s(2,e),!0))),new lp("episode3","",(()=>t[3]),!1,((t,n)=>0===n&&(s(3,e),!0))),new lp("episode4","",(()=>t[4]),!1,((t,n)=>0===n&&(s(4,e),!0))),new lp("episode5","",(()=>t[5]),!1,((t,n)=>0===n&&(s(5,e),!0))),new lp("episode6","",(()=>t[6]),!1,((t,n)=>0===n&&(s(6,e),!0))),new lp("back",null,(()=>!0),!1,((e,t)=>(0===t&&this.cancelMenu(!1,!0),!0))))},n=async()=>{const t={1:!!await Fn("./map/horde1.json"),2:!!await Fn("./map/horde2.json"),3:!!await Fn("./map/horde3.json"),4:!!await Fn("./map/horde4.json"),5:!!await Fn("./map/horde5.json"),6:!!await Fn("./map/horde6.json")};return this.pushMenus("choice map",new lp("horde 1","",(()=>t[1]),!1,(async(t,n)=>0===n&&(await o(1,e),!0))),new lp("horde 2","",(()=>t[2]),!1,(async(t,n)=>0===n&&(await o(2,e),!0))),new lp("horde 3","",(()=>t[3]),!1,(async(t,n)=>0===n&&(await o(3,e),!0))),new lp("horde 4","",(()=>t[4]),!1,(async(t,n)=>0===n&&(await o(4,e),!0))),new lp("horde 5","",(()=>t[5]),!1,(async(t,n)=>0===n&&(await o(5,e),!0))),new lp("horde 6","",(()=>t[6]),!1,(async(t,n)=>0===n&&(await o(6,e),!0))),new lp("back",null,(()=>!0),!1,((e,t)=>(0===t&&this.cancelMenu(!1,!0),!0)))),!0};this.hasDemo()?t():this.pushMenus("choice game mode",new lp("episode mode","",(()=>!0),!1,(async(e,n)=>0===n&&(await t(),!0))),new lp("horde mode","",(()=>!h),!1,(async(e,t)=>0===t&&(await n(),!0))),new lp("intermission test","",(()=>Xe()),!1,(async(t,n)=>0===n&&(await s(7,e),!0))),new lp("back",null,(()=>!0),!1,((t,n)=>(0===n&&this.cancelMenu(!1,!0,e),!0))))};return null!==i&&i instanceof Gh&&(i.hasContinue()||i.hasSaveData())?this.pushMenus("",new rp("The game you are playing will disappear. Are you sure?"),new lp("No",null,(()=>!0),!1,((e,t)=>0===t&&(this.cancelMenu(!1,!0),!0))),new lp("Yes",null,(()=>!0),!1,((e,t)=>0===t&&(a(2),!0)))):a(1),!0})),new lp("level editor","",(()=>s.hasScene("editor")),!1,((e,t)=>{if(0!==t)return!1;const n=e.getSceneManager(),i=n.getScene("editor");return(async()=>{this.loading=!0,n.activeScene("editor"),null!==i&&i instanceof op&&(i.hasLoad()||(i.hasSaveData()?i.load():await i.newMap())),this.loading=!1})(),!0})),new lp("practice area (beta)","",(()=>s.hasScene("practice")),!1,((e,t)=>{if(0!==t)return!1;const n=e.getSceneManager(),i=n.getScene("practice");return(async()=>{this.loading=!0,n.activeScene("practice"),null!==i&&i instanceof Gh&&(i.hasPractice()||await i.loadPracticeArea()),this.loading=!1})(),!0})),new lp("how to play","",(()=>!0),!1,((e,t)=>0===t&&(this.how_to_play="gamepad"===this.getControlManager().getInputType()?1:0,!0))),new lp("option","",(()=>!0),!1,((e,t)=>0===t&&(this.pushMenus("option",new lp("game play","",(()=>!0),!1,((e,t)=>0===t&&(this.pushMenus("game play",new lp("check point",(()=>"".concat(this.setting.hasCheckPoint()?"on":"off")),(()=>!0),!1,((e,t)=>0===t&&(this.setting.setCheckPoint(!this.setting.hasCheckPoint()),!0))),new lp("lose weapons when dead",(()=>"".concat(this.setting.hasDeadLoseWeapon()?"on":"off")),(()=>!0),!1,((e,t)=>0===t&&(this.setting.setDeadLoseWeapon(!this.setting.hasDeadLoseWeapon()),!0))),new lp("perma death",(()=>"".concat(this.setting.hasPermaDeath()?"on":"off")),(()=>!0),!1,((e,t)=>0===t&&(this.setting.setPermaDeath(!this.setting.hasPermaDeath()),!0))),new lp("SSS kill combo rank slow-mo",(()=>"".concat(this.setting.hasSSSSlowMo()?"on":"off")),(()=>!0),!1,((e,t)=>0===t&&(this.setting.setSSSSlowMo(!this.setting.hasSSSSlowMo()),!0))),new lp("random weapon drop",(()=>"".concat(Math.round(100*this.setting.getRandomWeaponDrop()),"%")),(()=>Xe()),!0,((e,t)=>{if(0===t)return!1;const n=this.setting.getRandomWeaponDrop();return t<0?this.setting.setRandomWeaponDrop(Math.max(0,n-.01)):t>0&&this.setting.setRandomWeaponDrop(Math.min(1,n+.01)),n!==this.setting.getRandomWeaponDrop()})),new lp("random height enemy",(()=>"".concat(Math.round((1-this.setting.getRandomHeightEnemy())/.5*100),"%")),(()=>Xe()),!0,((e,t)=>{if(0===t)return!1;const n=this.setting.getRandomHeightEnemy();return t<0?this.setting.setRandomHeightEnemy(Math.min(1,n+.05)):t>0&&this.setting.setRandomHeightEnemy(Math.max(.5,n-.05)),n!==this.setting.getRandomHeightEnemy()})),new lp("back",null,(()=>!0),!1,((e,t)=>(0===t&&this.cancelMenu(!1,!0),!0)))),!0))),new lp("control","",(()=>!0),!1,((e,t)=>0===t&&(this.pushMenus("control",new lp("look option","",(()=>!0),!1,((e,t)=>0===t&&(this.pushMenus("look option",new lp("sensibility",(()=>"".concat(0|this.setting.getSensibility())),(()=>!0),!0,((e,t)=>{if(0===t)return!1;const n=this.setting.getSensibility();return n<200&&t>0?this.setting.setSensibility(Math.min(200,n+5)):n>10&&t<0&&this.setting.setSensibility(Math.max(5,n-5)),n!==this.setting.getSensibility()})),new lp("look invert x",(()=>this.setting.hasInvertX()?"on":"off"),(()=>!0),!1,((e,t)=>0===t&&(this.setting.setInvertX(!this.setting.hasInvertX()),!0))),new lp("look invert y",(()=>this.setting.hasInvertY()?"on":"off"),(()=>!0),!1,((e,t)=>0===t&&(this.setting.setInvertY(!this.setting.hasInvertY()),!0))),new lp("back",null,(()=>!0),!1,((e,t)=>(0===t&&this.cancelMenu(!1,!0),!0)))),!0))),new lp("press option","",(()=>!0),!1,((e,t)=>0===t&&(this.pushMenus("press option",new lp("toggle sprint",(()=>this.setting.hasToggleSprint()?"on":"off"),(()=>!0),!1,((e,t)=>0===t&&(this.setting.setToggleSprint(!this.setting.hasToggleSprint()),!0))),new lp("toggle cluch",(()=>(this.setting.hasToggleCluch(),"on")),(()=>!0),!1,((e,t)=>0===t&&(this.setting.setToggleCluch(!this.setting.hasToggleCluch()),!0))),new lp("weapon charge stand time",(()=>"".concat(0|this.setting.getWeaponChargeStandTime())),(()=>!0),!0,((e,t)=>{if(0===t)return!1;const n=this.setting.getWeaponChargeStandTime();return n<500&&t>0?this.setting.setWeaponChargeStandTime(Math.min(500,n+5)):n>70&&t<0&&this.setting.setWeaponChargeStandTime(Math.max(5,n-5)),n!==this.setting.getWeaponChargeStandTime()})),new lp("weapon wheel stand time",(()=>"".concat(0|this.setting.getWeaponWheelStandTime())),(()=>!0),!0,((e,t)=>{if(0===t)return!1;const n=this.setting.getWeaponWheelStandTime();return n<500&&t>0?this.setting.setWeaponWheelStandTime(Math.min(500,n+5)):n>70&&t<0&&this.setting.setWeaponWheelStandTime(Math.max(5,n-5)),n!==this.setting.getWeaponWheelStandTime()})),new lp("back",null,(()=>!0),!1,((e,t)=>(0===t&&this.cancelMenu(!1,!0),!0)))),!0))),new lp("keyboard mouse option","",(()=>!0),!1,((e,t)=>0===t&&(this.pushMenus("keyboard mouse option",new lp("key config","",(()=>!0),!1,((e,t)=>0===t&&(this.pushMenus("key config",new lp("movemnet","",(()=>!0),!1,((e,t)=>0===t&&(this.pushMenus("movement",new dp(n,"forward","forward"),new dp(n,"back","back"),new dp(n,"left","left"),new dp(n,"right","right"),new lp("back",null,(()=>!0),!1,((e,t)=>(0===t&&this.cancelMenu(!1,!0),!0)))),!0))),new lp("move action","",(()=>!0),!1,((e,t)=>0===t&&(this.pushMenus("move action",new dp(n,"jump","jump"),new dp(n,"cluch","cluch/sliding"),new dp(n,"sprint","sprint"),new dp(n,"lean-right","lean right"),new dp(n,"lean-left","lean left"),new dp(n,"lean","lean"),new lp("back",null,(()=>!0),!1,((e,t)=>(0===t&&this.cancelMenu(!1,!0),!0)))),!0))),new lp("hand action","",(()=>!0),!1,((e,t)=>0===t&&(this.pushMenus("hand action",new dp(n,"use","use"),new dp(n,"fire-right","fire right"),new dp(n,"fire-left","fire left"),new lp("back",null,(()=>!0),!1,((e,t)=>(0===t&&this.cancelMenu(!1,!0),!0)))),!0))),new lp("weapon change","",(()=>!0),!1,((e,t)=>0===t&&(this.pushMenus("weapon change",new dp(n,"next-weapon","next weapon"),new dp(n,"prev-weapon","prev weapon"),new dp(n,"weapon-wheel","weapon wheel/weapon switch"),new dp(n,"weapon-wheel-right","right hand weapon wheel"),new dp(n,"weapon-wheel-left","left hand weapon wheel"),new lp("back",null,(()=>!0),!1,((e,t)=>(0===t&&this.cancelMenu(!1,!0),!0)))),!0))),new lp("weapon number","",(()=>!0),!1,((e,t)=>0===t&&(this.pushMenus("weapon number",new dp(n,"weapon-1","weapon 1"),new dp(n,"weapon-2","weapon 2"),new dp(n,"weapon-3","weapon 3"),new dp(n,"weapon-4","weapon 4"),new dp(n,"weapon-5","weapon 5"),new dp(n,"weapon-6","weapon 6"),new lp("back",null,(()=>!0),!1,((e,t)=>(0===t&&this.cancelMenu(!1,!0),!0)))),!0))),new lp("back",null,(()=>!0),!1,((e,t)=>(0===t&&this.cancelMenu(!1,!0),!0)))),!0))),new lp("back",null,(()=>!0),!1,((e,t)=>(0===t&&this.cancelMenu(!1,!0),!0)))),!0))),new lp("gamepad option","",(()=>!0),!1,((e,t)=>0===t&&(this.pushMenus("gamepad option",new lp("key config","",(()=>!0),!1,((e,t)=>0===t&&(this.pushMenus("key config",new lp("movemnet","",(()=>!0),!1,((e,t)=>0===t&&(this.pushMenus("movement",new up(n,"forward","forward"),new up(n,"back","back"),new up(n,"left","left"),new up(n,"right","right"),new lp("back",null,(()=>!0),!1,((e,t)=>(0===t&&this.cancelMenu(!1,!0),!0)))),!0))),new lp("move action","",(()=>!0),!1,((e,t)=>0===t&&(this.pushMenus("move action",new up(n,"jump","jump"),new up(n,"cluch","cluch/sliding"),new up(n,"sprint","sprint"),new up(n,"lean-right","lean right"),new up(n,"lean-left","lean left"),new up(n,"lean","lean"),new lp("back",null,(()=>!0),!1,((e,t)=>(0===t&&this.cancelMenu(!1,!0),!0)))),!0))),new lp("hand action","",(()=>!0),!1,((e,t)=>0===t&&(this.pushMenus("hand action",new up(n,"use","use"),new up(n,"fire-right","fire right"),new up(n,"fire-left","fire left"),new lp("back",null,(()=>!0),!1,((e,t)=>(0===t&&this.cancelMenu(!1,!0),!0)))),!0))),new lp("weapon change","",(()=>!0),!1,((e,t)=>0===t&&(this.pushMenus("weapon change",new up(n,"next-weapon","next-weapon"),new up(n,"prev-weapon","prev-weapon"),new up(n,"weapon-wheel","weapon wheel/weapon switch"),new up(n,"weapon-wheel-right","right hand weapon wheel"),new up(n,"weapon-wheel-left","left hand weapon wheel"),new lp("back",null,(()=>!0),!1,((e,t)=>(0===t&&this.cancelMenu(!1,!0),!0)))),!0))),new lp("weapon number","",(()=>!0),!1,((e,t)=>0===t&&(this.pushMenus("weapon number",new up(n,"weapon-1","weapon 1"),new up(n,"weapon-2","weapon 2"),new up(n,"weapon-3","weapon 3"),new up(n,"weapon-4","weapon 4"),new up(n,"weapon-5","weapon 5"),new up(n,"weapon-6","weapon 6"),new lp("back",null,(()=>!0),!1,((e,t)=>(0===t&&this.cancelMenu(!1,!0),!0)))),!0))),new lp("back",null,(()=>!0),!1,((e,t)=>(0===t&&this.cancelMenu(!1,!0),!0)))),!0))),new lp("joy stick deadzone","",(()=>!0),!1,((e,t)=>0===t&&(this.pushMenus("joy stick deadzone",new lp("inner left",(()=>{let e=0;return e=this.setting.getInnerDeadzoneX(),"".concat(Math.round(100*e))}),(()=>!0),!0,((e,t)=>{if(0===t)return!1;const n=this.setting.getInnerDeadzoneX();return n<.5&&t>0?this.setting.setInnerDeadzoneX(Math.min(1,Math.round(100*(n+.05))/100)):n>0&&t<0&&this.setting.setInnerDeadzoneX(Math.max(0,Math.round(100*(n-.05))/100)),n!==this.setting.getInnerDeadzoneX()})),new lp("outer left",(()=>{let e=0;return e=this.setting.getOuterDeadzoneX(),"".concat(Math.round(100*e))}),(()=>!0),!0,((e,t)=>{if(0===t)return!1;const n=this.setting.getOuterDeadzoneX();return n<.5&&t>0?this.setting.setOuterDeadzoneX(Math.min(1,Math.round(100*(n+.05))/100)):n>0&&t<0&&this.setting.setOuterDeadzoneX(Math.max(0,Math.round(100*(n-.05))/100)),n!==this.setting.getOuterDeadzoneX()})),new lp("inner right",(()=>{let e=0;return e=this.setting.getInnerDeadzoneY(),"".concat(Math.round(100*e))}),(()=>!0),!0,((e,t)=>{if(0===t)return!1;const n=this.setting.getInnerDeadzoneY();return n<.5&&t>0?this.setting.setInnerDeadzoneY(Math.min(1,Math.round(100*(n+.05))/100)):n>0&&t<0&&this.setting.setInnerDeadzoneY(Math.max(0,Math.round(100*(n-.05))/100)),n!==this.setting.getInnerDeadzoneY()})),new lp("outer right",(()=>{let e=0;return e=this.setting.getOuterDeadzoneY(),"".concat(Math.round(100*e))}),(()=>!0),!0,((e,t)=>{if(0===t)return!1;const n=this.setting.getOuterDeadzoneY();return n<.5&&t>0?this.setting.setOuterDeadzoneY(Math.min(1,Math.round(100*(n+.05))/100)):n>0&&t<0&&this.setting.setOuterDeadzoneY(Math.max(0,Math.round(100*(n-.05))/100)),n!==this.setting.getOuterDeadzoneY()})),new lp("back",null,(()=>!0),!1,((e,t)=>(0===t&&this.cancelMenu(!1,!0),!0)))),!0))),new lp("back",null,(()=>!0),!1,((e,t)=>(0===t&&this.cancelMenu(!1,!0),!0)))),!0))),new lp("back",null,(()=>!0),!1,((e,t)=>(0===t&&this.cancelMenu(!1,!0),!0)))),!0))),new lp("general","",(()=>!0),!1,((e,t)=>0===t&&(this.pushMenus("general",new lp("framerate",(()=>"".concat(this.setting.getFramerate()===1/0?"unlimit":this.setting.getFramerate())),(()=>f()),!0,((e,t)=>{if(0===t)return!1;let n=this.setting.getFramerateIndex();const i=n;return t<0?(n--,n<0&&(n=0),this.setting.setFramerate(n)):t>0&&(n++,n>=Nh.length&&(n=Nh.length-1),this.setting.setFramerate(n)),i!==this.setting.getFramerateIndex()})),new lp("fov",(()=>"".concat(this.setting.getFOV())),(()=>!0),!0,((e,t)=>{if(0===t)return!1;const n=this.setting.getFOV();return t<0?this.setting.setFOV(Math.max(90,n-5)):t>0&&this.setting.setFOV(Math.min(160,n+5)),n!==this.setting.getFOV()})),new lp("camera bob",(()=>"".concat(this.setting.hasBob()?"on":"off")),(()=>!0),!1,((e,t)=>0===t&&(this.setting.setBob(!this.setting.hasBob()),!0))),new lp("hud",(()=>"".concat(this.setting.hasHUD()?"on":"off")),(()=>!0),!1,((e,t)=>0===t&&(this.setting.setHUD(!this.setting.hasHUD()),!0))),new lp("not spawn actors",(()=>"".concat(this.setting.hasNotSpawnActors()?"on":"off")),(()=>Xe()),!1,((e,t)=>0===t&&(this.setting.setNotSpawnAcotrs(!this.setting.hasNotSpawnActors()),!0))),new lp("debug log",(()=>"".concat(this.setting.hasDebugLog()?"on":"off")),(()=>Xe()),!1,((e,t)=>{if(0!==t)return!1;const n=!this.setting.hasDebugLog();return this.setting.setDebugLog(n),n?dn():un(),!0})),new lp("back",null,(()=>!0),!1,((e,t)=>(0===t&&this.cancelMenu(!1,!0),!0)))),!0))),new lp("audio","",(()=>!0),!1,((e,t)=>0===t&&(this.pushMenus("audio",new lp("volume",(()=>"".concat(Math.round(100*this.setting.getSoundVolume()))),(()=>!0),!0,((e,t)=>{if(0===t)return!1;const n=this.setting.getSoundVolume();return t<0?this.setting.setSoundVolume(Math.max(0,n-.1)):t>0&&this.setting.setSoundVolume(Math.min(1,n+.1)),this.getSoundManager().setVolume(n),n!==this.setting.getSoundVolume()})),new lp("eat sound",(()=>"".concat(this.setting.hasEatSound()?"on":"off")),(()=>!0),!1,((e,t)=>0===t&&(this.setting.setEatSound(!this.setting.hasEatSound()),!0))),new lp("back",null,(()=>!0),!1,((e,t)=>(0===t&&this.cancelMenu(!1,!0),!0)))),!0))),new lp("graphics","",(()=>!0),!1,((e,t)=>0===t&&(this.pushMenus("graphics",new lp("screen","",(()=>!0),!1,((e,t)=>0===t&&(this.pushMenus("screen",new lp((()=>"fullscreen".concat(f()||_a()?"":"/only playing")),(()=>"".concat((f()?this.setting.hasFullscreen():this.setting.hasBrowserFullscreen()||_a(!0))?"on":"off")),(()=>!0),!1,((e,t)=>{if(0!==t)return!1;const n=this.setting.hasFullscreen();return f()?this.setting.setFullscreen(!this.setting.hasFullscreen()):_a()?Da():this.setting.setBrowserFullscreen(!this.setting.hasBrowserFullscreen()),n!==this.setting.hasFullscreen()&&sn({method:"resize"},[]),!0})),new lp("resolution",(e=>-1===this.setting.getResolutionIndex()?"auto":"".concat(ap[this.setting.getResolutionIndex()][0],"x").concat(ap[this.setting.getResolutionIndex()][1])),(()=>f()?_a():this.setting.hasBrowserFullscreen()||_a(!0)),!0,((e,t)=>{if(0===t)return!1;const n=this.setting.getResolutionIndex();return t<0?this.setting.setReolutionIndex(Math.min(ap.length-1,n+1)):t>0&&this.setting.setReolutionIndex(Math.max(-1,n-1)),n!==this.setting.getResolutionIndex()&&(sn({method:"resize"},[]),!0)})),new lp("contrast",(()=>"".concat(Math.round(100*this.setting.getContrast()))),(()=>!0),!0,((e,t)=>{if(0===t)return!1;const n=this.setting.getContrast();return t<0?this.setting.setContrast(Math.round(100*Math.max(0,n-.05))/100):t>0&&this.setting.setContrast(Math.round(100*Math.min(2,n+.05))/100),n!==this.setting.getContrast()})),new lp("brightness",(()=>"".concat(Math.round(100*this.setting.getBrightness()))),(()=>!0),!0,((e,t)=>{if(0===t)return!1;const n=this.setting.getBrightness();return t<0?this.setting.setBrightness(Math.round(100*Math.max(0,n-.05))/100):t>0&&this.setting.setBrightness(Math.round(100*Math.min(2,n+.05))/100),n!==this.setting.getBrightness()})),new lp("back",null,(()=>!0),!1,((e,t)=>(0===t&&this.cancelMenu(!1,!0),!0)))),!0))),new lp("post effect","",(()=>!0),!1,((e,t)=>0===t&&(this.pushMenus("post effect",new lp("muzzle flash",(()=>"".concat(this.setting.hasMuzzleFlash()?"on":"off")),(()=>!0),!1,((e,t)=>0===t&&(this.setting.setMuzzleFlash(!this.setting.hasMuzzleFlash()),!0))),new lp("shadow",(()=>"".concat(this.setting.hasShadow()?"on":"off")),(()=>!0),!1,((e,t)=>0===t&&(this.setting.setShadow(!this.setting.hasShadow()),!0))),new lp("soft shadow",(()=>"".concat(this.setting.hasSoftShadow()?"on":"off")),(()=>!0),!1,((e,t)=>0===t&&(this.setting.setSoftShadow(!this.setting.hasSoftShadow()),!0))),new lp("reflection count",(()=>"".concat(this.setting.getReflectionCount())),(()=>!0),!0,((e,t)=>{if(0===t)return!1;const n=this.setting.getReflectionCount();return n>0&&t<0?this.setting.setReflectionCount(n-1):n<10&&t>0&&this.setting.setReflectionCount(n+1),n!==this.setting.getReflectionCount()})),new lp("roughness",(()=>"".concat(this.setting.hasRoughness()?"on":"off")),(()=>!0),!1,((e,t)=>0===t&&(this.setting.setRoughness(!this.setting.hasRoughness()),!0))),new lp("bloom",(()=>"".concat(this.setting.hasBloom()?"on":"off")),(()=>!0),!1,((e,t)=>0===t&&(this.setting.setBloom(!this.setting.hasBloom()),!0))),new lp("pixelized lighting",(()=>"".concat(this.setting.hasPixelizedLighting()?"on":"off")),(()=>!0),!1,((e,t)=>0===t&&(this.setting.setPixelizedLighting(!this.setting.hasPixelizedLighting()),!0))),new lp("back",null,(()=>!0),!1,((e,t)=>(0===t&&this.cancelMenu(!1,!0),!0)))),!0))),new lp("crt filter","",(()=>!0),!1,((e,t)=>0===t&&(this.pushMenus("crt filter",new lp("enable",(()=>"".concat(this.setting.hasCRT()?"on":"off")),(()=>!0),!1,((e,t)=>0===t&&(this.setting.setCRTEnable(!this.setting.hasCRT()),!0))),new lp("sub pixel size",(()=>"".concat(this.setting.getCRTSubPixel())),(()=>!0),!0,((e,t)=>{if(0===t)return!1;const n=this.setting.getCRTSubPixel();return t<0?this.setting.setCRTSubPixel(Math.max(3,n-3)):t>0&&this.setting.setCRTSubPixel(Math.min(9,n+3)),n!==this.setting.getCRTSubPixel()})),new lp("lens scale",(()=>"".concat(this.setting.getCRTLens())),(()=>!0),!0,((e,t)=>{if(0===t)return!1;const n=this.setting.getCRTLens();return t<0?this.setting.setCRTLens(Math.round(1e3*Math.max(0,n-.025))/1e3):t>0&&this.setting.setCRTLens(Math.round(1e3*Math.min(1,n+.025))/1e3),n!==this.setting.getCRTLens()})),new lp("deep scale",(()=>"".concat(this.setting.getCRTDeep())),(()=>!0),!0,((e,t)=>{if(0===t)return!1;const n=this.setting.getCRTDeep();return t<0?this.setting.setCRTDeep(Math.round(1e3*Math.max(0,n-.025))/1e3):t>0&&this.setting.setCRTDeep(Math.round(1e3*Math.min(1,n+.025))/1e3),n!==this.setting.getCRTDeep()})),new lp("edge scale",(()=>"".concat(this.setting.getCRTEdge())),(()=>!0),!0,((e,t)=>{if(0===t)return!1;const n=this.setting.getCRTEdge();return t<0?this.setting.setCRTEdge(Math.round(1e3*Math.max(0,n-.025))/1e3):t>0&&this.setting.setCRTEdge(Math.round(1e3*Math.min(1,n+.025))/1e3),n!==this.setting.getCRTEdge()})),new lp("shadow vig",(()=>"".concat(this.setting.getCRTVig())),(()=>!0),!0,((e,t)=>{if(0===t)return!1;const n=this.setting.getCRTVig();return t<0?this.setting.setCRTVig(Math.round(1e3*Math.max(0,n-.025))/1e3):t>0&&this.setting.setCRTVig(Math.round(1e3*Math.min(1,n+.025))/1e3),n!==this.setting.getCRTVig()})),new lp("shadow mask",(()=>"".concat(this.setting.hasCRTShadowMask()?"on":"off")),(()=>!0),!1,((e,t)=>0===t&&(this.setting.setCRTShadowMask(!this.setting.hasCRTShadowMask()),!0))),new lp("back",null,(()=>!0),!1,((e,t)=>(0===t&&this.cancelMenu(!1,!0),!0)))),!0))),new lp("lighting dot scale",(()=>"X".concat(this.setting.getLightingDotScale())),(()=>!0),!0,((e,t)=>{if(0===t)return!1;const n=this.setting.getLightingDotScale();return n>1&&t<0?this.setting.setLightingDotScale(n-1):n<4&&t>0&&this.setting.setLightingDotScale(n+1),n!==this.setting.getLightingDotScale()})),new lp("tiled rendering resolution",(()=>"".concat(this.setting.getClusterResolution())),(()=>!0),!0,((e,t)=>{if(0===t)return!1;const n=this.setting.getClusterResolution();return n>2&&t<0?this.setting.setClusterResolution(n/2):n<128&&t>0&&this.setting.setClusterResolution(2*n),n!==this.setting.getClusterResolution()})),new lp("back",null,(()=>!0),!1,((e,t)=>(0===t&&this.cancelMenu(!1,!0),!0)))),!0))),new lp("back",null,(()=>!0),!1,((e,t)=>(0===t&&this.cancelMenu(!1,!0),!0)))),!0))),new lp("reflesh","",(()=>Xe()||!f()),!1,((e,t)=>0===t&&(on.postMessage({method:"reload"}),!0))),new lp("return desktop","",(()=>!Xe()&&f()),!1,((e,t)=>0===t&&(this.pushMenus("",new rp(gp[gp.length*Math.random()|0]),new lp("No",null,(()=>!0),!1,((e,t)=>(0===t&&this.cancelMenu(!1,!0),!0))),new lp("Yes",null,(()=>!0),!1,((e,t)=>0===t&&(on.postMessage({method:"shatdown"}),!0)))),!0)))];this.menus.push([new lp((()=>performance.now()%2e3<1e3?"PRESS ".concat("gamepad"===this.getControlManager().getInputType()?"a":"mouse left"," TO START"):""),null,(e=>!0),!1,((e,t)=>0===t&&(Xe()||this.hasDemo()?this.pushMenus("",...p()):this.pushMenus("",new rp("This game is an Early Access version."),new rp("It has many bugs and unfinished elements."),new rp("If you find any bugs, it would be appreciated "),new rp("if you could contact us at (ie.shoom88@gmail.com)"),new rp("or the steam forums.Thank you for your purchase."),new rp(""),new lp((()=>"(OK)"),null,(e=>!0),!1,((e,t)=>0===t&&(this.pushMenus("",...p()),!0)))),!0)))]),r.axes(((e,t,n)=>{var i;if("title"===s.getActiveSceneName()&&(null===(i=s.getScene("title"))||void 0===i?void 0:i.hasRun()))switch(e){case"x":this.walk.x=-t,this.walk.y=n;break;case"y":this.look.x=t,this.look.y=n}else this.walk.x=0,this.walk.y=0,this.look.x=0,this.look.y=0})),r.press(((e,t)=>{var n;const i=performance.now();if("title"===s.getActiveSceneName()&&(null===(n=s.getActiveScene())||void 0===n?void 0:n.hasRun())){let n=!1;if(this.isUpdateButton&&this.updateButtons[e])return void(t||(this.releases[e]=!0));this.toggles[e]!==t&&(n=!0),this.enablePresss(e,t,n,i),this.updateButtons[e]=!0,this.isUpdateButton=!0}else{for(const e in this.keys)this.keys[e]=0;for(const e in this.presss)this.presss[e]=0;for(const e in this.releases)this.enablePresss(e,!1,!1,i),delete this.releases[e];for(const e in this.updateButtons)delete this.updateButtons[e]}})),r.cursor(((e,t)=>{if(this.hasRun()&&-1===this.how_to_play&&!this.loading){const n=1-(this.setting.hasCRT()?this.setting.getCRTDeep()/2:0),i=this.setting.getCRTDeep()*this.setting.getCRTLens(),s=2*(t-.5)/n+(this.setting.hasCRT()?(1-Math.abs(Math.cos(e*(Math.PI/4))))*(1-Math.abs(t))*i:0);let o=-1,a=0;this.getMenus().forEach(((e,t)=>{if(!(e instanceof lp))return void a--;const n=.125*t+.05-.125;s>n&&s<n+.1&&(o=t+a,this.menuPoints[0]!==o&&this.getMenus()[t]instanceof lp&&(this.isFocusAjastMenu=this.getMenus()[t].hasAjastMouseWheel(),this.createSound("./asset/sound/menu/move.mp3",null,"menu").play()))})),this.menuPoints.length>1&&(this.menuPoints[0]=o)}}))}getFramerate(){return this.setting.getFramerate()}menuUp(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const n=this.menuPoints[0];this.menuPoints[0]--;let i=!0;this.menuPoints[0]<0&&(t?this.menuPoints[0]=e.length-1:(this.menuPoints[0]=0,i=!1)),i&&n!==this.menuPoints[0]&&this.createSound("./asset/sound/menu/move.mp3",null,"menu").play()}menuDown(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const n=this.menuPoints[0];this.menuPoints[0]++;let i=!0;this.menuPoints[0]>e.length-1&&(t?this.menuPoints[0]=0:(this.menuPoints[0]=e.length-1,i=!1)),i&&n!==this.menuPoints[0]&&this.createSound("./asset/sound/menu/move.mp3",null,"menu").play()}menuRight(){-1!==this.how_to_play?(this.how_to_play++,this.how_to_play>=mp.length&&(this.how_to_play=mp.length-1)):-1!==this.how_to_play||this.loading||-1===this.menuPoints[0]||this.activeMenu(1)}menuLeft(){-1!==this.how_to_play?(this.how_to_play--,this.how_to_play<0&&(this.how_to_play=0)):-1!==this.how_to_play||this.loading||-1===this.menuPoints[0]||this.activeMenu(-1)}enablePresss(e,t,n,i){const s=this.getTouchMenus();if(hp){if(t&&n){if(0!==e.indexOf("keyboard_")&&0!==e.indexOf("mouse_")||"pc"!==cp||"keyboard_escape"===e){if(0===e.indexOf("gamepad_")&&"gamepad"===cp&&"gamepad_start"!==e&&"gamepad_select"!==e){for(const t in this.keyconfig){const n=this.keyconfig[t];n.includes(e)&&n.splice(n.indexOf(e))}if(null!==pp&&this.keyconfig.hasOwnProperty(pp)){const t=this.keyconfig[pp].filter((e=>!e.includes("gamepad")));t.push(e),this.keyconfig[pp]=t}}}else{for(const t in this.keyconfig){const n=this.keyconfig[t];n.includes(e)&&n.splice(n.indexOf(e))}if(null!==pp&&this.keyconfig.hasOwnProperty(pp)){const t=this.keyconfig[pp].filter((e=>!e.includes("keyboard")&&!e.includes("mouse")));t.push(e),this.keyconfig[pp]=t}}hp=!1,pp=null,fa("keyconfig")}}else switch(e){case"mouse_left":if(-1!==this.how_to_play&&t&&n){this.how_to_play++,this.how_to_play>=mp.length&&(this.how_to_play=0);break}case"touchpad_a":case"gamepad_a":case"keyboard_enter":-1===this.how_to_play&&t&&n&&-1!==this.menuPoints[0]&&this.activeMenu(0);break;case"mouse_right":case"touchpad_b":case"gamepad_b":case"keyboard_escape":t&&n&&(-1!==this.how_to_play?this.how_to_play=-1:-1===this.how_to_play&&this.menus.length>1&&this.cancelMenu(!1,!0));break;case"touchpad_right":case"gamepad_right":case"keyboard_right_arrow":t&&n?(this.menuRight(),this.rightTime=i,this.rightID=setInterval((()=>{const e=performance.now()-this.rightTime;if(this.hasRun()||clearInterval(this.rightID),-1!==this.rightTime&&e>500){const t=e-e%100;t!==this.rightInterval&&this.menuRight(),this.rightInterval=t}}))):(this.rightTime=-1,this.rightInterval=-1,clearInterval(this.rightID));break;case"mouse_wheel_up":t&&n&&this.menuRight();break;case"touchpad_left":case"gamepad_left":case"keyboard_left_arrow":t&&n?(this.menuLeft(),this.leftTime=i,this.leftID=setInterval((()=>{const e=performance.now()-this.leftTime;if(this.hasRun()||clearInterval(this.leftID),-1!==this.leftTime&&e>500){const t=e-e%100;t!==this.leftInterval&&this.menuLeft(),this.leftInterval=t}}))):(this.leftTime=-1,this.leftInterval=-1,clearInterval(this.leftID));break;case"mouse_wheel_down":t&&n&&this.menuLeft();break;case"touchpad_up":case"gamepad_up":case"keyboard_up_arrow":-1===this.how_to_play&&t&&n?(this.menuUp(s),this.upTime=i,this.upID=setInterval((()=>{const e=performance.now()-this.upTime;if(this.hasRun()||clearInterval(this.upID),-1!==this.upTime&&e>500){const t=e-e%100;t!==this.upInterval&&this.menuUp(s,!1),this.upInterval=t}}))):(this.upTime=-1,this.upInterval=-1,clearInterval(this.upID));break;case"touchpad_down":case"gamepad_down":case"keyboard_down_arrow":-1===this.how_to_play&&t&&n?(this.menuDown(s),this.downTime=i,this.downID=setInterval((()=>{const e=performance.now()-this.downTime;if(this.hasRun()||clearInterval(this.downID),-1!==this.downTime&&e>500){const t=e-e%100;t!==this.downInterval&&this.menuDown(s,!1),this.downInterval=t}}))):(this.downTime=-1,this.downInterval=-1,clearInterval(this.downID))}}getMenus(){return(this.menus[0]||[]).filter((e=>e.hasVisible(this)))}getTouchMenus(){return(this.menus[0]||[]).filter((e=>e instanceof lp&&e.hasVisible(this)))}pushMenus(e){this.titles.unshift(e);for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];this.menus.unshift(n),this.menuPoints.unshift(0),this.isFocusAjastMenu=this.getMenus()[this.menuPoints[0]].hasAjastMouseWheel()}async activeMenu(e){const t=this.getTouchMenus()[this.menuPoints[0]];if(t instanceof lp&&await t.execute(this,e))switch(e){case 0:this.createSound("./asset/sound/menu/press.mp3",null,"menu").play();break;case 1:case-1:this.createSound("./asset/sound/menu/scroll.mp3",null,"menu").play()}}cancelMenu(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;for(let e=0;e<n;e++)this.menuPoints.shift(),this.titles.shift(),this.menus.shift();e&&(this.menuPoints[0]=0),t&&this.createSound("./asset/sound/menu/cancel.mp3",null,"menu").play(),this.isFocusAjastMenu=this.getMenus()[this.menuPoints[0]].hasAjastMouseWheel()}hasDemo(){return this.isDemo}createTransferUIData(){if(-1!==this.how_to_play)return[new Di("background","rgba(0,0,0,0.5)",!0,0,0,0,10,10,0,0),new Hi("howtoplay","./asset/how_to_play_".concat(mp[this.how_to_play],".png"),0,0,1,1)];{let e=0;return[new Di("background","rgba(0,0,0,0.5)",!0,0,0,0,10,10,0,0),new Hi("title",this.hasDemo()?"./asset/title-demo.png":"./asset/title-prod.png",0,-.5,2,2),new Fi("menu-title","./asset/font.png",5,5,di,this.titles[0]||"",-.9,-.125,2,1,0,1,[1,1,1]),...this.getMenus().map(((t,n)=>t instanceof lp?t.hasValue()?[new Fi("menu-sub-name","./asset/font.png",5,5,di,t.getName(this),-.9,.125*n,1,1,0,1,n-e===this.menuPoints[0]?[1,1,1]:[1,0,0]),new Fi("menu-sub-value","./asset/font.png",5,5,di,t.getValue(this)||"",.9,.125*n,1,-1,0,1,n-e===this.menuPoints[0]?[1,1,1]:[1,0,0]),"keyboard"===this.getControlManager().getInputType()&&n-e===this.menuPoints[0]&&this.isFocusAjastMenu?new Fi("font","./asset/font.png",5,5,di,"Adjust mouse wheel",.95,.125*n,1,1,0,1,[1,0,0]):null]:new Fi("menu-sub","./asset/font.png",5,5,di,t.getName(this),0,.125*n,1,0,0,1,n-e===this.menuPoints[0]?[1,1,1]:[1,0,0]):(e++,new Fi("menu-sub-text","./asset/font.png",5,5,di,t.getValue(this)||"",0,.125*n,1,0,0,1,[1,1,1])))),this.menus.length<=1?new Fi("font","./asset/font.png",5,5,di,"(c) 2022 latel88",-1,.9,1,1,-1,1,[1,1,1]):null,this.menus.length<=1?new Fi("font","./asset/font.png",5,5,di,"ver ".concat(fh),1,.9,1,-1,-1,1,[1,1,1]):null]}}onupdateend(){const e=performance.now();this.isUpdateButton=!1;for(const e in this.keys)this.presss[e]=this.keys[e];for(const t in this.releases)this.enablePresss(t,!1,!1,e),delete this.releases[t];for(const e in this.updateButtons)delete this.updateButtons[e]}async onactive(e){this.getSoundManager().setVolume(this.setting.getVolume()),await Da(),f()||await Ta()}}class yp{constructor(){this.size=new E(0,0)}getSize(){return[this.size.x,this.size.y]}applyData(e){this.size.x=e.size.width,this.size.y=e.size.height}}class wp{constructor(e,t){this.axess=new Array,this.presss=new Array,this.cursors=new Array,this.edits=new Array,this.isClear=!1,this.isStick=!1,this.isPointerLockPoint=!1,this.inputType="none",this.channel=e,this.keyconfig=t,this.channel.addEventListener("message",(e=>{const{data:t}=e;if(t instanceof Object){switch(t.method){case"press":this.firePress(t.name,t.press);break;case"axes":this.fireAxes(t.name,t.x,t.y);break;case"cursor":this.fireCursor(t.x,t.y);break;case"editor":this.fireEditor(t.name)}t.inputType&&(this.inputType=t.inputType)}}))}initKeyConfig(e){for(const t in e)this.keyconfig.hasOwnProperty(t)||(this.keyconfig[t]=e[t])}axes(e){-1===this.axess.indexOf(e)&&this.axess.push(e)}press(e){-1===this.presss.indexOf(e)&&this.presss.push(e)}editor(e){-1===this.edits.indexOf(e)&&this.edits.push(e)}firePress(e,t){this.presss.forEach((n=>n(e,t)))}fireAxes(e,t,n){this.axess.forEach((i=>i(e,t,n)))}fireCursor(e,t){this.cursors.forEach((n=>n(e,t)))}fireEditor(e){this.edits.forEach((t=>t(e)))}cursor(e){-1===this.cursors.indexOf(e)&&this.cursors.push(e)}getInputType(){return this.inputType}getKey(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.getInputType();var n,i,s,o;return(null===(i=null===(n=this.keyconfig[e])||void 0===n?void 0:n.find((e=>0===e.indexOf(t))))||void 0===i?void 0:i.replace(new RegExp("^".concat(t,"_"),"g"),""))||("keyboard"===t?"mouse ".concat(null===(o=null===(s=this.keyconfig[e])||void 0===s?void 0:s.find((e=>0===e.indexOf("mouse"))))||void 0===o?void 0:o.replace(new RegExp("^mouse_","g"),"")):null)}hasKey(e,t){return this.keyconfig.hasOwnProperty(e)&&this.keyconfig[e].includes(t)}hasPointerLockPoint(){return this.isPointerLockPoint}hasClear(){return this.isClear}hasStick(){return this.isStick}clear(){this.isClear=!0}changeStick(e,t){this.channel.postMessage({method:"stick",name:e,value:t}),this.isStick=t}createTransferData(){const e={isClear:this.hasClear()};return this.isClear=!1,e}}class xp{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.isInit=!1,this.isPlay=!1,this.isLoop=!1,this.volume=1,this.speed=1,this.oscillatorType=null,this.vibratoSpeed=0,this.vibratoDepth=0,this.isLive=!0,this.id=e,this.src=t,this.target=n}getID(){return this.id}play(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.isPlay=!0,this.isLoop=e}pause(){this.isPlay=!1}stop(){this.isLive=!1}hasLive(){return this.isLive}hasInit(){return this.isInit}setVolume(e){return this.volume=e,this}getVolume(){return this.volume}setSpeed(e){return this.speed=e,this}setTarget(e){return this.target=e,this}setOscillatorType(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"sine";return this.oscillatorType=e,this}setVibratoSpeed(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.vibratoSpeed=e,this}setVibratoDepth(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.vibratoDepth=e,this}createTransferData(){const e={id:this.id,src:this.src,init:this.isInit,target:null===this.target?null:{x:this.target.position.x,y:this.target.position.y,z:this.target.position.z},isPlay:this.isPlay,isLoop:this.isLoop,volume:this.volume,speed:this.speed,oscillatorType:this.oscillatorType,vibratoSpeed:this.vibratoSpeed,vibratoDepth:this.vibratoDepth};return this.isInit=!0,e}}class Mp{constructor(){this.stacks={},this.sounds={},this.volume=1}hasSound(e){return this.stacks.hasOwnProperty(e)||this.sounds.hasOwnProperty(e)}getSound(e){return this.stacks[e]||this.sounds[e]}getVolume(){return this.volume}setVolume(e){this.volume=e}create(e,t,n){const i=new xp(n,e,t);return this.stacks[n]=i,i}clear(){for(const e in this.sounds)delete this.sounds[e]}createTransferData(e,t,n){const i={};for(const e in this.stacks){const t=this.stacks[e];t.hasLive()&&(this.sounds.hasOwnProperty(e)&&this.sounds[e].stop(),this.sounds[e]=t),delete this.stacks[e]}for(const e in this.sounds){const t=this.sounds[e];t.hasLive()?i[e]=t.createTransferData():delete this.sounds[e]}return{sceneName:n.getName(),center:{direction:{x:e.x,y:e.y},position:{x:t.x,y:t.y,z:t.z}},volume:this.getVolume(),speed:n.getSpeed(),sounds:i}}applyData(e){const t=e.lives.map((e=>this.sounds[e])).filter((e=>!!e&&e.hasLive()));for(const e in this.sounds)t.includes(this.sounds[e])||delete this.sounds[e]}}class Ep{constructor(){this.assets={},this.isUpdate=!0}getBufferLocation(e,t){const n=this.assets.hasOwnProperty(e)?this.assets[e]:null;if(null===n)return 0;const i=void 0!==n.locations[t]&&n.locations[t][0]||null;return null===i?0:i.id}checkUpdate(){const{isUpdate:e}=this;return this.isUpdate=!1,e}applyData(e){this.isUpdate=this.isUpdate||e.isUpdate;for(const t in e.assets)this.assets[t]=e.assets[t]}}!function(e,t){let n=null,s=!0,o=!0,a=!0,r=!0,l=!1,h=0,p=null,c=null;function d(){if(null===n)return;const[e,t]=n.createTransferRenderData(!0,s);var i;p?p.postMessage({method:"transfer-render",data:e},t):sn({method:"transfer-render",data:e},t),i=h,fn("framerate","framerate:".concat(Math.floor(i))),pn?an.postMessage({method:"enable"}):an.postMessage({method:"disable"}),cn||!Xe()?an.postMessage({method:"stop"}):hn.length>0&&(an.postMessage({method:"log",messages:hn}),me(hn))}function u(e){if(null===n)return;l?(d(),s=!1,l=!1,r=!1):(l=!1,r=!0);const t=e.render;n.applyRenderData(t);const i=e.update;null!==i&&n.applyUpdateData(i),h=e.fps}addEventListener("message",(h=>{const{data:m}=h;if(m instanceof Object)switch(m.method){case"init":p=m.paintChannel,c=m.controlChannel,null!==p&&(p.addEventListener("message",(e=>{const{data:t}=e;if(t instanceof Object&&"apply-render-data"===t.method)u(t)})),p.start()),null!==c&&c.start(),async function(e){n=new t(await ga("setting"),await ga("keyconfig"),await ga("save-data"),await ga("editor-data"),await ga("horde-loadout"),c,e.maxTextureSize),n.getScenes().forEach((e=>{new i(e,"updateend").on((()=>{if(null!==n){if(r?(d(),s=!1,r=!1,l=!1):(r=!1,l=!0),o){const e=n.createTransferUpdateData();sn({method:"transfer-update",data:e},[]),o=!1}else e.updateDefault();if(a){const e=n.createTransferSoundData();sn({method:"transfer-sound",data:e},[]),a=!1}else e.updateDefault()}}))})),new i(n,"active").on((()=>{s=!0})),new i(n,"error").on((()=>{sn({method:"error"},[])})),sn({method:"ready"},[])}(m.data);break;case"start":ga("setting").then((t=>{new zh(t).hasDebugLog()?dn():un(),null!==n&&(n.activeScene(e,!0),n.run())}));break;case"apply-render-data":u(m);break;case"apply-update-data":o=!0;break;case"apply-sound-data":null!==n&&n.applySoundData(m.data),a=!0}}));let m=null;rn.addEventListener("message",(e=>{var t,i,s,o,a;const{data:r}=e;if(r instanceof Object)switch(r.method){case"sleep":null!==n&&(m=n.getActiveSceneName(),"string"==typeof r.scene&&n.activeScene(r.scene),null===(t=n.getActiveScene())||void 0===t||t.sleep(),"string"==typeof r.scene&&Da());break;case"unsleep":null!==n&&null!==m&&(n.activeScene(n.getActiveSceneName()||m,!0),null===(i=n.getScene(m))||void 0===i||i.unsleep(),m=null,"string"==typeof r.scene&&Da());break;case"run":null!==n&&(null===(s=n.getActiveScene())||void 0===s||s.run());break;case"stop":null!==n&&(null===(o=n.getActiveScene())||void 0===o||o.stop());break;case"pause":null!==n&&n.activeScene("title");break;case"error":null!==n&&(null===(a=n.getActiveScene())||void 0===a||a.error());break;case"apply-render-data":u(r)}})),sn({method:"standby"},[])}("title",class extends Pi{constructor(t,n,i,s,o,a,r){super();const l=new e(Object.values(oi)),h=new Ii,p=new Ii,c=new yp,d=new Ep,u=new wp(a,n),m=new Mp,g=new fp("title",t,n,o,this,c,d,u,m,!0),f=new Gh("practice",r,t,n,this,c,d,u,m,l,p,{}),y=new Gh("game",r,t,n,this,c,d,u,m,l,h,i);y.setMaterials(oi),f.setMaterials(oi),this.addScenes(g,y,f)}})})()})();